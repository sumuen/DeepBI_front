!function(e){function t(t){for(var r,i,l=t[0],s=t[1],c=t[2],d=0,m=[];d<l.length;d++)i=l[d],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&m.push(n[i][0]),n[i]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);for(u&&u(t);m.length;)m.shift()();return o.push.apply(o,c||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],r=!0,l=1;l<a.length;l++){var s=a[l];0!==n[s]&&(r=!1)}r&&(o.splice(t--,1),e=i(i.s=a[0]))}return e}var r={},n={0:0},o=[];function i(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.e=function(e){var t=[],a=n[e];if(0!==a)if(a)t.push(a[2]);else{var r=new Promise((function(t,r){a=n[e]=[t,r]}));t.push(a[2]=r);var o,l=document.createElement("script");l.charset="utf-8",l.timeout=120,i.nc&&l.setAttribute("nonce",i.nc),l.src=function(e){return i.p+""+({}[e]||e)+".js"}(e);var s=new Error;o=function(t){l.onerror=l.onload=null,clearTimeout(c);var a=n[e];if(0!==a){if(a){var r=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;s.message="Loading chunk "+e+" failed.\n("+r+": "+o+")",s.name="ChunkLoadError",s.type=r,s.request=o,a[1](s)}n[e]=void 0}};var c=setTimeout((function(){o({type:"timeout",target:l})}),12e4);l.onerror=l.onload=o,document.head.appendChild(l)}return Promise.all(t)},i.m=e,i.c=r,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(a,r,function(t){return e[t]}.bind(null,r));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/static/",i.oe=function(e){throw console.error(e),e};var l=window.webpackJsonp=window.webpackJsonp||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=s;o.push([739,2]),a()}(Array(105).concat([function(e,t,a){e.exports=a.p+"images/icon_small.png"},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){e.exports=a.p+"images/dashboard-example/dashboards_prettify_1.jpg"},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){},,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){e.exports=a.p+"images/dashboard-example/dashboards_prettify_2.jpg"},function(e,t,a){e.exports=a.p+"images/dashboard-example/dashboards_prettify_3.jpg"},,,function(e,t,a){e.exports=a.p+"images/db-logos/csv.png"},,,function(e){e.exports=JSON.parse('"dev"')},,,,,,,,,,,function(e,t,a){e.exports=a.p+"images/avatar.svg"},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){},,,,,,,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){e.exports=a.p+"images/copy.png"},function(e,t,a){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){e.exports="# DeepBI 使用说明\n\n\n## 1，配置 API KEY\n\n- [设置]-[API KEY]\n\n### 1.1, 关于 OPENAI API KEY:\n\n- API KEY 需要 OPENAI GPT4 模型的访问权限\n- 后续会陆续支持其他大模型，敬请期待\n\n### 1.2, 关于 代理:\n\n- OPENAI API 访问可能需要科学上网,请小伙伴们自行配置代理\n\n- KEY和代理配置完毕后，配置完毕后，点击【连接测试】，显示 测试通过 即可。\n测试不通过的情况，请自行检查 API KEY是否可用，以及代理是否配置正确。\n\n![doc_0.png](/static/images/cn/img/doc_0.png)\n\n### 1.3, 关于 DeepInsight API KEY:\n- 可以点击 设置key 下面的连接，进行注册，获取API Key.(可以加我们微信群(首页联系我们)，申请免费的Token)\n\n![doc_0.png](/static/images/cn/img/us_key.png)\n\n## 2, 配置 数据源\n\n- 目前支持的数据源有， MySql，Doris, starRocks, PostgreSql, 和 CSV\n- 后续会陆续支持更多数据源，如sqlserver，clickhouse，SQLite等，敬请期待\n\n### 2.1, CSV数据源配置:\n\n- 【设置】-【CSV数据源】-【点击上传】- 选择需上传的csv文件即可\n\n![doc.png](/static/images/cn/img/doc_1.png)\n\n### 2.2, [MySql，Doris, starRocks, PostgreSql] 数据源配置:\n\n- 【设置】-【数据源】-【新建一个数据源】\n- 选择数据源，填写数据库信息，并保存\n- 配置完毕后，点击【连接测试】，显示 连接成功 即可\n\n![doc.png](/static/images/cn/img/doc_2.png)\n\n![doc.png](/static/images/cn/img/doc_3.png)\n\n## 3, 数据分析\n\n### 3.1, [数据分析] - [对话]\n\n#### 3.1.1. 勾选数据（数据源和表）\n\n- 勾选的数据会作为对话数据分析中AI的基础数据\n\n#### 3.1.2, 填写注释，提交AI检测\n\n- 尽量完善表格和字段注释，协助AI更好的理解这些数据，使Agent更好的完成数据分析任务\n\n![doc.png](/static/images/cn/img/doc_4.png)\n\n#### 3.1.3, 修改未通过的注释，再次提交\n\n- AI会反馈未通过的注释，请修改补充后，再次提交，直到所有注释通过检测\n\n![doc.png](/static/images/cn/img/doc_5.png)\n\n#### 3.1.4, 所有注释检测通过后，开始对话\n\n- 🔥 注: 若要生成持久化报表，请使用【报表】-【报表生成】，数据分析中出现的报表均为临时报表，不支持持久化\n\n![doc.png](/static/images/cn/img/doc_6.png)\n\n#### 3.1.5, 重选数据源\n\n- 若要重选数据源，进行新一轮对话，请点击【新对话】，重置当前对话，当前对话记录会存储进【历史对话】中\n\n![doc.png](/static/images/cn/img/doc_7.png)\n\n### 3.2, 【数据分析】-【历史对话】\n- 可查看历史对话记录\n\n![doc.png](/static/images/cn/img/doc_8.png)\n\n## 4, 报表 \n\n### 4.1,【报表】-【报表生成】\n\n#### 4.1.1. Check the data (data source and table)\n\n- 勾选的数据会作为报表生成中AI的基础数据\n- 🔥注: 目前CSV数据源不支持【报表生成】\n\n#### 4.1.2, 填写注释，提交AI检测\n\n- 尽量完善表格和字段注释，协助AI更好的理解这些数据，使Agent更好的完成报表生成任务\n\n![doc.png](/static/images/cn/img/doc_9.png)\n\n#### 4.1.3, 修改未通过的注释，再次提交\n\n- AI会反馈未通过的注释，请修改补充后，再次提交, 直到所有注释检测通过\n\n![doc.png](/static/images/cn/img/doc_10.png)\n\n#### 4.1.4, 所有注释检测通过后，开始对话生成报表\n\n- 点击【编辑报表】，可直接编辑 新生成的报表.\n- 🔥 注: 【报表生成】模块目前仅支持持久化报表生成任务，分析类问题，请使用【数据分析】-【对话】\n\n![doc.png](/static/images/cn/img/doc_11.png)\n\n#### 4.1.5, 重选数据源\n\n- 若要重选数据源，进行新一轮对话，请点击【新对话】，重置当前对话\n\n![doc.png](/static/images/cn/img/doc_12.png)\n\n### 4.2, 【报表】-【报表列表】\n\n#### 4.2.1, 报表状态\n\n- 【报表生成】中新生成的报表会出现在【报表列表】中，此时报表为 草稿 状态，若想要在【仪表盘】展示该报表，请点击 【发布】 按钮，将报表状态变更为 已发布 状态\n\n![doc.png](/static/images/cn/img/doc_13.png)\n\n![doc.png](/static/images/cn/img/doc_14.png)\n\n#### 4.2.2, 修改SQL语句\n\n- 点击【编辑源】，可自定义修改报表的SQL语句.\n\n![doc.png](/static/images/cn/img/doc_15.png)\n\n#### 4.2.3, 修改图表样式\n\n- 点击【编辑可视化】，可自定义编辑 可视化图表样式\n- 点击【新增可视化】，可增加可视化图表\n\n![doc.png](/static/images/cn/img/doc_16.png)\n\n![doc.png](/static/images/cn/img/doc_17.png)\n\n#### 4.2.4, 删除报表\n\n- 点击【归档】，可将报表状态变更为 归档（删除）状态\n\n![doc.png](/static/images/cn/img/doc_18.png)\n\n### 5, 仪表盘\n\n#### 5.1, 新建仪表盘\n\n- 【仪表盘】-【新建】- 编辑仪表盘\n\n![doc.png](/static/images/cn/img/doc_19.png)\n\n- 将刚生成的【已发布 】报表，添加进仪表盘\n\n![doc.png](/static/images/cn/img/doc_20.png)\n\n- 点击【发布】仪表盘\n\n![doc.png](/static/images/cn/img/doc_21.png)\n\n#### 5.1.2 分享仪表盘 \n\n- 点击【发布】后，即可分享仪表盘\n\n![doc.png](/static/images/cn/img/doc_22.png)\n\n#### 5.2 仪表盘美化\n- 选中一个已经存在的仪表盘\n![doc.png](/static/images/cn/img/doc_22_1.png)\n- 点击进入\n![doc.png](/static/images/cn/img/doc_22_2.png)\n- 选择模板，点击应用\n![doc.png](/static/images/cn/img/doc_22_3.png)\n- 进入美化大屏，等待AI自动转换完成\n![doc.png](/static/images/cn/img/doc_22_4.png)\n![doc.png](/static/images/cn/img/doc_22_5.png)\n- 转换完成\n![doc.png](/static/images/cn/img/doc_22_6.png)\n- 点击查看大屏\n![doc.png](/static/images/cn/img/doc_22_7.png)\n\n## 6, 自动数据分析 \n\n#### 6.1 添加分析任务 \n1. 点击自动数据分析\n2. 选择自动数据分析\n3. 点击下拉框\n4. 选择数据源\n\n![doc.png](/static/images/cn/img/doc_23.png)\n\n#### 6.2 确认报告所需表  \n1. 选择数据表备注表字段信息\n2. 选择报告使用的表，可以选择多个表\n3. 备注表字段信息\n4. 然后提交\n\n![doc.png](/static/images/cn/img/doc_25.png)\n\n#### 6.3 等待报告完成  \n1. 历史分析，查看报告状态\n\n![doc.png](/static/images/cn/img/doc_26.png)\n\n2. 自动更改为生成中\n![doc.png](/static/images/cn/img/doc_27.png)\n\n4. 当状态更换为成功时\n![doc.png](/static/images/cn/img/doc_28.png)\n\n6. 查看报告详情\n![doc.png](/static/images/cn/img/doc_29.png)\n"},function(e,t){e.exports='# DeepBI User Manual\n\n## 1，Configure API KEY\n\n- [Setting]-[API KEY]\n\n### 1.1, About OPENAI API KEY:\n\n- Requires access to gpt4 models.\n- Other large models will be supported in the future, so stay tuned.\n\n### 1.2, About the proxy:\n\n- OPENAI API access may require proxy configuration, please configure the proxy yourself.\n\n- After the KEY and proxy are configured, click [Connection Test] and "Test success" will be displayed. If the test\n  fails, please check whether the API KEY is available and whether the proxy is configured correctly.\n\n![doc_0.png](/static/images/en/img/doc_0.png)\n\n### 1.3, About DeepInsight API KEY:\n- You can click the connection below the set key to register and get the API Key.(You can add our wechat group (contact us on the home page) to apply for a free Token.)\n\n![doc_0.png](/static/images/en/img/us_key.png)\n\n## 2,Configure Data Source\n\n- Currently supported data sources are MySql, Doris, starRocks, PostgreSql, and CSV. More data sources will be supported\n  in the future, such as sqlserver, clickhouse, SQLite, etc., so stay tuned.\n\n### 2.1, CSV data source configure:\n\n- [Setting]-[CSV Data Source]-[Click to upload]-select the csv file to be uploaded\n\n![doc.png](/static/images/en/img/doc_1.png)\n\n### 2.2, [MySql, Doris, starRocks, PostgreSql] data source configure:\n\n- [Setting]-[Data Sources]-[New Data Source]\n- Select the data source, fill in the database information, and save. After the configuration is completed,\n  click [Test Connection ] and "Connection Success" will be displayed.\n\n![doc.png](/static/images/en/img/doc_2.png)\n\n![doc.png](/static/images/en/img/doc_3.png)\n\n## 3,Chat Builder\n\n### 3.1, [Chat Builder] - [Dialogue]\n\n#### 3.1.1. Check the data (data source and table)\n\n- The checked data will be used as the basic data for AI in conversation data analysis.\n\n#### 3.1.2, fill in the comments and submit for AI detection\n\n- Try to improve the form and field annotations as much as possible to help AI better understand the data and enable the\n  Agent to better complete the data analysis task.\n\n![doc.png](/static/images/en/img/doc_4.png)\n\n#### 3.1.3, modify the failed comments and submit again\n\n- AI will feedback the comments that have not passed. Please revise and add them and submit again until all the comments\n  pass.\n\n![doc.png](/static/images/en/img/doc_5.png)\n\n#### 3.1.4, after all annotations pass the detection, start the conversation\n\n- 🔥 Note: If you want to generate a persistent report, please use [Query Builder]-[Report Generation]. The reports that\n  appear in [Chat Builder] are temporary reports and do not support persistence.\n\n![doc.png](/static/images/en/img/doc_6.png)\n\n#### 3.1.5, reselect data source\n\n- If you want to reselect the data source and start a new round of dialogue, please click [New Dialogue] to reset the\n  current conversation. The current conversation record will be stored in [History Dialogue].\n\n![doc.png](/static/images/en/img/doc_7.png)\n\n### 3.2, [Chat Builder] - [History Dialogue]\nCan view historical conversation records\n\n![doc.png](/static/images/en/img/doc_8.png)\n\n## 4, Query Builder \n\n### 4.1, [Query Builder]-[Report Generation]\n\n#### 4.1.1. Check the data (data source and table)\n\n- The checked data will be used as the basic data of AI in report generation.\n- 🔥Note: Currently the CSV data source does\n  not support [Report Generation]\n\n#### 4.1.2, fill in the comments and submit for AI detection\n\n- Try to improve the form and field annotations as much as possible to help AI better understand the data and enable the\n  Agent to better complete the report generation task.\n\n![doc.png](/static/images/en/img/doc_9.png)\n\n#### 4.1.3, modify the failed comments and submit again\n\n- AI will feedback the annotations that have failed. Please revise and add them and submit again until all annotations\n  pass the test.\n\n![doc.png](/static/images/en/img/doc_10.png)\n\n#### 4.1.4, after all annotations pass the detection, start the dialogue to generate reports\n\n- Click [Edit Report] to directly edit the newly generated report.\n- 🔥 Note: The [Report Generation] module currently only supports persistent report generation tasks. For analysis\n  questions, please use [Chat Builder] - [Dialogue].\n\n![doc.png](/static/images/en/img/doc_11.png)\n\n#### 4.1.5, reselect data source\n\n- If you want to reselect the data source and start a new round of dialogue, please click [New Dialogue] to reset the current dialogue.\n\n![doc.png](/static/images/en/img/doc_12.png)\n\n### 4.2, [Query]-[Report List]\n\n#### 4.2.1, Report status\n\n- The newly generated report in [Report Generation] will appear in the [Report List]. At this time, the report is in\n  draft status. If you want to display the report in the [Dashboards], please click the [Publish] button, change report\n  status to published status.\n\n![doc.png](/static/images/en/img/doc_13.png)\n\n![doc.png](/static/images/en/img/doc_14.png)\n\n#### 4.2.2, Modify SQL statement\n\n- Click [Edit Source] to customize the SQL statement of the report.\n\n![doc.png](/static/images/en/img/doc_15.png)\n\n#### 4.2.3, modify chart style\n\n- Click [Edit Visualization] to customize and edit the visualization chart style.\n- Click [Add Visualization] to add a visual chart.\n\n![doc.png](/static/images/en/img/doc_16.png)\n\n![doc.png](/static/images/en/img/doc_17.png)\n\n#### 4.2.4. Deleting a report\n\n- Click [Archive] to change the report status to archive (delete) status.\n\n![doc.png](/static/images/en/img/doc_18.png)\n\n### 5, Dashboards\n\n#### 5.1, create a new dashboard\n\n- [Dashboards]-[Create]-Edit Dashboard\n\n![doc.png](/static/images/en/img/doc_19.png)\n\n- Add the newly generated Published report to the dashboard\n\n![doc.png](/static/images/en/img/doc_20.png)\n\n- Click [Publish] Dashboard\n\n![doc.png](/static/images/en/img/doc_21.png)\n\n#### 5.1.2 Share Dashboard \n\n- After clicking [Publish], you can share the dashboard\n\n![doc.png](/static/images/en/img/doc_22.png)\n\n#### 5.2 Dashboards Prettify\n- Select an existing dashboard\n![doc.png](/static/images/en/img/doc_22_1.png)\n- Click to enter\n![doc.png](/static/images/en/img/doc_22_2.png)\n- Select the template and click Apply\n![doc.png](/static/images/en/img/doc_22_3.png)\n- Enter the beautification screen and wait for the AI automatic conversion to complete\n![doc.png](/static/images/en/img/doc_22_4.png)\n![doc.png](/static/images/en/img/doc_22_5.png)\n- Conversion complete\n![doc.png](/static/images/en/img/doc_22_6.png)\n- Click to view large screen\n![doc.png](/static/images/en/img/doc_22_7.png)\n\n## 6. Automatic Data Analysis\n\n#### 6.1 Add Analysis Task\n1. Click on Automatic Data Analysis.\n2. Choose Automatic Data Analysis.\n3. Click on the dropdown.\n4. Select the data source.\n\n![doc.png](/static/images/en/img/doc_23.png)\n\n#### 6.2 Confirm Required Tables for the Report\n1. Select table remarks and field information.\n2. Choose the tables to be used in the report; multiple tables can be selected.\n3. Provide remarks for table fields.\n4. Submit.\n\n![doc.png](/static/images/en/img/doc_25.png)\n\n#### 6.3 Wait for Report Completion\n1. In historical analysis, check the report status.\n\n![doc.png](/static/images/en/img/doc_26.png)\n2. Automatically changes to generating.\n\n![doc.png](/static/images/en/img/doc_27.png)\n3. When the status changes to successful.\n\n![doc.png](/static/images/en/img/doc_28.png)\n4. View the report details.\n\n![doc.png](/static/images/en/img/doc_29.png)\n\n\n\n'},,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){e.exports=a.p+"data/0962607.countries.geo.json"},function(e,t,a){e.exports=a.p+"data/eed73d1.usa-albers.geo.json"},function(e,t,a){e.exports=a.p+"data/dac34f3.japan.prefectures.geo.json"},function(e,t,a){e.exports=a.p+"data/47283ba.china.geo.json"},function(e,t,a){e.exports=a.p+"data/9301351.110000.geo.json"},function(e,t,a){e.exports=a.p+"data/0e6cd79.120000.geo.json"},function(e,t,a){e.exports=a.p+"data/45c8689.130000.geo.json"},function(e,t,a){e.exports=a.p+"data/0f3fc7b.140000.geo.json"},function(e,t,a){e.exports=a.p+"data/12c7237.150000.geo.json"},function(e,t,a){e.exports=a.p+"data/867ad03.210000.geo.json"},function(e,t,a){e.exports=a.p+"data/06a8c43.220000.geo.json"},function(e,t,a){e.exports=a.p+"data/b80aa15.230000.geo.json"},function(e,t,a){e.exports=a.p+"data/01e841f.310000.geo.json"},function(e,t,a){e.exports=a.p+"data/5cf6597.320000.geo.json"},function(e,t,a){e.exports=a.p+"data/44e6ca4.330000.geo.json"},function(e,t,a){e.exports=a.p+"data/c4a8143.340000.geo.json"},function(e,t,a){e.exports=a.p+"data/cc485e1.350000.geo.json"},function(e,t,a){e.exports=a.p+"data/93d9fa4.360000.geo.json"},function(e,t,a){e.exports=a.p+"data/9d7f18d.370000.geo.json"},function(e,t,a){e.exports=a.p+"data/72348fa.410000.geo.json"},function(e,t,a){e.exports=a.p+"data/33f1433.420000.geo.json"},function(e,t,a){e.exports=a.p+"data/937ee66.430000.geo.json"},function(e,t,a){e.exports=a.p+"data/fb5171d.440000.geo.json"},function(e,t,a){e.exports=a.p+"data/aa99dac.450000.geo.json"},function(e,t,a){e.exports=a.p+"data/5794562.460000.geo.json"},function(e,t,a){e.exports=a.p+"data/1cdd0ff.500000.geo.json"},function(e,t,a){e.exports=a.p+"data/b51f531.510000.geo.json"},function(e,t,a){e.exports=a.p+"data/1344c0c.520000.geo.json"},function(e,t,a){e.exports=a.p+"data/9ad8406.530000.geo.json"},function(e,t,a){e.exports=a.p+"data/8df5257.540000.geo.json"},function(e,t,a){e.exports=a.p+"data/e60e9ff.610000.geo.json"},function(e,t,a){e.exports=a.p+"data/307e6d4.620000.geo.json"},function(e,t,a){e.exports=a.p+"data/1253e95.630000.geo.json"},function(e,t,a){e.exports=a.p+"data/b230800.640000.geo.json"},function(e,t,a){e.exports=a.p+"data/8f5c51f.650000.geo.json"},function(e,t,a){e.exports=a.p+"data/5148730.710000.geo.json"},function(e,t,a){e.exports=a.p+"data/561839a.810000.geo.json"},function(e,t,a){e.exports=a.p+"data/d4c0f28.820000.geo.json"},,,,,,,,,,,,,,,,,,,,,,function(e,t,a){a(1824),a(1820),e.exports=a(1821)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){},,,,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){},,,,,,function(e,t,a){},,,function(e,t,a){var r={"./en-SG":480,"./en-SG.js":480,"./en-au":481,"./en-au.js":481,"./en-ca":482,"./en-ca.js":482,"./en-gb":483,"./en-gb.js":483,"./en-ie":484,"./en-ie.js":484,"./en-il":485,"./en-il.js":485,"./en-nz":486,"./en-nz.js":486};function n(e){var t=o(e);return a(t)}function o(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}n.keys=function(){return Object.keys(r)},n.resolve=o,e.exports=n,n.id=891},,,function(e,t,a){},function(e,t,a){},function(e,t,a){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){},function(e,t,a){},,,,,,,,function(e,t,a){},,,,,,,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},,function(e,t,a){},function(e,t,a){},,,,,,,,,,,,,,,,function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){},function(e,t,a){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,,,function(e,t,a){},function(e,t,a){},,,,,,,,,,,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,,,,,,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},,,function(e,t,a){},function(e,t,a){},,,function(e,t,a){},function(e,t,a){},,,,,,,,,,,,function(e,t,a){},,,,,,,,,,,,,,,,,,,,,,function(e,t,a){},,,,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,,,,function(e,t,a){},function(e,t,a){},,,,,,,,,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},,,function(e,t,a){},function(e,t,a){},,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},,,function(e,t,a){},,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,,,,,function(e,t,a){},,,,,,,,,,,,,,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,,,,,,,,,,function(e,t,a){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,,function(e,t,a){},function(e,t,a){},function(e,t,a){},,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){var r={"./analysis.png":1622,"./avatar.svg":442,"./cn/img/bios.png":1623,"./cn/img/bios1.png":1624,"./cn/img/bios2.png":1625,"./cn/img/bios3.png":1626,"./cn/img/cmd.jpg":1627,"./cn/img/doc_0.png":1628,"./cn/img/doc_1.png":1629,"./cn/img/doc_10.png":1630,"./cn/img/doc_11.png":1631,"./cn/img/doc_12.png":1632,"./cn/img/doc_13.png":1633,"./cn/img/doc_14.png":1634,"./cn/img/doc_15.png":1635,"./cn/img/doc_16.png":1636,"./cn/img/doc_17.png":1637,"./cn/img/doc_18.png":1638,"./cn/img/doc_19.png":1639,"./cn/img/doc_2.png":1640,"./cn/img/doc_20.png":1641,"./cn/img/doc_21.png":1642,"./cn/img/doc_22.png":1643,"./cn/img/doc_22_1.png":1644,"./cn/img/doc_22_2.png":1645,"./cn/img/doc_22_3.png":1646,"./cn/img/doc_22_4.png":1647,"./cn/img/doc_22_5.png":1648,"./cn/img/doc_22_6.png":1649,"./cn/img/doc_22_7.png":1650,"./cn/img/doc_23.png":1651,"./cn/img/doc_24.png":1652,"./cn/img/doc_25.png":1653,"./cn/img/doc_26.png":1654,"./cn/img/doc_27.png":1655,"./cn/img/doc_28.png":1656,"./cn/img/doc_29.png":1657,"./cn/img/doc_3.png":1658,"./cn/img/doc_4.png":1659,"./cn/img/doc_5.png":1660,"./cn/img/doc_6.png":1661,"./cn/img/doc_7.png":1662,"./cn/img/doc_8.png":1663,"./cn/img/doc_9.png":1664,"./cn/img/docker_err.jpg":1665,"./cn/img/download.png":1666,"./cn/img/ip.png":1667,"./cn/img/us_key.png":1668,"./copy.png":603,"./dashboard-example/dashboards_prettify_1.jpg":320,"./dashboard-example/dashboards_prettify_2.jpg":424,"./dashboard-example/dashboards_prettify_3.jpg":425,"./db-logos/Cassandra.png":1669,"./db-logos/arangodb.png":1670,"./db-logos/athena.png":1671,"./db-logos/aws_es.png":1672,"./db-logos/axibasetsd.png":1673,"./db-logos/azure_kusto.png":1674,"./db-logos/bigquery.png":1675,"./db-logos/bigquery_gce.png":1676,"./db-logos/clickhouse.png":1677,"./db-logos/cloudwatch.png":1678,"./db-logos/cloudwatch_insights.png":1679,"./db-logos/cockroach.png":1680,"./db-logos/corporate_memory.png":1681,"./db-logos/couchbase.png":1682,"./db-logos/csv.png":428,"./db-logos/csv1.png":1683,"./db-logos/databend.png":1684,"./db-logos/databricks.png":1685,"./db-logos/db2.png":1686,"./db-logos/dgraph.png":1687,"./db-logos/doris.png":1688,"./db-logos/drill.png":1689,"./db-logos/druid.png":1690,"./db-logos/dynamodb_sql.png":1691,"./db-logos/elasticsearch.png":1692,"./db-logos/elasticsearch2.png":1693,"./db-logos/elasticsearch2_OpenDistroSQLElasticSearch.png":1694,"./db-logos/elasticsearch2_XPackSQLElasticSearch.png":1695,"./db-logos/exasol.png":1696,"./db-logos/firebolt.png":1697,"./db-logos/google_analytics.png":1698,"./db-logos/google_spreadsheets.png":1699,"./db-logos/graphite.png":1700,"./db-logos/hive.png":1701,"./db-logos/hive_http.png":1702,"./db-logos/impala.png":1703,"./db-logos/influxdb.png":1704,"./db-logos/jirajql.png":1705,"./db-logos/json.png":1706,"./db-logos/kibana.png":1707,"./db-logos/kylin.png":1708,"./db-logos/mapd.png":1709,"./db-logos/memsql.png":1710,"./db-logos/mongodb.png":1711,"./db-logos/mssql.png":1712,"./db-logos/mssql_odbc.png":1713,"./db-logos/mysql.png":1714,"./db-logos/nz.png":1715,"./db-logos/oracle.png":1716,"./db-logos/pg.png":1717,"./db-logos/phoenix.png":1718,"./db-logos/pinot.png":1719,"./db-logos/presto.png":1720,"./db-logos/prometheus.png":1721,"./db-logos/python.png":1722,"./db-logos/qubole.png":1723,"./db-logos/rds_mysql.png":1724,"./db-logos/redshift.png":1725,"./db-logos/redshift_iam.png":1726,"./db-logos/results.png":1727,"./db-logos/rockset.png":1728,"./db-logos/salesforce.png":1729,"./db-logos/scylla.png":1730,"./db-logos/snowflake.png":1731,"./db-logos/sparql_endpoint.png":1732,"./db-logos/sqlite.png":1733,"./db-logos/starrocks.png":1734,"./db-logos/treasuredata.png":1735,"./db-logos/trino.png":1736,"./db-logos/uptycs.png":1737,"./db-logos/url.png":1738,"./db-logos/vertica.png":1739,"./db-logos/yandex_appmetrika.png":1740,"./db-logos/yandex_metrika.png":1741,"./destinations/chatwork.png":1742,"./destinations/email.png":1743,"./destinations/hangouts_chat.png":1744,"./destinations/hipchat.png":1745,"./destinations/mattermost.png":1746,"./destinations/microsoft_teams_webhook.png":1747,"./destinations/pagerduty.png":1748,"./destinations/slack.png":1749,"./destinations/webhook.png":1750,"./en/img/bios1.png":1751,"./en/img/bios2.png":1752,"./en/img/bios3.png":1753,"./en/img/cmd.png":1754,"./en/img/doc_0.png":1755,"./en/img/doc_1.png":1756,"./en/img/doc_10.png":1757,"./en/img/doc_11.png":1758,"./en/img/doc_12.png":1759,"./en/img/doc_13.png":1760,"./en/img/doc_14.png":1761,"./en/img/doc_15.png":1762,"./en/img/doc_16.png":1763,"./en/img/doc_17.png":1764,"./en/img/doc_18.png":1765,"./en/img/doc_19.png":1766,"./en/img/doc_2.png":1767,"./en/img/doc_20.png":1768,"./en/img/doc_21.png":1769,"./en/img/doc_22.png":1770,"./en/img/doc_22_1.png":1771,"./en/img/doc_22_2.png":1772,"./en/img/doc_22_3.png":1773,"./en/img/doc_22_4.png":1774,"./en/img/doc_22_5.png":1775,"./en/img/doc_22_6.png":1776,"./en/img/doc_22_7.png":1777,"./en/img/doc_23.png":1778,"./en/img/doc_24.png":1779,"./en/img/doc_25.png":1780,"./en/img/doc_26.png":1781,"./en/img/doc_27.png":1782,"./en/img/doc_28.png":1783,"./en/img/doc_29.png":1784,"./en/img/doc_3.png":1785,"./en/img/doc_4.png":1786,"./en/img/doc_5.png":1787,"./en/img/doc_6.png":1788,"./en/img/doc_7.png":1789,"./en/img/doc_8.png":1790,"./en/img/doc_9.png":1791,"./en/img/docker_err.png":1792,"./en/img/ip.png":1793,"./en/img/us_key.png":1794,"./favicon-16x16.png":1795,"./favicon-192x192.png":1796,"./favicon-32x32.png":1797,"./favicon-96x96.png":1798,"./fixtures/map-tile.png":1799,"./google_logo.svg":1800,"./gravatar.png":1801,"./icon_small.png":105,"./illustrations/alert.svg":1802,"./illustrations/dashboard.svg":1803,"./illustrations/no-query-results.svg":1804,"./illustrations/query.svg":1805,"./loading.png":1806,"./loading1.png":1807,"./logo.png":1808,"./logo_white.png":1809,"./next.png":1810,"./retry.png":1811,"./send-active.png":1812,"./send-default.png":1813};function n(e){var t=o(e);return a(t)}function o(e){if(!a.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}n.keys=function(){return Object.keys(r)},n.resolve=o,e.exports=n,n.id=1621},function(e,t,a){e.exports=a.p+"images/analysis.png"},function(e,t,a){e.exports=a.p+"images/cn/img/bios.png"},function(e,t,a){e.exports=a.p+"images/cn/img/bios1.png"},function(e,t,a){e.exports=a.p+"images/cn/img/bios2.png"},function(e,t,a){e.exports=a.p+"images/cn/img/bios3.png"},function(e,t,a){e.exports=a.p+"images/cn/img/cmd.jpg"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_0.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_1.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_10.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_11.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_12.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_13.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_14.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_15.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_16.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_17.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_18.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_19.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_2.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_20.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_21.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_22.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_22_1.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_22_2.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_22_3.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_22_4.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_22_5.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_22_6.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_22_7.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_23.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_24.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_25.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_26.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_27.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_28.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_29.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_3.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_4.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_5.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_6.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_7.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_8.png"},function(e,t,a){e.exports=a.p+"images/cn/img/doc_9.png"},function(e,t,a){e.exports=a.p+"images/cn/img/docker_err.jpg"},function(e,t,a){e.exports=a.p+"images/cn/img/download.png"},function(e,t,a){e.exports=a.p+"images/cn/img/ip.png"},function(e,t,a){e.exports=a.p+"images/cn/img/us_key.png"},function(e,t,a){e.exports=a.p+"images/db-logos/Cassandra.png"},function(e,t,a){e.exports=a.p+"images/db-logos/arangodb.png"},function(e,t,a){e.exports=a.p+"images/db-logos/athena.png"},function(e,t,a){e.exports=a.p+"images/db-logos/aws_es.png"},function(e,t,a){e.exports=a.p+"images/db-logos/axibasetsd.png"},function(e,t,a){e.exports=a.p+"images/db-logos/azure_kusto.png"},function(e,t,a){e.exports=a.p+"images/db-logos/bigquery.png"},function(e,t,a){e.exports=a.p+"images/db-logos/bigquery_gce.png"},function(e,t,a){e.exports=a.p+"images/db-logos/clickhouse.png"},function(e,t,a){e.exports=a.p+"images/db-logos/cloudwatch.png"},function(e,t,a){e.exports=a.p+"images/db-logos/cloudwatch_insights.png"},function(e,t,a){e.exports=a.p+"images/db-logos/cockroach.png"},function(e,t,a){e.exports=a.p+"images/db-logos/corporate_memory.png"},function(e,t,a){e.exports=a.p+"images/db-logos/couchbase.png"},function(e,t,a){e.exports=a.p+"images/db-logos/csv1.png"},function(e,t,a){e.exports=a.p+"images/db-logos/databend.png"},function(e,t,a){e.exports=a.p+"images/db-logos/databricks.png"},function(e,t,a){e.exports=a.p+"images/db-logos/db2.png"},function(e,t,a){e.exports=a.p+"images/db-logos/dgraph.png"},function(e,t,a){e.exports=a.p+"images/db-logos/doris.png"},function(e,t,a){e.exports=a.p+"images/db-logos/drill.png"},function(e,t,a){e.exports=a.p+"images/db-logos/druid.png"},function(e,t,a){e.exports=a.p+"images/db-logos/dynamodb_sql.png"},function(e,t,a){e.exports=a.p+"images/db-logos/elasticsearch.png"},function(e,t,a){e.exports=a.p+"images/db-logos/elasticsearch2.png"},function(e,t,a){e.exports=a.p+"images/db-logos/elasticsearch2_OpenDistroSQLElasticSearch.png"},function(e,t,a){e.exports=a.p+"images/db-logos/elasticsearch2_XPackSQLElasticSearch.png"},function(e,t,a){e.exports=a.p+"images/db-logos/exasol.png"},function(e,t,a){e.exports=a.p+"images/db-logos/firebolt.png"},function(e,t,a){e.exports=a.p+"images/db-logos/google_analytics.png"},function(e,t,a){e.exports=a.p+"images/db-logos/google_spreadsheets.png"},function(e,t,a){e.exports=a.p+"images/db-logos/graphite.png"},function(e,t,a){e.exports=a.p+"images/db-logos/hive.png"},function(e,t,a){e.exports=a.p+"images/db-logos/hive_http.png"},function(e,t,a){e.exports=a.p+"images/db-logos/impala.png"},function(e,t,a){e.exports=a.p+"images/db-logos/influxdb.png"},function(e,t,a){e.exports=a.p+"images/db-logos/jirajql.png"},function(e,t,a){e.exports=a.p+"images/db-logos/json.png"},function(e,t,a){e.exports=a.p+"images/db-logos/kibana.png"},function(e,t,a){e.exports=a.p+"images/db-logos/kylin.png"},function(e,t,a){e.exports=a.p+"images/db-logos/mapd.png"},function(e,t,a){e.exports=a.p+"images/db-logos/memsql.png"},function(e,t,a){e.exports=a.p+"images/db-logos/mongodb.png"},function(e,t,a){e.exports=a.p+"images/db-logos/mssql.png"},function(e,t,a){e.exports=a.p+"images/db-logos/mssql_odbc.png"},function(e,t,a){e.exports=a.p+"images/db-logos/mysql.png"},function(e,t,a){e.exports=a.p+"images/db-logos/nz.png"},function(e,t,a){e.exports=a.p+"images/db-logos/oracle.png"},function(e,t,a){e.exports=a.p+"images/db-logos/pg.png"},function(e,t,a){e.exports=a.p+"images/db-logos/phoenix.png"},function(e,t,a){e.exports=a.p+"images/db-logos/pinot.png"},function(e,t,a){e.exports=a.p+"images/db-logos/presto.png"},function(e,t,a){e.exports=a.p+"images/db-logos/prometheus.png"},function(e,t,a){e.exports=a.p+"images/db-logos/python.png"},function(e,t,a){e.exports=a.p+"images/db-logos/qubole.png"},function(e,t,a){e.exports=a.p+"images/db-logos/rds_mysql.png"},function(e,t,a){e.exports=a.p+"images/db-logos/redshift.png"},function(e,t,a){e.exports=a.p+"images/db-logos/redshift_iam.png"},function(e,t,a){e.exports=a.p+"images/db-logos/results.png"},function(e,t,a){e.exports=a.p+"images/db-logos/rockset.png"},function(e,t,a){e.exports=a.p+"images/db-logos/salesforce.png"},function(e,t,a){e.exports=a.p+"images/db-logos/scylla.png"},function(e,t,a){e.exports=a.p+"images/db-logos/snowflake.png"},function(e,t,a){e.exports=a.p+"images/db-logos/sparql_endpoint.png"},function(e,t,a){e.exports=a.p+"images/db-logos/sqlite.png"},function(e,t,a){e.exports=a.p+"images/db-logos/starrocks.png"},function(e,t,a){e.exports=a.p+"images/db-logos/treasuredata.png"},function(e,t,a){e.exports=a.p+"images/db-logos/trino.png"},function(e,t,a){e.exports=a.p+"images/db-logos/uptycs.png"},function(e,t,a){e.exports=a.p+"images/db-logos/url.png"},function(e,t,a){e.exports=a.p+"images/db-logos/vertica.png"},function(e,t,a){e.exports=a.p+"images/db-logos/yandex_appmetrika.png"},function(e,t,a){e.exports=a.p+"images/db-logos/yandex_metrika.png"},function(e,t,a){e.exports=a.p+"images/destinations/chatwork.png"},function(e,t,a){e.exports=a.p+"images/destinations/email.png"},function(e,t,a){e.exports=a.p+"images/destinations/hangouts_chat.png"},function(e,t,a){e.exports=a.p+"images/destinations/hipchat.png"},function(e,t,a){e.exports=a.p+"images/destinations/mattermost.png"},function(e,t,a){e.exports=a.p+"images/destinations/microsoft_teams_webhook.png"},function(e,t,a){e.exports=a.p+"images/destinations/pagerduty.png"},function(e,t,a){e.exports=a.p+"images/destinations/slack.png"},function(e,t,a){e.exports=a.p+"images/destinations/webhook.png"},function(e,t,a){e.exports=a.p+"images/en/img/bios1.png"},function(e,t,a){e.exports=a.p+"images/en/img/bios2.png"},function(e,t,a){e.exports=a.p+"images/en/img/bios3.png"},function(e,t,a){e.exports=a.p+"images/en/img/cmd.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_0.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_1.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_10.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_11.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_12.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_13.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_14.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_15.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_16.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_17.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_18.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_19.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_2.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_20.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_21.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_22.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_22_1.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_22_2.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_22_3.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_22_4.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_22_5.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_22_6.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_22_7.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_23.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_24.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_25.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_26.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_27.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_28.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_29.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_3.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_4.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_5.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_6.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_7.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_8.png"},function(e,t,a){e.exports=a.p+"images/en/img/doc_9.png"},function(e,t,a){e.exports=a.p+"images/en/img/docker_err.png"},function(e,t,a){e.exports=a.p+"images/en/img/ip.png"},function(e,t,a){e.exports=a.p+"images/en/img/us_key.png"},function(e,t,a){e.exports=a.p+"images/favicon-16x16.png"},function(e,t,a){e.exports=a.p+"images/favicon-192x192.png"},function(e,t,a){e.exports=a.p+"images/favicon-32x32.png"},function(e,t,a){e.exports=a.p+"images/favicon-96x96.png"},function(e,t,a){e.exports=a.p+"images/fixtures/map-tile.png"},function(e,t,a){e.exports=a.p+"images/google_logo.svg"},function(e,t,a){e.exports=a.p+"images/gravatar.png"},function(e,t,a){e.exports=a.p+"images/illustrations/alert.svg"},function(e,t,a){e.exports=a.p+"images/illustrations/dashboard.svg"},function(e,t,a){e.exports=a.p+"images/illustrations/no-query-results.svg"},function(e,t,a){e.exports=a.p+"images/illustrations/query.svg"},function(e,t,a){e.exports=a.p+"images/loading.png"},function(e,t,a){e.exports=a.p+"images/loading1.png"},function(e,t,a){e.exports=a.p+"images/logo.png"},function(e,t,a){e.exports=a.p+"images/logo_white.png"},function(e,t,a){e.exports=a.p+"images/next.png"},function(e,t,a){e.exports=a.p+"images/retry.png"},function(e,t,a){e.exports=a.p+"images/send-active.png"},function(e,t,a){e.exports=a.p+"images/send-default.png"},function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=1814},,,,,,function(e,t,a){},function(e,t,a){},,,function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),o=a(32),i=a.n(o),l=(a(8),a(5),a(2)),s=a.n(l),c=(a(442),a(63)),u=a.n(c),d=(a(9),a(11)),m=a.n(d);function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function f(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function g(e){var t=e.children,a=f(e,["children"]);return n.a.createElement(g.Component,a,t)}function b(e){return n.a.createElement(b.Component,e)}g.Component=function(e){var t=e.children,a=f(e,["children"]);return n.a.createElement("a",a,t)},g.WithIcon=function(e){var t=e.icon,a=e.alt,r=e.children,o=f(e,["icon","alt","children"]);return n.a.createElement(g.Component,o,r," ",t," ",n.a.createElement("span",{className:"sr-only"},a))},g.External=function(e){var t=e.icon,a=void 0===t?n.a.createElement("i",{className:"fa fa-external-link","aria-hidden":"true"}):t,r=e.alt,o=void 0===r?"(opens in a new tab)":r,i=f(e,["icon","alt"]);return n.a.createElement(g.WithIcon,p({target:"_blank",rel:"noopener noreferrer",icon:a,alt:o},i))},b.Component=function(e){return n.a.createElement(m.a,e)},g.Button=b;var h=g,y=(a(12),a(14),a(129)),v=a.n(y);function w(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var O=v()("redash:errors"),_=n.a.createContext({handleError:e=>{setTimeout(()=>{throw e})},reset:()=>{}});function E(e){var t=e.children;return n.a.createElement(u.a,{message:t,type:"error",showIcon:!0})}E.defaultProps={children:window.W_L.generic};class j extends n.a.Component{constructor(){super(...arguments),w(this,"state",{error:null}),w(this,"handleError",e=>{this.setState(this.constructor.getDerivedStateFromError(e)),this.componentDidCatch(e,null),Object(l.isFunction)(window.handleException)&&window.handleException(e)}),w(this,"reset",()=>{this.setState({error:null})})}static getDerivedStateFromError(e){return{error:e}}componentDidCatch(e,t){O(e,t)}render(){var e=this.props,t=e.renderError,a=e.children,r=this.state.error;return r?Object(l.isFunction)(t)?t(r):n.a.createElement(E,null):n.a.createElement(_.Provider,{value:this},a)}}w(j,"defaultProps",{children:null,renderError:null});a(112),a(73);var S=a(144),C=a.n(S),x=a(736),P=Object(x.a)();function L(e){var t=e.pathname,a=e.search,r=e.hash,n={};return n.path=t,n.search=Object(l.mapValues)(C.a.parse(a),e=>!!Object(l.isNil)(e)||e),n.hash=Object(l.trimStart)(r,"#"),n.url="".concat(t).concat(a).concat(r),n}var k={listen:e=>Object(l.isFunction)(e)?P.listen((t,a)=>e(k,a)):()=>{},confirmChange:e=>Object(l.isFunction)(e)?P.block(t=>e(L(t),k)):()=>{},update(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(l.isObject)(e)&&(e=Object(l.omitBy)({pathname:e.path,search:e.search,hash:e.hash},l.isUndefined),e=Object(l.extend)({pathname:k.path,search:k.search,hash:k.hash},e),Object(l.isObject)(e.search)&&(e.search=Object(l.omitBy)(Object(l.extend)({},k.search,e.search),l.isNil),e.search=Object(l.mapValues)(e.search,e=>!0===e?null:e),e.search=C.a.stringify(e.search))),t?P.replace(e):P.push(e)},url:void 0,path:void 0,setPath(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];k.update({path:e},t)},search:void 0,setSearch(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];k.update({search:e},t)},hash:void 0,setHash(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];k.update({hash:e},t)}};function N(){Object(l.extend)(k,L(P.location))}P.listen(N),N();var A=k,T=a(248),W=a.n(T),I=a(430),q=a.n(I),D=a(24),R=a.n(D);function M(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function z(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?M(Object(a),!0).forEach((function(t){F(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):M(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function F(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function V(e,t){var a=null;R.a.warning({content:"Your session has expired. Please login to continue.",okText:n.a.createElement(n.a.Fragment,null,"Login ",n.a.createElement("i",{className:"fa fa-external-link m-r-5","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)")),centered:!0,mask:!0,maskClosable:!1,keyboard:!1,onOk:r=>{if(!a||a.closed){var n,o,i,s,c,u,d=z(z({},(n=640,o=640,i=window.screenX,s=window.screenY,c=window.innerWidth,u=window.innerHeight,{left:Math.floor((c-n)/2+i),top:Math.floor((u-o)/2+s),width:Math.floor(n),height:Math.floor(o)})),{},{menubar:"no",toolbar:"no",location:"yes",resizable:"yes",scrollbars:"yes",status:"yes"});a=window.open(e,"Restore Session",Object(l.map)(d,(e,t)=>"".concat(t,"=").concat(e)).join(","));var m=e=>{"redash_session_restored"===e.data.type&&(a&&a.close(),a=null,window.removeEventListener("message",m),r(),t())};window.addEventListener("message",m,!1)}else a.focus()}})}var U=null;var B=W.a.create({paramsSerializer:e=>C.a.stringify(e),xsrfCookieName:"csrf_token",xsrfHeaderName:"X-CSRF-TOKEN"});B.interceptors.response.use(e=>e.data);q()(B,e=>{var t=Object(l.get)(e,"response.data.message");return e.isAxiosError&&Object(l.includes)(t,"CSRF")?B.get("/ping"):Promise.reject(e)},{statusCodes:[400]}),q()(B,e=>{var t=parseInt(Object(l.get)(e,"response.status")),a=Object(l.get)(e,"response.data.message"),r=Object(l.get)(e,"config.url");return e.isAxiosError&&(401===t||Object(l.includes)(a,"Please login"))&&"api/session"!==r?(U||(U=new Promise(e=>{V(X.getLoginUrl(),()=>{U=null,e()})})),U):Promise.reject(e)},{statusCodes:[401,404],pauseInstanceWhileRefreshing:!1});B.interceptors.request.use(e=>{var t=X.getApiKey();return t&&(e.headers.Authorization="Key ".concat(t)),e});var H={_isAdmin:void 0,canEdit(e){var t=e.user_id||e.user&&e.user.id;return this.isAdmin||t&&t===this.id},canCreate(){return this.hasPermission("create_query")||this.hasPermission("create_dashboard")||this.hasPermission("list_alerts")},hasPermission(e){return"admin"===e&&void 0!==this._isAdmin?this._isAdmin:Object(l.includes)(this.permissions,e)},get isAdmin(){return this.hasPermission("admin")},set isAdmin(e){this._isAdmin=e}},Y={},Q=[],K=v()("redash:auth"),$={loaded:!1},G={Login:"login"};function J(e){K("Updating session to be:",e),Object(l.extend)($,e,{loaded:!0}),Object(l.extend)(H,$.user),Object(l.extend)(Y,$.client_config),Object(l.extend)(Q,$.messages)}var X={isAuthenticated:()=>$.loaded&&$.user.id,getLoginUrl:()=>G.Login,setLoginUrl(e){G.Login=e},login(){var e=encodeURI(A.url);K("Calling login with next = %s",e),window.location.href="".concat(G.Login,"?next=").concat(e)},logout(){K("Logout."),window.location.href="logout"},loadSession:()=>(K("Loading session"),$.loaded&&$.user.id?(K("Resolving with local value."),Promise.resolve($)):(X.setApiKey(null),B.get("api/session").then(e=>(J(e),$)))),loadConfig:()=>(K("Loading config"),B.get("/api/config").then(e=>(J({client_config:e.client_config,user:{permissions:[]},messages:[]}),e))),setApiKey(e){K("Set API key to: %s",e),X.apiKey=e},getApiKey:()=>X.apiKey,requireSession:()=>(K("Requested authentication"),X.isAuthenticated()?Promise.resolve($):X.loadSession().then(()=>{if(X.isAuthenticated())return K("Loaded session"),window.opener&&window.opener.postMessage({type:"redash_session_restored"},window.location.origin),$;K("Need to login, redirecting"),X.login()}).catch(()=>{K("Need to login, redirecting"),X.login()}))};var Z=new class{refresh(){return Promise.resolve(this)}canCreateDataSource(){return H.isAdmin}isCreateDataSourceEnabled(){return H.isAdmin}canCreateDestination(){return H.isAdmin}isCreateDestinationEnabled(){return H.isAdmin}canCreateDashboard(){return H.hasPermission("create_dashboard")}isCreateDashboardEnabled(){return H.hasPermission("create_dashboard")}canCreateAlert(){return!0}canCreateUser(){return H.isAdmin}isCreateUserEnabled(){return H.isAdmin}isCreateQuerySnippetEnabled(){return!0}getDashboardRefreshIntervals(){var e=Y.dashboardRefreshIntervals;return Object(l.isArray)(e)?e:null}getQueryRefreshIntervals(){var e=Y.queryRefreshIntervals;return Object(l.isArray)(e)?e:null}canEdit(e){return Object(l.get)(e,"can_edit",!1)}canRun(){return!0}};var ee=new class{constructor(){this.objectCounters={}}refresh(){return B.get("api/organization/status").then(e=>(this.objectCounters=e.object_counters,this))}},te=(a(218),a(183),a(3)),ae=a.n(te);function re(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function ne(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var oe=new Map,ie=new Set;function le(e,t){Object(l.isString)(e)&&""!==e&&(oe.set(e,Object(l.isFunction)(t)?t:null),ie.forEach(t=>{t.props.name===e&&t.forceUpdate()}))}class se extends n.a.Component{componentDidMount(){ie.add(this)}componentWillUnmount(){ie.delete(this)}render(){var e=this.props,t=e.name,a=e.children,r=e.fallback,o=re(e,["name","children","fallback"]),i=oe.get(t);return i?n.a.createElement(i,o,a):Object(l.isUndefined)(r)?a:r}}ne(se,"propTypes",{name:ae.a.string.isRequired,fallback:ae.a.node,children:ae.a.node}),ne(se,"defaultProps",{children:null});var ce=a(17),ue=a.n(ce),de=a(4),me=a.n(de);a(847);function pe(){return(pe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function fe(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var ge=function(e){var t=e.className,a=e.type,r=fe(e,["className","type"]);return n.a.createElement("button",pe({className:me()("plain-button","clickable",{"plain-button-link":"link"===a},t),type:"button"},r))},be=(a(90),a(55)),he=a.n(be);function ye(){return(ye=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ve(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function we(e){var t=e.title,a=ve(e,["title"]),r=Object(l.isNil)(t)?null:n.a.createElement("span",{role:"status","aria-live":"assertive","aria-relevant":"additions"},t);return n.a.createElement(he.a,ye({trigger:["hover","focus"],title:r},a))}var Oe=a(314),_e=a.n(Oe),Ee=a(66),je=a.n(Ee);function Se(e){var t,a;return(t=()=>Object(l.uniqueId)(e),null===(a=Object(r.useRef)(null)).current&&(a.current=t()),a).current}function Ce(e){var t=e.message,a=e.icon,r=e.children,o=e.className,i=Se("bm-message");return n.a.createElement("div",{className:"big-message p-15 text-center "+o,role:"status","aria-live":"assertive","aria-relevant":"additions removals"},n.a.createElement("h3",{className:"m-t-0 m-b-0","aria-labelledby":i},n.a.createElement("i",{className:me()("fa",a),"aria-hidden":"true"})),n.a.createElement("br",null),n.a.createElement("span",{id:i},t),r)}Ce.propTypes={message:ae.a.string,icon:ae.a.string.isRequired,children:ae.a.node,className:ae.a.string},Ce.defaultProps={message:"",children:null,className:"tiled bg-white"};var xe=Ce,Pe=a(253),Le=a.n(Pe);Le.a.setConfig({ADD_ATTR:["target"]}),Le.a.addHook("afterSanitizeAttributes",(function(e){var t=e.getAttribute("target");Object(l.isString)(t)&&"_blank"===t.toLowerCase()?e.setAttribute("rel","noopener noreferrer"):e.removeAttribute("target")}));var ke=Le.a.sanitize;function Ne(){return(Ne=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ae(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var Te=n.a.memo((function(e){var t=e.children,a=Ae(e,["children"]);return n.a.createElement("div",Ne({},a,{dangerouslySetInnerHTML:{__html:ke(t)}}))}));Te.propTypes={children:ae.a.string},Te.defaultProps={children:""};var We=Te,Ie=a(110),qe=a(654),De=a.n(qe),Re=a(655),Me=a.n(Re);a(854);function ze(){return(ze=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Fe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Ve(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Fe(Object(a),!0).forEach((function(t){Ue(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Fe(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ue(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Be(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return He(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return He(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function He(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var Ye=Object(l.mapValues)({HOME:["",window.W_L.help],VALUE_SOURCE_OPTIONS:["/user-guide/querying/query-parameters#Value-Source-Options",window.W_L.guide_list_option],AUTHENTICATION_OPTIONS:["/user-guide/users/authentication-options",window.W_L.guide_authentication],USAGE_DATA_SHARING:["/open-source/admin-guide/usage-data",window.W_L.help_share_anonymous_data],DS_ATHENA:["/data-sources/amazon-athena-setup",window.W_L.guide_amazon_athena],DS_BIGQUERY:["/data-sources/bigquery-setup",window.W_L.guide_set_bigquery],DS_URL:["/data-sources/querying-urls",window.W_L.guide_set_url_port],DS_MONGODB:["/data-sources/mongodb-setup",window.W_L.guide_set_mongodb],DS_GOOGLE_SPREADSHEETS:["/data-sources/querying-a-google-spreadsheet",window.W_L.guide_set_google_spread],DS_GOOGLE_ANALYTICS:["/data-sources/google-analytics-setup",window.W_L.guide_set_google_analytics],DS_AXIBASETSD:["/data-sources/axibase-time-series-database",window.W_L.guide_set_axibase],DS_RESULTS:["/user-guide/querying/query-results-data-source",window.W_L.guide_set_query_result],ALERT_SETUP:["/user-guide/alerts/setting-up-an-alert",window.W_L.guide_set_alert],MAIL_CONFIG:["/open-source/setup/#Mail-Configuration",window.W_L.guide_set_mail],ALERT_NOTIF_TEMPLATE_GUIDE:["/user-guide/alerts/custom-alert-notifications",window.W_L.guide_set_notice],FAVORITES:["/user-guide/querying/favorites-tagging/#Favorites",window.W_L.guide_favorite],MANAGE_PERMISSIONS:["/user-guide/querying/writing-queries#Managing-Query-Permissions",window.W_L.guide_query_permissions],NUMBER_FORMAT_SPECS:["/user-guide/visualizations/formatting-numbers",window.W_L.guide_formatting_number],GETTING_STARTED:["/user-guide/getting-started",window.W_L.guide_menu_start],DASHBOARDS:["/user-guide/dashboards",window.W_L.guide_dashboard],QUERIES:["/help/user-guide/querying",window.W_L.guide_query],ALERTS:["/user-guide/alerts",window.W_L.guide_alert]},e=>{var t=Be(e,2);return["https://xxx/help"+t[0],t[1]]}),Qe={type:ae.a.string,href:ae.a.string,title:ae.a.node,className:ae.a.string,showTooltip:ae.a.bool,renderAsLink:ae.a.bool,children:ae.a.node},Ke={type:null,href:null,title:null,className:null,showTooltip:!0,renderAsLink:!1,children:n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"})};function $e(e){return n.a.createElement(se,ze({},e,{name:"HelpTrigger"}))}le("HelpTrigger",function(e){var t,a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return a=t=class extends n.a.Component{constructor(){super(...arguments),Ue(this,"iframeRef",n.a.createRef()),Ue(this,"iframeLoadingTimeout",null),Ue(this,"state",{visible:!1,loading:!1,error:!1,currentUrl:null,richText:null}),Ue(this,"loadIframe",e=>{clearTimeout(this.iframeLoadingTimeout),this.setState({loading:!0,error:!1}),this.iframeRef.current.src=e,this.iframeLoadingTimeout=setTimeout(()=>{this.setState({error:e,loading:!1})},2e4)}),Ue(this,"onIframeLoaded",()=>{this.setState({loading:!1}),clearTimeout(this.iframeLoadingTimeout)}),Ue(this,"onPostMessageReceived",e=>{if(Object(l.some)(r,t=>Object(l.startsWith)(e.origin,t))){var t=e.data||{},a=t.type,n=t.message;"iframe_url"===a&&this.setState({currentUrl:n})}}),Ue(this,"getUrl",()=>{var t=Object(l.get)(e,this.props.type);return t?t[0]:this.props.href}),Ue(this,"getRichText",()=>{var e;return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:e=Ie.markdown.toHTML("CN"===window.W_L.language_mode?De.a:Me.a),this.setState({richText:e,loading:!1});case 2:case"end":return t.stop()}}),null,this,null,Promise)}),Ue(this,"openDrawer",e=>{if("HOME"===this.props.type)return this.setState({visible:!0,loading:!0}),void this.getRichText();e.shiftKey||e.ctrlKey||e.metaKey||(e.preventDefault(),this.setState({visible:!0}),setTimeout(()=>this.loadIframe(this.getUrl()),300))}),Ue(this,"closeDrawer",e=>{e&&e.preventDefault(),this.setState({visible:!1}),this.setState({visible:!1,currentUrl:null,richText:null})})}componentDidMount(){window.addEventListener("message",this.onPostMessageReceived,!1)}componentWillUnmount(){window.removeEventListener("message",this.onPostMessageReceived),clearTimeout(this.iframeLoadingTimeout)}render(){var t=this.getUrl();if(!t)return null;var a=Object(l.get)(e,"".concat(this.props.type,"[1]"),this.props.title),i=me()("help-trigger",this.props.className),s=this.state.currentUrl,c=Object(l.some)(r,e=>Object(l.startsWith)(s||t,e)),u=this.props.renderAsLink||!c,d=this.props.type;return n.a.createElement(n.a.Fragment,null,n.a.createElement(we,{title:this.props.showTooltip?n.a.createElement(n.a.Fragment,null,a,u&&n.a.createElement(n.a.Fragment,null," ",n.a.createElement("i",{className:"fa fa-external-link",style:{marginLeft:5},"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)"))):null},"HOME"===d?n.a.createElement(h,{className:i,onClick:this.openDrawer},this.props.children):n.a.createElement(h,{href:s||this.getUrl(),className:i,rel:"noopener noreferrer",target:"_blank",onClick:u?()=>{}:this.openDrawer})),n.a.createElement(_e.a,{placement:"right",closable:!1,onClose:this.closeDrawer,visible:this.state.visible,className:me()("help-drawer",o),destroyOnClose:!0,width:1e3},n.a.createElement("div",{className:"drawer-wrapper"},n.a.createElement("div",{className:"drawer-menu"},s&&n.a.createElement(we,{title:"Open page in a new window",placement:"left"},n.a.createElement(h,{href:s,target:"_blank"},n.a.createElement("i",{className:"fa fa-external-link","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)"))),n.a.createElement(we,{title:"Close",placement:"bottom"},n.a.createElement(ge,{onClick:this.closeDrawer},n.a.createElement(je.a,null)))),this.state.richText&&n.a.createElement(We,{className:"preview markdown"},this.state.richText),this.state.loading&&n.a.createElement(xe,{icon:"fa-spinner fa-2x fa-pulse",message:"Loading...",className:"help-message"}),this.state.error&&n.a.createElement(xe,{icon:"fa-exclamation-circle",className:"help-message"},"Something went wrong.",n.a.createElement("br",null),n.a.createElement(h,{href:this.state.error,target:"_blank",rel:"noopener"},window.W_L.click_here)," ",window.W_L.open_new_window)),n.a.createElement(se,{name:"HelpDrawerExtraContent",onLeave:this.closeDrawer,openPageUrl:this.loadIframe})))}},Ue(t,"propTypes",Ve(Ve({},Qe),{},{type:ae.a.oneOf(Object.keys(e))})),Ue(t,"defaultProps",Ke),a}(Ye,["https://xxx"])),$e.propTypes=Qe,$e.defaultProps=Ke;var Ge=a(656),Je=document.createElement("a");Je.style.display="none",document.body.appendChild(Je);var Xe=["origin","protocol","host","hostname","port","pathname","search","hash","href"];var Ze={parse:function(e){return Je.setAttribute("href",e),Object(l.pick)(Je,Xe)},stringify:function(e){return Object(l.extend)(Je,Object(l.pick)(e,Xe)),Je.href},normalize:function(e){return Je.setAttribute("href",e),Je.href}};a(855);function et(e){return n.a.createElement("h4",null,e.message)}function tt(){return(tt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function at(e,t){switch(e){case 404:return window.W_L.web_404;case 401:case 403:return window.W_L.web_403;default:return t}}function rt(e){var t=window.W_L.web_error;if(Object(l.isObject)(e)){if(e.isAxiosError&&Object(l.isObject)(e.response))return at(e.response.status,Object(l.get)(e,"response.data.message",t));if(e.status)return at(e.status,t)}return t}function nt(e){var t=e.error,a=e.message;if(!t)return null;console.error(t);var r={error:t,message:a||rt(t)};return n.a.createElement("div",{className:"error-message-container","data-test":"ErrorMessage",role:"alert"},n.a.createElement("div",{className:"error-state bg-white tiled"},n.a.createElement("div",{className:"error-state__icon"},n.a.createElement("i",{className:"zmdi zmdi-alert-circle-o","aria-hidden":"true"})),n.a.createElement("div",{className:"error-state__details"},n.a.createElement(se,tt({name:"ErrorMessageDetails",fallback:n.a.createElement(et,r)},r)))))}function ot(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function it(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ot(Object(a),!0).forEach((function(t){lt(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ot(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function lt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function st(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ct(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ct(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ct(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}et.propTypes={error:ae.a.instanceOf(Error).isRequired,message:ae.a.string.isRequired},nt.propTypes={error:ae.a.object.isRequired,message:ae.a.string};var ut=n.a.createContext(null);function dt(e){var t=Object(l.trimEnd)(Ze.normalize(""),"/")+"/";return e=Ze.normalize(e),!!Object(l.startsWith)(e,t)&&"/"+Object(l.trimStart)(e.substr(t.length),"/")}function mt(e){var t=e.routes,a=e.onRouteChange,o=st(Object(r.useState)(null),2),i=o[0],s=o[1],c=Object(r.useRef)(null),u=Object(r.useRef)();return Object(r.useEffect)(()=>{var e=!1,a=new Ge.a(t,{resolveRoute(e,t){var a=e.route;if(Object(l.isFunction)(a.render))return it(it({},a),{},{routeParams:t})}});function r(t){if(!e){u.current&&u.current.reset();var r=dt(A.path)||"/";if(r===c.current)return;if(c.current=r,"REPLACE"===t)return;a.resolve({pathname:r}).then(t=>{e||c.current!==r||s(it(it({},t),{},{key:Math.random().toString(32).substr(2)}))}).catch(t=>{e||c.current!==r||s({render:e=>n.a.createElement(nt,e.routeParams),routeParams:{error:t}})})}}r("PUSH");var o=A.listen((e,t)=>r(t));return()=>{e=!0,c.current=null,o()}},[t]),Object(r.useEffect)(()=>{a(i)},[i,a]),i?n.a.createElement(ut.Provider,{value:i},n.a.createElement(j,{ref:u,renderError:e=>n.a.createElement(nt,{error:e})},i.render(i))):null}function pt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function ft(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?pt(Object(a),!0).forEach((function(t){gt(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):pt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function gt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}mt.propTypes={routes:ae.a.arrayOf(ae.a.shape({path:ae.a.string.isRequired,render:ae.a.func,resolve:ae.a.objectOf(ae.a.any)})),onRouteChange:ae.a.func},mt.defaultProps={routes:[],onRouteChange:()=>{}};class bt{constructor(e){Object(l.extend)(this,{pathPrefix:"/".concat(e.path)},Object(l.omit)(e,["isActive","isAvailable"])),Object(l.isFunction)(e.isActive)&&(this.isActive=e.isActive),Object(l.isFunction)(e.isAvailable)&&(this.isAvailable=e.isAvailable)}isActive(e){return e.startsWith(this.pathPrefix)}isAvailable(){return void 0===this.permission||H.hasPermission(this.permission)}}var ht=new class{constructor(){gt(this,"items",[])}add(e,t){e=Object(l.isString)(e)?e:null,this.remove(e),Object(l.isObject)(t)&&(this.items.push(new bt(ft(ft({},t),{},{id:e}))),this.items=Object(l.sortBy)(this.items,"order"))}remove(e){Object(l.isString)(e)&&(this.items=Object(l.filter)(this.items,t=>t.id!==e))}getAvailableItems(){return Object(l.filter)(this.items,e=>e.isAvailable())}getActiveItem(e){var t=dt(e);return Object(l.find)(this.items,e=>e.isActive(t))}},yt=a(105),vt=a.n(yt),wt=a(657),Ot=a.n(wt),_t=a(658),Et=a.n(_t),jt=a(659),St=a.n(jt),Ct=a(660),xt=a.n(Ct),Pt=a(206),Lt=a.n(Pt),kt=a(661),Nt=a.n(kt),At=a(431);function Tt(){return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",null,window.W_L.version,": ",Y.DeepBI_version,At!==Y.version&&" (".concat(At.substring(0,8),")")),Y.newVersionAvailable&&H.hasPermission("super_admin")&&n.a.createElement("div",{className:"m-t-10"},n.a.createElement(h,{href:"https://version.redash.io/",className:"update-available",target:"_blank",rel:"noopener"},"Update Available ",n.a.createElement("i",{className:"fa fa-external-link m-l-5","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)"))))}var Wt,It=a(246),qt=!1,Dt=0,Rt=!0,Mt=new It.EventEmitter,zt="ws";"https:"===window.location.protocol&&(zt="wss");var Ft=()=>{if(!Wt||1!==Wt.readyState){var e="".concat(zt,"://").concat("192.168.0.110:38318/chat/").concat(H.id,"_").concat(H.name);(Wt=new WebSocket(e)).onopen=function(){Ut.reset().start(),qt=!0,Rt=!1,Dt=1,Mt.emit("change",Dt)},Wt.onerror=function(t){Vt(e)},Wt.onclose=function(e){qt=!1,Dt=0,Mt.emit("change",Dt)},Wt.onmessage=function(e){qt=!0,Dt=1,Mt.emit("change",Dt)}}},Vt=e=>{qt||setTimeout((function(){Ft(),qt=!1,Dt=2,Mt.emit("change",Dt)}),4e3)},Ut={timeout:6e4,timeoutObj:null,reset:function(){return clearInterval(this.timeoutObj),this},start:function(){this.timeoutObj=setInterval((function(){Bt({state:200,sender:"heartCheck",data:{content:"HeartBeat"}})}),this.timeout)}},Bt=e=>{Wt&&1===Wt.readyState&&Wt.send(JSON.stringify(e))},Ht=e=>{Rt=e};a(856);function Yt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Qt(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Qt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qt(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Kt(){return(Kt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function $t(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Gt(e){var t=e.children,a=$t(e,["children"]);return n.a.createElement(ue.a,Kt({selectable:!1,mode:"vertical",theme:"dark"},a),t)}function Jt(){var e=Object(r.useContext)(ut);return Object(r.useMemo)(()=>({dashboards:Object(l.includes)(["Dashboards.List","Dashboards.Favorites","Dashboards.My","Dashboards.ViewOrEdit","Dashboards.LegacyViewOrEdit"],e.id),queries:Object(l.includes)(["Queries.List","Queries.Favorites","Queries.Archived","Queries.My","Queries.View","Queries.New","Queries.Edit"],e.id),dataSources:Object(l.includes)(["DataSources.List"],e.id),alerts:Object(l.includes)(["Alerts.List","Alerts.New","Alerts.View","Alerts.Edit"],e.id),testdialogue:Object(l.includes)(["Dialogue.List"],e.id),report_route:Object(l.includes)(["Dialogue.List.Report"],e.id),dialogue_list:Object(l.includes)(["Dialogue.List.Dialogue"],e.id),autopilot:Object(l.includes)(["Dialogue.List.autopilot"],e.id),autopilot_list:Object(l.includes)(["Dialogue.List.autopilot_list"],e.id),autopilot_view:Object(l.includes)(["Dialogue.List.autopilot_view"],e.id),dashboards_prettify:Object(l.includes)(["Dialogue.List.dashboards_prettify"],e.id)}),[e.id])}function Xt(){var e=Object(l.first)(ht.getAvailableItems()),t=Jt(),a=Yt(Object(r.useState)(0),2),o=a[0],i=a[1];return Object(r.useEffect)(()=>{var e=e=>{i(e)};return Mt.on("change",e),()=>{Mt.off("change",e)}},[]),n.a.createElement("nav",{className:"desktop-navbar"},n.a.createElement(Gt,{className:"desktop-navbar-logo"},n.a.createElement("div",{role:"menuitem"},n.a.createElement(h,{href:"./"},n.a.createElement("img",{src:vt.a,alt:"DeepBI"})))),n.a.createElement(Gt,{className:"desktop-navbar-spacer",style:{flex:"0"}},n.a.createElement(ue.a.SubMenu,{key:"create",popupClassName:"desktop-navbar-submenu","data-test":"dialogueButton",className:t.testdialogue||t.dialogue_list?"navbar-active-item":null,tabIndex:0,title:n.a.createElement(n.a.Fragment,null,n.a.createElement(Ot.a,null),n.a.createElement("span",{className:"desktop-navbar-label"},window.W_L.data_analysis))},n.a.createElement(ue.a.Item,{key:"testdialogue"},n.a.createElement(h,{href:"./","data-test":"testdialogue"},window.W_L.dialogue)),n.a.createElement(ue.a.Item,{key:"dialogue_list"},n.a.createElement(h,{"data-test":"dialogue-list",href:"dialogue-list"},window.W_L.history_dialogue)))),n.a.createElement(Gt,{className:"desktop-navbar-spacer",style:{flex:"0"}},n.a.createElement(ue.a.SubMenu,{key:"create",popupClassName:"desktop-navbar-submenu","data-test":"queriesButton",tabIndex:0,className:t.report_route||t.queries?"navbar-active-item":null,title:n.a.createElement(n.a.Fragment,null,n.a.createElement(Et.a,null),n.a.createElement("span",{className:"desktop-navbar-label"},window.W_L.query_builder))},n.a.createElement(ue.a.Item,{key:"report_route"},n.a.createElement(h,{href:"report-route","data-test":"report-route"},window.W_L.report_generation)),n.a.createElement(ue.a.Item,{key:"queries"},n.a.createElement(h,{"data-test":"queries",href:"queries"},window.W_L.report_list)))),n.a.createElement(Gt,{style:{flex:"0"}},n.a.createElement(ue.a.SubMenu,{key:"create",popupClassName:"desktop-navbar-submenu","data-test":"queriesButton",tabIndex:0,className:t.dashboards||t.dashboards_prettify?"navbar-active-item":null,title:n.a.createElement(n.a.Fragment,null,n.a.createElement(St.a,null),n.a.createElement("span",{className:"desktop-navbar-label"},window.W_L.dashboards))},n.a.createElement(ue.a.Item,{key:"dashboards"},n.a.createElement(h,{href:"dashboards","data-test":"dashboards"},window.W_L.dashboards)),n.a.createElement(ue.a.Item,{key:"dashboards_prettify"},n.a.createElement(h,{href:"dashboards_prettify","data-test":"dashboards_prettify"},window.W_L.dashboards_prettify)))),n.a.createElement(Gt,{className:"desktop-navbar-spacer",style:{flex:"1"}},n.a.createElement(ue.a.SubMenu,{key:"create",popupClassName:"desktop-navbar-submenu","data-test":"autopilotButton",className:t.autopilot||t.autopilot_view||t.autopilot_list?"navbar-active-item":null,tabIndex:0,title:n.a.createElement(n.a.Fragment,null,n.a.createElement(xt.a,{"aria-label":"autopilot navigation button"}),n.a.createElement("span",{className:"desktop-navbar-label"},window.W_L.auto_pilot))},n.a.createElement(ue.a.Item,{key:"autopilot"},n.a.createElement(h,{href:"autopilot","data-test":"autopilot"},window.W_L.auto_pilot)),n.a.createElement(ue.a.Item,{key:"autopilot_list"},n.a.createElement(h,{"data-test":"autopilot_list",href:"autopilot_list"},window.W_L.history_autopilot)))),n.a.createElement(Gt,null,n.a.createElement(ue.a.Item,{key:"help"},n.a.createElement($e,{showTooltip:!1,type:"HOME",tabIndex:0},n.a.createElement(Lt.a,null),n.a.createElement("span",{className:"desktop-navbar-label"},window.W_L.help))),e&&n.a.createElement(ue.a.Item,{key:"settings",className:t.dataSources?"navbar-active-item":null},n.a.createElement(h,{href:e.path,"data-test":"SettingsLink"},n.a.createElement(Nt.a,null),n.a.createElement("span",{className:"desktop-navbar-label"},window.W_L.setting)))),n.a.createElement(Gt,{className:"desktop-navbar-profile-menu"},n.a.createElement(ue.a.SubMenu,{key:"profile",popupClassName:"desktop-navbar-submenu",tabIndex:0,title:n.a.createElement("span",{"data-test":"ProfileDropdown",className:"desktop-navbar-profile-menu-title"},n.a.createElement("img",{className:"profile__image_thumb",src:H.profile_image_url,alt:H.name}),n.a.createElement("div",{className:"profile__live__type"},n.a.createElement("span",{style:{background:0===o?"red":1===o?"green":"yellow"}}),n.a.createElement("div",null,0===o?window.W_L.offline:1===o?window.W_L.online:window.W_L.pending)))},n.a.createElement(ue.a.Item,{key:"profile"},n.a.createElement(h,{href:"users/me"},window.W_L.personal_setting)),H.hasPermission("super_admin")&&n.a.createElement(ue.a.Item,{key:"status"},n.a.createElement(h,{href:"admin/status"},window.W_L.sys_status)),n.a.createElement(ue.a.Divider,null),n.a.createElement(ue.a.Item,{key:"logout"},n.a.createElement(ge,{"data-test":"LogOutButton",onClick:()=>X.logout()},window.W_L.log_out)),n.a.createElement(ue.a.Divider,null),n.a.createElement(ue.a.Item,{key:"version",role:"presentation",disabled:!0,className:"version-info"},n.a.createElement(Tt,null)))))}var Zt=a(662),ea=a.n(Zt),ta=a(71),aa=a.n(ta);function ra(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return na(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return na(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function na(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}a(882);function oa(e){var t=e.getPopupContainer,a=Object(l.first)(ht.getAvailableItems()),o=(e=>{var t=ra(Object(r.useState)(!0),2),a=t[0],n=t[1],o=ra(Object(r.useState)(0),2),i=o[0],l=o[1];return Object(r.useEffect)(()=>{var t=document.querySelector(e);if(t){var r=()=>{var e=t.scrollTop;e>i&&e>100?a&&n(!1):a||n(!0),l(e)};return t.addEventListener("scroll",r),()=>{t.removeEventListener("scroll",r)}}},[i,a,e]),a})(".dialogue-content-all");return n.a.createElement("div",{className:"mobile-navbar ".concat(o?"":"hidden")},n.a.createElement("div",{className:"mobile-navbar-logo"},n.a.createElement(h,{href:"./"},n.a.createElement("img",{src:vt.a,alt:"DeepBI",onClick:()=>{window.location.reload()}}))),n.a.createElement("div",{className:"mobile-navbar-name"},"ChatBI"),n.a.createElement("div",null,n.a.createElement(aa.a,{overlayStyle:{minWidth:200},trigger:["click"],getPopupContainer:t,overlay:n.a.createElement(ue.a,{mode:"vertical",theme:"dark",selectable:!1,className:"mobile-navbar-menu"},n.a.createElement(ue.a.Item,{key:"testdialogue"},n.a.createElement(h,{href:"./"},window.W_L.data_analysis)),n.a.createElement(ue.a.Item,{key:"dialogue-list"},n.a.createElement(h,{href:"dialogue-list"},window.W_L.history_dialogue)),n.a.createElement(ue.a.Item,{key:"report-route"},n.a.createElement(h,{href:"report-route"},window.W_L.report_generation)),n.a.createElement(ue.a.Item,{key:"queries"},n.a.createElement(h,{href:"queries"},window.W_L.report_list)),n.a.createElement(ue.a.Item,{key:"dashboards"},n.a.createElement(h,{href:"dashboards"},window.W_L.dashboard)),n.a.createElement(ue.a.Item,{key:"dashboards_prettify"},n.a.createElement(h,{href:"dashboards_prettify"},window.W_L.dashboards_prettify)),n.a.createElement(ue.a.Item,{key:"autopilot"},n.a.createElement(h,{href:"autopilot"},window.W_L.auto_pilot)),n.a.createElement(ue.a.Item,{key:"autopilot_list"},n.a.createElement(h,{href:"autopilot_list"},window.W_L.history_autopilot)),a&&n.a.createElement(ue.a.Item,{key:"settings"},n.a.createElement(h,{href:a.path},window.W_L.setting)),H.hasPermission("super_admin")&&n.a.createElement(ue.a.Divider,null),n.a.createElement(ue.a.Item,{key:"logout",onClick:()=>X.logout()},window.W_L.log_out))},n.a.createElement(m.a,{className:"mobile-navbar-toggle-button",ghost:!0},n.a.createElement(ea.a,null)))))}oa.propTypes={getPopupContainer:ae.a.func},oa.defaultProps={getPopupContainer:null};a(888);function ia(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return la(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return la(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function la(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function sa(e){var t=e.children,a=Object(r.useRef)(),o=ia(Object(r.useState)(!0),2),i=o[0],l=(o[1],Object(r.useCallback)(()=>a.current,[]));return n.a.createElement(n.a.Fragment,null,n.a.createElement(se,{name:"ApplicationWrapper"},n.a.createElement("div",{className:"application-layout-side-menu"},n.a.createElement(se,{name:"ApplicationDesktopNavbar"},n.a.createElement(Xt,null))),n.a.createElement("div",{className:"application-layout-content"},i&&n.a.createElement("nav",{className:"application-layout-top-menu",ref:a},n.a.createElement(se,{name:"ApplicationMobileNavbar",getPopupContainer:l},n.a.createElement(oa,{getPopupContainer:l}))),t)))}function ca(){return(ca=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ua(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function da(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function ma(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?da(Object(a),!0).forEach((function(t){pa(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):da(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function pa(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function fa(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ga(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ga(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ga(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function ba(e){var t=e.bodyClass,a=e.currentRoute,o=e.render,i=fa(Object(r.useState)(!!X.isAuthenticated()),2),l=i[0],s=i[1];return Object(r.useEffect)(()=>{var e=!1;return Promise.all([X.requireSession(),ee.refresh(),Z.refresh()]).then(()=>{e||s(!!X.isAuthenticated())}).catch(()=>{e||s(!1)}),()=>{e=!0}},[]),Object(r.useEffect)(()=>{if(t)return document.body.classList.toggle(t,!0),()=>{document.body.classList.toggle(t,!1)}},[t]),l?n.a.createElement(sa,null,n.a.createElement(n.a.Fragment,{key:a.key},n.a.createElement(j,{renderError:e=>n.a.createElement(nt,{error:e})},n.a.createElement(_.Consumer,null,e=>{var t=e.handleError;return o(ma(ma({},a.routeParams),{},{pageTitle:a.title,onError:t}))})))):null}sa.propTypes={children:ae.a.node},sa.defaultProps={children:null};function ha(e){var t=e.render,a=e.bodyClass;return ma(ma({},ua(e,["render","bodyClass"])),{},{render:e=>{var r={render:t,bodyClass:a,currentRoute:e};return n.a.createElement(se,ca({},r,{name:"UserSessionWrapper",fallback:n.a.createElement(ba,r)}))}})}var ya=a(20),va=a.n(ya);a(70);function wa(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Oa(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?wa(Object(a),!0).forEach((function(t){_a(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):wa(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function _a(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ea(){return(Ea=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var ja=ae.a.shape({props:ae.a.shape({visible:ae.a.bool,onOk:ae.a.func,onCancel:ae.a.func,afterClose:ae.a.func}).isRequired,close:ae.a.func.isRequired,dismiss:ae.a.func.isRequired});function Sa(e){return{Component:e,showModal:t=>function(e,t){var a={props:{visible:!0,okButtonProps:{},cancelButtonProps:{},onOk:()=>{},onCancel:()=>{},afterClose:()=>{}},close:()=>{},dismiss:()=>{}},r=null,o={onClose:()=>{},onDismiss:()=>{}},s=document.createElement("div");function c(){i.a.render(n.a.createElement(e,Ea({},t,{dialog:a})),s)}function u(e,t){return a.props.okButtonProps={disabled:!0},a.props.cancelButtonProps={disabled:!0},t(),c(),Promise.resolve(e).then(()=>{a.props.visible=!1}).finally(()=>{a.props.okButtonProps={},a.props.cancelButtonProps={},c()})}function d(e){return r||(r=u(o.onClose(e),()=>{a.props.okButtonProps.loading=!0}).finally(()=>{r=null})),r}function m(e){return r||(r=u(o.onDismiss(e),()=>{a.props.cancelButtonProps.loading=!0}).finally(()=>{r=null})),r}document.body.appendChild(s),a.props.onOk=d,a.props.onCancel=m,a.props.afterClose=function(){setTimeout(()=>{i.a.unmountComponentAtNode(s),document.body.removeChild(s)},10)},a.close=d,a.dismiss=m;var p={close:d,dismiss:m,update:e=>{t=Oa(Oa({},t),e),c()},onClose:e=>(Object(l.isFunction)(e)&&(o.onClose=e),p),onDismiss:e=>(Object(l.isFunction)(e)&&(o.onDismiss=e),p)};return c(),p}(e,t)}}function Ca(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];setTimeout(()=>{!1===dt(e)?window.location=e:(e=Ze.parse(e),A.update({path:e.pathname,search:e.search,hash:e.hash},t))},10)}var xa=[],Pa=Object(l.debounce)(()=>{var e=xa;xa=[],B.post("api/events",e)},1e3);function La(e,t,a,r){var n={action:e,object_type:t,object_id:a,timestamp:Date.now()/1e3,screen_resolution:"".concat(window.screen.width,"x").concat(window.screen.height)};Object(l.extend)(n,r),xa.push(n),Pa()}var ka=6,Na=50,Aa=15,Ta=800,Wa=3,Ia=3,qa=1,Da=6,Ra=1,Ma=1e3,za=a(15),Fa=a.n(za);var Va=class{constructor(e,t){this.title=e.title,this.name=e.name,this.type=e.type,this.global=e.global,this.parentQueryId=t,this.locals=[],this.urlPrefix="p_"}static getExecutionValue(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(l.isObject)(e)&&Object(l.isFunction)(e.getExecutionValue)?e.getExecutionValue(t):null}static setValue(e,t){return Object(l.isObject)(e)&&Object(l.isFunction)(e.setValue)?e.setValue(t):null}get isEmpty(){return Object(l.isNull)(this.normalizedValue)}get hasPendingValue(){return void 0!==this.pendingValue&&!Object(l.isEqual)(this.pendingValue,this.normalizedValue)}get normalizedValue(){return this.$$value}isEmptyValue(e){return Object(l.isNull)(this.normalizeValue(e))}normalizeValue(e){return Object(l.isUndefined)(e)?null:e}updateLocals(){Object(l.isArray)(this.locals)&&Object(l.each)(this.locals,e=>{e.setValue(this.value)})}setValue(e){var t=this.normalizeValue(e);return this.value=t,this.$$value=t,this.updateLocals(),this.clearPendingValue(),this}getExecutionValue(){return this.value}setPendingValue(e){this.pendingValue=this.normalizeValue(e)}applyPendingValue(){this.hasPendingValue&&this.setValue(this.pendingValue)}clearPendingValue(){this.pendingValue=void 0}toUrlParams(){var e=this.urlPrefix;return{["".concat(e).concat(this.name)]:this.isEmpty?null:this.value}}fromUrlParams(e){var t=this.urlPrefix,a="".concat(t).concat(this.name);Object(l.has)(e,a)&&this.setValue(e[a])}toQueryTextFragment(){return"{{ ".concat(this.name," }}")}toSaveableObject(){return Object(l.omit)(this,["$$value","urlPrefix","pendingValue","parentQueryId"])}};var Ua=class extends Va{constructor(e,t){super(e,t),this.setValue(e.value)}normalizeValue(e){var t=Object(l.toString)(e);return Object(l.isEmpty)(t)?null:t}};var Ba=class extends Va{constructor(e,t){super(e,t),this.setValue(e.value)}normalizeValue(e){if(Object(l.isNull)(e))return null;var t=Object(l.toNumber)(e);return isNaN(t)?null:t}};a(103);var Ha=class extends Va{constructor(e,t){super(e,t),this.enumOptions=e.enumOptions,this.multiValuesOptions=e.multiValuesOptions,this.setValue(e.value)}normalizeValue(e){if(Object(l.isEmpty)(this.enumOptions))return null;var t=this.enumOptions.split("\n")||[];return this.multiValuesOptions?(Object(l.isArray)(e)||(e=[e]),e=Object(l.intersection)(e,t)):e&&!Object(l.isArray)(e)&&Object(l.includes)(t,e)||(e=t[0]),Object(l.isArray)(e)&&Object(l.isEmpty)(e)?null:e}getExecutionValue(){if((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).joinListValues&&Object(l.isArray)(this.value)){var e=Object(l.get)(this.multiValuesOptions,"separator",","),t=Object(l.get)(this.multiValuesOptions,"prefix",""),a=Object(l.get)(this.multiValuesOptions,"suffix",""),r=Object(l.map)(this.value,e=>"".concat(t).concat(e).concat(a));return Object(l.join)(r,e)}return this.value}toUrlParams(){var e=this.urlPrefix,t=this.value;return this.multiValuesOptions&&Object(l.isArray)(this.value)&&(t=JSON.stringify(this.value)),{["".concat(e).concat(this.name)]:this.isEmpty?null:t}}fromUrlParams(e){var t=this.urlPrefix,a="".concat(t).concat(this.name);if(Object(l.has)(e,a))if(this.multiValuesOptions)try{var r=JSON.parse(e[a]);this.setValue(Object(l.isArray)(r)?r:e[a])}catch(t){this.setValue(e[a])}else this.setValue(e[a])}},Ya=(a(487),a(255)),Qa=a.n(Ya),Ka=v()("redash:services:QueryResult"),$a=["filter","multi-filter","multiFilter"];function Ga(e){return function(e){var t;if(-1!==e.indexOf("::"))t="::";else{if(-1===e.indexOf("__"))return e;t="__"}var a=e.split(t);return""===a[0]&&2===a.length?a[1]:Object(l.includes)($a,a[1])?a[0]:e}(e).replace(/(?:^|\s)\S/g,e=>e.toUpperCase())}var Ja=e=>{var t=e.id;return B.get("api/query_results/".concat(t))},Xa=e=>B.post((e=>e.id?"api/query_results/".concat(e.id):"api/query_results")(e),e),Za="waiting",er="processing",tr="done",ar="failed",rr="loading-result",nr={1:Za,2:er,3:tr,4:ar};function or(e,t){switch(Object(l.get)(t,"response.status")){case 403:return void e.update(t.response.data);case 400:if("job"in t.response.data)return void e.update(t.response.data);break;case 404:return void e.update({job:{error:"cached query result unavailable, please execute again.",status:4}})}Ka("Unknown error",t),e.update({job:{error:Object(l.get)(t,"response.data.message","Unknown error occurred. Please try again later."),status:4}})}function ir(e){return new Promise(t=>setTimeout(t,e))}function lr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;return B.get("api/jobs/".concat(e)).then(e=>{var a=nr[e.job.status];return a===Za||a===er?ir(t).then(()=>lr(e.job.id)):a===tr?e.job.result:a===ar?Promise.reject(e.job.error):void 0})}class sr{constructor(e){var t;this.deferred=((t={onStatusChange:e=>{}}).promise=new Promise((e,a)=>{t.resolve=e,t.reject=a}),t),this.job={},this.query_result={},this.status="waiting",this.updatedAt=Fa()(),this.isLoadingResult=!1,e&&this.update(e)}update(e){if(Object(l.extend)(this,e),"query_result"in e){this.status=tr,this.deferred.onStatusChange(tr);var t={};Object(l.each)(this.query_result.data.rows,e=>{Object(l.forOwn)(e,(a,r)=>{var n=null;Object(l.isNumber)(a)?n="float":Object(l.isString)(a)&&a.match(/^\d{4}-\d{2}-\d{2}T/)?(e[r]=Fa.a.utc(a),n="datetime"):Object(l.isString)(a)&&a.match(/^\d{4}-\d{2}-\d{2}$/)?(e[r]=Fa.a.utc(a),n="date"):"object"==typeof a&&null!==a?e[r]=JSON.stringify(a):n="string",null!==n&&(void 0!==t[r]&&t[r]!==n?t[r]="string":t[r]=n)})}),Object(l.each)(this.query_result.data.columns,e=>{e.name=""+e.name,t[e.name]&&(null!=e.type&&"string"!==e.type||(e.type=t[e.name]))}),this.deferred.resolve(this)}else 3===this.job.status||2===this.job.status?(this.deferred.onStatusChange(er),this.status="processing"):4===this.job.status?(this.status=nr[this.job.status],this.deferred.reject(new vr(this.job.error))):(this.deferred.onStatusChange(void 0),this.status=void 0)}getId(){var e=null;return"query_result"in this&&(e=this.query_result.id),e}cancelExecution(){B.delete("api/jobs/".concat(this.job.id))}getStatus(){return this.isLoadingResult?rr:this.status||nr[this.job.status]}getError(){if("None"!==this.job.error)return this.job.error}getLog(){return this.query_result.data&&this.query_result.data.log&&0!==this.query_result.data.log.length?this.query_result.data.log:null}getUpdatedAt(){return this.query_result.retrieved_at||1e3*this.job.updated_at||this.updatedAt}getRuntime(){return this.query_result.runtime}getRawData(){return this.query_result.data?this.query_result.data.rows:null}getData(){return this.query_result.data?this.query_result.data.rows:null}isEmpty(){return null===this.getData()||0===this.getData().length}getColumns(){return void 0===this.columns&&this.query_result.data&&(this.columns=this.query_result.data.columns),this.columns}getColumnNames(){return void 0===this.columnNames&&this.query_result.data&&(this.columnNames=this.query_result.data.columns.map(e=>e.name)),this.columnNames}getColumnFriendlyNames(){return this.getColumnNames().map(e=>Ga(e))}getTruncated(){return this.query_result.data?this.query_result.data.truncated:null}getFilters(){if(!this.getColumns())return[];var e=[];return this.getColumns().forEach(t=>{var a=t.name,r=a.split("::")[1]||a.split("__")[1];if(Object(l.includes)($a,r)){var n={name:a,friendlyName:Ga(a),column:t,values:[],multiple:"multiFilter"===r||"multi-filter"===r};e.push(n)}},this),this.getRawData().forEach(t=>{e.forEach(e=>{e.values.push(t[e.name]),1===e.values.length&&(e.multiple?e.current=[t[e.name]]:e.current=t[e.name])})}),e.forEach(e=>{e.values=Object(l.uniqBy)(e.values,e=>Fa.a.isMoment(e)?e.unix():e),e.values.length>1&&e.multiple&&(e.current=e.values.slice())}),e}toPromise(e){return e&&(this.deferred.onStatusChange=e),this.deferred.promise}static getById(e,t){var a=new sr;return a.isLoadingResult=!0,a.deferred.onStatusChange(rr),B.get("api/queries/".concat(e,"/results/").concat(t,".json")).then(e=>{a.isLoadingResult=!1,a.update(e)}).catch(e=>{a.isLoadingResult=!1,or(a,e)}),a}loadLatestCachedResult(e,t){B.post("api/queries/".concat(e,"/results"),{queryId:e,parameters:t}).then(e=>{this.update(e)}).catch(e=>{or(this,e)})}loadResult(e){this.isLoadingResult=!0,this.deferred.onStatusChange(rr),Ja({id:this.job.query_result_id}).then(e=>{this.update(e),this.isLoadingResult=!1}).catch(t=>{void 0===e&&(e=0),e>3?(Ka("Connection error while trying to load result",t),this.update({job:{error:"failed communicating with server. Please check your Internet connection and try again.",status:4}}),this.isLoadingResult=!1):setTimeout(()=>{this.loadResult(e+1)},1e3*Math.pow(2,e))})}refreshStatus(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=()=>X.isAuthenticated()?this.loadResult():this.loadLatestCachedResult(e,t);(X.isAuthenticated()?B.get("api/jobs/".concat(this.job.id)):B.get("api/queries/".concat(e,"/jobs/").concat(this.job.id))).then(n=>{if(this.update(n),"processing"===this.getStatus()&&this.job.query_result_id&&"None"!==this.job.query_result_id)r();else if("failed"!==this.getStatus()){setTimeout(()=>{this.refreshStatus(e,t,a+1)},a>10?3e3:500)}}).catch(e=>{Ka("Connection error",e),this.update({job:{error:"failed communicating with server. Please check your Internet connection and try again.",status:4}})})}getLink(e,t,a){var r="api/queries/".concat(e,"/results/").concat(this.getId(),".").concat(t);return a&&(r="".concat(r,"?api_key=").concat(a)),r}getName(e,t){return"".concat(e.replace(/ /g,"_")+Fa()(this.getUpdatedAt()).format("_YYYY_MM_DD"),".").concat(t)}static getByQueryId(e,t,a,r){var n=new sr;return B.post("api/queries/".concat(e,"/results"),{id:e,parameters:t,apply_auto_limit:a,max_age:r}).then(a=>{n.update(a),"job"in a&&n.refreshStatus(e,t)}).catch(e=>{or(n,e)}),n}static get(e,t,a,r,n,o){var i=new sr,l={data_source_id:e,parameters:a,query:t,apply_auto_limit:r,max_age:n};return void 0!==o&&(l.query_id=o),Xa(l).then(e=>{i.update(e),"job"in e&&i.refreshStatus(t,a)}).catch(e=>{or(i,e)}),i}}var cr=sr,ur="localOptions:";var dr={get:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,a=ur+e;return a in window.localStorage?JSON.parse(window.localStorage.getItem(a)):t},set:function(e,t){var a=ur+e;window.localStorage.setItem(a,JSON.stringify(t))}};function mr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function pr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?mr(Object(a),!0).forEach((function(t){fr(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):mr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function fr(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function gr(){return(gr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}Qa.a.escape=l.identity;var br=v()("redash:services:query");class hr{constructor(e){Object(l.extend)(this,e),Object(l.has)(this,"options")||(this.options={}),this.options.apply_auto_limit=!!this.options.apply_auto_limit,Object(l.isArray)(this.options.parameters)||(this.options.parameters=[])}isNew(){return void 0===this.id}hasDailySchedule(){return this.schedule&&null!==this.schedule.match(/\d\d:\d\d/)}scheduleInLocalTime(){var e=this.schedule.split(":");return Fa.a.utc().hour(e[0]).minute(e[1]).local().format("HH:mm")}hasResult(){return!(!this.latest_query_data&&!this.latest_query_data_id)}paramsRequired(){return this.getParameters().isRequired()}hasParameters(){return this.getParametersDefs().length>0}prepareQueryResultExecution(e,t){var a=this.getParameters(),r=a.getMissing();if(r.length>0){var n="parameter",o="value";return r.length>1&&(n="parameters",o="values"),new cr({job:{error:"missing ".concat(o," for ").concat(r.join(", ")," ").concat(n,"."),status:4}})}return a.isRequired()&&(this.latest_query_data=null,this.latest_query_data_id=null),this.latest_query_data&&0!==t?this.queryResult||(this.queryResult=new cr({query_result:this.latest_query_data})):this.latest_query_data_id&&0!==t?this.queryResult||(this.queryResult=cr.getById(this.id,this.latest_query_data_id)):this.queryResult=e(),this.queryResult}getQueryResult(e){return this.prepareQueryResultExecution(()=>cr.getByQueryId(this.id,this.getParameters().getExecutionValues(),this.getAutoLimit(),e),e)}getQueryResultByText(e,t){var a=t||this.query;if(!a)return new vr(window.W_L.empty_query);var r=this.getParameters().getExecutionValues({joinListValues:!0});return this.prepareQueryResultExecution(()=>cr.get(this.data_source_id,a,r,this.getAutoLimit(),e,this.id),e)}getUrl(e,t){var a="queries/".concat(this.id);e&&(a+="/source");var r={};return this.getParameters().isRequired()&&this.getParametersDefs().forEach(e=>{Object(l.extend)(r,e.toUrlParams())}),Object.keys(r).forEach(e=>null==r[e]&&delete r[e]),""!==(r=Object(l.map)(r,(e,t)=>"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(e))).join("&"))&&(a+="?".concat(r)),t&&(a+="#".concat(t)),a}getQueryResultPromise(){return this.getQueryResult().toPromise()}getParameters(){return this.$parameters||(this.$parameters=new yr(this,A.search)),this.$parameters}getAutoLimit(){return this.options.apply_auto_limit}getParametersDefs(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.getParameters().get(e)}favorite(){return hr.favorite(this)}unfavorite(){return hr.unfavorite(this)}clone(){var e=Object(l.clone)(this);return e.$parameters=null,e.getParameters(),e}}class yr{constructor(e,t){this.query=e,this.updateParameters(),this.initFromQueryString(t)}parseQuery(){var e=()=>Object(l.map)(this.query.options.parameters,e=>e.name),t=[];if(void 0!==this.query.query)try{var a=Qa.a.parse(this.query.query);t=Object(l.uniq)(function e(t){var a=[];return t.forEach(t=>{"name"===t[0]||"&"===t[0]?a.push(t[1].split(".")[0]):"#"===t[0]&&(a=Object(l.union)(a,e(t[4])))}),a}(a))}catch(a){br("Failed parsing parameters: ",a),t=e()}else t=e();return t}updateParameters(e){if(this.query.query!==this.cachedQueryText){this.cachedQueryText=this.query.query;var t=e?this.parseQuery():Object(l.map)(this.query.options.parameters,e=>e.name);this.query.options.parameters=this.query.options.parameters||[];var a={};this.query.options.parameters.forEach(e=>{a[e.name]=e}),t.forEach(e=>{Object(l.has)(a,e)||this.query.options.parameters.push(Br({title:e,name:e,type:"text",value:null,global:!1}))});var r=this.query.options.parameters;this.query.options.parameters=r.filter(e=>Object(l.includes)(t,e.name)).map(e=>e instanceof Va?e:Br(e,this.query.id))}else{var n=this.query.options.parameters;Object(l.find)(n,e=>!(e instanceof Va))&&(this.query.options.parameters=Object(l.map)(n,e=>e instanceof Va?e:Br(e,this.query.id)))}}initFromQueryString(e){this.get().forEach(t=>{t.fromUrlParams(e)})}get(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.updateParameters(e),this.query.options.parameters}add(e){this.query.options.parameters=this.query.options.parameters.filter(t=>t.name!==e.name);var t=Br(e);return this.query.options.parameters.push(t),t}getMissing(){return Object(l.map)(Object(l.filter)(this.get(),e=>e.isEmpty),e=>e.title)}isRequired(){return!Object(l.isEmpty)(this.get())}getExecutionValues(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.get();return Object(l.zipObject)(Object(l.map)(t,e=>e.name),Object(l.map)(t,t=>t.getExecutionValue(e)))}hasPendingValues(){return Object(l.some)(this.get(),e=>e.hasPendingValue)}applyPendingValues(){Object(l.each)(this.get(),e=>e.applyPendingValue())}toUrlParams(){if(0===this.get().length)return"";var e=gr(...this.get().map(e=>e.toUrlParams()));return Object.keys(e).forEach(t=>null==e[t]&&delete e[t]),Object.keys(e).map(t=>"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(e[t]))).join("&")}}class vr{constructor(e){this.errorMessage=e,this.updatedAt=Fa.a.utc()}getUpdatedAt(){return this.updatedAt}getError(){return this.errorMessage}toPromise(){return Promise.reject(this)}getStatus(){return"failed"}getData(){return null}getLog(){return null}}var wr=e=>new hr(e),Or=e=>pr(pr({},e),{},{results:Object(l.map)(e.results,wr)}),_r={query:e=>B.get("api/queries",{params:e}).then(Or),get:e=>B.get("api/queries/".concat(e.id),e).then(wr),save:e=>B.post((e=>e.id?"api/queries/".concat(e.id):"api/queries")(e),e).then(wr),delete:e=>B.delete("api/queries/".concat(e.id)),recent:e=>B.get("api/queries/recent",{params:e}).then(e=>Object(l.map)(e,wr)),archive:e=>B.get("api/queries/archive",{params:e}).then(Or),myQueries:e=>B.get("api/queries/my",{params:e}).then(Or),fork:e=>{var t=e.id;return B.post("api/queries/".concat(t,"/fork"),{id:t}).then(wr)},resultById:e=>B.get("api/queries/".concat(e.id,"/results.json")),asDropdown:e=>B.get("api/queries/".concat(e.id,"/dropdown")),associatedDropdown:e=>{var t=e.queryId,a=e.dropdownQueryId;return B.get("api/queries/".concat(t,"/dropdowns/").concat(a))},favorites:e=>B.get("api/queries/favorites",{params:e}).then(Or),favorite:e=>B.post("api/queries/".concat(e.id,"/favorite")),unfavorite:e=>B.delete("api/queries/".concat(e.id,"/favorite")),newQuery:function(){return new hr({query:"",name:window.W_L.new_Query,schedule:null,user:H,options:{apply_auto_limit:dr.get("applyAutoLimit",!0)},tags:[],can_edit:!0})}};Object(l.extend)(hr,_r);var Er=class extends Va{constructor(e,t){super(e,t),this.queryId=e.queryId,this.multiValuesOptions=e.multiValuesOptions,this.setValue(e.value)}normalizeValue(e){return Object(l.isUndefined)(e)||Object(l.isNull)(e)||Object(l.isArray)(e)&&Object(l.isEmpty)(e)?null:e=this.multiValuesOptions?Object(l.isArray)(e)?e:[e]:Object(l.isArray)(e)?e[0]:e}getExecutionValue(){if((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).joinListValues&&Object(l.isArray)(this.value)){var e=Object(l.get)(this.multiValuesOptions,"separator",","),t=Object(l.get)(this.multiValuesOptions,"prefix",""),a=Object(l.get)(this.multiValuesOptions,"suffix",""),r=Object(l.map)(this.value,e=>"".concat(t).concat(e).concat(a));return Object(l.join)(r,e)}return this.value}toUrlParams(){var e=this.urlPrefix,t=this.value;return this.multiValuesOptions&&Object(l.isArray)(this.value)&&(t=JSON.stringify(this.value)),{["".concat(e).concat(this.name)]:this.isEmpty?null:t}}fromUrlParams(e){var t=this.urlPrefix,a="".concat(t).concat(this.name);if(Object(l.has)(e,a))if(this.multiValuesOptions)try{var r=JSON.parse(e[a]);this.setValue(Object(l.isArray)(r)?r:e[a])}catch(t){this.setValue(e[a])}else this.setValue(e[a])}loadDropdownValues(){return this.parentQueryId?hr.associatedDropdown({queryId:this.parentQueryId,dropdownQueryId:this.queryId}).catch(()=>Promise.resolve([])):hr.asDropdown({id:this.queryId}).catch(Promise.resolve([]))}},jr={date:"YYYY-MM-DD","datetime-local":"YYYY-MM-DD HH:mm","datetime-with-seconds":"YYYY-MM-DD HH:mm:ss"},Sr={now:{name:"Today/Now",value:()=>Fa()()},yesterday:{name:"Yesterday",value:()=>Fa()().subtract(1,"day")}},Cr=ae.a.oneOf(Object(l.values)(Sr));function xr(e){return Object(l.startsWith)(e,"d_")&&Object(l.has)(Sr,e.substring("d_".length))}function Pr(e){return Object(l.includes)(Sr,e)}function Lr(e){return xr(e)?Sr[e.substring("d_".length)]:null}var kr=class extends Va{constructor(e,t){super(e,t),this.useCurrentDateTime=e.useCurrentDateTime,this.setValue(e.value)}get hasDynamicValue(){return Pr(this.normalizedValue)}normalizeValue(e){if(xr(e))return Lr(e);if(Pr(e))return e;var t=Fa()(e);return t.isValid()?t:null}setValue(e){var t=this.normalizeValue(e);return Pr(t)?this.value="d_"+Object(l.findKey)(Sr,t):Fa.a.isMoment(t)?this.value=t.format(jr[this.type]):this.value=t,this.$$value=t,this.updateLocals(),this.clearPendingValue(),this}getExecutionValue(){return this.hasDynamicValue?this.normalizedValue.value().format(jr[this.type]):Object(l.isNull)(this.value)&&this.useCurrentDateTime?Fa()().format(jr[this.type]):this.value}};function Nr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ar(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ar(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ar(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var Tr={"date-range":"YYYY-MM-DD","datetime-range":"YYYY-MM-DD HH:mm","datetime-range-with-seconds":"YYYY-MM-DD HH:mm:ss"},Wr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>Fa()();return function(){var a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return[e(),a?t():void 0]}},Ir={today:{name:"Today",value:()=>[Fa()().startOf("day"),Fa()().endOf("day")]},yesterday:{name:"Yesterday",value:()=>[Fa()().subtract(1,"day").startOf("day"),Fa()().subtract(1,"day").endOf("day")]},this_week:{name:"This week",value:()=>[Fa()().startOf("week"),Fa()().endOf("week")]},this_month:{name:"This month",value:()=>[Fa()().startOf("month"),Fa()().endOf("month")]},this_year:{name:"This year",value:()=>[Fa()().startOf("year"),Fa()().endOf("year")]},last_week:{name:"Last week",value:()=>[Fa()().subtract(1,"week").startOf("week"),Fa()().subtract(1,"week").endOf("week")]},last_month:{name:"Last month",value:()=>[Fa()().subtract(1,"month").startOf("month"),Fa()().subtract(1,"month").endOf("month")]},last_year:{name:"Last year",value:()=>[Fa()().subtract(1,"year").startOf("year"),Fa()().subtract(1,"year").endOf("year")]},last_hour:{name:"Last hour",value:Wr(()=>Fa()().subtract(1,"hour"))},last_8_hours:{name:"Last 8 hours",value:Wr(()=>Fa()().subtract(8,"hour"))},last_24_hours:{name:"Last 24 hours",value:Wr(()=>Fa()().subtract(24,"hour"))},last_7_days:{name:"Last 7 days",value:Wr(()=>Fa()().subtract(7,"days").startOf("day"),()=>Fa()().endOf("day"))},last_14_days:{name:"Last 14 days",value:Wr(()=>Fa()().subtract(14,"days").startOf("day"),()=>Fa()().endOf("day"))},last_30_days:{name:"Last 30 days",value:Wr(()=>Fa()().subtract(30,"days").startOf("day"),()=>Fa()().endOf("day"))},last_60_days:{name:"Last 60 days",value:Wr(()=>Fa()().subtract(60,"days").startOf("day"),()=>Fa()().endOf("day"))},last_90_days:{name:"Last 90 days",value:Wr(()=>Fa()().subtract(90,"days").startOf("day"),()=>Fa()().endOf("day"))},last_12_months:{name:"Last 12 months",value:Wr(()=>Fa()().subtract(12,"months").startOf("day"),()=>Fa()().endOf("day"))}},qr=ae.a.oneOf(Object(l.values)(Ir));function Dr(e){return!!Object(l.startsWith)(e,"d_")&&!!Ir[e.substring("d_".length)]}function Rr(e){return Object(l.includes)(Ir,e)}function Mr(e){return Dr(e)?Ir[e.substring("d_".length)]:null}var zr=class extends Va{constructor(e,t){super(e,t),this.setValue(e.value)}get hasDynamicValue(){return Rr(this.normalizedValue)}normalizeValue(e){return Dr(e)?Mr(e):Rr(e)?e:(Object(l.isObject)(e)&&!Object(l.isArray)(e)&&(e=[e.start,e.end]),Object(l.isArray)(e)&&2===e.length&&(e=[Fa()(e[0]),Fa()(e[1])])[0].isValid()&&e[1].isValid()?e:null)}setValue(e){var t=this.normalizeValue(e);return Rr(t)?this.value="d_"+Object(l.findKey)(Ir,t):Object(l.isArray)(t)?this.value={start:t[0].format(Tr[this.type]),end:t[1].format(Tr[this.type])}:this.value=t,this.$$value=t,this.updateLocals(),this.clearPendingValue(),this}getExecutionValue(){if(this.hasDynamicValue){var e=Nr(this.normalizedValue.value().map(e=>e.format(Tr[this.type])),2);return{start:e[0],end:e[1]}}return this.value}toUrlParams(){var e=this.urlPrefix;return Object(l.isObject)(this.value)&&this.value.start&&this.value.end?{["".concat(e).concat(this.name)]:"".concat(this.value.start,"--").concat(this.value.end)}:super.toUrlParams()}fromUrlParams(e){var t=this.urlPrefix,a="".concat(t).concat(this.name),r="".concat(t).concat(this.name,".start"),n="".concat(t).concat(this.name,".end");if(Object(l.has)(e,a)){var o=e[a].split("--");2===o.length?this.setValue(o):this.setValue(e[a])}else Object(l.has)(e,r)&&Object(l.has)(e,n)&&this.setValue([e[r],e[n]])}toQueryTextFragment(){return"{{ ".concat(this.name,".start }} {{ ").concat(this.name,".end }}")}};function Fr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Vr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Fr(Object(a),!0).forEach((function(t){Ur(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Fr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ur(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Br(e,t){switch(e.type){case"number":return new Ba(e,t);case"enum":return new Ha(e,t);case"query":return new Er(e,t);case"date":case"datetime-local":case"datetime-with-seconds":return new kr(e,t);case"date-range":case"datetime-range":case"datetime-range-with-seconds":return new zr(e,t);default:return new Ua(Vr(Vr({},e),{},{type:"text"}),t)}}function Hr(e){return Br(e,e.parentQueryId)}var Yr=a(18),Qr=a.n(Yr),Kr=new Map;function $r(){Kr.size>0&&(Kr.forEach((e,t)=>{var a=t.getBoundingClientRect(),r=Math.round(10*a.width),n=Math.round(10*a.height);e.width===r&&e.height===n||(e.width=r,e.height=n,e.callback(t))}),setTimeout($r,100))}function Gr(e,t){if(e&&!Kr.has(e)){var a=0===Kr.size;return Kr.set(e,{callback:t}),a&&$r(),()=>Kr.delete(e)}return()=>{}}var Jr=ae.a.object,Xr=ae.a.shape({columns:ae.a.arrayOf(ae.a.object).isRequired,rows:ae.a.arrayOf(ae.a.object).isRequired}),Zr=ae.a.shape({id:ae.a.number,type:ae.a.string.isRequired,name:ae.a.string.isRequired,options:Jr.isRequired}),en={visualizationName:ae.a.string,data:Xr.isRequired,options:Jr.isRequired,onOptionsChange:ae.a.func},tn={visualizationName:ae.a.string,data:Xr.isRequired,options:Jr.isRequired,onOptionsChange:ae.a.func.isRequired};a(168);function an(e){return[0,e.length-1]}function rn(e){return[d3.quantile(e,.25),d3.quantile(e,.5),d3.quantile(e,.75)]}var nn=function(){var e=1,t=1,a=0,r=null,n=Number,o=an,i=rn,l=null;function s(s){s.each((function(s,c){s=s.map(n).sort(d3.ascending);var u=d3.select(this),d=s.length,m=s[0],p=s[d-1],f=s.quartiles=i(s),g=o&&o.call(this,s,c),b=g&&g.map(e=>s[e]),h=g?d3.range(0,g[0]).concat(d3.range(g[1]+1,d)):d3.range(d),y=d3.scale.linear().domain(r&&r.call(this,s,c)||[m,p]).range([t,0]),v=this.__chart__||d3.scale.linear().domain([0,1/0]).range(y.range());this.__chart__=y;var w=u.selectAll("line.center").data(b?[b]:[]);w.enter().insert("line","rect").attr("class","center").attr("x1",e/2).attr("y1",e=>v(e[0])).attr("x2",e/2).attr("y2",e=>v(e[1])).style("opacity",1e-6).transition().duration(a).style("opacity",1).attr("y1",e=>y(e[0])).attr("y2",e=>y(e[1])),w.transition().duration(a).style("opacity",1).attr("y1",e=>y(e[0])).attr("y2",e=>y(e[1])),w.exit().transition().duration(a).style("opacity",1e-6).attr("y1",e=>y(e[0])).attr("y2",e=>y(e[1])).remove();var O=u.selectAll("rect.box").data([f]);O.enter().append("rect").attr("class","box").attr("x",0).attr("y",e=>v(e[2])).attr("width",e).attr("height",e=>v(e[0])-v(e[2])).transition().duration(a).attr("y",e=>y(e[2])).attr("height",e=>y(e[0])-y(e[2])),O.transition().duration(a).attr("y",e=>y(e[2])).attr("height",e=>y(e[0])-y(e[2])),O.exit().remove();var _=u.selectAll("line.median").data([f[1]]);_.enter().append("line").attr("class","median").attr("x1",0).attr("y1",v).attr("x2",e).attr("y2",v).transition().duration(a).attr("y1",y).attr("y2",y),_.transition().duration(a).attr("y1",y).attr("y2",y),_.exit().remove();var E=u.selectAll("line.whisker").data(b||[]);E.enter().insert("line","circle, text").attr("class","whisker").attr("x1",0).attr("y1",v).attr("x2",e).attr("y2",v).style("opacity",1e-6).transition().duration(a).attr("y1",y).attr("y2",y).style("opacity",1),E.transition().duration(a).attr("y1",y).attr("y2",y).style("opacity",1),E.exit().transition().duration(a).attr("y1",y).attr("y2",y).style("opacity",1e-6).remove();var j=u.selectAll("circle.outlier").data(h,Number);j.enter().insert("circle","text").attr("class","outlier").attr("r",5).attr("cx",e/2).attr("cy",e=>v(s[e])).style("opacity",1e-6).transition().duration(a).attr("cy",e=>y(s[e])).style("opacity",1),j.transition().duration(a).attr("cy",e=>y(s[e])).style("opacity",1),j.exit().transition().duration(a).attr("cy",e=>y(s[e])).style("opacity",1e-6).remove();var S=l||y.tickFormat(8),C=u.selectAll("text.box").data(f);C.enter().append("text").attr("class","box").attr("dy",".3em").attr("dx",(e,t)=>1&t?6:-6).attr("x",(t,a)=>1&a?e:0).attr("y",v).attr("text-anchor",(e,t)=>1&t?"start":"end").text(S).transition().duration(a).attr("y",y),C.transition().duration(a).text(S).attr("y",y),C.exit().remove();var x=u.selectAll("text.whisker").data(b||[]);x.enter().append("text").attr("class","whisker").attr("dy",".3em").attr("dx",6).attr("x",e).attr("y",v).text(S).style("opacity",1e-6).transition().duration(a).attr("y",y).style("opacity",1),x.transition().duration(a).text(S).attr("y",y).style("opacity",1),x.exit().transition().duration(a).attr("y",y).style("opacity",1e-6).remove()})),d3.timer.flush()}return s.width=function(t){return arguments.length?(e=t,s):e},s.height=function(e){return arguments.length?(t=e,s):t},s.tickFormat=function(e){return arguments.length?(l=e,s):l},s.duration=function(e){return arguments.length?(a=e,s):a},s.domain=function(e){return arguments.length?(r=null==e?e:d3.functor(e),s):r},s.value=function(e){return arguments.length?(n=e,s):n},s.whiskers=function(e){return arguments.length?(o=e,s):o},s.quartiles=function(e){return arguments.length?(i=e,s):i},s};a(894);function on(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ln(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ln(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ln(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function sn(e,t,a){var r,n=a.xAxisLabel,o=a.yAxisLabel,i=(e=Qr.a.select(e)).node().getBoundingClientRect(),s=Math.floor(i.width),c=Math.floor(i.height),u={top:10,right:50,bottom:40,left:50,inner:25},d=s-u.right-u.left,m=c-u.top-u.bottom,p=1/0,f=-1/0,g=[],b=0,h=[],y=Object(l.map)(t.columns,e=>e.name),v=Qr.a.scale.ordinal().domain(y).rangeBands([0,s-u.left-u.right]);r=y.length>1?Math.min(v(y[1]),120):120,u.inner=r/3,Object(l.each)(y,(e,a)=>{h=g[a]=[],Object(l.each)(t.rows,t=>{b=t[e],h.push(b),b>f&&(f=Math.ceil(b)),b<p&&(p=Math.floor(b))})});var w,O=Qr.a.scale.linear().domain([.99*p,1.01*f]).range([m,0]),_=nn().whiskers((w=1.5,e=>{var t=e.quartiles[0],a=e.quartiles[2],r=(a-t)*w,n=-1,o=e.length;for(n+=1;e[n]<t-r;)n+=1;for(o-=1;e[o]>a+r;)o-=1;return[n,o]})).width(r-2*u.inner).height(m).domain([.99*p,1.01*f]),E=Qr.a.svg.axis().scale(v).orient("bottom"),j=Qr.a.svg.axis().scale(O).orient("left"),S=Qr.a.svg.axis().scale(v).tickSize(m).orient("bottom"),C=Qr.a.svg.axis().scale(O).tickSize(d).orient("right");e.selectAll("*").remove();var x=e.append("svg").attr("width",s).attr("height",m+u.bottom+u.top),P=x.append("g").attr("width",s-u.left-u.right).attr("transform","translate(".concat(u.left,",").concat(u.top,")"));x.append("text").attr("class","box").attr("x",s/2).attr("text-anchor","middle").attr("y",m+u.bottom).text(n),x.append("text").attr("class","box").attr("transform","translate(10,".concat((m+u.top+u.bottom)/2,")rotate(-90)")).attr("text-anchor","middle").text(o),P.append("rect").attr("class","grid-background").attr("width",d).attr("height",m),P.append("g").attr("class","grid").call(C),P.append("g").attr("class","grid").call(S),P.append("g").attr("class","x axis").attr("transform","translate(0,".concat(m,")")).call(E),P.append("g").attr("class","y axis").call(j),P.selectAll(".box").data(g).enter().append("g").attr("class","box").attr("width",r).attr("height",m).attr("transform",(e,t)=>"translate(".concat(function(e){return v(y[e])+(v(y[1])-u.inner)/2}(t),",",0,")")).call(_)}function cn(e){var t=e.data,a=e.options,o=on(Object(r.useState)(null),2),i=o[0],l=o[1];return Object(r.useEffect)(()=>{if(i)return sn(i,t,a),Gr(i,()=>{sn(i,t,a)})},[i,t,a]),n.a.createElement("div",{className:"box-plot-deprecated-visualization-container",ref:l})}cn.propTypes=en;var un=a(23),dn=a.n(un),mn=a(117),pn=a.n(mn),fn=a(49),gn=a.n(fn),bn=a(142),hn=a.n(bn),yn=a(106),vn=a.n(yn),wn=a(99),On=a.n(wn);function _n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["#ffffff","#333333"];try{return e=On()(e),Object(l.maxBy)(t,t=>On.a.contrast(e,t))}catch(e){return null}}var En=a(156),jn=a.n(En),Sn=a(81),Cn=a.n(Sn),xn=a(77),Pn=a.n(xn);a(895);function Ln(){return(Ln=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function kn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Nn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?kn(Object(a),!0).forEach((function(t){An(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):kn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function An(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Tn(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Wn(e){var t=e.className,a=e.color,r=e.title,o=e.size,i=e.style,s=Tn(e,["className","color","title","size","style"]),c=n.a.createElement("span",Ln({className:me()("color-swatch",t),style:Nn({backgroundColor:a,width:o},i)},s));return Object(l.isString)(r)&&""!==r?n.a.createElement(he.a,{title:r,mouseEnterDelay:0,mouseLeaveDelay:0},c):c}Wn.defaultProps={className:null,style:null,title:null,color:"transparent",size:12};a(896);function In(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return qn(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return qn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qn(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Dn(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#";Object(l.isNil)(e)&&t(null),(e=Cn()(e)).isValid()&&t(a+e.toHex().toUpperCase())}function Rn(e){var t=e.color,a=e.presetColors,o=e.presetColumns,i=e.onChange,s=e.onPressEnter,c=In(Object(r.useState)(""),2),u=c[0],d=c[1],m=In(Object(r.useState)(!1),2),p=m[0],f=m[1],g=function(e,t){return e=Object(l.isArray)(e)?Object(l.map)(e,e=>[null,e]):Object(l.toPairs)(e),e=Object(l.map)(e,e=>{var t=In(e,2),a=t[0],r=t[1];return Object(l.isNil)(r)?[a,null]:(r=Cn()(r)).isValid()?[a,"#"+r.toHex().toUpperCase()]:null}),Object(l.chunk)(Object(l.filter)(e),t)}(a,o);return Object(r.useEffect)(()=>{p||Dn(t,d,"")},[t,p]),n.a.createElement(n.a.Fragment,null,Object(l.map)(g,(e,t)=>n.a.createElement("div",{className:"color-picker-input-swatches",key:"preset-row-".concat(t)},Object(l.map)(e,e=>{var t=In(e,2),a=t[0],r=t[1];return n.a.createElement(Wn,{key:r,color:r,title:a,size:30,onClick:()=>Dn(r,i)})}))),n.a.createElement("div",{className:"color-picker-input"},n.a.createElement(va.a,{"data-test":"ColorPicker.CustomColor",addonBefore:n.a.createElement(Pn.a.Text,{type:"secondary"},"#"),value:u,onChange:e=>{return t=e.target.value,d(t),void Dn(t,i);var t},onFocus:()=>f(!0),onBlur:()=>f(!1),onPressEnter:s})))}function Mn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(e=Cn()(e)).isValid()?"#"+e.toHex().toUpperCase():t}Rn.defaultProps={color:"#FFFFFF",presetColors:null,presetColumns:8,onChange:()=>{},onPressEnter:()=>{}};a(925);function zn(){return(zn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Fn(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Vn(e){var t=e.className,a=e.color,o=e.presetColors,i=Fn(e,["className","color","presetColors"]),s=Object(r.useMemo)(()=>function(e,t){return Object(l.isArray)(t)?e:Object(l.findKey)(t,t=>Mn(t)===e)||e}(Mn(a),o),[a,o]);return n.a.createElement("span",zn({className:me()("color-label",t)},i),s)}Vn.defaultProps={className:null,color:"#FFFFFF",presetColors:null};a(926);function Un(){return(Un=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Bn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Hn(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Hn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Hn(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Yn(e){var t=e.color,a=e.placement,o=e.presetColors,i=e.presetColumns,s=e.interactive,c=e.children,u=e.onChange,d=e.triggerProps,m=e.addonBefore,p=e.addonAfter,f=Bn(Object(r.useState)(!1),2),g=f[0],b=f[1],h=Object(r.useMemo)(()=>Mn(t),[t]),y=Bn(Object(r.useState)(""),2),v=y[0],w=y[1];function O(){b(!1),s||u(v)}var _=[];return s||(_.push(n.a.createElement(he.a,{key:"cancel",title:window.W_L.cancel},n.a.createElement(je.a,{onClick:function(){b(!1)}}))),_.push(n.a.createElement(he.a,{key:"apply",title:window.W_L.apply},n.a.createElement(jn.a,{onClick:O})))),Object(r.useEffect)(()=>{g&&w(h)},[h,g]),n.a.createElement("span",{className:"color-picker-wrapper"},m,n.a.createElement(hn.a,{arrowPointAtCenter:!0,overlayClassName:"color-picker ".concat(s?"color-picker-interactive":"color-picker-with-actions"),overlayStyle:{"--color-picker-selected-color":v},content:n.a.createElement(vn.a,{"data-test":"ColorPicker",className:"color-picker-panel",bordered:!1,title:Object(l.toString)(v).toUpperCase(),headStyle:{backgroundColor:v,color:_n(v)},actions:_},n.a.createElement(Rn,{color:v,presetColors:o,presetColumns:i,onChange:function(e){w(e),s&&u(e)},onPressEnter:O})),trigger:"click",placement:a,visible:g,onVisibleChange:b},c||n.a.createElement(Wn,Un({color:h,size:30},d,{className:me()("color-picker-trigger",d.className)}))),p)}Yn.defaultProps={color:"#FFFFFF",placement:"top",presetColors:null,presetColumns:8,interactive:!1,triggerProps:{},children:null,addonBefore:null,addonAfter:null,onChange:()=>{}},Yn.Input=Rn,Yn.Swatch=Wn,Yn.Label=Vn;var Qn=a(50),Kn=a.n(Qn),$n=a(663),Gn=a.n($n),Jn=a(664),Xn=a.n(Jn),Zn=a(665),eo=a.n(Zn);a(934);function to(){return(to=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ao(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function ro(e){var t=e.className,a=ao(e,["className"]);return n.a.createElement("div",Object(l.pickBy)(a,(e,t)=>Object(l.startsWith)(t,"data-")),n.a.createElement(Kn.a.Group,to({className:me()("text-alignment-select",t)},a),n.a.createElement(he.a,{title:window.W_L.left_align,mouseEnterDelay:0,mouseLeaveDelay:0},n.a.createElement(Kn.a.Button,{value:"left","data-test":"TextAlignmentSelect.Left"},n.a.createElement(Gn.a,null))),n.a.createElement(he.a,{title:window.W_L.center,mouseEnterDelay:0,mouseLeaveDelay:0},n.a.createElement(Kn.a.Button,{value:"center","data-test":"TextAlignmentSelect.Center"},n.a.createElement(Xn.a,null))),n.a.createElement(he.a,{title:window.W_L.right_align,mouseEnterDelay:0,mouseLeaveDelay:0},n.a.createElement(Kn.a.Button,{value:"right","data-test":"TextAlignmentSelect.Right"},n.a.createElement(eo.a,null)))))}ro.defaultProps={className:null};var no=a(316),oo=a.n(no),io=a(36);a(944);function lo(){return(lo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function so(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function co(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?so(Object(a),!0).forEach((function(t){uo(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):so(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function uo(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function mo(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function po(e){var t=e.layout,a=e.label,r=e.labelProps,o=e.disabled,i=e.children;return"vertical"===t&&a?n.a.createElement("div",{className:"visualization-editor-control-label visualization-editor-control-label-vertical"},n.a.createElement("label",r,n.a.createElement(Pn.a.Text,{disabled:o},a)),i):"horizontal"===t&&a?n.a.createElement(io.Row,{className:"visualization-editor-control-label visualization-editor-control-label-horizontal",type:"flex",align:"middle",gutter:15},n.a.createElement(io.Col,{span:12},n.a.createElement("label",r,n.a.createElement(Pn.a.Text,{disabled:o},a))),n.a.createElement(io.Col,{span:12},i)):i}function fo(e){function t(t){var a=t.className,o=t.id,i=t.layout,l=t.label,s=t.labelProps,c=t.disabled,u=mo(t,["className","id","layout","label","labelProps","disabled"]),d=Object(r.useMemo)(()=>"visualization-editor-control-".concat(Math.random().toString(36).substr(2,10)),[]);return s=co(co({},s),{},{htmlFor:o||d}),n.a.createElement(po,{layout:i,label:l,labelProps:s,disabled:c},n.a.createElement(e,lo({className:me()("visualization-editor-input",a),id:s.htmlFor,disabled:c},u)))}return oo()(t,e),t}po.defaultProps={layout:"vertical",label:null,disabled:!1,children:null};var go=a(107),bo=a.n(go);function ho(){return(ho=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function yo(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var vo={replace:(e,t)=>Object(l.merge)({},t),shallowMerge:(e,t)=>Object(l.extend)({},e,t),deepMerge:(e,t)=>Object(l.merge)({},e,t)};function wo(e){var t=e.tabs,a=e.options,r=e.data,o=e.onOptionsChange,i=yo(e,["tabs","options","data","onOptionsChange"]),s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:vo.deepMerge;o(t(a,e))};return t=Object(l.filter)(t,e=>!Object(l.isFunction)(e.isAvailable)||e.isAvailable(a,r)),n.a.createElement(bo.a,{animated:!1,tabBarGutter:20},Object(l.map)(t,e=>{var t=e.key,o=e.title,c=e.component;return n.a.createElement(bo.a.TabPane,{key:t,tab:n.a.createElement("span",{"data-test":"VisualizationEditor.Tabs.".concat(t)},Object(l.isFunction)(o)?o(a):o)},n.a.createElement(c,ho({options:a,data:r,onOptionsChange:s},i)))}))}function Oo(e){return function(t){return n.a.createElement(wo,ho({},t,{tabs:e}))}}wo.defaultProps={tabs:[]};a(945);function _o(){return(_o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Eo(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function jo(e){var t=e.className,a=e.children,r=Eo(e,["className","children"]);return a?n.a.createElement("h4",_o({className:me()("visualization-editor-section-title",t)},r),a):null}function So(e){var t=e.className,a=e.children,r=Eo(e,["className","children"]);return n.a.createElement("div",_o({className:me()("visualization-editor-section",t)},r),a)}jo.defaultProps={className:null,children:null},So.defaultProps={className:null,children:null},So.Title=jo;var Co=a(116),xo=a.n(Co);a(946);function Po(){return(Po=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Lo(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function ko(e){var t=e.id,a=e.children,o=e.disabled,i=Lo(e,["id","children","disabled"]),l=Object(r.useMemo)(()=>"visualization-editor-control-".concat(Math.random().toString(36).substr(2,10)),[]);return t=t||l,a?n.a.createElement("label",{htmlFor:t,className:"switch-with-label"},n.a.createElement(xo.a,Po({id:t,disabled:o},i)),n.a.createElement(Pn.a.Text,{className:"switch-text",disabled:o},a)):n.a.createElement(xo.a,i)}ko.defaultProps={id:null,disabled:!1,children:null};a(948);function No(){return(No=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ao(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var To=fo((function(e){var t=e.className,a=Ao(e,["className"]);return n.a.createElement(va.a.TextArea,No({className:me()("visualization-editor-text-area",t)},a))})),Wo=a(317),Io=a.n(Wo);function qo(e){var t=e.title,a=e.href,r=e.className,o=e.children;return n.a.createElement(he.a,{title:n.a.createElement(n.a.Fragment,null,t,n.a.createElement("i",{className:"fa fa-external-link",style:{marginLeft:5}}))},n.a.createElement("a",{className:r,href:a,target:"_blank",rel:"noopener noreferrer"},o))}qo.defaultValues={title:null,className:null,children:null};var Do={HelpTriggerComponent:qo,LinkComponent:function(e){return n.a.createElement("a",e)},dateFormat:"DD/MM/YYYY",dateTimeFormat:"DD/MM/YYYY HH:mm",integerFormat:"0,0",floatFormat:"0,0.00",booleanValues:["false","true"],tableCellMaxJSONSize:5e4,allowCustomJSVisualizations:!1,hidePlotlyModeBar:!1,choroplethAvailableMaps:{}};a(949);function Ro(){return(Ro=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Mo(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function zo(e){var t=e.icon,a=e.children,r=Mo(e,["icon","children"]);return n.a.createElement(hn.a,Ro({},r,{content:a}),t||zo.defaultIcon)}zo.defaultProps={icon:null,children:null},zo.defaultIcon=n.a.createElement(Io.a,{className:"context-help-default-icon"}),zo.NumberFormatSpecs=function(){var e=Do.HelpTriggerComponent;return n.a.createElement(e,{type:"NUMBER_FORMAT_SPECS",title:window.W_L.formatting_numbers,href:"https://redash.io/help/user-guide/visualizations/formatting-numbers",className:"visualization-editor-context-help"},zo.defaultIcon)},zo.DateTimeFormatSpecs=function(){var e=Do.HelpTriggerComponent;return n.a.createElement(e,{title:window.W_L.formatting_dates_and_times,href:"https://momentjs.com/docs/#/displaying/format/",className:"visualization-editor-context-help"},zo.defaultIcon)};var Fo=fo(dn.a),Vo=fo(va.a),Uo=fo(pn.a),Bo=fo(Yn),Ho=fo(ro);function Yo(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Qo(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Yo(Object(a),!0).forEach((function(t){Ko(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Yo(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ko(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function $o(e){var t=e.options,a=e.onOptionsChange;return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Vo,{label:window.W_L.x_axis_label,"data-test":"BoxPlot.XAxisLabel",value:t.xAxisLabel,onChange:e=>{return r=e.target.value,n=Qo(Qo({},t),{},{xAxisLabel:r}),void a(n);var r,n}})),n.a.createElement(So,null,n.a.createElement(Vo,{label:window.W_L.y_axis_label,"data-test":"BoxPlot.YAxisLabel",value:t.yAxisLabel,onChange:e=>{return r=e.target.value,n=Qo(Qo({},t),{},{yAxisLabel:r}),void a(n);var r,n}})))}function Go(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Jo(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}$o.propTypes=tn;var Xo={type:"BOXPLOT",name:"箱线图(Boxplot)",isDeprecated:!0,getOptions:e=>function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Go(Object(a),!0).forEach((function(t){Jo(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Go(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e),Renderer:cn,Editor:$o,defaultRows:8,minRows:5},Zo={globalSeriesType:"column",sortX:!0,legend:{enabled:!0,placement:"auto",traceorder:"normal"},xAxis:{type:"-",labels:{enabled:!0}},yAxis:[{type:"linear"},{type:"linear",opposite:!0}],alignYAxesAtZero:!1,error_y:{type:"data",visible:!0},series:{stacking:null,error_y:{type:"data",visible:!0}},seriesOptions:{},valuesOptions:{},columnMapping:{},direction:{type:"counterclockwise"},sizemode:"diameter",coefficient:1,numberFormat:"0,0[.]00000",percentFormat:"0[.]00%",textFormat:"",missingValuesAsZero:!0};var ei=a(118),ti=a.n(ei);function ai(e,t,a){void 0===t[a]&&(t[a]={name:a,type:"column",data:[]}),t[a].data.push(e)}function ri(e,t){var a={},r=t.columnMapping;return Object(l.each)(e,e=>{var t={$raw:e},n=null,o=0,i={},s=null,c=null,u=null;Object(l.forOwn)(e,(e,a)=>{var l=(a=""+a).split("::")||a.split("__"),d=l[0],m=r?r[a]:l[1];"unused"!==m&&("x"===m&&(o=e,t[m]=e),"y"===m&&(i[d]=e,t[m]=e),"yError"===m&&(s=e,t[m]=e),"series"===m&&(n=String(e)),"size"===m&&(t[m]=e,c=e),"zVal"===m&&(t[m]=e,u=e),"multiFilter"!==m&&"multi-filter"!==m||(n=String(e)))}),Object(l.isNil)(n)?Object(l.each)(i,(e,r)=>{t={x:o,y:e,$raw:t.$raw},null!==s&&(t.yError=s),null!==c&&(t.size=c),null!==u&&(t.zVal=u),ai(t,a,r)}):ai(t,a,n)}),Object(l.sortBy)(Object(l.values)(a),e=>{var a=e.name;return Object(l.isObject)(t.seriesOptions[a])&&t.seriesOptions[a].zIndex||0})}var ni=a(318),oi=a.n(ni),ii=a(666),li=a.n(ii),si=a(667),ci=a.n(si),ui=a(668),di=a.n(ui),mi=a(669),pi=a.n(mi),fi=a(670),gi=a.n(fi);function bi(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function hi(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?bi(Object(a),!0).forEach((function(t){yi(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):bi(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function yi(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var vi={Blue:"#356AFF",Red:"#E92828",Green:"#3BD973",Purple:"#604FE9",Cyan:"#50F5ED",Orange:"#FB8D3D","Light Blue":"#799CFF",Lilac:"#B554FF","Light Green":"#8CFFB4",Brown:"#A55F2A",Black:"#000000",Gray:"#494949",Pink:"#FF7DE3","Dark Blue":"#002FB4"},wi=Object(l.values)(vi),Oi=hi(hi({},vi),{"Indian Red":"#981717","Green 2":"#17BF51","Green 3":"#049235","Dark Turquoise":"#00B6EB","Dark Violet":"#A58AFF","Pink 2":"#C63FA9"}),_i=a(422),Ei=a.n(_i);function ji(e){return Object(l.isUndefined)(e)?e:Ei()(e)}function Si(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"YYYY-MM-DD HH:mm:ss";return"datetime"===t&&Fa.a.utc(e).isValid()&&(e=Fa.a.utc(e)),Fa.a.isMoment(e)?e.format(a):e}function Ci(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function xi(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ci(Object(a),!0).forEach((function(t){Pi(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ci(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Pi(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Li(e){var t=e.length>2?2:1,a=Math.ceil(e.length/t);return{rows:t,cellsInRow:a,cellWidth:1/a,cellHeight:1/t,xPadding:.02,yPadding:.1}}function ki(e){var t="text";return/{{\s*@@x\s*}}/.test(e.textFormat)||(t+="+label"),t}function Ni(e,t){var a=Qr.a.scale.ordinal().domain([]).range(wi),r={};Object(l.each)(t.valuesOptions,(e,t)=>{Object(l.isString)(e.color)&&""!==e.color&&(r[t]=e.color)});var n=xi(xi({},Li(e)),{},{hasX:Object(l.includes)(t.columnMapping,"x"),hoverInfoPattern:ki(t),getValueColor:e=>r[e]||a(e)});return Object(l.map)(e,(e,a)=>function(e,t,a){var r=a.cellWidth,n=a.cellHeight,o=a.xPadding,i=a.yPadding,s=a.cellsInRow,c=a.hasX,u=a.index,d=a.hoverInfoPattern,m=a.getValueColor,p=Object(l.extend)({type:t.globalSeriesType,yAxis:0},t.seriesOptions[e.name]),f=u%s*r,g=Math.floor(u/s)*n,b=[],h=[],y=new Map,v=Object(l.reduce)(e.data,(e,t)=>{var a=ji(t.y);return e+Math.abs(a)},0);Object(l.each)(e.data,e=>{var a=c?Si(e.x,t.xAxis.type):"Slice ".concat(u),r=ji(e.y);b.push(a),h.push(r),y.set(a,{x:a,y:r,yPercent:r/v*100,row:e})});var w=Object(l.map)(e.data,e=>m(e.x)),O=Object(l.map)(w,e=>_n(e));return{visible:!0,values:h,labels:b,type:"pie",hole:.4,marker:{colors:w},hoverinfo:d,text:[],textinfo:t.showDataLabels?"percent":"none",textposition:"inside",textfont:{color:O},name:p.name||e.name,direction:t.direction.type,domain:{x:[f,f+r-o],y:[g,g+n-i]},sourceData:y}}(e,t,xi(xi({},n),{},{index:a})))}var Ai=a(671),Ti=a.n(Ai),Wi=a(162),Ii=a.n(Wi);Ii.a.options.scalePercentBy100=!1;var qi=/(^|[\s\n]|<br\/?>)((?:https?|ftp):\/\/[\-A-Z0-9+\u0026\u2019@#\/%?=()~_|!:,.;]*[\-A-Z0-9+\u0026@#\/%=~()_|])/gi,Di=Object.prototype.hasOwnProperty;function Ri(e){return Object(l.isString)(e)&&""!==e?t=>{var a=function(e){return Fa.a.isMoment(e)?e:Object(l.isFinite)(e)?Fa()(e):Fa()(Object(l.toString)(e),[Fa.a.ISO_8601,Fa.a.RFC_2822])}(t);return a.isValid()?a.format(e):Object(l.toString)(t)}:e=>Object(l.toString)(e)}function Mi(e){if(Object(l.isString)(e)&&""!==e){var t=Ii()(0);return a=>null===a||""===a?"":t.set(a).format(e)}return e=>Object(l.toString)(e)}function zi(e,t){return Object(l.isString)(e)?e.replace(/{{\s*([^\s]+?)\s*}}/g,(e,a)=>Di.call(t,a)&&!Object(l.isUndefined)(t[a])?t[a]:e):""}var Fi=[[0,"#356aff"],[.14,"#4a7aff"],[.28,"#5d87ff"],[.42,"#7398ff"],[.56,"#fb8c8c"],[.71,"#ec6463"],[.86,"#ec4949"],[1,"#e92827"]];function Vi(e,t){var a={colorScheme:t.colorScheme?"Custom..."===t.colorScheme?[[0,t.heatMinColor],[1,t.heatMaxColor]]:t.colorScheme:Fi,formatNumber:Mi(t.numberFormat)};return Object(l.flatten)(Object(l.map)(e,e=>function(e,t,a){var r=a.colorScheme,n=a.formatNumber,o={x:[],y:[],z:[],type:"heatmap",name:"",colorscale:r};o.x=Object(l.uniq)(Object(l.map)(e.data,e=>e.x)),o.y=Object(l.uniq)(Object(l.map)(e.data,e=>e.y)),t.sortX&&(o.x=Object(l.sortBy)(o.x)),t.sortY&&(o.y=Object(l.sortBy)(o.y)),t.reverseX&&o.x.reverse(),t.reverseY&&o.y.reverse();for(var i=Object(l.max)(Object(l.map)(e.data,e=>e.zVal)),s={x:[],y:[],mode:"text",hoverinfo:"skip",showlegend:!1,text:[],textfont:{color:[]}},c=0;c<o.y.length;c+=1){for(var u=[],d=0;d<o.x.length;d+=1){var m=Object(l.find)(e.data,{x:o.x[d],y:o.y[c]}),p=m&&m.zVal||0;u.push(p),isFinite(i)&&t.showDataLabels&&(s.x.push(o.x[d]),s.y.push(o.y[c]),s.text.push(n(p)),t.colorScheme&&"Custom..."===t.colorScheme?s.textfont.color.push("white"):s.textfont.color.push(p/i<.25?"white":"black"))}o.z.push(u)}return isFinite(i)&&t.showDataLabels?[o,s]:[o]}(e,t,a)))}function Ui(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Bi(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ui(Object(a),!0).forEach((function(t){Hi(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ui(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Hi(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Yi(e){var t="text";return/{{\s*@@x\s*}}/.test(e.textFormat)||(t+="+x"),/{{\s*@@name\s*}}/.test(e.textFormat)||(t+="+name"),t}function Qi(e,t,a){var r=a,n=r.hoverInfoPattern,o=r.index,i=Object(l.extend)({type:t.globalSeriesType,yAxis:0},t.seriesOptions[e.name]),s=function(e,t){return e.color||wi[t%wi.length]}(i,o),c=function(e,t){var a=t.seriesOptions[e.name]||{type:t.globalSeriesType};return 1!==a.yAxis||t.series.stacking&&"line"!==a.type?"y":"y2"}(e,t),u=t.sortX?Object(l.sortBy)(e.data,e=>Si(e.x,t.xAxis.type)):e.data,d=Object(l.includes)(["bubble","scatter"],i.type)?Si:e=>(e=ji(e),t.missingValuesAsZero&&Object(l.isNil)(e)?0:e),m=new Map,p=[],f=[],g=[];Object(l.each)(u,e=>{var a=Si(e.x,t.xAxis.type),r=d(e.y,"y2"===c?t.yAxis[1].type:t.yAxis[0].type),n=ji(e.yError),o=ji(e.size);m.set(a,{x:a,y:r,yError:n,size:o,yPercent:null,row:e}),p.push(a),f.push(r),g.push(n)});var b={visible:!0,hoverinfo:n,x:p,y:f,error_y:{array:g,color:s},name:i.name||e.name,marker:{color:s},insidetextfont:{color:_n(s)},yaxis:c,sourceData:m};switch(a=Bi(Bi({},a),{},{seriesColor:s,data:u}),i.type){case"column":return function(e,t,a){return e.type="bar",e.offsetgroup=Object(l.toString)(a.index),t.showDataLabels&&(e.textposition="inside"),e}(b,t,a);case"line":return function(e,t){return e.mode="lines"+(t.showDataLabels?"+text":""),e}(b,t);case"area":return function(e,t){return e.mode="lines"+(t.showDataLabels?"+text":""),e.fill=t.series.stacking?"tonexty":"tozeroy",e}(b,t);case"scatter":return function(e,t){return e.type="scatter",e.mode="markers"+(t.showDataLabels?"+text":""),e}(b,t);case"bubble":return function(e,t,a){var r=a.seriesColor,n=a.data,o=t.coefficient||1;return e.mode="markers",e.marker={color:r,size:Object(l.map)(n,e=>e.size*o),sizemode:t.sizemode||"diameter"},e}(b,t,a);case"box":return function(e,t,a){var r=a.seriesColor;return e.type="box",e.mode="markers",e.boxpoints="outliers",e.hoverinfo=!1,e.marker={color:r,size:3},t.showpoints&&(e.boxpoints="all",e.jitter=.3,e.pointpos=-1.8),e}(b,t,a);default:return b}}function Ki(e){return e.sortX&&"category"===e.xAxis.type&&"box"!==e.globalSeriesType}function $i(e){var t=e["@@y"];return void 0!==e["@@yError"]&&(t="".concat(t," ± ").concat(e["@@yError"])),void 0!==e["@@yPercent"]&&(t="".concat(e["@@yPercent"]," (").concat(t,")")),void 0!==e["@@size"]&&(t="".concat(t,": ").concat(e["@@size"])),t}function Gi(e){return e["@@yPercent"]+" ("+e["@@y"]+")"}function Ji(e,t,a){var r=null;switch(t){case"x":r=a.xAxis.type;break;case"y":r=a.yAxis[0].type;break;case"y2":r=a.yAxis[1].type}return Si(e,r,a.dateTimeFormat)}function Xi(e,t){var a=Mi(t.numberFormat),r=Mi(t.percentFormat),n=function(e){return""===e.textFormat?"pie"===e.globalSeriesType?Gi:$i:t=>zi(e.textFormat,t)}(t),o=t.missingValuesAsZero?0:null;Object(l.each)(e,e=>{var i=t.seriesOptions[e.name]||{type:t.globalSeriesType};e.text=[],e.hover=[],("pie"===t.globalSeriesType?e.labels:e.x).forEach(s=>{var c={"@@name":e.name},u=e.sourceData.get(s)||{x:s,y:o,row:{x:s,y:o}},d=Object(l.includes)(["bubble","scatter"],i.type);c["@@x"]=Ji(u.row.x,"x",t),c["@@y"]=d?Ji(u.row.y,e.yaxis,t):a(u.y),void 0!==u.yError&&(c["@@yError"]=a(u.yError)),void 0!==u.size&&(c["@@size"]=a(u.size)),(t.series.percentValues||"pie"===t.globalSeriesType)&&(c["@@yPercent"]=r(Math.abs(u.yPercent))),Object(l.extend)(c,u.row.$raw),e.text.push(n(c))})})}function Zi(e,t){if(t.series.percentValues){var a=new Map;Object(l.each)(e,e=>{e.sourceData.forEach(e=>{var t=a.get(e.x)||0;a.set(e.x,t+Math.abs(e.y||0))})}),Object(l.each)(e,e=>{var r=[];e.sourceData.forEach(e=>{if(Object(l.isNil)(e.y)&&!t.missingValuesAsZero)e.yPercent=null;else{var n=a.get(e.x);e.yPercent=e.y/n*100}r.push(e.yPercent)}),e.y=r})}}function el(e,t){var a=function(e,t){var a=new Set;Object(l.each)(e,e=>{e.sourceData.forEach(e=>{a.add(e.x)})});var r=[...a];return t?Object(l.sortBy)(r,l.identity):r}(e,t.sortX),r=t.missingValuesAsZero?0:null;Object(l.each)(e,e=>{e.x=[],e.y=[],e.error_y.array=[],Object(l.each)(a,a=>{e.x.push(a);var n=e.sourceData.get(a);n?(e.y.push(t.series.percentValues?n.yPercent:n.y),e.error_y.array.push(n.yError)):(e.y.push(r),e.error_y.array.push(null))})})}function tl(e,t){var a=Object(l.filter)(e,e=>!0===e.visible);if(a.length>0)switch(t.globalSeriesType){case"pie":!function(e,t){Xi(e,t)}(a,t);break;case"line":case"area":!function(e,t){if(Zi(e,t),t.series.stacking){el(e,t);var a={};Object(l.each)(e,e=>{e.y=Object(l.map)(e.y,(r,n)=>{if(Object(l.isNil)(r)&&!t.missingValuesAsZero)return null;var o=e.x[n],i=r+(a[o]||0);return a[o]=i,i})})}else Ki(t)&&el(e,t);Xi(e,t)}(a,t);break;case"heatmap":break;default:!function(e,t){Zi(e,t),t.series.stacking||Ki(t)&&el(e,t),Xi(e,t)}(a,t)}return e}function al(e,t){switch(t.globalSeriesType){case"pie":return tl(Ni(e,t),t);case"heatmap":return tl(Vi(e,t));default:return tl(function(e,t){var a={hoverInfoPattern:Yi(t)};return Object(l.map)(e,(e,r)=>Qi(e,t,Bi(Bi({},a),{},{index:r})))}(e,t),t)}}function rl(e){return Object(l.isObject)(e.title)?e.title.text:null}function nl(e){switch(e.type){case"datetime":return"date";case"logarithmic":return"log";default:return e.type}}function ol(e){return{title:rl(e),type:nl(e),automargin:!0,autorange:!0,range:null}}function il(e,t,a){var r,n,o,i=a.filter(e=>"y2"===e.yaxis);return e.xaxis=(r=t.xAxis,n=t,o={title:rl(r),type:nl(r),automargin:!0},n.sortX&&"category"===o.type&&(n.reverseX?o.categoryorder="category descending":o.categoryorder="category ascending"),Object(l.isUndefined)(r.labels)||(o.showticklabels=r.labels.enabled),o),e.yaxis=ol(t.yAxis[0]),i.length>0&&(e.yaxis2=ol(t.yAxis[1]),e.yaxis2.overlaying="y",e.yaxis2.side="right"),t.series.stacking&&(e.barmode="relative"),e}function ll(e,t,a){var r={margin:{l:10,r:10,b:5,t:20,pad:4},width:Math.max(5,Math.floor(e.offsetWidth)),height:Math.max(5,Math.floor(e.offsetHeight)),autosize:!1,showlegend:t.legend.enabled,legend:{traceorder:t.legend.traceorder},hoverlabel:{namelength:-1}};switch(t.globalSeriesType){case"pie":return function(e,t,a){var r=/{{\s*@@name\s*}}/.test(t.textFormat),n=Li(a),o=n.cellsInRow,i=n.cellWidth,s=n.cellHeight,c=n.xPadding;return e.annotations=r?[]:Object(l.filter)(Object(l.map)(a,(e,t)=>{var a=t%o*i,r=Math.floor(t/o)*s;return{x:a+(i-c)/2,y:r+s-.015,xanchor:"center",yanchor:"top",text:e.name,showarrow:!1}})),e}(r,t,a);case"box":return function(e,t,a){return(e=il(e,t,a)).boxmode="group",e.boxgroupgap=.5,e}(r,t,a);default:return il(r,t,a)}}function sl(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function cl(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?sl(Object(a),!0).forEach((function(t){ul(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):sl(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ul(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function dl(e,t,a){return[Object(l.isNumber)(t)?t:e[0],Object(l.isNumber)(a)?a:e[1]]}function ml(e,t,a){return a*t/(1-Math.abs(e)/t-a)}function pl(e,t,a,r){var n={};return Object(l.isObject)(a.yaxis)&&(n.yaxis=cl(cl({},a.yaxis),{},{autorange:!0,range:null})),Object(l.isObject)(a.yaxis2)&&(n.yaxis2=cl(cl({},a.yaxis2),{},{autorange:!0,range:null})),[n,()=>{if(Object(l.isObject)(a.yaxis)){var o=r.yAxis[0],i=e.layout.yaxis.range;n.yaxis.autorange=!1,n.yaxis.range=dl(i,o.rangeMin,o.rangeMax)}if(Object(l.isObject)(a.yaxis2)){var s=r.yAxis[1],c=e.layout.yaxis2.range;n.yaxis2.autorange=!1,n.yaxis2.range=dl(c,s.rangeMin,s.rangeMax)}if(r.swappedAxes){Object(l.each)(t,e=>{e.orientation="h";var t=e.x,a=e.y;e.x=a,e.y=t});var u=a.xaxis,d=n.yaxis,m=n.yaxis2;Object(l.isObject)(u)&&Object(l.isObject)(d)&&(n.xaxis=d,n.yaxis=u),Object(l.isObject)(m)&&(n.yaxis2=null)}return r.alignYAxesAtZero&&Object(l.isObject)(a.yaxis)&&Object(l.isObject)(a.yaxis2)&&function(e,t){e.range[1]=Math.max(0,e.range[1]),t.range[1]=Math.max(0,t.range[1]),e.range[0]=Math.min(0,e.range[0]),t.range[0]=Math.min(0,t.range[0]);var a=e.range[1]-e.range[0],r=e.range[1]/a,n=t.range[1]-t.range[0],o=t.range[1]/n,i=Math.abs(o-r)/2;i<.01||(r<o?(e.range[1]+=ml(e.range[1],a,i),t.range[0]-=ml(e.range[0],n,i)):(t.range[1]+=ml(t.range[1],n,i),e.range[0]-=ml(e.range[0],a,i)))}(n.yaxis,n.yaxis2),[n,null]}]}function fl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return gl(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return gl(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function gl(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function bl(e,t){var a=Object(l.find)(["transform","WebkitTransform","MozTransform","MsTransform","OTransform"],t=>t in e.style),r=t.height;return t.legend=Object(l.extend)({},t.legend,{orientation:"h",y:0,x:0,xanchor:"left",yanchor:"bottom"}),function(e){var t=e.querySelector(".legend");if(t)for(var a=t.parentNode;a;){if("svg"===a.tagName.toLowerCase()){a.style.overflow="visible";break}a=a.parentNode}}(e),[Object(l.pick)(t,["width","height","legend"]),()=>{var n=e.querySelector(".legend");if(n){var o=n.getBoundingClientRect();return t.height=Math.floor(Math.max(r/2,r-(o.bottom-o.top))),n.style[a]="translate(0, "+t.height+"px)",[Object(l.pick)(t,["height"]),null]}}]}function hl(e,t){return t.width<=600?bl(e,t):function(e,t){var a=Object(l.find)(["transform","WebkitTransform","MozTransform","MsTransform","OTransform"],t=>t in e.style);t.legend=Object(l.extend)({},t.legend,{orientation:"v",y:1,x:1,xanchor:"left",yanchor:"top"});var r=e.querySelector(".legend");return r&&(r.style[a]=null),[Object(l.pick)(t,["width","height","legend"]),null]}(e,t)}function yl(e,t,a){t.width=Math.max(5,Math.floor(e.offsetWidth)),t.height=Math.max(5,Math.floor(e.offsetHeight));var r=fl(e.__previousSize||[],2),n=r[0],o=r[1];if(t.width!==n||t.height!==o){if(e.__previousSize=[t.width,t.height],!a.legend.enabled)return[Object(l.pick)(t,["width","height"]),null];switch(a.legend.placement){case"auto":return hl(e,t);case"below":return bl(e,t)}}}function vl(e,t,a,r,n){var o,i=(o=n,e=>{Object(l.isString)(e)&&Object(l.startsWith)(e,"ax.dtick error")||o(e)}),s={showLink:!1,displaylogo:!1};r.hidePlotlyModeBar&&(s.displayModeBar=!1);var c=al(a,t),u=ll(e,t,c),d=!1,m=function(){var e=[],t={append:a=>(Object(l.isArray)(a)&&Object(l.isObject)(a[0])&&e.push(a),t),process(a){if(e.length>0){var r=Object(l.reduce)(e,(e,t)=>Object(l.merge)(e,t[0]),{}),n=Object(l.map)(e,e=>Object(l.isFunction)(e[1])?e[1]:()=>null);return e=[],oi.a.relayout(a,r).then(()=>(Object(l.each)(n,e=>t.append(e())),t.process(a)))}return Promise.resolve()}};return t}();function p(e){return function(){if(!d)try{return e(...arguments)}catch(e){i(e)}}}var f=()=>{},g={initialized:Promise.resolve().then(()=>oi.a.newPlot(e,c,u,s)).then(p(()=>m.append(pl(e,c,u,t)).append(yl(e,u,t)).process(e))).then(p(()=>{e.on("plotly_restyle",p(a=>{Object(l.isArray)(a)&&Object(l.isObject)(a[0])&&a[0].visible&&(tl(c,t),m.append(pl(e,c,u,t)).process(e))})),t.onHover&&e.on("plotly_hover",t.onHover),t.onUnHover&&e.on("plotly_unhover",t.onUnHover),f=Gr(e,p(()=>{m.append(yl(e,u,t)).process(e)}))})).catch(i).then(()=>g),setZoomEnabled:p(t=>{var a={dragmode:!!t&&"zoom"};return oi.a.relayout(e,a)}),destroy:p(()=>{d=!0,e.removeAllListeners("plotly_restyle"),f(),delete e.__previousSize,oi.a.purge(e)})};return g}function wl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ol(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ol(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ol(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function _l(e){var t=e.options,a=e.data,o=wl(Object(r.useState)(null),2),i=o[0],l=o[1],s=wl(Object(r.useState)(null),2),c=s[0],u=s[1],d=Object(r.useContext)(_),m=Object(r.useRef)();m.current=d;var p=ti()({maxWidth:768});return Object(r.useRef)().current=p,Object(r.useEffect)(()=>{if(i){var e=!1,r=ri(a.rows,t),n=vl(i,t,r,Do,e=>{m.current.handleError(e)});return n.initialized.then(()=>{e||u(n)}),()=>{e=!0,n.destroy()}}},[t,a,i]),Object(r.useEffect)(()=>{c&&c.setZoomEnabled(!p)},[c,p]),n.a.createElement("div",{className:"chart-visualization-container",ref:l})}function El(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return jl(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return jl(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jl(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Sl(e){var t=e.options,a=e.data,o=El(Object(r.useState)(null),2),i=o[0],s=o[1],c=Object(r.useMemo)(()=>function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=()=>{};try{a=new Function("x, ys, element, Plotly",e)}catch(e){t&&console.log("Error while executing custom graph: ".concat(e))}return(e,r,n,o)=>{try{a(e,r,n,o)}catch(e){t&&console.log("Error while executing custom graph: ".concat(e))}}}(t.customCode,t.enableConsoleLogs),[t.customCode,t.enableConsoleLogs]),u=Object(r.useMemo)(()=>{return e=ri(a.rows,t),r=[],n={},Object(l.each)(e,e=>{var t=e.name,a=e.data;n[t]=[],Object(l.each)(a,e=>{r.push(Si(e.x)),n[t].push(Si(e.y))})}),{x:r,ys:n};var e,r,n},[t,a]);return Object(r.useEffect)(()=>{if(i)return Gr(i,()=>{oi.a.purge(i),c(u.x,u.ys,i,oi.a)})},[i,u,c]),Object(r.useEffect)(()=>{if(i)return()=>oi.a.purge(i)},[i]),n.a.createElement("div",{className:"chart-visualization-container",ref:s})}oi.a.register([li.a,ci.a,di.a,pi.a,gi.a]),oi.a.setPlotConfig({modeBarButtonsToRemove:["sendDataToCloud"]}),_l.propTypes=en,Sl.propTypes=en;a(1144);function Cl(){return(Cl=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function xl(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Pl(e){var t=e.options,a=xl(e,["options"]);return"custom"===t.globalSeriesType&&Do.allowCustomJSVisualizations?n.a.createElement(Sl,Cl({options:t},a)):n.a.createElement(_l,Cl({options:t},a))}function Ll(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}Pl.propTypes=en;var kl=[{type:"line",name:"线形图(Line)",icon:"line-chart"},{type:"column",name:"条形图(Bar)",icon:"bar-chart"},{type:"area",name:"面积图(Area)",icon:"area-chart"},{type:"pie",name:"饼形图(Pie)",icon:"pie-chart"},{type:"scatter",name:"散点图(Scatter)",icon:"circle-o"},{type:"bubble",name:"气泡图(Bubble)",icon:"circle-o"},{type:"heatmap",name:"热力图(Heatmap)",icon:"th"},{type:"box",name:"箱线图(Box)",icon:"square-o"}];function Nl(e){var t=e.hiddenChartTypes,a=Ll(e,["hiddenChartTypes"]),o=Object(r.useMemo)(()=>{var e=[...kl];return Do.allowCustomJSVisualizations&&e.push({type:"custom",name:"自定义(Custom)",icon:"code"}),t.length>0?Object(l.filter)(e,e=>{var a=e.type;return!Object(l.includes)(t,a)}):e},[]);return n.a.createElement(Fo,a,Object(l.map)(o,e=>{var t=e.type,a=e.name,r=e.icon;return n.a.createElement(Fo.Option,{key:t,value:t,"data-test":"Chart.ChartType.".concat(t)},n.a.createElement("i",{className:"fa fa-".concat(r),style:{marginRight:5}}),a)}))}function Al(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Tl(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Al(Object(a),!0).forEach((function(t){Wl(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Al(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Wl(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Nl.defaultProps={hiddenChartTypes:[]};var Il={x:{label:window.W_L.x_column},y:{label:window.W_L.y_column,multiple:!0},series:{label:window.W_L.group_by},yError:{label:window.W_L.errors_column},size:{label:"气泡尺寸(Bubble Size)"},zVal:{label:window.W_L.color_column}},ql=Tl(Tl({},Il),{},{x:{label:window.W_L.y_column},y:{label:window.W_L.x_column,multiple:!0}});function Dl(e){var t=e.value,a=e.availableColumns,r=e.type,o=e.onChange,i=e.areAxesSwapped,s=Object(l.sortBy)(Object(l.filter)(Object(l.uniq)(Object(l.flatten)([a,t])),e=>Object(l.isString)(e)&&""!==e)),c=i?ql[r]:Il[r],u=c.label,d=c.multiple;return n.a.createElement(So,null,n.a.createElement(Fo,{label:u,"data-test":"Chart.ColumnMapping.".concat(r),mode:d?"multiple":"default",allowClear:!0,showSearch:!0,placeholder:d?window.W_L.choose_columns:window.W_L.choose_column,value:t||void 0,onChange:e=>o(e||null,r)},Object(l.map)(s,e=>n.a.createElement(Fo.Option,{key:e,value:e,"data-test":"Chart.ColumnMapping.".concat(r,".").concat(e)},e))))}function Rl(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Ml(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Rl(Object(a),!0).forEach((function(t){zl(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Rl(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function zl(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Fl(e,t){var a={},r=function(e){var t=["x","y"];return Object(l.includes)(["custom","heatmap"],e.globalSeriesType)||t.push("series"),("bubble"===e.globalSeriesType||Object(l.some)(e.seriesOptions,{type:"bubble"}))&&t.push("size"),"heatmap"===e.globalSeriesType&&t.push("zVal"),Object(l.includes)(["custom","bubble","heatmap"],e.globalSeriesType)||t.push("yError"),t}(e);Object(l.each)(r,e=>{a[e]=Dl.MappingTypes[e].multiple?[]:null}),t=Object(l.map)(t,e=>e.name);var n=[];return Object(l.each)(e.columnMapping,(e,o)=>{Object(l.includes)(t,o)&&Object(l.includes)(r,e)&&(Dl.MappingTypes[e].multiple?a[e].push(o):a[e]=o,n.push(o))}),{mappedColumns:a,unusedColumns:Object(l.difference)(t,n)}}function Vl(e){var t=e.options,a=e.data,o=e.onOptionsChange,i=Object(r.useMemo)(()=>Fl(t,a.columns),[t,a.columns]),s=i.mappedColumns,c=i.unusedColumns;function u(e,t){var a=function(e){var t={};return Object(l.each)(e,(e,a)=>{Object(l.isArray)(e)?Object(l.each)(e,e=>{t[e]=a}):e&&(t[e]=a)}),t}(Ml(Ml({},s),{},{[t]:e}));o({columnMapping:a},vo.shallowMerge)}return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Nl,{label:"Chart Type","data-test":"Chart.GlobalSeriesType",defaultValue:t.globalSeriesType,onChange:function(e){o({globalSeriesType:e,showDataLabels:"pie"===e,swappedAxes:!1,seriesOptions:Object(l.mapValues)(t.seriesOptions,t=>Ml(Ml({},t),{},{type:e}))})}})),Object(l.includes)(["column","line","box"],t.globalSeriesType)&&n.a.createElement(So,null,n.a.createElement(gn.a,{"data-test":"Chart.SwappedAxes",defaultChecked:t.swappedAxes,checked:t.swappedAxes,onChange:function(){var e=Object(l.mapValues)(t.seriesOptions,e=>Ml(Ml({},e),{},{yAxis:0}));o({swappedAxes:!t.swappedAxes,seriesOptions:e})}},window.W_L.Horizontal_Chart)),Object(l.map)(s,(e,a)=>n.a.createElement(Dl,{key:a,type:a,value:e,areAxesSwapped:t.swappedAxes,availableColumns:c,onChange:u})),Object(l.includes)(["bubble"],t.globalSeriesType)&&n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Uo,{label:window.W_L.bubble_size_coefficient,"data-test":"Chart.BubbleCoefficient",defaultValue:t.coefficient,onChange:e=>o({coefficient:Object(l.toNumber)(e)})})),n.a.createElement(So,null,n.a.createElement(Fo,{label:window.W_L.bubble_size_proportional_to,"data-test":"Chart.SizeMode",defaultValue:t.sizemode,onChange:e=>o({sizemode:e})},n.a.createElement(Fo.Option,{value:"area","data-test":"Chart.SizeMode.Area"},window.W_L.Area),n.a.createElement(Fo.Option,{value:"diameter","data-test":"Chart.SizeMode.Diameter"},window.W_L.Diameter)))),Object(l.includes)(["pie"],t.globalSeriesType)&&n.a.createElement(So,null,n.a.createElement(Fo,{label:window.W_L.direction,"data-test":"Chart.PieDirection",defaultValue:t.direction.type,onChange:e=>o({direction:{type:e}})},n.a.createElement(Fo.Option,{value:"counterclockwise","data-test":"Chart.PieDirection.Counterclockwise"},window.W_L.Counterclockwise),n.a.createElement(Fo.Option,{value:"clockwise","data-test":"Chart.PieDirection.Clockwise"},window.W_L.Clockwise))),!Object(l.includes)(["custom","heatmap"],t.globalSeriesType)&&n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Fo,{label:window.W_L.legend_placement,"data-test":"Chart.LegendPlacement",value:t.legend.enabled?t.legend.placement:"hidden",onChange:function(e){o("hidden"===e?{legend:{enabled:!1}}:{legend:{enabled:!0,placement:e}})}},n.a.createElement(Fo.Option,{value:"hidden","data-test":"Chart.LegendPlacement.HideLegend"},window.W_L.Hide_legend),n.a.createElement(Fo.Option,{value:"auto","data-test":"Chart.LegendPlacement.Auto"},window.W_L.Right),n.a.createElement(Fo.Option,{value:"below","data-test":"Chart.LegendPlacement.Below"},window.W_L.Bottom))),t.legend.enabled&&n.a.createElement(So,null,n.a.createElement(Fo,{label:window.W_L.legend_items_order,"data-test":"Chart.LegendItemsOrder",value:t.legend.traceorder,onChange:e=>o({legend:{traceorder:e}})},n.a.createElement(Fo.Option,{value:"normal","data-test":"Chart.LegendItemsOrder.Normal"},window.W_L.Normal),n.a.createElement(Fo.Option,{value:"reversed","data-test":"Chart.LegendItemsOrder.Reversed"},window.W_L.Reversed)))),Object(l.includes)(["box"],t.globalSeriesType)&&n.a.createElement(So,null,n.a.createElement(gn.a,{"data-test":"Chart.ShowPoints",defaultChecked:t.showpoints,onChange:e=>o({showpoints:e.target.checked})},window.W_L.Show_All_Points)),!Object(l.includes)(["custom","heatmap"],t.globalSeriesType)&&n.a.createElement(So,null,n.a.createElement(Fo,{label:window.W_L.stacking,"data-test":"Chart.Stacking",defaultValue:t.series.stacking,disabled:!Object(l.includes)(["line","area","column"],t.globalSeriesType),onChange:e=>o({series:{stacking:e}})},n.a.createElement(Fo.Option,{value:null,"data-test":"Chart.Stacking.Disabled"},window.W_L.Disabled),n.a.createElement(Fo.Option,{value:"stack","data-test":"Chart.Stacking.Stack"},window.W_L.Stack))),Object(l.includes)(["line","area","column"],t.globalSeriesType)&&n.a.createElement(So,null,n.a.createElement(gn.a,{"data-test":"Chart.NormalizeValues",defaultChecked:t.series.percentValues,onChange:e=>o({series:{percentValues:e.target.checked}})},window.W_L.Normalize_values_to_percentage)),!Object(l.includes)(["custom","heatmap","bubble","scatter"],t.globalSeriesType)&&n.a.createElement(So,null,n.a.createElement(Fo,{label:window.W_L.missing_and_NULL_values,"data-test":"Chart.MissingValues",defaultValue:t.missingValuesAsZero?1:0,onChange:e=>o({missingValuesAsZero:!!e})},n.a.createElement(Fo.Option,{value:0,"data-test":"Chart.MissingValues.Keep"},window.W_L.Do_not_display_in_chart),n.a.createElement(Fo.Option,{value:1,"data-test":"Chart.MissingValues.Zero"},window.W_L.Convert_to_0_and_display_in_chart))))}Dl.defaultProps={value:null,availableColumns:[],type:null,onChange:()=>{}},Dl.MappingTypes=Il,Vl.propTypes=tn;var Ul=a(1846);function Bl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Hl(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Hl(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Hl(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Yl(e){return e=Object(l.isNumber)(e)?e:parseFloat(e),Object(l.isFinite)(e)?e:null}function Ql(e){var t=e.id,a=e.options,r=e.features,o=e.onChange;function i(e){o(Object(l.merge)({},a,e))}var s=Bl(Object(Ul.a)(e=>{i({title:Object(l.isString)(e)&&""!==e?{text:e}:null})},200),1)[0],c=Bl(Object(Ul.a)(e=>i(e),200),1)[0];return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Fo,{label:window.W_L.scale,"data-test":"Chart.".concat(t,".Type"),defaultValue:a.type,onChange:e=>i({type:e})},r.autoDetectType&&n.a.createElement(Fo.Option,{value:"-","data-test":"Chart.".concat(t,".Type.Auto")},window.W_L.auto_detect),n.a.createElement(Fo.Option,{value:"datetime","data-test":"Chart.".concat(t,".Type.DateTime")},window.W_L.datetime),n.a.createElement(Fo.Option,{value:"linear","data-test":"Chart.".concat(t,".Type.Linear")},window.W_L.linear),n.a.createElement(Fo.Option,{value:"logarithmic","data-test":"Chart.".concat(t,".Type.Logarithmic")},window.W_L.logarithmic),n.a.createElement(Fo.Option,{value:"category","data-test":"Chart.".concat(t,".Type.Category")},window.W_L.category))),n.a.createElement(So,null,n.a.createElement(Vo,{label:window.W_L.name,"data-test":"Chart.".concat(t,".Name"),defaultValue:Object(l.isObject)(a.title)?a.title.text:null,onChange:e=>s(e.target.value)})),r.range&&n.a.createElement(So,null,n.a.createElement(io.Row,{gutter:15,type:"flex",align:"middle"},n.a.createElement(io.Col,{span:12},n.a.createElement(Uo,{label:window.W_L.min_value,placeholder:window.W_L.auto,"data-test":"Chart.".concat(t,".RangeMin"),defaultValue:Yl(a.rangeMin),onChange:e=>c({rangeMin:Yl(e)})})),n.a.createElement(io.Col,{span:12},n.a.createElement(Uo,{label:window.W_L.max_value,placeholder:window.W_L.auto,"data-test":"Chart.".concat(t,".RangeMax"),defaultValue:Yl(a.rangeMax),onChange:e=>c({rangeMax:Yl(e)})})))))}function Kl(e){var t=e.options,a=e.onOptionsChange;return n.a.createElement(n.a.Fragment,null,n.a.createElement(Ql,{id:"XAxis",features:{autoDetectType:!0},options:t.xAxis,onChange:e=>a({xAxis:e})}),n.a.createElement(So,null,n.a.createElement(ko,{"data-test":"Chart.XAxis.Sort",defaultChecked:t.sortX,onChange:e=>a({sortX:e})},window.W_L.sort_values)),n.a.createElement(So,null,n.a.createElement(ko,{"data-test":"Chart.XAxis.Reverse",defaultChecked:t.reverseX,onChange:e=>a({reverseX:e})},window.W_L.reverse_order)),n.a.createElement(So,null,n.a.createElement(ko,{"data-test":"Chart.XAxis.ShowLabels",defaultChecked:t.xAxis.labels.enabled,onChange:e=>a({xAxis:{labels:{enabled:e}}})},window.W_L.Show_Labels)))}function $l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Gl(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Gl(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Gl(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Jl(e){var t=e.options,a=e.onOptionsChange,r=$l(t.yAxis,2),o=r[0],i=r[1];return n.a.createElement(n.a.Fragment,null,n.a.createElement(So.Title,null,t.swappedAxes?window.W_L.x_axis:window.W_L.left_y_axis),n.a.createElement(So,null,n.a.createElement(Ql,{id:"LeftYAxis",features:{range:!0},options:o,onChange:e=>a({yAxis:[e,i]})})),"heatmap"!==t.globalSeriesType&&!t.swappedAxes&&n.a.createElement(n.a.Fragment,null,n.a.createElement(So.Title,null,window.W_L.right_y_axis),n.a.createElement(So,null,n.a.createElement(Ql,{id:"RightYAxis",features:{range:!0},options:i,onChange:e=>a({yAxis:[o,e]})})),n.a.createElement(So,null,n.a.createElement(ko,{id:"chart-editor-y-axis-align-at-zero","data-test":"Chart.YAxis.AlignAtZero",defaultChecked:t.alignYAxesAtZero,onChange:e=>a({alignYAxesAtZero:e})},window.W_L.align_Y_axes_at_zero))),"heatmap"===t.globalSeriesType&&n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(ko,{id:"chart-editor-y-axis-sort","data-test":"Chart.LeftYAxis.Sort",defaultChecked:t.sortY,onChange:e=>a({sortY:e})},window.W_L.sort_values)),n.a.createElement(So,null,n.a.createElement(ko,{id:"chart-editor-y-axis-reverse","data-test":"Chart.LeftYAxis.Reverse",defaultChecked:t.reverseY,onChange:e=>a({reverseY:e})},window.W_L.reverse_order))))}Ql.defaultProps={features:{},onChange:()=>{}},Kl.propTypes=tn,Jl.propTypes=tn;var Xl=a(48),Zl=a.n(Xl),es=a(161);a(1145);function ts(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function as(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ts(Object(a),!0).forEach((function(t){rs(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ts(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function rs(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ns(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return os(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return os(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function os(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function is(){return(is=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ls(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var ss=Object(es.c)(e=>{var t=e.className,a=ls(e,["className"]);return n.a.createElement("div",is({className:me()("drag-handle",t)},a))}),cs=Object(es.a)(e=>e.children),us=Object(es.b)(e=>e.children);function ds(e){var t=e.disabled,a=e.containerComponent,o=e.containerProps,i=e.children,s=ls(e,["disabled","containerComponent","containerProps","children"]),c=Object(r.useRef)(),u=ns(Object(r.useState)(!1),2),d=u[0],m=u[1];s=as({},s),o=as({},o),t?s.shouldCancelStart=()=>!0:(s.helperContainer=Object(l.wrap)(s.helperContainer,e=>Object(l.isFunction)(e)?e(c.current):c.current),s.updateBeforeSortStart=Object(l.wrap)(s.updateBeforeSortStart,(function(e){if(m(!0),Object(l.isFunction)(e)){for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];e(...a)}})),s.onSortStart=Object(l.wrap)(s.onSortStart,(function(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];if(Object(l.isFunction)(e))e(...a);else{var n=a[1];n.preventDefault()}})),s.onSortEnd=Object(l.wrap)(s.onSortEnd,(function(e){if(m(!1),Object(l.isFunction)(e)){for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];e(...a)}})),o.className=me()("sortable-container",{"sortable-container-dragging":d},o.className),o.ref=c);var p=a;return n.a.createElement(cs,s,n.a.createElement(p,o,i))}function ms(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ps(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ps(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ps(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}ds.defaultProps={disabled:!1,containerComponent:"div",containerProps:{},children:null};var fs=Object(es.b)(e=>n.a.createElement("tr",e));function gs(e){var t=e.options,a=e.data,o=e.onOptionsChange,i=Object(r.useMemo)(()=>Object(l.map)(ri(a.rows,t),(e,a)=>{var r=e.name;return Object(l.extend)({key:r,type:t.globalSeriesType},t.seriesOptions[r],{zIndex:a})}),[t,a]),s=Object(r.useCallback)(e=>{var t=e.oldIndex,a=e.newIndex,r=[...i];r.splice(a,0,...r.splice(t,1)),o({seriesOptions:Object(l.fromPairs)(Object(l.map)(r,(e,t)=>[e.key,{zIndex:t}]))})},[o,i]),c=Object(r.useCallback)((e,t,a)=>{o({seriesOptions:{[e]:{[t]:a}}})},[o]),u=ms(Object(Ul.a)(c,200),1)[0],d=Object(r.useMemo)(()=>function(e,t,a){var r=[{title:window.W_L.order,dataIndex:"zIndex",render:(e,t)=>n.a.createElement("span",{className:"series-settings-order"},n.a.createElement(ss,null),t.zIndex+1)},{title:window.W_L.label,dataIndex:"name",render:(e,t)=>n.a.createElement(va.a,{"data-test":"Chart.Series.".concat(t.key,".Label"),placeholder:t.key,defaultValue:t.name,onChange:e=>a(t.key,"name",e.target.value)})}];return Object(l.includes)(["pie","heatmap"],e.globalSeriesType)||(e.swappedAxes||r.push({title:window.W_L.y_axis,dataIndex:"yAxis",render:(e,a)=>n.a.createElement(Kn.a.Group,{className:"series-settings-y-axis",value:1===a.yAxis?1:0,onChange:e=>t(a.key,"yAxis",e.target.value)},n.a.createElement(Kn.a,{value:0,"data-test":"Chart.Series.".concat(a.key,".UseLeftAxis")},window.W_L.Left),n.a.createElement(Kn.a,{value:1,"data-test":"Chart.Series.".concat(a.key,".UseRightAxis")},window.W_L.Right))}),r.push({title:window.W_L.type,dataIndex:"type",render:(e,a)=>n.a.createElement(Nl,{"data-test":"Chart.Series.".concat(a.key,".Type"),dropdownMatchSelectWidth:!1,value:a.type,hiddenChartTypes:["pie","heatmap","bubble","box"],onChange:e=>t(a.key,"type",e)})})),r}(t,c,u),[t,c,u]);return n.a.createElement(ds,{axis:"y",lockAxis:"y",lockToContainerEdges:!0,useDragHandle:!0,helperClass:"chart-editor-series-dragged-item",helperContainer:e=>e.querySelector("tbody"),onSortEnd:s,containerProps:{className:"chart-editor-series"}},n.a.createElement(Zl.a,{dataSource:i,columns:d,components:{body:{row:fs}},onRow:e=>({index:e.zIndex}),pagination:!1}))}function bs(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function hs(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ys(e){var t=e.options,a=e.data,o=e.onOptionsChange,i=Object(r.useMemo)(()=>function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?bs(Object(a),!0).forEach((function(t){hs(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):bs(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({Automatic:null},Oi),[]),s=Object(r.useMemo)(()=>{return Object(l.map)((e=ri(a.rows,t),r=new Set,Object(l.each)(e,e=>{Object(l.each)(e.data,e=>{r.add(e.x)})}),[...r]),e=>({key:e,color:(t.valuesOptions[e]||{}).color||null}));var e,r},[t,a]),c=Object(r.useCallback)((e,t,a)=>{o({valuesOptions:{[e]:{[t]:a}}})},[o]),u=[{title:window.W_L.value,dataIndex:"key"},{title:window.W_L.color,dataIndex:"color",width:"1%",render:(e,t)=>n.a.createElement(Yn,{"data-test":"Chart.Series.".concat(t.key,".Color"),interactive:!0,presetColors:i,placement:"topRight",color:t.color,onChange:e=>c(t.key,"color",e),addonAfter:n.a.createElement(Yn.Label,{color:t.color,presetColors:i})})}];return n.a.createElement(Zl.a,{showHeader:!1,dataSource:s,columns:u,pagination:!1})}gs.propTypes=tn,ys.propTypes=tn;var vs=["Blackbody","Bluered","Blues","Earth","Electric","Greens","Greys","Hot","Jet","Picnic","Portland","Rainbow","RdBu","Reds","Viridis","YlGnBu","YlOrRd","Custom..."];function ws(e){var t=e.options,a=e.onOptionsChange;return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Fo,{label:window.W_L.color_scheme,"data-test":"Chart.Colors.Heatmap.ColorScheme",placeholder:window.W_L.choose_color_scheme,allowClear:!0,value:t.colorScheme||void 0,onChange:e=>a({colorScheme:e||null})},Object(l.map)(vs,e=>n.a.createElement(Fo.Option,{key:e,value:e,"data-test":"Chart.Colors.Heatmap.ColorScheme.".concat(e)},e)))),"Custom..."===t.colorScheme&&n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Bo,{layout:"horizontal",label:window.W_L.min_color,"data-test":"Chart.Colors.Heatmap.MinColor",interactive:!0,placement:"topLeft",presetColors:Oi,color:t.heatMinColor,onChange:e=>a({heatMinColor:e}),addonAfter:n.a.createElement(Bo.Label,{color:t.heatMinColor,presetColors:Oi})})),n.a.createElement(So,null,n.a.createElement(Bo,{layout:"horizontal",label:window.W_L.max_color,"data-test":"Chart.Colors.Heatmap.MaxColor",interactive:!0,placement:"topRight",presetColors:Oi,color:t.heatMaxColor,onChange:e=>a({heatMaxColor:e}),addonAfter:n.a.createElement(Bo.Label,{color:t.heatMaxColor,presetColors:Oi})}))))}function Os(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function _s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Es(e){var t=e.options,a=e.data,o=e.onOptionsChange,i=Object(r.useMemo)(()=>function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Os(Object(a),!0).forEach((function(t){_s(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Os(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({Automatic:null},Oi),[]),s=Object(r.useMemo)(()=>Object(l.map)(ri(a.rows,t),e=>{var a=e.name;return{key:a,color:(t.seriesOptions[a]||{}).color||null}}),[t,a]),c=Object(r.useCallback)((e,t,a)=>{o({seriesOptions:{[e]:{[t]:a}}})},[o]),u=[{title:window.W_L.series,dataIndex:"key"},{title:window.W_L.color,dataIndex:"color",width:"1%",render:(e,t)=>n.a.createElement(Yn,{"data-test":"Chart.Series.".concat(t.key,".Color"),interactive:!0,presetColors:i,placement:"topRight",color:t.color,onChange:e=>c(t.key,"color",e),addonAfter:n.a.createElement(Yn.Label,{color:t.color,presetColors:i})})}];return n.a.createElement(Zl.a,{showHeader:!1,dataSource:s,columns:u,pagination:!1})}function js(){return(js=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ss(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}ws.propTypes=tn,Es.propTypes=tn;var Cs={pie:ys,heatmap:ws};function xs(e){var t=e.options,a=Ss(e,["options"]),r=Cs[t.globalSeriesType]||Es;return n.a.createElement(r,js({options:t},a))}function Ps(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ls(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ls(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ls(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function ks(e){var t=e.options,a=e.onOptionsChange,r=Object(l.includes)(["line","area","column","scatter","pie","heatmap"],t.globalSeriesType),o=Ps(Object(Ul.a)(a,200),1)[0];return n.a.createElement(n.a.Fragment,null,r&&n.a.createElement(So,null,n.a.createElement(gn.a,{"data-test":"Chart.DataLabels.ShowDataLabels",defaultChecked:t.showDataLabels,onChange:e=>a({showDataLabels:e.target.checked})},window.W_L.Show_Data_Labels)),n.a.createElement(So,null,n.a.createElement(Vo,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Number_format,n.a.createElement(zo.NumberFormatSpecs,null)),"data-test":"Chart.DataLabels.NumberFormat",defaultValue:t.numberFormat,onChange:e=>o({numberFormat:e.target.value})})),n.a.createElement(So,null,n.a.createElement(Vo,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Percent_Values_Format,n.a.createElement(zo.NumberFormatSpecs,null)),"data-test":"Chart.DataLabels.PercentFormat",defaultValue:t.percentFormat,onChange:e=>o({percentFormat:e.target.value})})),n.a.createElement(So,null,n.a.createElement(Vo,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Date_Time_format,n.a.createElement(zo.DateTimeFormatSpecs,null)),"data-test":"Chart.DataLabels.DateTimeFormat",defaultValue:t.dateTimeFormat,onChange:e=>o({dateTimeFormat:e.target.value})})),n.a.createElement(So,null,n.a.createElement(Vo,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Data_Labels,n.a.createElement(zo,{placement:"topRight",arrowPointAtCenter:!0},n.a.createElement("div",{style:{paddingBottom:5}},"Use special names to access additional properties:"),n.a.createElement("div",null,n.a.createElement("code",null,"{{ @@name }}")," series name;"),n.a.createElement("div",null,n.a.createElement("code",null,"{{ @@x }}")," x-value;"),n.a.createElement("div",null,n.a.createElement("code",null,"{{ @@y }}")," y-value;"),n.a.createElement("div",null,n.a.createElement("code",null,"{{ @@yPercent }}")," relative y-value;"),n.a.createElement("div",null,n.a.createElement("code",null,"{{ @@yError }}")," y deviation;"),n.a.createElement("div",null,n.a.createElement("code",null,"{{ @@size }}")," bubble size;"),n.a.createElement("div",{style:{paddingTop:5}},window.W_L.Also_all_query_result_columns_can_be_referenced,n.a.createElement("br",null),window.W_L.using,n.a.createElement("code",{style:{whiteSpace:"nowrap"}},"{{ column_name }}"),"  ",window.W_L.syntax))),"data-test":"Chart.DataLabels.TextFormat",placeholder:"(auto)",defaultValue:t.textFormat,onChange:e=>o({textFormat:e.target.value})})))}xs.propTypes=tn,ks.propTypes=tn;var Ns=Object(l.trimStart)("\n// Available variables are x, ys, element, and Plotly\n// Type console.log(x, ys); for more info about x and ys\n// To plot your graph call Plotly.plot(element, ...)\n// Plotly examples and docs: https://plot.ly/javascript/\n");function As(e){var t=e.options,a=e.onOptionsChange;return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(To,{label:"Custom code","data-test":"Chart.Custom.Code",rows:"10",defaultValue:Object(l.isNil)(t.customCode)?Ns:t.customCode,onChange:e=>a({customCode:e.target.value})})),n.a.createElement(So,null,n.a.createElement(ko,{"data-test":"Chart.Custom.EnableConsoleLogs",defaultChecked:t.enableConsoleLogs,onChange:e=>a({enableConsoleLogs:e})},"Show errors in the console")),n.a.createElement(So,null,n.a.createElement(ko,{id:"chart-editor-auto-update-custom-chart","data-test":"Chart.Custom.AutoUpdate",defaultChecked:t.autoRedraw,onChange:e=>a({autoRedraw:e})},"Auto update graph")))}As.propTypes=tn;a(1270);var Ts=e=>"custom"===e.globalSeriesType,Ws=e=>"pie"===e.globalSeriesType,Is={type:"CHART",name:"图表(Chart)",isDefault:!0,getOptions:function(e){var t=Object(l.merge)({},Zo,{showDataLabels:"pie"===e.globalSeriesType,dateTimeFormat:Do.dateTimeFormat},e);return["normal","percent"].indexOf(t.series.stacking)>=0&&(t.series.percentValues="percent"===t.series.stacking,t.series.stacking="stack"),t},Renderer:Pl,Editor:Oo([{key:"General",title:window.W_L.general,component:e=>n.a.createElement(n.a.Fragment,null,n.a.createElement(Vl,e),Ts(e.options)&&n.a.createElement(As,e))},{key:"XAxis",title:e=>e.swappedAxes?window.W_L.y_column:window.W_L.x_column,component:Kl,isAvailable:e=>!Ts(e)&&!Ws(e)},{key:"YAxis",title:e=>e.swappedAxes?window.W_L.x_column:window.W_L.y_column,component:Jl,isAvailable:e=>!Ts(e)&&!Ws(e)},{key:"Series",title:window.W_L.series,component:gs,isAvailable:e=>!Ts(e)},{key:"Colors",title:window.W_L.color,component:xs,isAvailable:e=>!Ts(e)},{key:"DataLabels",title:window.W_L.data_labels,component:ks,isAvailable:e=>!Ts(e)}]),defaultColumns:3,defaultRows:8,minColumns:1,minRows:5},qs=Object(l.extend)({White:"#ffffff",Black:"#000000","Light Gray":"#dddddd"},Oi);var Ds={mapType:"countries",keyColumn:null,targetField:null,valueColumn:null,clusteringMode:"e",steps:5,valueFormat:"0,0.00",noValuePlaceholder:"N/A",colors:{min:qs["Light Blue"],max:qs["Dark Blue"],background:qs.White,borders:qs.White,noValue:qs["Light Gray"]},legend:{visible:!0,position:"bottom-left",alignText:"right"},tooltip:{enabled:!0,template:"<b>{{ @@name }}</b>: {{ @@value }}"},popup:{enabled:!0,template:"".concat(window.W_L.region,": <b>{{ @@name_long }} ({{ @@iso_a2 }})</b>\n<br>\n").concat(window.W_L.value,": <b>{{ @@value }}</b>")}};function Rs(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ms(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ms(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ms(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var zs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.cleanupDelay,a=void 0===t?2e3:t,r={},n=Object(l.debounce)(()=>{Object(l.each)(r,(e,t)=>{e.refCount<=0&&delete r[t]})},a);function o(e,t){r[e]||(r[e]={value:t(),refCount:0});var a=r[e];return a.refCount+=1,a.value}function i(e){if(r[e]){var t=r[e];t.refCount>0&&(t.refCount-=1,t.refCount<=0&&n())}}return{get:o,release:i}}();function Fs(e){var t=Rs(Object(r.useState)(null),2),a=t[0],n=t[1],o=Rs(Object(r.useState)(!1),2),i=o[0],s=o[1];return Object(r.useEffect)(()=>{var t=Object(l.get)(Do,"choroplethAvailableMaps.".concat(e,".url"),void 0);if(Object(l.isString)(t)){s(!0);var a=!1;return zs.get(t,()=>W.a.get(t).catch(()=>null)).then(e=>{var t=e.data;a||(n(Object(l.isObject)(t)?t:null),s(!1))}),()=>{a=!0,zs.release(t)}}n(null),s(!1)},[e]),[a,i]}var Vs=a(58),Us=a.n(Vs);a(588),a(589),a(590);function Bs(e){return On()(e).darken().hex()}function Hs(e,t,a){var r=e.properties[a];return Object(l.isString)(r)&&Object(l.isObject)(t[r])?t[r].value:Object(l.isNumber)(r)&&Object(l.isObject)(t[r.toString()])?t[r.toString()].value:void 0}function Ys(e){var t=e.items,a=e.alignText;return n.a.createElement("div",{className:"choropleth-visualization-legend"},Object(l.map)(t,(e,t)=>n.a.createElement("div",{key:"legend".concat(t),className:"legend-item"},n.a.createElement(Yn.Swatch,{color:e.color}),n.a.createElement("div",{className:"legend-item-text text-".concat(a)},e.text))))}function Qs(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Ks(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Qs(Object(a),!0).forEach((function(t){$s(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Qs(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function $s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Ys.defaultProps={items:[],alignText:"left"};var Gs=Us.a.Control.extend({options:{position:"topright"},onAdd(){var e=document.createElement("div");return e.className="leaflet-bar leaflet-custom-toolbar",e.style.background="#fff",e.style.backgroundClip="padding-box",e},onRemove(){i.a.unmountComponentAtNode(this.getContainer())}});function Js(e){var t=e.feature,a=e.layer,r=e.data,n=e.options,o=e.limits,i=e.colors,s=e.formatValue,c=Hs(t,r,n.targetField),u=function(e,t,a,r){var n={};Object(l.each)(e.properties,(e,t)=>{n["@@"+t]=e}),n["@@value"]=t;var o=a[e.properties[r]]||{};return Object(l.extend)(n,o.item)}(t,s(c),r,n.targetField),d=function(e,t,a,r){if(Object(l.isFinite)(e))for(var n=0;n<t.length;n+=1)if(e<=t[n])return a[n];return r}(c,o,i,n.colors.noValue);a.setStyle({color:n.colors.borders,weight:1,fillColor:d,fillOpacity:1}),n.tooltip.enabled&&a.bindTooltip(ke(zi(n.tooltip.template,u)),{sticky:!0}),n.popup.enabled&&a.bindPopup(ke(zi(n.popup.template,u))),a.on("mouseover",()=>{a.setStyle({weight:2,fillColor:Bs(d)})}),a.on("mouseout",()=>{a.setStyle({weight:1,fillColor:d})})}function Xs(e,t){return e&&(e=Us.a.latLngBounds(e[0],e[1])).isValid()?e:t&&t.isValid()?t:null}function Zs(e,t){var a=Us.a.map(e,{center:[0,0],zoom:1,zoomSnap:0,scrollWheelZoom:!1,maxBoundsViscosity:1,attributionControl:!1,fullscreenControl:!0}),r=null,o=new Gs;var s=!1,c=()=>{!function(){if(Object(l.isFunction)(t)){var e=a.getBounds();t([[e._southWest.lat,e._southWest.lng],[e._northEast.lat,e._northEast.lng]])}}()};a.on("focus",()=>{s=!0,a.on("moveend",c)}),a.on("blur",()=>{a.off("moveend",c),s=!1});var u=Gr(e,()=>{a.invalidateSize(!1)});return{updateLayers:function(e,t,s){if(a.eachLayer(e=>a.removeLayer(e)),a.removeControl(o),!Object(l.isObject)(e)||!Object(l.isArray)(e.features))return r=null,void a.setMaxBounds(null);var c,u,d,m=function(e,t,a){var r=Object(l.uniq)(Object(l.filter)(Object(l.map)(e,e=>Hs(e,t,a.targetField)),l.isFinite));if(0===r.length)return{limits:[],colors:[],legend:[]};var n=Math.min(r.length,a.steps);if(1===n)return{limits:r,colors:[a.colors.max],legend:[{color:a.colors.max,limit:Object(l.first)(r)}]};var o=On.a.limits(r,a.clusteringMode,n-1),i=On.a.scale([a.colors.min,a.colors.max]).colors(o.length),s=Object(l.map)(i,(e,t)=>({color:e,limit:o[t]})).reverse();return{limits:o,colors:i,legend:s}}(e.features,t,s),p=m.limits,f=m.colors,g=m.legend,b=(c=s.valueFormat,u=s.noValuePlaceholder,d=Mi(c),e=>Object(l.isFinite)(e)?d(e):u),h=(r=Us.a.geoJSON(e,{onEachFeature(e,a){Js({feature:e,layer:a,data:t,options:s,limits:p,colors:f,formatValue:b})}}).addTo(a)).getBounds(),y=Xs(s.bounds,h);a.fitBounds(y,{animate:!1,duration:0}),a.options.maxBounds=h,a.panInsideBounds(h,{animate:!1,duration:0}),s.legend.visible&&g.length>0&&(o.setPosition(s.legend.position.replace("-","")),a.addControl(o),i.a.render(n.a.createElement(Ys,{items:Object(l.map)(g,e=>Ks(Ks({},e),{},{text:b(e.limit)})),alignText:s.legend.alignText}),o.getContainer()))},updateBounds:function(e){s||(e=Xs(e,r?r.getBounds():a.getBounds()))&&a.fitBounds(e,{animate:!1,duration:0})},destroy(){u(),a.removeControl(o),a.remove()}}}a(1271);function ec(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function tc(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ec(Object(a),!0).forEach((function(t){ac(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ec(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ac(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function rc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return nc(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return nc(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nc(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function oc(e){var t=e.data,a=e.options,o=e.onOptionsChange,i=rc(Object(r.useState)(null),2),s=i[0],c=i[1],u=rc(Fs(a.mapType),1)[0],d=Object(r.useRef)();d.current=o?e=>o(tc(tc({},a),{},{bounds:e})):l.noop;var m,p,f,g,b=(m=()=>Object(l.omit)(a,["bounds"]),p=[a],f=Object(r.useRef)(),g=Object(r.useMemo)(m,p),Object(l.isEqual)(g,f.current)||(f.current=g),f.current),h=rc(Object(r.useState)(null),2),y=h[0],v=h[1];return Object(r.useEffect)(()=>{if(s){var e=Zs(s,(function(){return d.current(...arguments)}));return v(e),()=>{e.destroy()}}},[s]),Object(r.useEffect)(()=>{y&&y.updateLayers(u,function(e,t,a){if(!t||!a)return{};var r={};return Object(l.each)(e,e=>{if(e[t]){var n=parseFloat(e[a]);r[e[t]]={code:e[t],value:Object(l.isFinite)(n)?n:void 0,item:e}}}),r}(t.rows,b.keyColumn,b.valueColumn),a)},[y,u,t.rows,b]),Object(r.useEffect)(()=>{y&&y.updateBounds(a.bounds)},[y,a,o]),n.a.createElement("div",{className:"map-visualization-container",style:{background:a.colors.background},ref:c})}function ic(e){var t=Object(l.isObject)(e)&&Object(l.isArray)(e.features)?e.features:[];return Object(l.reduce)(t,(e,t)=>{var a=Object(l.isObject)(t)&&Object(l.isObject)(t.properties)?t.properties:{};return Object(l.uniq)([...e,...Object(l.keys)(a)])},[])}function lc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return sc(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return sc(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function sc(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function cc(e){var t=e.options,a=e.data,o=e.onOptionsChange,i=lc(Fs(t.mapType),2),s=i[0],c=i[1],u=Object(r.useMemo)(()=>ic(s),[s]),d=c?Object(l.filter)([t.targetField],l.isString):u,m=Object(l.get)(Do,"choroplethAvailableMaps.".concat(t.mapType,".fieldNames"),{}),p=Object(r.useCallback)(e=>{o({mapType:e||null})},[o]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Fo,{label:window.W_L.Map,"data-test":"Choropleth.Editor.MapType",defaultValue:t.mapType,onChange:p},Object(l.map)(Do.choroplethAvailableMaps,(e,t)=>n.a.createElement(Fo.Option,{key:t,"data-test":"Choropleth.Editor.MapType.".concat(t)},Object(l.get)(Do,"choroplethAvailableMaps.".concat(t,".name"),t))))),n.a.createElement(So,null,n.a.createElement(io.Row,{gutter:15},n.a.createElement(io.Col,{span:12},n.a.createElement(Fo,{label:window.W_L.Key_Column,className:"w-100","data-test":"Choropleth.Editor.KeyColumn",disabled:0===a.columns.length,defaultValue:t.keyColumn,onChange:e=>o({keyColumn:e})},Object(l.map)(a.columns,e=>{var t=e.name;return n.a.createElement(Fo.Option,{key:t,"data-test":"Choropleth.Editor.KeyColumn.".concat(t)},t)}))),n.a.createElement(io.Col,{span:12},n.a.createElement(Fo,{label:window.W_L.Target_Field,className:"w-100","data-test":"Choropleth.Editor.TargetField",disabled:c||0===d.length,loading:c,value:t.targetField,onChange:e=>o({targetField:e})},Object(l.map)(d,e=>n.a.createElement(Fo.Option,{key:e,"data-test":"Choropleth.Editor.TargetField.".concat(e)},m[e]||e)))))),n.a.createElement(So,null,n.a.createElement(Fo,{label:window.W_L.Value_Column,"data-test":"Choropleth.Editor.ValueColumn",disabled:0===a.columns.length,defaultValue:t.valueColumn,onChange:e=>o({valueColumn:e})},Object(l.map)(a.columns,e=>{var t=e.name;return n.a.createElement(Fo.Option,{key:t,"data-test":"Choropleth.Editor.ValueColumn.".concat(t)},t)}))))}function uc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return dc(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return dc(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function dc(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function mc(e){var t=e.options,a=e.onOptionsChange,r=uc(Object(Ul.a)(a,200),1)[0];return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Fo,{layout:"horizontal",label:window.W_L.Clustering_Mode,"data-test":"Choropleth.Editor.ClusteringMode",defaultValue:t.clusteringMode,onChange:e=>a({clusteringMode:e})},n.a.createElement(Fo.Option,{value:"q","data-test":"Choropleth.Editor.ClusteringMode.q"},"分位数(quantile)"),n.a.createElement(Fo.Option,{value:"e","data-test":"Choropleth.Editor.ClusteringMode.e"},"等距(equidistant)"),n.a.createElement(Fo.Option,{value:"k","data-test":"Choropleth.Editor.ClusteringMode.k"},"K均值(k-means)"))),n.a.createElement(So,null,n.a.createElement(Uo,{layout:"horizontal",label:window.W_L.Steps,"data-test":"Choropleth.Editor.ColorSteps",min:3,max:11,defaultValue:t.steps,onChange:e=>r({steps:e})})),n.a.createElement(So,null,n.a.createElement(Bo,{layout:"horizontal",label:window.W_L.min_color,interactive:!0,presetColors:qs,placement:"topRight",color:t.colors.min,triggerProps:{"data-test":"Choropleth.Editor.Colors.Min"},onChange:e=>a({colors:{min:e}}),addonAfter:n.a.createElement(Bo.Label,{color:t.colors.min,presetColors:qs})})),n.a.createElement(So,null,n.a.createElement(Bo,{layout:"horizontal",label:window.W_L.max_color,interactive:!0,presetColors:qs,placement:"topRight",color:t.colors.max,triggerProps:{"data-test":"Choropleth.Editor.Colors.Max"},onChange:e=>a({colors:{max:e}}),addonAfter:n.a.createElement(Bo.Label,{color:t.colors.max,presetColors:qs})})),n.a.createElement(So,null,n.a.createElement(Bo,{layout:"horizontal",label:window.W_L.No_Value_Color,interactive:!0,presetColors:qs,placement:"topRight",color:t.colors.noValue,triggerProps:{"data-test":"Choropleth.Editor.Colors.NoValue"},onChange:e=>a({colors:{noValue:e}}),addonAfter:n.a.createElement(Bo.Label,{color:t.colors.noValue,presetColors:qs})})),n.a.createElement(So,null,n.a.createElement(Bo,{layout:"horizontal",label:window.W_L.Background_Color,interactive:!0,presetColors:qs,placement:"topRight",color:t.colors.background,triggerProps:{"data-test":"Choropleth.Editor.Colors.Background"},onChange:e=>a({colors:{background:e}}),addonAfter:n.a.createElement(Bo.Label,{color:t.colors.background,presetColors:qs})})),n.a.createElement(So,null,n.a.createElement(Bo,{layout:"horizontal",label:window.W_L.Borders_Color,interactive:!0,presetColors:qs,placement:"topRight",color:t.colors.borders,triggerProps:{"data-test":"Choropleth.Editor.Colors.Borders"},onChange:e=>a({colors:{borders:e}}),addonAfter:n.a.createElement(Bo.Label,{color:t.colors.borders,presetColors:qs})})))}function pc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return fc(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return fc(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fc(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function gc(e){var t=e.geoJsonProperties;return n.a.createElement(zo,{placement:"topLeft",arrowPointAtCenter:!0},n.a.createElement("div",{style:{paddingBottom:5}},n.a.createElement("div",null,window.W_L.Also_all_query_result_columns_can_be_referenced,"：",n.a.createElement("code",null,"{{ column_name }}"),"。"),n.a.createElement("div",null,"Use",n.a.createElement("code",null,"{{ @@value }}")," to access formatted value.")),t.length>0&&n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"p-b-5"},"GeoJSON properties could be accessed by these names:"),n.a.createElement("div",{style:{maxHeight:300,overflow:"auto"}},Object(l.map)(t,e=>n.a.createElement("div",{key:e},n.a.createElement("code",null,"{{ @@".concat(e,"}}")))))))}function bc(e){var t=e.options,a=e.onOptionsChange,o=pc(Object(Ul.a)(a,200),1)[0],i=pc(Fs(t.mapType),1)[0],l=Object(r.useMemo)(()=>ic(i),[i]),s=n.a.createElement(gc,{geoJsonProperties:l});return n.a.createElement("div",{className:"choropleth-visualization-editor-format-settings"},n.a.createElement(So,null,n.a.createElement(io.Row,{gutter:15},n.a.createElement(io.Col,{span:12},n.a.createElement(Vo,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Value_Format,n.a.createElement(zo.NumberFormatSpecs,null)),"data-test":"Choropleth.Editor.ValueFormat",defaultValue:t.valueFormat,onChange:e=>o({valueFormat:e.target.value})})),n.a.createElement(io.Col,{span:12},n.a.createElement(Vo,{label:window.W_L.Value_Placeholder,"data-test":"Choropleth.Editor.ValuePlaceholder",defaultValue:t.noValuePlaceholder,onChange:e=>o({noValuePlaceholder:e.target.value})})))),n.a.createElement(So,null,n.a.createElement(gn.a,{"data-test":"Choropleth.Editor.LegendVisibility",checked:t.legend.visible,onChange:e=>a({legend:{visible:e.target.checked}})},window.W_L.Show_Legend)),n.a.createElement(So,null,n.a.createElement(io.Row,{gutter:15},n.a.createElement(io.Col,{span:12},n.a.createElement(Fo,{label:window.W_L.Legend_Position,"data-test":"Choropleth.Editor.LegendPosition",disabled:!t.legend.visible,defaultValue:t.legend.position,onChange:e=>a({legend:{position:e}})},n.a.createElement(Fo.Option,{value:"top-left","data-test":"Choropleth.Editor.LegendPosition.TopLeft"},"top / left"),n.a.createElement(Fo.Option,{value:"top-right","data-test":"Choropleth.Editor.LegendPosition.TopRight"},"top / right"),n.a.createElement(Fo.Option,{value:"bottom-left","data-test":"Choropleth.Editor.LegendPosition.BottomLeft"},"bottom / left"),n.a.createElement(Fo.Option,{value:"bottom-right","data-test":"Choropleth.Editor.LegendPosition.BottomRight"},"bottom / right"))),n.a.createElement(io.Col,{span:12},n.a.createElement(Ho,{"data-test":"Choropleth.Editor.LegendTextAlignment",label:window.W_L.Legend_Text_Alignment,disabled:!t.legend.visible,defaultValue:t.legend.alignText,onChange:e=>a({legend:{alignText:e.target.value}})})))),n.a.createElement(So,null,n.a.createElement(gn.a,{"data-test":"Choropleth.Editor.TooltipEnabled",checked:t.tooltip.enabled,onChange:e=>a({tooltip:{enabled:e.target.checked}})},window.W_L.Show_tooltip)),n.a.createElement(So,null,n.a.createElement(Vo,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Tooltip_template," ",s),"data-test":"Choropleth.Editor.TooltipTemplate",disabled:!t.tooltip.enabled,defaultValue:t.tooltip.template,onChange:e=>o({tooltip:{template:e.target.value}})})),n.a.createElement(So,null,n.a.createElement(gn.a,{"data-test":"Choropleth.Editor.PopupEnabled",checked:t.popup.enabled,onChange:e=>a({popup:{enabled:e.target.checked}})},window.W_L.Show_popup)),n.a.createElement(So,null,n.a.createElement(To,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Popup_template," ",s),"data-test":"Choropleth.Editor.PopupTemplate",disabled:!t.popup.enabled,rows:4,defaultValue:t.popup.template,onChange:e=>o({popup:{template:e.target.value}})})))}function hc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return yc(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return yc(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yc(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function vc(e){var t=e.options,a=e.onOptionsChange,o=hc(Object(r.useState)(t.bounds),2),i=o[0],s=o[1],c=hc(Object(Ul.a)(a,200),1)[0],u=hc(Fs(t.mapType),1)[0];Object(r.useEffect)(()=>{if(t.bounds)s(t.bounds);else{var e=function(e){if(Object(l.isObject)(e)){var t=Us.a.geoJSON(e).getBounds();if(t.isValid())return[[t._southWest.lat,t._southWest.lng],[t._northEast.lat,t._northEast.lng]]}return null}(u);e&&s(e)}},[t.bounds,u]);var d=Object(r.useCallback)((e,t,a)=>{if(a=parseFloat(a),Object(l.isFinite)(a)){var r=Object(l.cloneDeep)(i);r[e][t]=a,s(r),c({bounds:r})}},[i,c]),m=Object(l.isArray)(i);return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(po,{label:window.W_L.North_East_Latitude_and_Longitude},n.a.createElement(io.Row,{gutter:15},n.a.createElement(io.Col,{span:12},n.a.createElement(Uo,{disabled:!m,value:m?i[1][0]:void 0,onChange:e=>d(1,0,e)})),n.a.createElement(io.Col,{span:12},n.a.createElement(Uo,{disabled:!m,value:m?i[1][1]:void 0,onChange:e=>d(1,1,e)}))))),n.a.createElement(So,null,n.a.createElement(po,{label:window.W_L.South_West_Latitude_and_Longitude},n.a.createElement(io.Row,{gutter:15},n.a.createElement(io.Col,{span:12},n.a.createElement(Uo,{disabled:!m,value:m?i[0][0]:void 0,onChange:e=>d(0,0,e)})),n.a.createElement(io.Col,{span:12},n.a.createElement(Uo,{disabled:!m,value:m?i[0][1]:void 0,onChange:e=>d(0,1,e)}))))))}oc.propTypes=en,cc.propTypes=tn,mc.propTypes=tn,gc.defaultProps={geoJsonProperties:[]},bc.propTypes=tn,vc.propTypes=tn;var wc={type:"CHOROPLETH",name:"地理分布图(Choropleth Map)",getOptions:function(e){var t=Object(l.merge)({},Ds,e);return t.bounds=Object(l.get)(e,"bounds"),Object(l.isNil)(Do.choroplethAvailableMaps[t.mapType])&&(t.mapType=Object(l.first)(Object(l.keys)(Do.choroplethAvailableMaps))||null),Object(l.isNil)(t.countryCodeColumn)||(t.keyColumn=t.countryCodeColumn),delete t.countryCodeColumn,Object(l.isNil)(t.countryCodeType)||(t.targetField=t.countryCodeType),delete t.countryCodeType,t},Renderer:oc,Editor:Oo([{key:"General",title:window.W_L.general,component:cc},{key:"Colors",title:window.W_L.color,component:mc},{key:"Format",title:window.W_L.formatting,component:bc},{key:"Bounds",title:window.W_L.border,component:vc}]),defaultColumns:3,defaultRows:8,minColumns:2},Oc={timeInterval:"daily",mode:"diagonal",dateColumn:"date",stageColumn:"day_number",totalColumn:"total",valueColumn:"value",showTooltips:!0,percentValues:!0,timeColumnTitle:"Time",peopleColumnTitle:"Users",stageColumnTitle:"{{ @ }}",numberFormat:"0,0[.]00",percentFormat:"0.00%",noValuePlaceholder:"-",colors:{min:"#ffffff",max:Oi["Dark Blue"],steps:7}};var _c={weekly:"weeks",daily:"days",monthly:"months"};function Ec(e){var t={};return s.a.each(e,e=>{var a=Fa()(e.date),r=a.valueOf();t[r]=t[r]||{date:a,total:parseInt(e.total,10)||0,values:{}},t[r].values[e.stage]=parseInt(e.value,10)||null}),s.a.values(t)}function jc(e,t){if(!function(e,t){var a=s.a.map(e.columns,e=>e.name);return e.rows.length>0&&s.a.includes(a,t.dateColumn)&&s.a.includes(a,t.stageColumn)&&s.a.includes(a,t.totalColumn)&&s.a.includes(a,t.valueColumn)}(e,t))return{data:[],initialDate:null};e=s.a.map(e.rows,e=>({date:e[t.dateColumn],stage:parseInt(e[t.stageColumn],10),total:parseFloat(e[t.totalColumn]),value:parseFloat(e[t.valueColumn])}));var a,r=s.a.sortBy(e,e=>e.date+e.stage),n=Fa()(r[0].date).toDate();switch(t.mode){case"simple":a=function(e,t){var a=t.timeInterval,r=Ec(e),n=s.a.map(e,e=>e.stage),o=s.a.min(n),i=s.a.max(n),l=null,c=[];return s.a.each(r,e=>{if(null!==l)for(var t=Math.abs(l.diff(e.date,_c[a]));t>1;)c.push([0]),t-=1;l=e.date;for(var r=[e.total],n=o;n<=i;n+=1)r.push(e.values[n]);c.push(r)}),c}(r,t);break;default:a=function(e,t){var a=t.timeInterval,r=Ec(e),n=s.a.min(s.a.map(e,e=>e.stage)),o=Fa()(s.a.last(r).date).diff(s.a.first(r).date,_c[a]),i=n+o,l=null,c=[];return s.a.each(r,e=>{if(null!==l)for(var t=Math.abs(l.diff(e.date,_c[a]));t>1;){for(var r=[0],o=n;o<=i;o+=1)r.push(e.values[o]||0);c.push(r),i-=1,t-=1}l=e.date;for(var s=[e.total],u=n;u<=i;u+=1)s.push(e.values[u]||0);i-=1,c.push(s)}),c}(r,t)}return{data:a,initialDate:n}}a(1272),a(1273);var Sc={daily:"days",weekly:"weeks",monthly:"months",yearly:"years"},Cc={daily:"MMMM D, YYYY",weekly:"[Week of] MMM D, YYYY",monthly:"MMMM YYYY",yearly:"YYYY"},xc={initialDate:null,timeInterval:"monthly",noValuePlaceholder:"-",rawNumberOnHover:!0,displayAbsoluteValues:!1,initialIntervalNumber:1,maxColumns:1/0,title:null,timeColumnTitle:"Time",peopleColumnTitle:"People",stageColumnTitle:"{{ @ }}",numberFormat:"0,0[.]00",percentFormat:"0.00%",timeLabelFormat:Cc.monthly,colors:{min:"#ffffff",max:"#041d66",steps:7}};function Pc(e){e=On()(e);return On.a.contrast(e,"#ffffff")<On.a.contrast(e,"#000000")}function Lc(e,t){return zi(e.stageColumnTitle,{"@":e.initialIntervalNumber-1+t})}function kc(e){for(var t=e.options,a=e.maxRowLength,r=[],o=1;o<a;o+=1)r.push(n.a.createElement("th",{key:"col".concat(o),className:"cornelius-stage"},Lc(t,o)));return n.a.createElement("tr",null,n.a.createElement("th",{className:"cornelius-time"},t.timeColumnTitle),n.a.createElement("th",{className:"cornelius-people"},t.peopleColumnTitle),r)}function Nc(e){for(var t=e.options,a=e.data,r=e.index,o=e.maxRowLength,i=a[0]||0,s=[],c=1;c<o;c+=1){var u=a[c],d=Object(l.isFinite)(u/i)?u/i*100:null,m={key:"col".concat(c)};if(Object(l.isNil)(d))m.className="cornelius-empty",m.children=t.noValuePlaceholder;else{m.className=t.displayAbsoluteValues?"cornelius-absolute":"cornelius-percentage",m.children=t.displayAbsoluteValues?t.formatNumber(u):t.formatPercent(d);var p=t.getColorForValue(d);m.style={backgroundColor:p,color:_n(p)},Pc(m.style.color)&&(m.className+=" cornelius-white-text"),t.rawNumberOnHover&&!t.displayAbsoluteValues&&(m.children=n.a.createElement(he.a,{title:t.formatNumber(u),mouseEnterDelay:0,mouseLeaveDelay:0},n.a.createElement("div",null,m.children)))}s.push(n.a.createElement("td",m))}return n.a.createElement("tr",null,n.a.createElement("td",{className:"cornelius-label"},function(e,t){var a=Sc[e.timeInterval];return e.initialDate.clone().add(t,a).format(e.timeLabelFormat)}(t,r)),n.a.createElement("td",{className:"cornelius-people"},t.formatNumber(i)),s)}function Ac(e){var t=e.data,a=e.options;a=Object(r.useMemo)(()=>function(e){return e=Object(l.extend)({},xc,e,{initialDate:Fa()(e.initialDate),colors:Object(l.extend)({},xc.colors,e.colors)}),Object(l.extend)(e,{timeLabelFormat:Cc[e.timeInterval],formatNumber:Mi(e.numberFormat),formatPercent:Mi(e.percentFormat),getColorForValue:On.a.scale([e.colors.min,e.colors.max]).mode("hsl").domain([0,100]).classes(e.colors.steps)})}(a),[a]);var o=Object(r.useMemo)(()=>Object(l.min)([Object(l.max)(Object(l.map)(t,e=>e.length))||0,a.maxColumns+1]),[t,a.maxColumns]);return 0===t.length?null:n.a.createElement("div",{className:"cornelius-container"},a.title&&n.a.createElement("div",{className:"cornelius-title"},a.title),n.a.createElement("table",{className:"cornelius-table"},n.a.createElement("thead",null,n.a.createElement(kc,{options:a,maxRowLength:o})),n.a.createElement("tbody",null,Object(l.map)(t,(e,t)=>n.a.createElement(Nc,{key:"row".concat(t),options:a,data:e,index:t,maxRowLength:o})))))}function Tc(e){var t=e.data,a=e.options,o=Object(r.useMemo)(()=>jc(t,a),[t,a]),i=o.data,l=o.initialDate,s=Object(r.useMemo)(()=>({initialDate:l,timeInterval:a.timeInterval,noValuePlaceholder:a.noValuePlaceholder,rawNumberOnHover:a.showTooltips,displayAbsoluteValues:!a.percentValues,timeColumnTitle:a.timeColumnTitle,peopleColumnTitle:a.peopleColumnTitle,stageColumnTitle:a.stageColumnTitle,numberFormat:a.numberFormat,percentFormat:a.percentFormat,colors:a.colors}),[a,l]);return 0===i.length?null:n.a.createElement("div",{className:"cohort-visualization-container"},n.a.createElement(Ac,{data:i,options:s}))}function Wc(e){var t=e.options,a=e.data,r=e.onOptionsChange;return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Fo,{layout:"horizontal",label:"Date (Bucket)","data-test":"Cohort.DateColumn",value:t.dateColumn,onChange:e=>r({dateColumn:e})},Object(l.map)(a.columns,e=>{var t=e.name;return n.a.createElement(Fo.Option,{key:t,"data-test":"Cohort.DateColumn."+t},t)}))),n.a.createElement(So,null,n.a.createElement(Fo,{layout:"horizontal",label:window.W_L.Steps,"data-test":"Cohort.StageColumn",value:t.stageColumn,onChange:e=>r({stageColumn:e})},Object(l.map)(a.columns,e=>{var t=e.name;return n.a.createElement(Fo.Option,{key:t,"data-test":"Cohort.StageColumn."+t},t)}))),n.a.createElement(So,null,n.a.createElement(Fo,{layout:"horizontal",label:"Bucket Population Size","data-test":"Cohort.TotalColumn",value:t.totalColumn,onChange:e=>r({totalColumn:e})},Object(l.map)(a.columns,e=>{var t=e.name;return n.a.createElement(Fo.Option,{key:t,"data-test":"Cohort.TotalColumn."+t},t)}))),n.a.createElement(So,null,n.a.createElement(Fo,{layout:"horizontal",label:window.W_L.Stage_Value,"data-test":"Cohort.ValueColumn",value:t.valueColumn,onChange:e=>r({valueColumn:e})},Object(l.map)(a.columns,e=>{var t=e.name;return n.a.createElement(Fo.Option,{key:t,"data-test":"Cohort.ValueColumn."+t},t)}))))}Ac.defaultProps={data:[],options:{}},Tc.propTypes=en,Wc.propTypes=tn;var Ic={daily:window.W_L.Daily,weekly:window.W_L.Weekly,monthly:window.W_L.Monthly},qc={diagonal:window.W_L.Fill_gaps_with_zeros,simple:window.W_L.Show_data_as_is};function Dc(e){var t=e.options,a=e.onOptionsChange;return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Fo,{layout:"horizontal",label:window.W_L.Time_Interval,"data-test":"Cohort.TimeInterval",value:t.timeInterval,onChange:e=>a({timeInterval:e})},Object(l.map)(Ic,(e,t)=>n.a.createElement(Fo.Option,{key:t,"data-test":"Cohort.TimeInterval."+t},e)))),n.a.createElement(So,null,n.a.createElement(Fo,{layout:"horizontal",label:window.W_L.Mode,"data-test":"Cohort.Mode",value:t.mode,onChange:e=>a({mode:e})},Object(l.map)(qc,(e,t)=>n.a.createElement(Fo.Option,{key:t,"data-test":"Cohort.Mode."+t},e)))))}function Rc(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Mc(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Dc.propTypes=tn;var zc=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Rc(Object(a),!0).forEach((function(t){Mc(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Rc(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({White:"#FFFFFF"},Oi);function Fc(e){return e=Object(l.isFinite)(e)?e:parseInt(e,10),e=Object(l.isFinite)(e)?e:0,Math.max(3,Math.min(e,20))}function Vc(e){var t=e.options,a=e.onOptionsChange;return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Bo,{layout:"horizontal",label:window.W_L.min_color,presetColors:zc,interactive:!0,color:t.colors.min,onChange:e=>a({colors:{min:e}}),addonAfter:n.a.createElement(Bo.Label,{color:t.colors.min,presetColors:zc})})),n.a.createElement(So,null,n.a.createElement(Bo,{layout:"horizontal",label:window.W_L.max_color,presetColors:zc,interactive:!0,color:t.colors.max,onChange:e=>a({colors:{max:e}}),addonAfter:n.a.createElement(Bo.Label,{color:t.colors.max,presetColors:zc})})),n.a.createElement(So,null,n.a.createElement(Uo,{layout:"horizontal",label:window.W_L.Steps,min:3,max:20,value:t.colors.steps,onChange:e=>a({colors:{steps:Fc(e)}})})))}function Uc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Bc(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Bc(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Bc(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Hc(e){var t=e.options,a=e.onOptionsChange,r=Uc(Object(Ul.a)(a,200),1)[0];return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Vo,{layout:"horizontal",label:window.W_L.Time_Column_Title,defaultValue:t.timeColumnTitle,onChange:e=>r({timeColumnTitle:e.target.value})})),n.a.createElement(So,null,n.a.createElement(Vo,{layout:"horizontal",label:window.W_L.People_Column_Title,defaultValue:t.peopleColumnTitle,onChange:e=>r({peopleColumnTitle:e.target.value})})),n.a.createElement(So,null,n.a.createElement(Vo,{layout:"horizontal",label:n.a.createElement(n.a.Fragment,null,window.W_L.Stage_Column_Title,n.a.createElement(zo,{placement:"topRight",arrowPointAtCenter:!0},n.a.createElement("div",null,"Use ",n.a.createElement("code",null,"{{ @ }}")," to insert a stage number"))),defaultValue:t.stageColumnTitle,onChange:e=>r({stageColumnTitle:e.target.value})})),n.a.createElement(So,null,n.a.createElement(Vo,{layout:"horizontal",label:n.a.createElement(n.a.Fragment,null,window.W_L.Number_format,n.a.createElement(zo.NumberFormatSpecs,null)),defaultValue:t.numberFormat,onChange:e=>r({numberFormat:e.target.value})})),n.a.createElement(So,null,n.a.createElement(Vo,{layout:"horizontal",label:n.a.createElement(n.a.Fragment,null,window.W_L.Percent_Values_Format,n.a.createElement(zo.NumberFormatSpecs,null)),defaultValue:t.percentFormat,onChange:e=>r({percentFormat:e.target.value})})),n.a.createElement(So,null,n.a.createElement(Vo,{layout:"horizontal",label:window.W_L.No_Value_Placeholder,defaultValue:t.noValuePlaceholder,onChange:e=>r({noValuePlaceholder:e.target.value})})),n.a.createElement(So,null,n.a.createElement(gn.a,{defaultChecked:t.showTooltips,onChange:e=>a({showTooltips:e.target.checked})},window.W_L.Show_Tooltips)),n.a.createElement(So,null,n.a.createElement(gn.a,{defaultChecked:t.percentValues,onChange:e=>a({percentValues:e.target.checked})},window.W_L.Normalize_values_to_percentage)))}Vc.propTypes=tn,Hc.propTypes=tn;var Yc={type:"COHORT",name:"同期群分析(Cohort)",getOptions:function(e){return Object(l.merge)({},Oc,e)},Renderer:Tc,Editor:Oo([{key:"Columns",title:window.W_L.column,component:Wc},{key:"Options",title:window.W_L.option,component:Dc},{key:"Colors",title:window.W_L.color,component:Vc},{key:"Appearance",title:window.W_L.exterior,component:Hc}]),autoHeight:!0,defaultRows:8};function Qc(e,t){if(0===(e=parseInt(e,10)||0))return e;var a=(Math.abs(e)-1)%t;return e>0?a:t-a-1}function Kc(e,t){var a=t.stringPrefix,r=t.stringSuffix,n=t.stringDecimal,o=t.stringDecChar,i=t.stringThouSep;return Object(l.isNumber)(e)?(e=function(e,t,a,r){var n=Ii.a.localeData(),o=n.delimiters;n.delimiters={thousands:",",decimal:"."};var i="0,0.000";if((Number.isFinite(t)&&t>=0||a||r)&&(n.delimiters={thousands:r,decimal:a||"."},i="0,0",t>0))for(i+=".";t>0;)i+="0",t-=1;var l=Ii()(e).format(i);return n.delimiters=o,l}(e,n,o,i),Object(l.toString)(a)+e+Object(l.toString)(r)):Object(l.toString)(e)}function $c(e,t){return Object(l.isNumber)(e)?Ii()(e).format(t):Object(l.toString)(e)}a(1274);function Gc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Jc(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Jc(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Jc(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Xc(e){return{msTransform:"scale(".concat(e,")"),MozTransform:"scale(".concat(e,")"),WebkitTransform:"scale(".concat(e,")"),transform:"scale(".concat(e,")")}}function Zc(e){var t=e.firstChild,a=Math.min(e.offsetWidth/t.offsetWidth,e.offsetHeight/t.offsetHeight);return Number(Object(l.isFinite)(a)?a:1).toFixed(2)}function eu(e){var t=e.data,a=e.options,o=e.visualizationName,i=Gc(Object(r.useState)("1.00"),2),s=i[0],c=i[1],u=Gc(Object(r.useState)(null),2),d=u[0],m=u[1];Object(r.useEffect)(()=>{if(d)return Gr(d,()=>{c(Zc(d))})},[d]),Object(r.useEffect)(()=>{d&&c(Zc(d))},[t,a,d]);var p=function(e,t,a){var r={},n=e.length;if(n>0||t.countRow){var o=t.counterColName,i=t.targetColName;if(r.counterLabel=t.counterLabel||a,t.countRow)r.counterValue=n;else if(o){var s=Qc(t.rowNumber,n);r.counterValue=e[s][o]}if(r.showTrend=!1,i){var c=Qc(t.targetRowNumber,n);if(r.targetValue=e[c][i],Number.isFinite(r.counterValue)&&Object(l.isFinite)(r.targetValue)){var u=r.counterValue-r.targetValue;r.showTrend=!0,r.trendPositive=u>=0}}else r.targetValue=null;r.counterValueTooltip=$c(r.counterValue,t.tooltipFormat),r.targetValueTooltip=$c(r.targetValue,t.tooltipFormat),r.counterValue=Kc(r.counterValue,t),t.formatTargetValue?r.targetValue=Kc(r.targetValue,t):Object(l.isFinite)(r.targetValue)&&(r.targetValue=Ii()(r.targetValue).format("0[.]00[0]"))}return r}(t.rows,a,o),f=p.showTrend,g=p.trendPositive,b=p.counterValue,h=p.counterValueTooltip,y=p.targetValue,v=p.targetValueTooltip,w=p.counterLabel;return n.a.createElement("div",{className:me()("counter-visualization-container",{"trend-positive":f&&g,"trend-negative":f&&!g})},n.a.createElement("div",{className:"counter-visualization-content",ref:m},n.a.createElement("div",{style:Xc(s)},n.a.createElement("div",{className:"counter-visualization-value",title:h},b),y&&n.a.createElement("div",{className:"counter-visualization-target",title:v},"(",y,")"),n.a.createElement("div",{className:"counter-visualization-label"},w))))}function tu(e){var t=e.options,a=e.data,r=e.visualizationName,o=e.onOptionsChange;return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Vo,{layout:"horizontal",label:"Counter Label","data-test":"Counter.General.Label",defaultValue:t.counterLabel,placeholder:r,onChange:e=>o({counterLabel:e.target.value})})),n.a.createElement(So,null,n.a.createElement(Fo,{layout:"horizontal",label:"Counter Value Column Name","data-test":"Counter.General.ValueColumn",defaultValue:t.counterColName,disabled:t.countRow,onChange:e=>o({counterColName:e})},Object(l.map)(a.columns,e=>n.a.createElement(Fo.Option,{key:e.name,"data-test":"Counter.General.ValueColumn."+e.name},e.name)))),n.a.createElement(So,null,n.a.createElement(Uo,{layout:"horizontal",label:"Counter Value Row Number","data-test":"Counter.General.ValueRowNumber",defaultValue:t.rowNumber,disabled:t.countRow,onChange:e=>o({rowNumber:e})})),n.a.createElement(So,null,n.a.createElement(Fo,{layout:"horizontal",label:"Target Value Column Name","data-test":"Counter.General.TargetValueColumn",defaultValue:t.targetColName,onChange:e=>o({targetColName:e})},n.a.createElement(Fo.Option,{value:""},"No target value"),Object(l.map)(a.columns,e=>n.a.createElement(Fo.Option,{key:e.name,"data-test":"Counter.General.TargetValueColumn."+e.name},e.name)))),n.a.createElement(So,null,n.a.createElement(Uo,{layout:"horizontal",label:"Target Value Row Number","data-test":"Counter.General.TargetValueRowNumber",defaultValue:t.targetRowNumber,onChange:e=>o({targetRowNumber:e})})),n.a.createElement(So,null,n.a.createElement(ko,{"data-test":"Counter.General.CountRows",defaultChecked:t.countRow,onChange:e=>o({countRow:e})},"Count Rows")))}function au(e){var t=e.options,a=e.data,r=e.onOptionsChange,o=function(e,t){if(t.countRow)return!0;var a=e.length;if(a>0){var r=Qc(t.rowNumber,a),n=t.counterColName;if(n)return Object(l.isNumber)(e[r][n])}return!1}(a.rows,t);return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Uo,{layout:"horizontal",label:"Formatting Decimal Place","data-test":"Counter.Formatting.DecimalPlace",defaultValue:t.stringDecimal,disabled:!o,onChange:e=>r({stringDecimal:e})})),n.a.createElement(So,null,n.a.createElement(Vo,{layout:"horizontal",label:"Formatting Decimal Character","data-test":"Counter.Formatting.DecimalCharacter",defaultValue:t.stringDecChar,disabled:!o,onChange:e=>r({stringDecChar:e.target.value})})),n.a.createElement(So,null,n.a.createElement(Vo,{layout:"horizontal",label:"Formatting Thousands Separator","data-test":"Counter.Formatting.ThousandsSeparator",defaultValue:t.stringThouSep,disabled:!o,onChange:e=>r({stringThouSep:e.target.value})})),n.a.createElement(So,null,n.a.createElement(Vo,{layout:"horizontal",label:"Formatting String Prefix","data-test":"Counter.Formatting.StringPrefix",defaultValue:t.stringPrefix,disabled:!o,onChange:e=>r({stringPrefix:e.target.value})})),n.a.createElement(So,null,n.a.createElement(Vo,{layout:"horizontal",label:"Formatting String Suffix","data-test":"Counter.Formatting.StringSuffix",defaultValue:t.stringSuffix,disabled:!o,onChange:e=>r({stringSuffix:e.target.value})})),n.a.createElement(So,null,n.a.createElement(ko,{"data-test":"Counter.Formatting.FormatTargetValue",defaultChecked:t.formatTargetValue,onChange:e=>r({formatTargetValue:e})},"Format Target Value")))}eu.propTypes=en,tu.propTypes=tn,au.propTypes=tn;var ru=Oo([{key:"General",title:window.W_L.general,component:tu},{key:"Format",title:window.W_L.formatting,component:au}]);function nu(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function ou(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?nu(Object(a),!0).forEach((function(t){iu(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):nu(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function iu(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var lu={counterLabel:"",counterColName:"counter",rowNumber:1,targetRowNumber:1,stringDecimal:0,stringDecChar:".",stringThouSep:",",tooltipFormat:"0,0.000"},su={type:"COUNTER",name:"计数器(Counter)",getOptions:e=>ou(ou({},lu),e),Renderer:eu,Editor:ru,defaultColumns:2,defaultRows:5},cu=a(177),uu=a.n(cu),du=a(200),mu=a.n(du);a(1275);function pu(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return fu(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return fu(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fu(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function gu(e){var t=e.data,a=pu(Object(r.useState)(0),2),o=a[0],i=a[1];if(!t||!t.rows||0===t.rows.length)return null;var s=Object(l.mapValues)(Object(l.keyBy)(t.columns,"name"),"type"),c=t.columns.map(e=>e.name),u=t.rows[o];return n.a.createElement("div",{className:"details-viz"},n.a.createElement(uu.a,{size:"small",column:1,bordered:!0},Object(l.map)(c,e=>{return n.a.createElement(uu.a.Item,{key:e,label:e},(t=u[e],a=s[e],r={date:Do.dateFormat,datetime:Do.dateTimeFormat},"date"!==a&&"datetime"!==a||!Fa.a.isMoment(t)?""+t:t.format(r[a])));var t,a,r})),t.rows.length>1&&n.a.createElement("div",{className:"paginator-container"},n.a.createElement(mu.a,{showSizeChanger:!1,current:o+1,defaultPageSize:1,total:t.rows.length,onChange:e=>i(e-1)})))}function bu(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function hu(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?bu(Object(a),!0).forEach((function(t){yu(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):bu(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function yu(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}gu.propTypes=en;var vu={},wu={type:"DETAILS",name:"<记录明细显示>",getOptions:e=>hu(hu({},vu),e),Renderer:gu,defaultColumns:2,defaultRows:2},Ou={stepCol:{colName:null,displayAs:"Steps"},valueCol:{colName:null,displayAs:"Value"},autoSort:!0,sortKeyCol:{colName:null,reverse:!1},itemsLimit:100,percentValuesRange:{min:.01,max:1e3},numberFormat:"0,0[.]00",percentFormat:"0[.]00%"};function _u(e){if(Fa.a.isMoment(e)){var t=Do.dateTimeFormat||"DD/MM/YYYY HH:mm";return e.format(t)}return Object(l.toString)(e)}a(1279);function Eu(e){var t=e.color,a=e.value,r=e.align,o=e.className,i=e.children;return n.a.createElement("div",{className:me()("funnel-bar","funnel-bar-".concat(r),o)},n.a.createElement("div",{className:"funnel-bar-value",style:{backgroundColor:t,width:a+"%"}}),n.a.createElement("div",{className:"funnel-bar-label"},i))}Eu.defaultProps={color:"#dadada",value:0,align:"left",className:null,children:null};a(1280);function ju(e){var t=e.data,a=e.options,o=Object(r.useMemo)(()=>function(e,t){if(0===e.length||!t.stepCol.colName||!t.valueCol.colName)return[];e=[...e],t.sortKeyCol.colName&&(e=Object(l.sortBy)(e,t.sortKeyCol.colName)),t.sortKeyCol.reverse&&(e=e.reverse());var a=Object(l.map)(e,e=>({step:_u(e[t.stepCol.colName]),value:parseFloat(e[t.valueCol.colName])||0})),r=Object(l.maxBy)(a,e=>e.value).value;return a.forEach((e,t)=>{e.pctMax=e.value/r*100,e.pctPrevious=0===t||e.value===a[t-1].value?100:e.value/a[t-1].value*100}),a.slice(0,t.itemsLimit)}(t.rows,a),[t,a]),i=Object(r.useMemo)(()=>Math.trunc(Math.random()*Number.MAX_SAFE_INTEGER).toString(36)+":",[o]),s=Object(r.useMemo)(()=>Mi(a.numberFormat),[a.numberFormat]),c=Object(r.useMemo)(()=>{var e=Mi(a.percentFormat);return t=>t<a.percentValuesRange.min?"<".concat(e(a.percentValuesRange.min)):t>a.percentValuesRange.max?">".concat(e(a.percentValuesRange.max)):e(t)},[a.percentFormat,a.percentValuesRange]),u=Object(r.useMemo)(()=>{if(0===o.length)return[];var e=Object(l.maxBy)(o,e=>isFinite(e.pctPrevious)?e.pctPrevious:0).pctPrevious;return[{title:a.stepCol.displayAs,dataIndex:"step",width:"25%",className:"text-ellipsis",render:e=>n.a.createElement(he.a,{title:e,mouseEnterDelay:0,mouseLeaveDelay:0},e)},{title:a.valueCol.displayAs,dataIndex:"value",width:"45%",align:"center",render:(e,t)=>n.a.createElement(Eu,{align:"center",color:Oi.Cyan,value:t.pctMax},s(e))},{title:"% Max",dataIndex:"pctMax",width:"15%",align:"center",render:e=>c(e)},{title:"% Previous",dataIndex:"pctPrevious",width:"15%",align:"center",render:t=>n.a.createElement(Eu,{className:"funnel-percent-column",value:t/e*100},c(t))}]},[a.stepCol.displayAs,a.valueCol.displayAs,o,s,c]);return 0===o.length?null:n.a.createElement("div",{className:"funnel-visualization-container"},n.a.createElement(Zl.a,{columns:u,dataSource:o,rowKey:(e,t)=>i+t,pagination:!1}))}function Su(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Cu(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Cu(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Cu(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function xu(e){var t=e.options,a=e.data,o=e.onOptionsChange,i=Object(r.useMemo)(()=>Object(l.map)(a.columns,e=>e.name),[a]),s=Su(Object(Ul.a)(o,200),1)[0];return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Fo,{layout:"horizontal",label:"Step Column","data-test":"Funnel.StepColumn",placeholder:"Choose column...",defaultValue:t.stepCol.colName||void 0,onChange:e=>o({stepCol:{colName:e||null}})},Object(l.map)(i,e=>n.a.createElement(Fo.Option,{key:e,"data-test":"Funnel.StepColumn.".concat(e)},e)))),n.a.createElement(So,null,n.a.createElement(Vo,{layout:"horizontal",label:"Step Column Title","data-test":"Funnel.StepColumnTitle",defaultValue:t.stepCol.displayAs,onChange:e=>s({stepCol:{displayAs:e.target.value}})})),n.a.createElement(So,null,n.a.createElement(Fo,{layout:"horizontal",label:"Value Column","data-test":"Funnel.ValueColumn",placeholder:"Choose column...",defaultValue:t.valueCol.colName||void 0,onChange:e=>o({valueCol:{colName:e||null}})},Object(l.map)(i,e=>n.a.createElement(Fo.Option,{key:e,"data-test":"Funnel.ValueColumn.".concat(e)},e)))),n.a.createElement(So,null,n.a.createElement(Vo,{layout:"horizontal",label:"Value Column Title","data-test":"Funnel.ValueColumnTitle",defaultValue:t.valueCol.displayAs,onChange:e=>s({valueCol:{displayAs:e.target.value}})})),n.a.createElement(So,null,n.a.createElement(gn.a,{"data-test":"Funnel.CustomSort",checked:!t.autoSort,onChange:e=>o({autoSort:!e.target.checked})},"Custom Sorting")),!t.autoSort&&n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Fo,{layout:"horizontal",label:"Sort Column","data-test":"Funnel.SortColumn",allowClear:!0,placeholder:"Choose column...",defaultValue:t.sortKeyCol.colName||void 0,onChange:e=>o({sortKeyCol:{colName:e||null}})},Object(l.map)(i,e=>n.a.createElement(Fo.Option,{key:e,"data-test":"Funnel.SortColumn.".concat(e)},e)))),n.a.createElement(So,null,n.a.createElement(Fo,{layout:"horizontal",label:"Sort Order","data-test":"Funnel.SortDirection",disabled:!t.sortKeyCol.colName,defaultValue:t.sortKeyCol.reverse?"desc":"asc",onChange:e=>o({sortKeyCol:{reverse:"desc"===e}})},n.a.createElement(Fo.Option,{value:"asc","data-test":"Funnel.SortDirection.Ascending"},"ascending"),n.a.createElement(Fo.Option,{value:"desc","data-test":"Funnel.SortDirection.Descending"},"descending")))))}function Pu(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Lu(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Lu(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Lu(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function ku(e){var t=e.options,a=e.onOptionsChange,r=Pu(Object(Ul.a)(a,200),1)[0];return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Vo,{layout:"horizontal",label:n.a.createElement(n.a.Fragment,null,window.W_L.Number_format,n.a.createElement(zo.NumberFormatSpecs,null)),"data-test":"Funnel.NumberFormat",defaultValue:t.numberFormat,onChange:e=>r({numberFormat:e.target.value})})),n.a.createElement(So,null,n.a.createElement(Vo,{layout:"horizontal",label:n.a.createElement(n.a.Fragment,null,window.W_L.Percent_Values_Format,n.a.createElement(zo.NumberFormatSpecs,null)),"data-test":"Funnel.PercentFormat",defaultValue:t.percentFormat,onChange:e=>r({percentFormat:e.target.value})})),n.a.createElement(So,null,n.a.createElement(Uo,{layout:"horizontal",label:window.W_L.Items_Count_Limit,"data-test":"Funnel.ItemsLimit",min:2,defaultValue:t.itemsLimit,onChange:e=>r({itemsLimit:e})})),n.a.createElement(So,null,n.a.createElement(Uo,{layout:"horizontal",label:window.W_L.Min_Percent_Value,"data-test":"Funnel.PercentRangeMin",min:0,defaultValue:t.percentValuesRange.min,onChange:e=>r({percentValuesRange:{min:e}})})),n.a.createElement(So,null,n.a.createElement(Uo,{layout:"horizontal",label:window.W_L.Max_Percent_Value,"data-test":"Funnel.PercentRangeMax",min:0,defaultValue:t.percentValuesRange.max,onChange:e=>r({percentValuesRange:{max:e}})})))}ju.propTypes=en,xu.propTypes=tn,ku.propTypes=tn;var Nu={type:"FUNNEL",name:"漏斗分析(Funnel)",getOptions:function(e,t){var a=t.columns;e=Object(l.merge)({},Ou,e);var r=Object(l.map)(a,e=>e.name);return Object(l.includes)(r,e.stepCol.colName)||(e.stepCol.colName=null),Object(l.includes)(r,e.valueCol.colName)||(e.valueCol.colName=null),Object(l.includes)(r,e.sortKeyCol.colName)||(e.sortKeyCol.colName=null),Object(l.isFinite)(e.itemsLimit)||(e.itemsLimit=Ou.itemsLimit),e.itemsLimit<2&&(e.itemsLimit=2),e.autoSort&&(e.sortKeyCol.colName=e.valueCol.colName,e.sortKeyCol.reverse=!0),e},Renderer:ju,Editor:Oo([{key:"General",title:window.W_L.general,component:xu},{key:"Appearance",title:window.W_L.exterior,component:ku}]),defaultRows:10},Au={latColName:"lat",lonColName:"lon",classify:null,groups:{},mapTileUrl:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",clusterMarkers:!0,customizeMarkers:!1,iconShape:"marker",iconFont:"circle",foregroundColor:"#ffffff",backgroundColor:"#356AFF",borderColor:"#356AFF",bounds:null,tooltip:{enabled:!1,template:""},popup:{enabled:!0,template:""}};function Tu(e,t){var a=Qr.a.scale.category10(),r=t.classify,n=t.latColName,o=t.lonColName,i=r?Object(l.groupBy)(e.rows,r):{All:e.rows};return Object(l.filter)(Object(l.map)(i,(e,r)=>{var i=Object(l.filter)(Object(l.map)(e,e=>{var t=e[n],a=e[o];return Object(l.isNil)(t)||Object(l.isNil)(a)?null:{lat:t,lon:a,row:Object(l.omit)(e,[n,o])}}));if(0===i.length)return null;var s=Object(l.extend)({},t.groups[r],{name:r,points:i});return Object(l.isNil)(s.color)&&(s.color=a(r)),s}))}a(1281),a(1282),a(1283),a(1284),a(1285);var Wu=a(672),Iu=a.n(Wu),qu=a(673),Du=a.n(qu),Ru=a(674),Mu=a.n(Ru);Us.a.Icon.Default.mergeOptions({iconUrl:Iu.a,iconRetinaUrl:Du.a,shadowUrl:Mu.a}),delete Us.a.Icon.Default.prototype._getIconUrl;var zu={marker:[14,32],circle:[10,10],rectangle:[11,11],"circle-dot":[1,2],"rectangle-dot":[1,2],doughnut:[8,8]},Fu={rectangle:[0,-3],circle:[1,-3]};function Vu(e,t){var a=t.color,r=t.points,n=e.classify,o=e.clusterMarkers,i=e.customizeMarkers,s=o?function(e){return Us.a.markerClusterGroup({iconCreateFunction:t=>Us.a.markerClusterIcon({color:e,html:t.getChildCount()})})}(a):Us.a.featureGroup();return Object(l.each)(r,t=>{var r,o=t.lat,c=t.lon,u=t.row,d=Object(l.clone)(u);d[e.latColName]=o,d[e.lonColName]=c,r=n?((e,t,a)=>Us.a.circleMarker([e,t],{fillColor:a,fillOpacity:.9,stroke:!1}))(o,c,a):i?function(e,t,a){var r=a.iconShape,n=a.iconFont,o=a.foregroundColor,i=a.backgroundColor,l=a.borderColor,s=Us.a.BeautifyIcon.icon({iconShape:r,icon:n,iconSize:"rectangle"===r&&[22,22],iconAnchor:zu[r],popupAnchor:Fu[r],prefix:"fa",textColor:o,backgroundColor:i,borderColor:l});return Us.a.marker([e,t],{icon:s})}(o,c,e):Us.a.marker([o,c]),e.tooltip.enabled&&(""!==e.tooltip.template?r.bindTooltip(ke(zi(e.tooltip.template,d))):r.bindTooltip("\n          <strong>".concat(o,", ").concat(c,"</strong>\n        "))),e.popup.enabled&&(""!==e.popup.template?r.bindPopup(ke(zi(e.popup.template,d))):r.bindPopup('\n          <ul style="list-style-type: none; padding-left: 0">\n            <li><strong>'.concat(o,", ").concat(c,"</strong>\n            ").concat(Object(l.map)(u,(e,t)=>"<li>".concat(t,": ").concat(e,"</li>")).join(""),"\n          </ul>\n        "))),s.addLayer(r)}),s}function Uu(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Bu(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Bu(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Bu(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Hu(e){var t,a,o,i,s=e.data,c=e.options,u=e.onOptionsChange,d=Uu(Object(r.useState)(null),2),m=d[0],p=d[1],f=(t=()=>Object(l.omit)(c,["bounds"]),a=[c],o=Object(r.useRef)(),i=Object(r.useMemo)(t,a),Object(l.isEqual)(i,o.current)||(o.current=i),o.current),g=Object(r.useMemo)(()=>Tu(s,f),[s,f]),b=Uu(Object(r.useState)(null),2),h=b[0],y=b[1];return Object(r.useEffect)(()=>{if(m){var e=function(e){var t=Us.a.map(e,{center:[0,0],zoom:1,scrollWheelZoom:!1,fullscreenControl:!0}),a=Us.a.tileLayer("//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(t),r=Us.a.featureGroup().addTo(t),n=Us.a.control.layers().addTo(t),o=()=>{},i=!1,s=()=>{o(t.getBounds())};t.on("focus",()=>{i=!0,t.on("moveend",s)}),t.on("blur",()=>{t.off("moveend",s),i=!1});var c=Gr(e,()=>{t.invalidateSize(!1)});return{get onBoundsChange(){return o},set onBoundsChange(e){o=Object(l.isFunction)(e)?e:()=>{}},updateLayers:function(e,o){a.setUrl(o.mapTileUrl),r.eachLayer(e=>{r.removeLayer(e),n.removeLayer(e)}),Object(l.each)(e,e=>{var t=Vu(o,e);r.addLayer(t),n.addOverlay(t,e.name)}),e.length>0?n.addTo(t):n.remove()},updateBounds:function(e){i||(e=e?Us.a.latLngBounds([e._southWest.lat,e._southWest.lng],[e._northEast.lat,e._northEast.lng]):r.getBounds()).isValid()&&t.fitBounds(e,{animate:!1,duration:0})},destroy(){c(),t.remove()}}}(m);return y(e),()=>{e.destroy()}}},[m]),Object(r.useEffect)(()=>{h&&h.updateLayers(g,f)},[h,g,f]),Object(r.useEffect)(()=>{h&&h.updateBounds(c.bounds)},[h,c.bounds]),Object(r.useEffect)(()=>{h&&u&&(h.onBoundsChange=e=>{u(Object(l.merge)({},c,{bounds:e}))})},[h,c,u]),n.a.createElement("div",{className:"map-visualization-container",ref:p})}function Yu(e,t){return Object(l.filter)([e,...t],e=>!Object(l.isNil)(e))}function Qu(e){var t=e.options,a=e.data,o=e.onOptionsChange,i=Object(r.useMemo)(()=>Object(l.difference)(Object(l.map)(a.columns,e=>e.name),[t.latColName,t.lonColName,t.classify]),[a,t.latColName,t.lonColName,t.classify]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Fo,{label:window.W_L.Latitude_Column_Name,"data-test":"Map.Editor.LatitudeColumnName",value:t.latColName,onChange:e=>o({latColName:e})},Object(l.map)(Yu(t.latColName,i),e=>n.a.createElement(Fo.Option,{key:e,"data-test":"Map.Editor.LatitudeColumnName."+e},e)))),n.a.createElement(So,null,n.a.createElement(Fo,{label:window.W_L.Longitude_Column_Name,"data-test":"Map.Editor.LongitudeColumnName",value:t.lonColName,onChange:e=>o({lonColName:e})},Object(l.map)(Yu(t.lonColName,i),e=>n.a.createElement(Fo.Option,{key:e,"data-test":"Map.Editor.LongitudeColumnName."+e},e)))),n.a.createElement(So,null,n.a.createElement(Fo,{label:window.W_L.group_by,"data-test":"Map.Editor.GroupBy",allowClear:!0,placeholder:"none",value:t.classify||void 0,onChange:e=>o({classify:e||null})},Object(l.map)(Yu(t.classify,i),e=>n.a.createElement(Fo.Option,{key:e,"data-test":"Map.Editor.GroupBy."+e},e)))))}function Ku(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function $u(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Gu(e){var t=e.options,a=e.data,o=e.onOptionsChange,i=Object(r.useMemo)(()=>Object(l.map)(Tu(a,t),e=>{var a=e.name;return{name:a,color:(t.groups[a]||{}).color||null}}),[a,t]),s=Object(r.useMemo)(()=>function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ku(Object(a),!0).forEach((function(t){$u(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ku(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({Automatic:null},Oi),[]),c=Object(r.useCallback)((e,t,a)=>{o({groups:{[e]:{[t]:a}}})},[o]),u=[{title:"Group",dataIndex:"name"},{title:"Color",dataIndex:"color",width:"1%",render:(e,t)=>n.a.createElement(Yn,{interactive:!0,presetColors:s,placement:"topRight",color:t.color,triggerProps:{"data-test":"Map.Editor.Groups.".concat(t.name,".Color")},onChange:e=>c(t.name,"color",e),addonAfter:n.a.createElement(Yn.Label,{color:t.color,presetColors:s})})}];return n.a.createElement(Zl.a,{columns:u,dataSource:i,rowKey:"name",showHeader:!1,pagination:!1})}function Ju(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Xu(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Xu(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xu(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Zu(){return n.a.createElement(zo,{placement:"topLeft",arrowPointAtCenter:!0},n.a.createElement("div",{style:{paddingBottom:5}},window.W_L.Also_all_query_result_columns_can_be_referenced," ",n.a.createElement("code",null,"{{ column_name }}")," syntax."),n.a.createElement("div",{style:{paddingBottom:5}},window.W_L.Leave_empty_to_use_default_value))}function ed(e){var t=e.options,a=e.onOptionsChange,r=Ju(Object(Ul.a)(a,200),1)[0],o=n.a.createElement(Zu,null);return n.a.createElement("div",{className:"map-visualization-editor-format-settings"},n.a.createElement(So,null,n.a.createElement(gn.a,{"data-test":"Map.Editor.TooltipEnabled",checked:t.tooltip.enabled,onChange:e=>a({tooltip:{enabled:e.target.checked}})},window.W_L.Show_tooltip)),n.a.createElement(So,null,n.a.createElement(Vo,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Tooltip_template," ",o),"data-test":"Map.Editor.TooltipTemplate",disabled:!t.tooltip.enabled,placeholder:window.W_L.default_template,defaultValue:t.tooltip.template,onChange:e=>r({tooltip:{template:e.target.value}})})),n.a.createElement(So,null,n.a.createElement(gn.a,{"data-test":"Map.Editor.PopupEnabled",checked:t.popup.enabled,onChange:e=>a({popup:{enabled:e.target.checked}})},window.W_L.Show_popup)),n.a.createElement(So,null,n.a.createElement(To,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Popup_template," ",o),"data-test":"Map.Editor.PopupTemplate",disabled:!t.popup.enabled,rows:4,placeholder:window.W_L.default_template,defaultValue:t.popup.template,onChange:e=>r({popup:{template:e.target.value}})})))}function td(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ad(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ad(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ad(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function rd(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function nd(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Us.a.MarkerClusterIcon=Us.a.DivIcon.extend({options:{color:null,className:"marker-cluster",iconSize:new Us.a.Point(40,40)},createIcon(){for(var e=On()(this.options.color),t=_n(e),a=e.alpha(.4).css(),r=e.alpha(.8).css(),n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];var s=Us.a.DivIcon.prototype.createIcon.call(this,...o);return s.innerHTML='\n      <div style="background: '.concat(r,'">\n        <span style="color: ').concat(t,'">').concat(Object(l.toString)(this.options.html),"</span>\n      </div>\n    "),s.style.background=a,s}}),Us.a.markerClusterIcon=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return new Us.a.MarkerClusterIcon(...t)},Hu.propTypes=en,Qu.propTypes=tn,Gu.propTypes=tn,ed.propTypes=tn;var od=[{name:"OpenStreetMap",url:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"},{name:"OpenStreetMap BW",url:"//{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png"},{name:"OpenStreetMap DE",url:"//{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png"},{name:"OpenStreetMap FR",url:"//{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png"},{name:"OpenStreetMap Hot",url:"//{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png"},{name:"Thunderforest",url:"//{s}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png"},{name:"Thunderforest Spinal",url:"//{s}.tile.thunderforest.com/spinal-map/{z}/{x}/{y}.png"},{name:"OpenMapSurfer",url:"//korona.geog.uni-heidelberg.de/tiles/roads/x={x}&y={y}&z={z}"},{name:"Stamen Toner",url:"//stamen-tiles-{s}.a.ssl.fastly.net/toner/{z}/{x}/{y}.png"},{name:"Stamen Toner Background",url:"//stamen-tiles-{s}.a.ssl.fastly.net/toner-background/{z}/{x}/{y}.png"},{name:"Stamen Toner Lite",url:"//stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png"},{name:"OpenTopoMap",url:"//{s}.tile.opentopomap.org/{z}/{x}/{y}.png"}],id=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?rd(Object(a),!0).forEach((function(t){nd(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):rd(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({White:"#ffffff"},Oi);function ld(e){var t=e.options,a=e.onOptionsChange,o=td(Object(Ul.a)(a,200),1)[0],i=Object(r.useMemo)(()=>function(e){switch(e){case"doughnut":return{showIcon:!1,showBackgroundColor:!0,showBorderColor:!0};case"circle-dot":case"rectangle-dot":return{showIcon:!1,showBackgroundColor:!1,showBorderColor:!0};default:return{showIcon:!0,showBackgroundColor:!0,showBorderColor:!0}}}(t.iconShape),[t.iconShape]),s=i.showIcon,c=i.showBackgroundColor,u=i.showBorderColor,d=Object(l.isNil)(t.classify);return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Fo,{label:window.W_L.Map_Tiles,"data-test":"Map.Editor.Tiles",value:t.mapTileUrl,onChange:e=>a({mapTileUrl:e})},Object(l.map)(od,e=>{var t=e.name,a=e.url;return n.a.createElement(Fo.Option,{key:a,"data-test":"Map.Editor.Tiles."+t},t)}))),n.a.createElement(So.Title,null,window.W_L.Markers),n.a.createElement(So,null,n.a.createElement(gn.a,{"data-test":"Map.Editor.ClusterMarkers",defaultChecked:t.clusterMarkers,onChange:e=>a({clusterMarkers:e.target.checked})},window.W_L.Cluster_Markers)),n.a.createElement(So,null,n.a.createElement(gn.a,{"data-test":"Map.Editor.CustomizeMarkers",disabled:!d,defaultChecked:t.customizeMarkers,onChange:e=>a({customizeMarkers:e.target.checked})},window.W_L.Override_default_style),!d&&n.a.createElement(zo,{placement:"topLeft",arrowPointAtCenter:!0},"Custom marker styles are not available",n.a.createElement("br",null),"when ",n.a.createElement("b",null,"Group By")," column selected.")),d&&t.customizeMarkers&&n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Fo,{layout:"horizontal",label:window.W_L.Shape,"data-test":"Map.Editor.MarkerShape",value:t.iconShape,onChange:e=>a({iconShape:e})},n.a.createElement(Fo.Option,{key:"marker","data-test":"Map.Editor.MarkerShape.marker"},window.W_L.Markers," + ",window.W_L.icon),n.a.createElement(Fo.Option,{key:"doughnut","data-test":"Map.Editor.MarkerShape.doughnut"},window.W_L.Circle),n.a.createElement(Fo.Option,{key:"circle-dot","data-test":"Map.Editor.MarkerShape.circle-dot"},window.W_L.Circle_Dot),n.a.createElement(Fo.Option,{key:"circle","data-test":"Map.Editor.MarkerShape.circle"},window.W_L.Circle," + ",window.W_L.icon),n.a.createElement(Fo.Option,{key:"rectangle-dot","data-test":"Map.Editor.MarkerShape.rectangle-dot"},window.W_L.Square_Dot),n.a.createElement(Fo.Option,{key:"rectangle","data-test":"Map.Editor.MarkerShape.rectangle"},window.W_L.Square," + ",window.W_L.icon))),s&&n.a.createElement(So,null,n.a.createElement(Vo,{layout:"horizontal",label:n.a.createElement(n.a.Fragment,null,window.W_L.icon,n.a.createElement(zo,{placement:"topLeft",arrowPointAtCenter:!0},n.a.createElement("div",{style:{marginBottom:5}},window.W_L.Enter_an_icon_name_from," ",n.a.createElement("a",{href:"https://fontawesome.com/v4.7.0/icons/",target:"_blank",rel:"noopener noreferrer"},"Font-Awesome 4.7")),n.a.createElement("div",{style:{marginBottom:5}},window.W_L.Examples,"：",n.a.createElement("code",null,"check"),", ",n.a.createElement("code",null,"times-circle"),", ",n.a.createElement("code",null,"flag")),n.a.createElement("div",null,window.W_L.Leave_blank_to_remove))),"data-test":"Map.Editor.MarkerIcon",defaultValue:t.iconFont,onChange:e=>o({iconFont:e.target.value})})),s&&n.a.createElement(So,null,n.a.createElement(Bo,{layout:"horizontal",label:window.W_L.Icon_Color,interactive:!0,presetColors:id,placement:"topRight",color:t.foregroundColor,triggerProps:{"data-test":"Map.Editor.MarkerIconColor"},onChange:e=>a({foregroundColor:e}),addonAfter:n.a.createElement(Bo.Label,{color:t.foregroundColor,presetColors:id})})),c&&n.a.createElement(So,null,n.a.createElement(Bo,{layout:"horizontal",label:window.W_L.Background_Color,interactive:!0,presetColors:id,placement:"topRight",color:t.backgroundColor,triggerProps:{"data-test":"Map.Editor.MarkerBackgroundColor"},onChange:e=>a({backgroundColor:e}),addonAfter:n.a.createElement(Bo.Label,{color:t.backgroundColor,presetColors:id})})),u&&n.a.createElement(So,null,n.a.createElement(Bo,{layout:"horizontal",label:window.W_L.Borders_Color,interactive:!0,presetColors:id,placement:"topRight",color:t.borderColor,triggerProps:{"data-test":"Map.Editor.MarkerBorderColor"},onChange:e=>a({borderColor:e}),addonAfter:n.a.createElement(Bo.Label,{color:t.borderColor,presetColors:id})}))))}ld.propTypes=tn;var sd={type:"MAP",name:"地理标记(Map Markers)",getOptions:function(e){return(e=Object(l.merge)({},Au,e)).mapTileUrl=e.mapTileUrl||Au.mapTileUrl,"none"===e.classify&&(e.classify=null),e},Renderer:Hu,Editor:Oo([{key:"General",title:window.W_L.general,component:Qu},{key:"Groups",title:window.W_L.role,component:Gu},{key:"Format",title:window.W_L.formatting,component:ed},{key:"Style",title:window.W_L.style,component:ld}]),defaultColumns:3,defaultRows:8,minColumns:2},cd=a(675),ud=a.n(cd);function dd(e){if(!e)return"";var t=Fa()(e);return t.isValid()?t.format(Do.dateTimeFormat):"-"}function md(e){if(!e)return"";var t=Fa()(e);return t.isValid()?t.format(Do.dateFormat):"-"}a(1293),a(1294);function pd(){return(pd=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function fd(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function gd(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?fd(Object(a),!0).forEach((function(t){bd(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):fd(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function bd(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function hd(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return yd(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return yd(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yd(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var vd=["rows","cols","vals","aggregatorName","valueFilter","sorters","rowOrder","colOrder","derivedAttributes","rendererName","hiddenAttributes","hiddenFromAggregators","hiddenFromDragDrop","menuLimit","unusedOrientationCutoff","controls","rendererOptions"];function wd(e){var t=e.rows,a=e.columns;return Object(l.map)(t,e=>Object(l.mapValues)(e,(e,t)=>function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Fa.a.isMoment(e)?"date"===t?md(e):dd(e):"boolean"==typeof e?e.toString():e}(e,Object(l.find)(a,{name:t}).type)))}function Od(e){var t=e.data,a=e.options,o=e.onOptionsChange,i=hd(Object(r.useState)(gd({},a)),2),s=i[0],c=i[1],u=Object(r.useMemo)(()=>wd(t),[t]);Object(r.useEffect)(()=>{c(gd({},a))},[a]);var d=Object(l.get)(a,"controls.enabled"),m=!Object(l.get)(a,"rendererOptions.table.rowTotals"),p=!Object(l.get)(a,"rendererOptions.table.colTotals");return n.a.createElement("div",{className:"pivot-table-visualization-container","data-hide-controls":d||null,"data-hide-row-totals":m||null,"data-hide-column-totals":p||null,"data-test":"PivotTableVisualization"},n.a.createElement(ud.a,pd({},Object(l.pick)(s,vd),{data:u,onChange:e=>{var t=Object(l.pick)(e,vd);c(gd({},t)),o(t)}})))}function _d(e){var t=e.options,a=e.onOptionsChange,r=e=>{a(Object(l.merge)({},t,e))};return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(ko,{"data-test":"PivotEditor.HideControls",id:"pivot-show-controls",defaultChecked:!t.controls.enabled,onChange:e=>r({controls:{enabled:!e}})},window.W_L.Show_Pivot_Controls)),n.a.createElement(So,null,n.a.createElement(ko,{id:"pivot-show-row-totals",defaultChecked:t.rendererOptions.table.rowTotals,onChange:e=>r({rendererOptions:{table:{rowTotals:e}}})},window.W_L.Show_Row_Totals)),n.a.createElement(So,null,n.a.createElement(ko,{id:"pivot-show-column-totals",defaultChecked:t.rendererOptions.table.colTotals,onChange:e=>r({rendererOptions:{table:{colTotals:e}}})},window.W_L.Show_Column_Totals)))}Od.propTypes=en,Od.defaultProps={onOptionsChange:()=>{}},_d.propTypes=tn;var Ed={controls:{enabled:!1},rendererOptions:{table:{colTotals:!0,rowTotals:!0}}},jd={type:"PIVOT",name:"数据透视表(Pivot Table)",getOptions:e=>Object(l.merge)({},Ed,e),Renderer:Od,Editor:_d,defaultRows:10,defaultColumns:3,minColumns:2};function Sd(e){return e.y+e.dy/2}function Cd(e){return e.value}var xd=function(){var e={},t=24,a=8,r=[1,1],n=[],o=[];function i(){var e,a,o=n,i=0;function l(a){a.x=i,a.dx=t,a.sourceLinks.forEach(t=>{e.indexOf(t.target)<0&&e.push(t.target)})}for(;o.length;)e=[],o.forEach(l),o=e,i+=1;!function(e){n.forEach(t=>{t.sourceLinks.length||(t.x=e-1)})}(i),i=Math.max(Qr.a.max(n,e=>e.x),2),a=(r[0]-t)/(i-1),n.forEach(e=>{e.x*=a})}function l(){function e(e,t){return e.source.y-t.source.y}function t(e,t){return e.target.y-t.target.y}n.forEach(a=>{a.sourceLinks.sort(t),a.targetLinks.sort(e)}),n.forEach(e=>{var t=0,a=0;e.sourceLinks.forEach(e=>{e.sy=t,t+=e.dy}),e.targetLinks.forEach(e=>{e.ty=a,a+=e.dy})})}return e.nodeWidth=function(a){return arguments.length?(t=+a,e):t},e.nodePadding=function(t){return arguments.length?(a=+t,e):a},e.nodes=function(t){return arguments.length?(n=t,e):n},e.links=function(t){return arguments.length?(o=t,e):o},e.size=function(t){return arguments.length?(r=t,e):r},e.layout=function(t){return n.forEach(e=>{e.sourceLinks=[],e.targetLinks=[]}),o.forEach(e=>{var t=e.source,a=e.target;"number"==typeof t&&(t=e.source=n[e.source]),"number"==typeof a&&(a=e.target=n[e.target]),t.sourceLinks.push(e),a.targetLinks.push(e)}),n.forEach(e=>{e.value=Math.max(Qr.a.sum(e.sourceLinks,Cd),Qr.a.sum(e.targetLinks,Cd))}),i(),function(e){var t,i=Qr.a.nest().key(e=>e.x).sortKeys(Qr.a.ascending).entries(n).map(e=>e.values);function l(e){function t(e){return Sd(e.source)*e.value}i.forEach(a=>{a.forEach(a=>{if(a.targetLinks.length){var r=Qr.a.sum(a.targetLinks,t)/Qr.a.sum(a.targetLinks,Cd);a.y+=(r-Sd(a))*e}})})}function s(){i.forEach(e=>{var t,n,o,i=e.length,l=0;for(e.sort(d),o=0;o<i;++o)(n=l-(t=e[o]).y)>0&&(t.y+=n),l=t.y+t.dy+a;if((n=l-a-r[1])>0)for(l=t.y-=n,o=i-2;o>=0;--o)(n=(t=e[o]).y+t.dy+a-l)>0&&(t.y-=n),l=t.y})}t=Qr.a.min(i,e=>(r[1]-(e.length-1)*a)/Qr.a.sum(e,Cd)),i.forEach(e=>{e.forEach((e,a)=>{e.y=a,e.dy=e.value*t})}),o.forEach(e=>{e.dy=e.value*t}),s();for(var c=1;e>0;e-=1)u(c*=.99),s(),l(c),s();function u(e){function t(e){return Sd(e.target)*e.value}i.slice().reverse().forEach(a=>{a.forEach(a=>{if(a.sourceLinks.length){var r=Qr.a.sum(a.sourceLinks,t)/Qr.a.sum(a.sourceLinks,Cd);a.y+=(r-Sd(a))*e}})})}function d(e,t){return e.y-t.y}}(t),l(),e},e.relayout=function(){return l(),e},e.link=function(){var e=.5;function t(t){var a=t.source.x+t.source.dx,r=t.target.x,n=Qr.a.interpolateNumber(a,r),o=n(e),i=n(1-e),l=t.source.y+t.sy+t.dy/2,s=t.target.y+t.ty+t.dy/2;return"M".concat(a,",").concat(l,"C").concat(o,",").concat(l," ").concat(i,",").concat(s," ").concat(r,",").concat(s)}return t.curvature=a=>arguments.length?(e=+a,t):e,t},e};function Pd(e){var t={},a={},r=[],n=Object(l.sortBy)(Object(l.filter)(Object(l.keys)(e[0]),e=>"value"!==e),l.identity);function o(e,a){e=function(e){return Object(l.isNil)(e)?"Exit":""+e}(e);var n="".concat(e,":").concat(String(a)),o=t[n];return o||((o={name:e}).id=r.push(o)-1,t[n]=o),o}function i(e,t,r,n){if(""!==e&&e||!(n>1)){var i=o(e,n),l=o(t,n+1);(function(e,t){var r=a[[e,t]];return r||(r={target:t,source:e,value:0},a[[e,t]]=r),r}(i.id,l.id)).value+=parseInt(r,10)}}e.forEach(e=>{i(e[n[0]],e[n[1]],e.value||0,1),i(e[n[1]],e[n[2]],e.value||0,2),i(e[n[2]],e[n[3]],e.value||0,3),i(e[n[3]],e[n[4]],e.value||0,4),i(e[n[4]],null,e.value||0,5)});var s=Qr.a.scale.category20();return{nodes:Object(l.map)(r,e=>Object(l.extend)(e,{color:s(e.name.replace(/ .*/,""))})),links:Object(l.values)(a)}}function Ld(e){var t;if(e.rows=(t=e.rows,Object(l.map)(t,e=>Object(l.mapValues)(e,e=>!e||Object(l.isNumber)(e)||Object(l.isNaN)(parseFloat(e))?e:parseFloat(e)))),!function(e){return!(!e||!Object(l.find)(e.columns,e=>"value"===e.name))&&Object(l.every)(e.rows,e=>Object(l.every)(e,e=>!(e&&!Object(l.isString)(e))||isFinite(e)))}(e))return e=>{Qr.a.select(e).selectAll("*").remove()};e=Pd(e.rows);var a=e=>Qr.a.format(",.0f")(e);return t=>{Qr.a.select(t).selectAll("*").remove();var r=10,n=10,o=10,i=10,s=t.offsetWidth-i-n,c=t.offsetHeight-r-o;if(!(s<=0||c<=0)){var u=Qr.a.select(t).append("svg").attr("class","sankey").attr("width",s+i+n).attr("height",c+r+o).append("g").attr("transform","translate(".concat(i,",").concat(r,")")),d=xd().nodeWidth(15).nodePadding(10).size([s,c]),m=d.link();d.nodes(e.nodes).links(e.links).layout(0),function(e,t){Qr.a.nest().key(e=>e.x).entries(t.nodes).map(e=>e.values).forEach(t=>{t=Object(l.filter)(Object(l.sortBy)(t,e=>-e.value),e=>"Exit"!==e.name);var a=Qr.a.sum(t,e=>e.dy),r=(e-a)/t.length;Object(l.reduce)(t,(e,t)=>(t.y=e,e+t.dy+r),0)})}(c,e),d.relayout();var p=u.append("g").selectAll(".link").data(e.links).enter().append("path").filter(e=>"Exit"!==e.target.name).attr("class","link").attr("d",m).style("stroke-width",e=>Math.max(1,e.dy)).sort((e,t)=>t.dy-e.dy);p.append("title").text(e=>"".concat(e.source.name," → ").concat(e.target.name,"\n").concat(a(e.value)));var f=u.append("g").selectAll(".node").data(e.nodes).enter().append("g").filter(e=>"Exit"!==e.name).attr("class","node").attr("transform",e=>"translate(".concat(e.x,",").concat(e.y,")"));f.on("mouseover",(function(e){var t=function(e){console.log(e);var t=[];return e.sourceLinks.forEach(e=>{t.push(e.target)}),e.targetLinks.forEach(e=>{t.push(e.source)}),t}(e);t=Object(l.map)(t,e=>e.id),f.filter(a=>a!==e&&!Object(l.includes)(t,a.id)).style("opacity",.2),p.filter(t=>!(Object(l.includes)(e.sourceLinks,t)||Object(l.includes)(e.targetLinks,t))).style("opacity",.2)})).on("mouseout",(function(){f.style("opacity",1),p.style("opacity",1)})),f.append("rect").attr("height",e=>e.dy).attr("width",d.nodeWidth()).style("fill",e=>e.color).style("stroke",e=>Qr.a.rgb(e.color).darker(2)).append("title").text(e=>"".concat(e.name,"\n").concat(a(e.value))),f.append("text").attr("x",-6).attr("y",e=>e.dy/2).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).text(e=>e.name).filter(e=>e.x<s/2).attr("x",6+d.nodeWidth()).attr("text-anchor","start")}}}a(1295);function kd(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Nd(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Nd(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Nd(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Ad(e){var t=e.data,a=kd(Object(r.useState)(null),2),o=a[0],i=a[1],l=Object(r.useMemo)(()=>Ld(t),[t]);return Object(r.useEffect)(()=>{if(o)return l(o),Gr(o,()=>{l(o)})},[o,l]),n.a.createElement("div",{className:"sankey-visualization-container",ref:i})}function Td(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Wd(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Ad.propTypes=en;var Id={type:"SANKEY",name:"桑基图(Sankey)",getOptions:e=>function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Td(Object(a),!0).forEach((function(t){Wd(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Td(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e),Renderer:Ad,Editor:function(){return n.a.createElement(n.a.Fragment,null,n.a.createElement("p",null,window.W_L.This_visualization_expects_the_query_result_to_have_rows_in_one_of_the_following_formats,"："),n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement("strong",null,"stage1")," - ",window.W_L.stage_1_value),n.a.createElement("li",null,n.a.createElement("strong",null,"stage2")," - ",window.W_L.stage_2_value_or_null),n.a.createElement("li",null,n.a.createElement("strong",null,"stage3")," - ",window.W_L.stage_3_value_or_null),n.a.createElement("li",null,n.a.createElement("strong",null,"stage4")," - ",window.W_L.stage_4_value_or_null),n.a.createElement("li",null,n.a.createElement("strong",null,"stage5")," - ",window.W_L.stage_5_value_or_null),n.a.createElement("li",null,n.a.createElement("strong",null,"value")," -",window.W_L.number_of_times_this_sequence_occurred)))},defaultRows:7},qd=Yr.scale.category10();function Dd(e){return qd(e.name)}function Rd(e){e=function(e){var t=Object(l.first)(e);return Object(l.every)(["sequence","stage","node","value"],e=>Object(l.has)(t,e))}(e)?function(e){var t=Object(l.groupBy)(e,"sequence");return Object(l.map)(t,e=>{var t=Object(l.sortBy)(e,"stage");return{size:e[0].value||0,sequence:e[0].sequence,nodes:Object(l.map)(t,e=>e.node)}})}(e):function(e){var t=Object(l.sortBy)(Object(l.filter)(Object(l.keys)(e[0]),e=>"value"!==e),l.identity);return Object(l.map)(e,(e,a)=>({size:e.value||0,sequence:a,nodes:Object(l.compact)(Object(l.map)(t,t=>e[t]))}))}(e);var t={name:"root",children:[]};return e.forEach(e=>{for(var a=e.nodes,r=parseInt(e.size,10),n=t,o=function(e){var t=n.children,o=a[e],i=e+1===a.length;t||(n.children=t=[],t.push({name:"<<<Exit>>>",size:n.size}));var s=Object(l.find)(t,e=>e.name===o);i&&s?(s.children=s.children||[],s.children.push({name:"<<<Exit>>>",size:r})):i?t.push({name:o,size:r}):(s||(s={name:o,children:[]},t.push(s)),n=s)},i=0;i<a.length;i+=1)o(i)}),t}function Md(e){return function(e){return e&&e.rows.length>0}(e)?(e=Rd(e.rows),t=>{Yr.select(t).selectAll("*").remove();var a=t.clientWidth,r=t.offsetHeight,n={w:a/6,h:30,s:3,t:10},o=Math.min(a-n.h,r-n.h)/2-5;if(!(o<=0)){var i,l={top:o,bottom:50,left:o,right:0},s=0,c=Yr.layout.partition().size([2*Math.PI,o*o]).value(e=>e.size),u=Yr.svg.arc().startAngle(e=>e.x).endAngle(e=>e.x+e.dx).innerRadius(e=>Math.sqrt(e.y)).outerRadius(e=>Math.sqrt(e.y+e.dy)),d=Yr.select(t),m=d.append("div").classed("breadcrumbs-container",!0).append("svg").attr("width",a).attr("height",n.h).attr("fill","white").attr("font-weight",600),p=d.append("div"),f=p.append("div").classed("summary-container",!0),g=p.append("div").classed("sunburst-container",!0).append("svg").attr("width",2*o).attr("height",2*o).append("g").attr("transform","translate(".concat(l.left,",").concat(l.top,")")),b=m.append("text").classed("lastCrumb",!0),h=c.nodes(e).filter(e=>e.dx>.005&&"<<<Exit>>>"!==e.name),y=(i=[],h.forEach(e=>{-1===i.indexOf(e.name)&&i.push(e.name)}),i);qd.domain(y);var v=g.data([e]).selectAll("path").data(h).enter().append("path").classed("nodePath",!0).attr("display",e=>e.depth?null:"none").attr("d",u).attr("fill",Dd).attr("opacity",1).attr("stroke","white").on("mouseover",O);d.on("click",(function(){g.selectAll("path").on("mouseover",null),g.selectAll("path").transition().duration(1e3).attr("opacity",1).each("end",(function(){Yr.select(this).on("mouseover",O)})),m.style("visibility","hidden"),f.style("visibility","hidden")})),s=v.node().__data__.value}function w(e,t){var a=[];return a.push("0,0"),a.push("".concat(n.w,",0")),a.push("".concat(n.w+n.t,",").concat(n.h/2)),a.push("".concat(n.w,",").concat(n.h)),a.push("0,".concat(n.h)),t>0&&a.push("".concat(n.t,",").concat(n.h/2)),a.join(" ")}function O(e){var t=(100*e.value/s).toPrecision(3),a="".concat(t,"%");t<1&&(a="< 1.0%");var r=function(e){for(var t=[],a=e;a.parent;)t.unshift(a),a=a.parent;return t}(e);!function(e,t){var a=m.selectAll("g").data(e,e=>e.name+e.depth),r=a.enter().append("g");r.append("polygon").classed("breadcrumbs-shape",!0).attr("points",w).attr("fill",Dd),r.append("text").classed("breadcrumbs-text",!0).attr("x",(n.w+n.t)/2).attr("y",n.h/2).attr("dy","0.35em").attr("font-size","10px").attr("text-anchor","middle").text(e=>e.name),a.attr("transform",(e,t)=>"translate(".concat(t*(n.w+n.s),", 0)")),a.exit().remove(),b.attr("x",(e.length+.5)*(n.w+n.s)).attr("y",n.h/2).attr("dy","0.35em").attr("text-anchor","middle").attr("fill","black").attr("font-weight",600).text(t)}(r,a),g.selectAll("path").attr("opacity",.3),g.selectAll("path").filter(e=>r.indexOf(e)>=0).attr("opacity",1),f.html("\n      <span>层级:".concat(e.depth,"</span>\n      <span class='percentage' style='font-size: 2em;'>").concat(a,"</span>\n      <span>").concat(e.value," / ").concat(s,"</span>\n    ")),f.style("visibility",""),m.style("visibility","")}}):e=>{Yr.select(e).selectAll("*").remove()}}a(1296);function zd(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Fd(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Fd(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fd(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Vd(e){var t=e.data,a=zd(Object(r.useState)(null),2),o=a[0],i=a[1],l=Object(r.useMemo)(()=>Md(t),[t]);return Object(r.useEffect)(()=>{if(o)return l(o),Gr(o,()=>{l(o)})},[o,l]),n.a.createElement("div",{className:"sunburst-visualization-container",ref:i})}function Ud(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Bd(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Vd.propTypes=en;var Hd={type:"SUNBURST_SEQUENCE",name:"旭辉图(Sunburst Sequence)",getOptions:e=>function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ud(Object(a),!0).forEach((function(t){Bd(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ud(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e),Renderer:Vd,Editor:function(){return n.a.createElement(n.a.Fragment,null,n.a.createElement("p",null,window.W_L.This_visualization_expects_the_query_result_to_have_rows_in_one_of_the_following_formats,"："),n.a.createElement(So,null,n.a.createElement("p",null,n.a.createElement("strong",null,window.W_L.Option,"1：")),n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement("strong",null,"sequence")," - ",window.W_L.sequence_id),n.a.createElement("li",null,n.a.createElement("strong",null,"stage")," - ",window.W_L.what_stage_in_sequence_this_is_1_2),n.a.createElement("li",null,n.a.createElement("strong",null,"node")," - ",window.W_L.stage_name),n.a.createElement("li",null,n.a.createElement("strong",null,"value")," - ",window.W_L.number_of_times_this_sequence_occurred))),n.a.createElement(So,null,n.a.createElement("p",null,n.a.createElement("strong",null,window.W_L.Option,"2：")),n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement("strong",null,"stage1")," - ",window.W_L.stage_1_value),n.a.createElement("li",null,n.a.createElement("strong",null,"stage2")," - ",window.W_L.stage_2_value_or_null),n.a.createElement("li",null,n.a.createElement("strong",null,"stage3")," - ",window.W_L.stage_3_value_or_null),n.a.createElement("li",null,n.a.createElement("strong",null,"stage4")," - ",window.W_L.stage_4_value_or_null),n.a.createElement("li",null,n.a.createElement("strong",null,"stage5")," - ",window.W_L.stage_5_value_or_null),n.a.createElement("li",null,n.a.createElement("strong",null,"value")," - ",window.W_L.number_of_times_this_sequence_occurred))))},defaultRows:7};function Yd(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Qd(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Yd(Object(a),!0).forEach((function(t){Kd(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Yd(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Kd(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var $d={itemsPerPage:25,paginationSize:"default"},Gd=["filter","multi-filter","multiFilter"];function Jd(e){var t;if(-1!==e.indexOf("::"))t="::";else{if(-1===e.indexOf("__"))return e;t="__"}var a=e.split(t);return""===a[0]&&2===a.length?a[1]:s.a.includes(Gd,a[1])?a[0]:e}function Xd(e,t){var a=function(e){var t={integer:"number",float:"number",boolean:"boolean",date:"datetime",datetime:"datetime"};return s.a.map(e,(e,a)=>{return{name:e.name,type:e.type,displayAs:t[e.type]||"string",visible:!0,order:1e5+a,title:Jd(e.name),allowSearch:!1,alignContent:(r=e.type,["integer","float","boolean","date","datetime"].indexOf(r)>=0?"right":"left"),allowHTML:!0,highlightLinks:!1};var r})}(e);return t=function(e,t){e=s.a.map(e,e=>e.name),t=s.a.map(t,e=>e.name),t=s.a.filter(t,t=>s.a.includes(e,t)),e=s.a.filter(e,e=>s.a.includes(t,e));for(var a=0;a<e.length;a+=1)if(t[a]!==e[a])return!0;return!1}(e,t)?s.a.fromPairs(s.a.map(t,(e,t)=>[e.name,s.a.extend({},e,{order:t})])):s.a.fromPairs(s.a.map(t,e=>[e.name,s.a.omit(e,"order")])),s.a.each(a,e=>s.a.extend(e,t[e.name])),s.a.sortBy(a,"order")}var Zd=a(305),em=a.n(Zd);function tm(e){var t=e.allowHTML&&e.highlightLinks?e=>{if(Object(l.isString)(e)){var t=Do.LinkComponent;e=e.replace(qi,(e,a,r)=>a+Ti.a.renderToStaticMarkup(n.a.createElement(t,{href:r,target:"_blank",rel:"noopener noreferrer"},r)))}return Object(l.toString)(e)}:e=>Object(l.toString)(e);function a(a){return{text:t(a[e.name])}}function r(t){var r=a(t.row).text;return e.allowHTML?n.a.createElement(We,null,r):r}return r.prepareData=a,r}function am(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return rm(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return rm(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rm(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function nm(e){var t=Mi(e.numberFormat);function a(a){return{text:t(a[e.name])}}function r(e){return a(e.row).text}return r.prepareData=a,r}function om(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return im(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return im(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function im(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function lm(e){var t=Ri(e.dateTimeFormat);function a(a){return{text:t(a[e.name])}}function r(e){return a(e.row).text}return r.prepareData=a,r}function sm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return cm(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return cm(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cm(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function um(e){var t=function(e){if(Object(l.isArray)(e)){if(e.length>=2)return t=>Object(l.isNil)(t)?"":""+e[t?1:0];if(1===e.length)return t=>t?e[0]:""}return e=>Object(l.isNil)(e)?"":e?"true":"false"}(e.booleanValues);function a(a){return{text:t(a[e.name])}}function r(e){return a(e.row).text}return r.prepareData=a,r}function dm(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function mm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return pm(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return pm(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pm(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function fm(e){function t(t){t=Object(l.extend)({"@":t[e.name]},t);var a=Object(l.trim)(zi(e.linkUrlTemplate,t));if(""===a)return{};var r=Object(l.trim)(zi(e.linkTitleTemplate,t)),n=Object(l.trim)(zi(e.linkTextTemplate,t)),o={href:a,text:""!==n?n:a};return""!==r&&(o.title=r),e.linkOpenInNewTab&&(o.target="_blank"),o}function a(e){var a=t(e.row),r=a.text,o=dm(a,["text"]);return n.a.createElement("a",o,r)}return a.prepareData=t,a}function gm(){return(gm=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function bm(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function hm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ym(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ym(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ym(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function vm(e){function t(t){t=Object(l.extend)({"@":t[e.name]},t);var a=Object(l.trim)(zi(e.imageUrlTemplate,t));if(""===a)return{};var r=parseInt(zi(e.imageWidth,t),10),n=parseInt(zi(e.imageHeight,t),10),o=Object(l.trim)(zi(e.imageTitleTemplate,t)),i={src:a};return Number.isFinite(r)&&r>0&&(i.width=r),Number.isFinite(n)&&n>0&&(i.height=n),""!==o&&(i.text=o,i.title=o,i.alt=o),i}function a(e){var a=t(e.row),r=(a.text,bm(a,["text"]));return n.a.createElement("img",gm({alt:""},r))}return a.prepareData=t,a}tm.friendlyName=window.W_L.text,tm.Editor=function(e){var t=e.column,a=e.onChange;return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(gn.a,{"data-test":"Table.ColumnEditor.Text.AllowHTML",checked:t.allowHTML,onChange:e=>a({allowHTML:e.target.checked})},window.W_L.Allow_HTML_content)),t.allowHTML&&n.a.createElement(So,null,n.a.createElement(gn.a,{"data-test":"Table.ColumnEditor.Text.HighlightLinks",checked:t.highlightLinks,onChange:e=>a({highlightLinks:e.target.checked})},window.W_L.Highlight_links)))},nm.friendlyName=window.W_L.number,nm.Editor=function(e){var t=e.column,a=e.onChange,r=am(Object(Ul.a)(a,200),1)[0];return n.a.createElement(So,null,n.a.createElement(Vo,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Number_format,n.a.createElement(zo.NumberFormatSpecs,null)),"data-test":"Table.ColumnEditor.Number.Format",defaultValue:t.numberFormat,onChange:e=>r({numberFormat:e.target.value})}))},lm.friendlyName=window.W_L.datetime,lm.Editor=function(e){var t=e.column,a=e.onChange,r=om(Object(Ul.a)(a,200),1)[0];return n.a.createElement(So,null,n.a.createElement(Vo,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Date_Time_format,n.a.createElement(zo.DateTimeFormatSpecs,null)),"data-test":"Table.ColumnEditor.DateTime.Format",defaultValue:t.dateTimeFormat,onChange:e=>r({dateTimeFormat:e.target.value})}))},um.friendlyName=window.W_L.Boolean,um.Editor=function(e){var t=e.column,a=e.onChange,r=sm(Object(Ul.a)((function(e,r){var n=[...t.booleanValues];n.splice(e,1,r),a({booleanValues:n})}),200),1)[0];return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Vo,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Value_for," ",n.a.createElement("code",null,"false")),"data-test":"Table.ColumnEditor.Boolean.False",defaultValue:t.booleanValues[0],onChange:e=>r(0,e.target.value)})),n.a.createElement(So,null,n.a.createElement(Vo,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Value_for," ",n.a.createElement("code",null,"true")),"data-test":"Table.ColumnEditor.Boolean.True",defaultValue:t.booleanValues[1],onChange:e=>r(1,e.target.value)})))},fm.friendlyName=window.W_L.Link,fm.Editor=function(e){var t=e.column,a=e.onChange,r=mm(Object(Ul.a)(a,200),1)[0];return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Vo,{label:window.W_L.URL_template,"data-test":"Table.ColumnEditor.Link.UrlTemplate",defaultValue:t.linkUrlTemplate,onChange:e=>r({linkUrlTemplate:e.target.value})})),n.a.createElement(So,null,n.a.createElement(Vo,{label:window.W_L.Text_template,"data-test":"Table.ColumnEditor.Link.TextTemplate",defaultValue:t.linkTextTemplate,onChange:e=>r({linkTextTemplate:e.target.value})})),n.a.createElement(So,null,n.a.createElement(Vo,{label:window.W_L.Title_template,"data-test":"Table.ColumnEditor.Link.TitleTemplate",defaultValue:t.linkTitleTemplate,onChange:e=>r({linkTitleTemplate:e.target.value})})),n.a.createElement(So,null,n.a.createElement(gn.a,{"data-test":"Table.ColumnEditor.Link.OpenInNewTab",checked:t.linkOpenInNewTab,onChange:e=>a({linkOpenInNewTab:e.target.checked})},window.W_L.Open_in_new_tab)),n.a.createElement(So,null,n.a.createElement(zo,{placement:"topLeft",arrowPointAtCenter:!0,icon:n.a.createElement("span",{style:{cursor:"default"}},"Format specs ",zo.defaultIcon)},n.a.createElement("div",null,window.W_L.All_columns_can_be_referenced_using,n.a.createElement("code",null,"{{ column_name }}")," ",window.W_L.syntax),n.a.createElement("div",null,window.W_L.Use," ",n.a.createElement("code",null,"{{ @ }}")," ",window.W_L.to_reference_current_this_column),n.a.createElement("div",null,window.W_L.This_syntax_is_applicable_to_URL_Text_and_Title_options))))},vm.friendlyName=window.W_L.Image,vm.Editor=function(e){var t=e.column,a=e.onChange,r=hm(Object(Ul.a)(a,200),1)[0];return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Vo,{label:window.W_L.URL_template,"data-test":"Table.ColumnEditor.Image.UrlTemplate",defaultValue:t.imageUrlTemplate,onChange:e=>r({imageUrlTemplate:e.target.value})})),n.a.createElement(So,null,n.a.createElement(po,{label:n.a.createElement(n.a.Fragment,null,window.W_L.Size,n.a.createElement(zo,{placement:"topLeft",arrowPointAtCenter:!0},n.a.createElement("div",{style:{marginBottom:5}},window.W_L.Any_positive_integer_value_that_specifies_size_in_pixels),n.a.createElement("div",null,window.W_L.Leave_empty_to_use_default_value)))},n.a.createElement("div",{className:"image-dimension-selector"},n.a.createElement(Vo,{"data-test":"Table.ColumnEditor.Image.Width",placeholder:window.W_L.Width,defaultValue:t.imageWidth,onChange:e=>r({imageWidth:e.target.value})}),n.a.createElement("span",{className:"image-dimension-selector-spacer"},"×"),n.a.createElement(Vo,{"data-test":"Table.ColumnEditor.Image.Height",placeholder:window.W_L.Height,defaultValue:t.imageHeight,onChange:e=>r({imageHeight:e.target.value})})))),n.a.createElement(So,null,n.a.createElement(Vo,{label:window.W_L.Title_template,"data-test":"Table.ColumnEditor.Image.TitleTemplate",defaultValue:t.imageTitleTemplate,onChange:e=>r({imageTitleTemplate:e.target.value})})),n.a.createElement(So,null,n.a.createElement(zo,{placement:"topLeft",arrowPointAtCenter:!0,icon:n.a.createElement("span",{style:{cursor:"default"}},"Format specs ",zo.defaultIcon)},n.a.createElement("div",null,window.W_L.All_columns_can_be_referenced_using,n.a.createElement("code",null,"{{ column_name }}")," ",window.W_L.syntax),n.a.createElement("div",null,window.W_L.Use," ",n.a.createElement("code",null,"{{ @ }}")," ",window.W_L.to_reference_current_this_column),n.a.createElement("div",null,window.W_L.This_syntax_is_applicable_to_URL_Text_and_Title_options))))};a(1297);function wm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Om(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Om(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Om(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function _m(e){var t=e.value,a=e.children,o=e.openingBrace,i=e.closingBrace,s=e.withKeys,c=wm(Object(r.useState)(!1),2),u=c[0],d=c[1],m=Object(l.keys)(t),p=m.length;return n.a.createElement(n.a.Fragment,null,p>0&&n.a.createElement("span",{className:"jvi-toggle",onClick:()=>d(!u)},n.a.createElement("i",{className:me()("fa",{"fa-caret-right":!u,"fa-caret-down":u})})),n.a.createElement("span",{className:"jvi-punctuation jvi-braces"},o),!u&&p>0&&n.a.createElement("span",{className:"jvi-punctuation jvi-ellipsis",onClick:()=>d(!0)},"…"),u&&n.a.createElement("span",{className:"jvi-block"},Object(l.map)(m,(e,a)=>{var r=0===a,o=a===p-1,i=o?null:n.a.createElement("span",{className:"jvi-punctuation jvi-comma"},",");return n.a.createElement("span",{key:"item-"+e,className:me()("jvi-item",{"jvi-nested-first":r,"jvi-nested-last":o})},s&&n.a.createElement("span",{className:"jvi-object-key"},n.a.createElement(Em,{value:e},n.a.createElement("span",{className:"jvi-punctuation"},": "))),n.a.createElement(Em,{value:t[e]},i))})),n.a.createElement("span",{className:"jvi-punctuation jvi-braces"},i),a,!u&&n.a.createElement("span",{className:"jvi-comment"}," // "+p+" "+(1===p?"item":"items")))}function Em(e){var t=e.value,a=e.children;return null===t||!1===t||!0===t||Object(l.isFinite)(t)?n.a.createElement("span",{className:"jvi-value jvi-primitive"},""+t,a):Object(l.isString)(t)?n.a.createElement(n.a.Fragment,null,n.a.createElement("span",{className:"jvi-punctuation jvi-string"},'"'),n.a.createElement("span",{className:"jvi-value jvi-string"},t),n.a.createElement("span",{className:"jvi-punctuation jvi-string"},'"'),a):Object(l.isArray)(t)?n.a.createElement(_m,{value:t,openingBrace:"[",closingBrace:"]"},a):Object(l.isObject)(t)?n.a.createElement(_m,{value:t,openingBrace:"{",closingBrace:"}",withKeys:!0},a):null}function jm(e){var t=e.value;return n.a.createElement("span",{className:"jvi-item jvi-root"},n.a.createElement(Em,{value:t}))}function Sm(e){function t(t){var a=t[e.name];if(Object(l.isString)(a)&&a.length<=Do.tableCellMaxJSONSize)try{return{text:a,value:JSON.parse(a)}}catch(e){}return{text:a,value:void 0}}function a(e){var a=t(e.row),r=a.text,o=a.value;return Object(l.isUndefined)(o)?n.a.createElement("div",{className:"json-cell-invalid"},""+r):n.a.createElement("div",{className:"json-cell-valid"},n.a.createElement(jm,{value:o}))}return a.prepareData=t,a}jm.defaultProps={value:void 0},Sm.friendlyName="JSON";var Cm={string:tm,number:nm,datetime:lm,boolean:um,link:fm,image:vm,json:Sm};function xm(e){switch(e){case"ascend":return"descend";case"descend":return null;default:return"ascend"}}function Pm(e,t,a,r){e=Object(l.filter)(e,"visible"),e=Object(l.sortBy)(e,"order");var o=a.length>1,i=function(e){var t={};return Object(l.each)(e,(e,a)=>{var r=e.name,n=e.direction;t[r]={direction:n,index:a+1}}),t}(a),s=Object(l.map)(e,e=>{var t=i[e.name]&&"ascend"===i[e.name].direction,s=i[e.name]&&"descend"===i[e.name].direction,c=o&&i[e.name]?i[e.name].index:null,u={key:e.name,dataIndex:"record[".concat(JSON.stringify(e.name),"]"),align:e.alignContent,sorter:{multiple:1},sortOrder:Object(l.get)(i,[e.name,"direction"],null),title:n.a.createElement(n.a.Fragment,null,e.description&&n.a.createElement("span",{style:{paddingRight:5}},n.a.createElement(he.a,{placement:"top",title:e.description},n.a.createElement("div",{className:"table-visualization-heading"},n.a.createElement("i",{className:"fa fa-info-circle","aria-hidden":"true"})))),n.a.createElement(he.a,{placement:"top",title:e.title},n.a.createElement("div",{className:"table-visualization-heading","data-sort-column-index":c},e.title))),onHeaderCell:()=>({className:me()({"table-visualization-column-is-sorted":t||s}),onClick:t=>r(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Object(l.findIndex)(t,t=>t.name===e),n={name:e,direction:"ascend"};return r>=0&&(n.direction=xm(t[r].direction)),a?n.direction?(r>=0?t[r]=n:t.push(n),[...t]):Object(l.filter)(t,t=>t.name!==e):n.direction?[n]:[]}(e.name,a,t.shiftKey))})},d=(0,Cm[e.displayAs])(e);return u.render=(t,a)=>({children:n.a.createElement(d,{row:a.record}),props:{className:"display-as-".concat(e.displayAs)}}),u});return s.push({key:"###Redash::Visualizations::Table::Spacer###",dataIndex:null,title:"",className:"table-visualization-spacer",render:()=>"",onHeaderCell:()=>({className:"table-visualization-spacer"})}),t&&(s=[{key:"table-search",title:t,onHeaderCell:()=>({className:"table-visualization-search"}),children:s}]),s}a(1298);function Lm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return km(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return km(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function km(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Nm(){return(Nm=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Am(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Tm(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:", ";return Object(l.reduce)(e,(e,a,r)=>(r>0&&e.push(t),e.push(a),e),[])}function Wm(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.limit,r=void 0===a?1/0:a,n=t.renderColumn,o=void 0===n?e=>e.title:n,i=Object(l.map)(e.slice(0,r),e=>o(e)),s=Object(l.map)(e.slice(r),e=>e.title);return s.length>0?[...Tm(i)," and ".concat(s.length," others")]:i.length>1?[...Tm(Object(l.initial)(i))," and ",Object(l.last)(i)]:i}function Im(e){var t=e.searchColumns;return n.a.createElement(hn.a,{arrowPointAtCenter:!0,placement:"topRight",content:n.a.createElement("div",{className:"table-visualization-search-info-content"},window.W_L.search," ",Wm(t,{renderColumn:e=>n.a.createElement("code",{key:e.name},e.title)}))},n.a.createElement(em.a,{className:"table-visualization-search-info-icon"}))}function qm(e){var t=e.searchColumns,a=Am(e,["searchColumns"]);if(t.length<=0)return null;return n.a.createElement(va.a.Search,Nm({},a,{placeholder:"".concat(window.W_L.search," ").concat(Wm(t,{limit:3}).join(""),"..."),suffix:t.length>3?n.a.createElement(Im,{searchColumns:t}):null}))}function Dm(e){var t=e.options,a=e.data,o=Lm(Object(r.useState)(""),2),i=o[0],s=o[1],c=Lm(Object(r.useState)([]),2),u=c[0],d=c[1],m=Object(r.useMemo)(()=>Object(l.filter)(t.columns,"allowSearch"),[t.columns]),p=Object(r.useMemo)(()=>{var e=m.length>0?n.a.createElement(qm,{searchColumns:m,onChange:e=>s(e.target.value)}):null;return Pm(t.columns,e,u,e=>{d(e),document.getSelection().removeAllRanges()})},[t.columns,m,u]),f=Object(r.useMemo)(()=>{return function(e,t){if(0===t.length||0===e.length)return e;var a={ascend:1,descend:-1};return[...e].sort((e,r)=>{for(var n,o,i=0;i<t.length;i+=1){if(n=e.record[t[i].name],o=r.record[t[i].name],Object(l.isNil)(n)||n<o)return-1*a[t[i].direction];if(n>o||Object(l.isNil)(o))return 1*a[t[i].direction]}return 0})}(function(e,t,a){if(""!==t&&a.length>0){t=t.toUpperCase();var r=Object(l.map)(a,e=>{var a=(0,Cm[e.displayAs])(e).prepareData;return e=>{var r=a(e).text;return Object(l.toString)(r).toUpperCase().indexOf(t)>=0}});return Object(l.filter)(e,e=>Object(l.some)(r,t=>t(e.record)))}return e}((e=a.rows,Object(l.map)(e,(e,t)=>({key:"record".concat(t),record:e}))),i,m),u);var e},[a.rows,i,m,u]);return Object(r.useEffect)(()=>{d([])},[t.columns,a.columns]),0===a.rows.length?null:n.a.createElement("div",{className:"table-visualization-container"},n.a.createElement(Zl.a,{className:"table-fixed-header","data-percy":"show-scrollbars","data-test":"TableVisualization",columns:p,dataSource:f,pagination:{size:Object(l.get)(t,"paginationSize",""),position:"bottom",pageSize:t.itemsPerPage,hideOnSinglePage:!0,showSizeChanger:!1},showSorterTooltip:!1}))}qm.defaultProps={onChange:()=>{}},Dm.propTypes=en;var Rm=a(212),Mm=a.n(Rm),zm=a(306),Fm=a.n(zm),Vm=a(421),Um=a.n(Vm);function Bm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Hm(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Hm(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Hm(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Ym(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Qm(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ym(Object(a),!0).forEach((function(t){Km(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ym(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Km(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function $m(e){var t=e.column,a=e.onChange;function r(e){a(Qm(Qm({},t),e))}var o=Bm(Object(Ul.a)(r,200),1)[0],i=Cm[t.displayAs].Editor||null;return n.a.createElement("div",{className:"table-visualization-editor-column"},n.a.createElement(So,null,n.a.createElement(io.Row,{gutter:15,type:"flex",align:"middle"},n.a.createElement(io.Col,{span:16},n.a.createElement(Vo,{"data-test":"Table.Column.".concat(t.name,".Title"),defaultValue:t.title,onChange:e=>o({title:e.target.value})})),n.a.createElement(io.Col,{span:8},n.a.createElement(Ho,{"data-test":"Table.Column.".concat(t.name,".TextAlignment"),defaultValue:t.alignContent,onChange:e=>r({alignContent:e.target.value})})))),n.a.createElement(So,null,n.a.createElement(gn.a,{"data-test":"Table.Column.".concat(t.name,".UseForSearch"),defaultChecked:t.allowSearch,onChange:e=>r({allowSearch:e.target.checked})},"Use for search")),n.a.createElement(So,null,n.a.createElement(Vo,{label:"Description",defaultValue:t.description,onChange:e=>o({description:e.target.value})})),n.a.createElement(So,null,n.a.createElement(Fo,{label:"Display as:","data-test":"Table.Column.".concat(t.name,".DisplayAs"),defaultValue:t.displayAs,onChange:e=>r({displayAs:e})},Object(l.map)(Cm,(e,a)=>{var r=e.friendlyName;return n.a.createElement(Fo.Option,{key:a,"data-test":"Table.Column.".concat(t.name,".DisplayAs.").concat(a)},r)}))),i&&n.a.createElement(i,{column:t,onChange:r}))}function Gm(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Jm(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Gm(Object(a),!0).forEach((function(t){Xm(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Gm(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Xm(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}$m.defaultProps={onChange:()=>{}};var Zm=Pn.a.Text,ep=Object(es.b)(Mm.a.Panel);function tp(e){var t=e.options,a=e.onOptionsChange;function r(e,r){r&&r.stopPropagation();var n=Object(l.map)(t.columns,t=>t.name===e.name?e:t);a({columns:n})}return n.a.createElement(ds,{axis:"y",lockAxis:"y",useDragHandle:!0,helperClass:"table-editor-columns-dragged-item",helperContainer:e=>e.firstChild,onSortEnd:function(e){var r=e.oldIndex,n=e.newIndex,o=[...t.columns];o.splice(n,0,...o.splice(r,1)),a({columns:o})},containerProps:{className:"table-visualization-editor-columns"}},n.a.createElement(Mm.a,{bordered:!1,defaultActiveKey:[],expandIconPosition:"right"},Object(l.map)(t.columns,(e,t)=>n.a.createElement(ep,{key:e.name,index:t,header:n.a.createElement(n.a.Fragment,null,n.a.createElement(ss,null),n.a.createElement("span",{"data-test":"Table.Column.".concat(e.name,".Name")},e.name,""!==e.title&&e.title!==e.name&&n.a.createElement(Zm,{type:"secondary",style:{marginLeft:5}},n.a.createElement("i",null,"(",e.title,")")))),extra:n.a.createElement(he.a,{title:window.W_L.toggle_visibility,mouseEnterDelay:0,mouseLeaveDelay:0},e.visible?n.a.createElement(Fm.a,{"data-test":"Table.Column.".concat(e.name,".Visibility"),onClick:t=>r(Jm(Jm({},e),{},{visible:!e.visible}),t)}):n.a.createElement(Um.a,{"data-test":"Table.Column.".concat(e.name,".Visibility"),onClick:t=>r(Jm(Jm({},e),{},{visible:!e.visible}),t)}))},n.a.createElement($m,{column:e,onChange:r})))))}tp.propTypes=tn;var ap=[5,10,15,20,25,50,100,150,200,250,500];function rp(e){var t=e.options,a=e.onOptionsChange;return n.a.createElement(So,null,n.a.createElement(Fo,{label:window.W_L.items_per_page,"data-test":"Table.ItemsPerPage",defaultValue:t.itemsPerPage,onChange:e=>a({itemsPerPage:e})},Object(l.map)(ap,e=>n.a.createElement(Fo.Option,{key:"ipp".concat(e),value:e,"data-test":"Table.ItemsPerPage.".concat(e)},e))))}rp.propTypes=tn;a(1302);var np={type:"TABLE",name:"表格(Table)",getOptions:function(e,t){var a=t.columns;return(e=Qd(Qd({},$d),e)).columns=s.a.map(Xd(a,e.columns),e=>{return Qd(Qd({},(a={integer:Do.integerFormat||"0,0",float:Do.floatFormat||"0,0.00"},{dateTimeFormat:{date:Do.dateFormat||"DD/MM/YYYY",datetime:Do.dateTimeFormat||"DD/MM/YYYY HH:mm"}[(t=e).type],numberFormat:a[t.type],booleanValues:Do.booleanValues||["false","true"],imageUrlTemplate:"{{ @ }}",imageTitleTemplate:"{{ @ }}",imageWidth:"",imageHeight:"",linkUrlTemplate:"{{ @ }}",linkTextTemplate:"{{ @ }}",linkTitleTemplate:"{{ @ }}",linkOpenInNewTab:!0})),e);var t,a}),e},Renderer:Dm,Editor:Oo([{key:"Columns",title:window.W_L.columns,component:tp},{key:"Grid",title:window.W_L.grid,component:rp}]),autoHeight:!0,defaultRows:14,defaultColumns:3,minColumns:2},op=a(676),ip=a.n(op);a(1303);function lp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return sp(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return sp(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function sp(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function cp(e,t){var a=[];t.column&&(a=t.frequenciesColumn?function(e,t,a){var r={};return Object(l.each)(e,e=>{var n=parseFloat(e[a]);if(Number.isFinite(n)&&n>0){var o=Object(l.toString)(e[t]);r[o]=n}}),r}(e,t.column,t.frequenciesColumn):function(e,t){var a={};return Object(l.each)(e,e=>{var r=Object(l.toString)(e[t]).split(/\s/g);Object(l.each)(r,e=>{a[e]=(a[e]||0)+1})}),a}(e,t.column),a=Object(l.sortBy)(Object(l.map)(a,(e,t)=>({text:t,count:e})),[e=>-e.count,e=>-e.text.length]));var r,n,o,i,s=Object(l.map)(a,e=>e.count),c=Qr.a.scale.linear().domain([Object(l.min)(s),Object(l.max)(s)]).range([10,100]),u=Qr.a.scale.category20();return Object(l.each)(a,(e,t)=>{e.size=c(e.count),e.color=u(t),e.angle=t%2*90}),r=a,n={wordLength:t.wordLengthLimit,wordCount:t.wordCountLimit},o=n.wordLength,i=n.wordCount,o.min=Number.isFinite(o.min)?o.min:null,o.max=Number.isFinite(o.max)?o.max:null,i.min=Number.isFinite(i.min)?i.min:null,i.max=Number.isFinite(i.max)?i.max:null,Object(l.filter)(r,e=>{var t=e.text,a=e.count,r=(!o.min||t.length>=o.min)&&(!o.max||t.length<=o.max),n=(!i.min||a>=i.min)&&(!i.max||a<=i.max);return r&&n})}function up(e,t){e.style.transform=null;var a=e.getBoundingClientRect(),r=a.width,n=a.height,o=t.getBoundingClientRect(),i=o.width/r,l=o.height/n;e.style.transform="scale(".concat(Math.min(i,l),")")}function dp(){var e=window.getComputedStyle(document.body).fontFamily;return ip()().size([5e3,5e3]).padding(3).font(e).rotate(e=>e.angle).fontSize(e=>e.size).random(()=>.5)}function mp(e){var t=e.data,a=e.options,o=lp(Object(r.useState)(null),2),i=o[0],l=o[1],s=lp(Object(r.useState)([]),2),c=s[0],u=s[1],d=Object(r.useMemo)(dp,[]);return Object(r.useEffect)(()=>(d.words(cp(t.rows,a)).on("end",e=>u(e)).start(),()=>d.on("end",null).stop()),[d,t,a,u]),Object(r.useEffect)(()=>{i&&function(e,t){(e=Qr.a.select(e)).selectAll("*").remove();var a=e.append("svg"),r=a.append("g");r.selectAll("text").data(t).enter().append("text").style("font-size",e=>"".concat(e.size,"px")).style("font-family",e=>e.font).style("fill",e=>e.color).attr("text-anchor","middle").attr("transform",e=>"translate(".concat([e.x,e.y],") rotate(").concat(e.rotate,")")).text(e=>e.text);var n=a.node().getBoundingClientRect(),o=r.node().getBoundingClientRect();a.attr("width",Math.ceil(o.width)).attr("height",Math.ceil(o.height)),r.attr("transform","translate(".concat(n.left-o.left,",").concat(n.top-o.top,")")),up(a.node(),e.node())}(i,c)},[i,c]),Object(r.useEffect)(()=>{if(i)return Gr(i,()=>{var e=i.querySelector("svg");e&&up(e,i)})},[i]),n.a.createElement("div",{className:"word-cloud-visualization-container",ref:l})}function pp(e){var t=e.options,a=e.data,r=e.onOptionsChange,o=e=>{r(Object(l.merge)({},t,e))};return n.a.createElement(n.a.Fragment,null,n.a.createElement(So,null,n.a.createElement(Fo,{label:"Words Column","data-test":"WordCloud.WordsColumn",value:t.column,onChange:e=>o({column:e})},Object(l.map)(a.columns,e=>{var t=e.name;return n.a.createElement(Fo.Option,{key:t,"data-test":"WordCloud.WordsColumn."+t},t)}))),n.a.createElement(So,null,n.a.createElement(Fo,{label:"Frequencies Column","data-test":"WordCloud.FrequenciesColumn",value:t.frequenciesColumn,onChange:e=>o({frequenciesColumn:e})},n.a.createElement(Fo.Option,{key:"none",value:""},n.a.createElement("i",null,"(count word frequencies automatically)")),Object(l.map)(a.columns,e=>{var t=e.name;return n.a.createElement(Fo.Option,{key:"column-"+t,value:t,"data-test":"WordCloud.FrequenciesColumn."+t},t)}))),n.a.createElement(So,null,n.a.createElement(po,{label:"Words Length Limit"},n.a.createElement(io.Row,{gutter:15,type:"flex"},n.a.createElement(io.Col,{span:12},n.a.createElement(Uo,{"data-test":"WordCloud.WordLengthLimit.Min",placeholder:"Min",min:0,value:t.wordLengthLimit.min,onChange:e=>o({wordLengthLimit:{min:e>0?e:null}})})),n.a.createElement(io.Col,{span:12},n.a.createElement(Uo,{"data-test":"WordCloud.WordLengthLimit.Max",placeholder:"Max",min:0,value:t.wordLengthLimit.max,onChange:e=>o({wordLengthLimit:{max:e>0?e:null}})}))))),n.a.createElement(So,null,n.a.createElement(po,{label:"Frequencies Limit"},n.a.createElement(io.Row,{gutter:15,type:"flex"},n.a.createElement(io.Col,{span:12},n.a.createElement(Uo,{"data-test":"WordCloud.WordCountLimit.Min",placeholder:"Min",min:0,value:t.wordCountLimit.min,onChange:e=>o({wordCountLimit:{min:e>0?e:null}})})),n.a.createElement(io.Col,{span:12},n.a.createElement(Uo,{"data-test":"WordCloud.WordCountLimit.Max",placeholder:"Max",min:0,value:t.wordCountLimit.max,onChange:e=>o({wordCountLimit:{max:e>0?e:null}})}))))))}mp.propTypes=en,pp.propTypes=tn;var fp={column:"",frequenciesColumn:"",wordLengthLimit:{min:null,max:null},wordCountLimit:{min:null,max:null}},gp={type:"WORD_CLOUD",name:"词云图(Word Cloud)",getOptions:e=>Object(l.merge)({},fp,e),Renderer:mp,Editor:pp,defaultRows:8};function bp(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function hp(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?bp(Object(a),!0).forEach((function(t){yp(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):bp(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function yp(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var vp=ae.a.shape({type:ae.a.string.isRequired,name:ae.a.string.isRequired,getOptions:ae.a.func.isRequired,isDefault:ae.a.bool,isDeprecated:ae.a.bool,Renderer:ae.a.func.isRequired,Editor:ae.a.func,autoHeight:ae.a.bool,defaultRows:ae.a.number,defaultColumns:ae.a.number,minRows:ae.a.number,maxRows:ae.a.number,minColumns:ae.a.number,maxColumns:ae.a.number}),wp={};Object(l.each)(Object(l.flatten)([Xo,Is,wc,Yc,su,wu,Nu,sd,jd,Id,Hd,np,gp]),(function(e){if(function(e){var t={config:vp},a={config:e};ae.a.checkPropTypes(t,a,"prop","registerVisualization")}(e),e=hp(hp({Editor:()=>null},e),{},{isDefault:e.isDefault&&!e.isDeprecated}),wp[e.type])throw new Error("Visualization ".concat(e.type," already registered."));wp[e.type]=e}));var Op=wp;function _p(){return Object(l.find)(wp,e=>e.isDefault)||Object(l.find)(wp,e=>!e.isDeprecated)}function Ep(){return(Ep=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function jp(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Sp(){return(Sp=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Cp(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var xp="textbox",Pp="visualization",Lp="restricted";var kp,Np,Ap,Tp={DashboardLevel:"dashboard-level",WidgetLevel:"widget-level",StaticValue:"static-value"};class Wp{constructor(e){Object(l.extend)(this,e);var t=function(e){e.width=1;var t={autoHeight:!1,sizeX:Math.round(ka/2),sizeY:Ia,minSizeX:qa,maxSizeX:Da,minSizeY:Ra,maxSizeY:Ma},a=e.visualization?Op[e.visualization.type]:null;if(Object(l.isObject)(a)){Object.prototype.hasOwnProperty.call(a,"autoHeight")&&(t.autoHeight=a.autoHeight);var r=parseInt(a.minColumns,10);isFinite(r)&&r>=0&&(t.minSizeX=r);var n=parseInt(a.maxColumns,10);isFinite(n)&&n>=0&&(t.maxSizeX=Math.min(n,ka));var o=parseInt(a.height,10);isFinite(o)&&(t.minSizeY=Math.ceil(o/Na));var i=parseInt(a.minRows,10);isFinite(i)&&(t.minSizeY=i);var s=parseInt(a.maxRows,10);isFinite(s)&&s>=0&&(t.maxSizeY=s);var c=parseInt(a.defaultColumns,10);isFinite(c)&&c>0&&(t.sizeX=c);var u=parseInt(a.defaultRows,10);isFinite(u)&&u>0&&(t.sizeY=u)}return t}(this);this.options=this.options||{},this.options.position=Object(l.extend)({},t,Object(l.pick)(this.options.position,["col","row","sizeX","sizeY","autoHeight"])),this.options.position.sizeY<0&&(this.options.position.autoHeight=!0)}get type(){return this.visualization?Pp:this.restricted?Lp:xp}getQuery(){return!this.query&&this.visualization&&(this.query=new hr(this.visualization.query)),this.query}getQueryResult(){return this.data}getName(){return this.visualization?"".concat(this.visualization.query.name," (").concat(this.visualization.name,")"):Object(l.truncate)(this.text,20)}load(e,t){if(!this.visualization)return Promise.resolve();if(e||void 0===this.queryResult){this.loading=!0,this.refreshStartedAt=Fa()(),(void 0===t||e)&&(t=e?0:void 0);var a=this.getQuery().getQueryResult(t);this.queryResult=a,a.toPromise().then(e=>(this.queryResult===a&&(this.loading=!1,this.data=e),e)).catch(e=>(this.queryResult===a&&(this.loading=!1,this.data=e),e))}return this.queryResult.toPromise()}save(e,t){var a=Object(l.pick)(this,"options","text","id","width","dashboard_id","visualization_id");e&&t&&(a[e]=Object(l.merge)({},a[e],t));var r="api/widgets";return this.id&&(r="".concat(r,"/").concat(this.id)),B.post(r,a).then(e=>(Object(l.each)(e,(e,t)=>{this[t]=e}),this))}delete(){var e="api/widgets/".concat(this.id);return B.delete(e)}isStaticParam(e){return this.getParameterMappings()[e.name].type===Wp.MappingType.StaticValue}getParametersDefs(){var e=this.getParameterMappings(),t=this.getQuery()?this.getQuery().getParametersDefs():[],a=A.search,r=[Wp.MappingType.WidgetLevel,Wp.MappingType.StaticValue],n=Object(l.map)(Object(l.filter)(t,t=>r.indexOf(e[t.name].type)>=0),t=>{var r=e[t.name],n=Hr(t);return n.title=r.title||t.title,n.locals=[t],n.urlPrefix="p_w".concat(this.id,"_"),r.type===Wp.MappingType.StaticValue?n.setValue(r.value):n.fromUrlParams(a),n});return Object(l.sortBy)(n,e=>Object(l.includes)(this.options.paramOrder,e.name)?Object(l.indexOf)(this.options.paramOrder,e.name):Object(l.size)(this.options.paramOrder))}getParameterMappings(){Object(l.isObject)(this.options.parameterMappings)||(this.options.parameterMappings={});var e={},t=this.getQuery()?this.getQuery().getParametersDefs(!1):[];Object(l.each)(t,t=>{e[t.name]=!0,Object(l.isObject)(this.options.parameterMappings[t.name])||(this.options.parameterMappings[t.name]={name:t.name,type:t.global?Wp.MappingType.DashboardLevel:Wp.MappingType.WidgetLevel,mapTo:t.name,value:null,title:""})});var a=Object(l.difference)(Object(l.keys)(this.options.parameterMappings),Object(l.keys)(e));return Object(l.each)(a,e=>{delete this.options.parameterMappings[e]}),this.options.parameterMappings}getLocalParameters(){return Object(l.filter)(this.getParametersDefs(),e=>!this.isStaticParam(e))}}Ap=Tp,(Np="MappingType")in(kp=Wp)?Object.defineProperty(kp,Np,{value:Ap,enumerable:!0,configurable:!0,writable:!0}):kp[Np]=Ap;var Ip=Wp;function qp(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Dp(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?qp(Object(a),!0).forEach((function(t){Rp(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):qp(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Rp(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Mp(e,t,a){var r={};return s.a.each(t,t=>{var n=t&&t.getFilters?t.getFilters():[];s.a.each(n,t=>{var n=s.a.has(a,t.name);if(n||e.dashboard_filters_enabled){n&&(t.current=a[t.name]);var o=Dp({},t);s.a.has(r,t.name)?r[o.name].values=s.a.union(r[o.name].values,o.values):r[o.name]=o}})}),s.a.values(r)}function zp(e){var t=Math.max(s.a.chain(e).map(e=>e.options.position.sizeY).max().value(),20)+5;return s.a.chain(e).sortBy(e=>e.options.position.row).groupBy(e=>e.options.position.row).reduce((e,a)=>{var r=1;return s.a.each(a,a=>{r=Math.max(r,a.options.position.autoHeight?t:a.options.position.sizeY),a.options.position.row=e,a.options.position.sizeY<1&&(a.options.position.sizeY=t)}),e+r},0).value(),e=s.a.sortBy(e,e=>e.options.position.col),e=s.a.sortBy(e,e=>e.options.position.row)}function Fp(e,t){var a=s.a.extend({sizeX:Wa},s.a.extend({},t.options).position).sizeX,r=s.a.chain(e).map(e=>{var t=s.a.extend({},e.options),a=s.a.extend({row:0,sizeY:0},t.position);return{left:a.col,top:a.row,right:a.col+a.sizeX,bottom:a.row+a.sizeY,width:a.sizeX,height:a.sizeY}}).reduce((e,t)=>{for(var a=Math.max(t.left,0),r=Math.min(t.right,e.length+1),n=a;n<r;n+=1)e[n]=Math.max(e[n],t.bottom);return e},s.a.map(new Array(ka),s.a.constant(0))).value();return s.a.chain(s.a.range(0,ka-a+1)).map(e=>({col:e,row:s.a.chain(r).slice(e,e+a).max().value()})).sortBy("row").first().value()}function Vp(e){s.a.extend(this,e),Object.defineProperty(this,"url",{get:function(){return t=(e=this).id,a=e.slug,"dashboards/".concat(t,"-").concat(a);var e,t,a}})}function Up(e){return zp(s.a.map(e,e=>new Ip(e)))}function Bp(e){return(e=new Vp(e)).widgets&&(e.widgets=Up(e.widgets)),e.publicAccessEnabled=void 0!==e.public_url,e}function Hp(e){return e=e.results?Dp(Dp({},e),{},{results:s.a.map(e.results,Bp)}):Bp(e)}var Yp={get:e=>{var t=e.id,a=e.slug,r={};return t||(r.legacy=null),B.get("api/dashboards/".concat(t||a),{params:r}).then(Hp)},getByToken:e=>{var t=e.token;return B.get("api/dashboards/public/".concat(t)).then(Hp)},save:e=>B.post((e=>e.id?"api/dashboards/".concat(e.id):"api/dashboards")(e),e).then(Hp),delete:e=>{var t=e.id;return B.delete("api/dashboards/".concat(t)).then(Hp)},query:e=>B.get("api/dashboards",{params:e}).then(Hp),recent:e=>B.get("api/dashboards/recent",{params:e}).then(Hp),myDashboards:e=>B.get("api/dashboards/my",{params:e}).then(Hp),favorites:e=>B.get("api/dashboards/favorites",{params:e}).then(Hp),favorite:e=>{var t=e.id;return B.post("api/dashboards/".concat(t,"/favorite"))},unfavorite:e=>{var t=e.id;return B.delete("api/dashboards/".concat(t,"/favorite"))}};function Qp(){return(Qp=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Kp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return $p(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return $p(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $p(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Gp(e){var t=e.dialog,a=Kp(Object(r.useState)(""),2),o=a[0],i=a[1],s=Kp(Object(r.useState)(!1),2),c=s[0],u=s[1],d=Kp(Object(r.useState)(!1),2),m=d[0],p=d[1],f=Z.isCreateDashboardEnabled();function g(){""!==o&&(p(!0),Vp.save({name:o}).then(e=>{t.close(),Ca("".concat(e.url,"?edit"))}),La("create","dashboard"))}return n.a.createElement(R.a,Qp({},t.props,f?{}:{footer:null},{title:window.W_L.new_dashboard,okText:window.W_L.save,cancelText:window.W_L.cancel,okButtonProps:{disabled:!c||m,loading:m,"data-test":"DashboardSaveButton"},cancelButtonProps:{disabled:m},onOk:g,closable:!m,maskClosable:!m,wrapProps:{"data-test":"CreateDashboardDialog"}}),n.a.createElement(se,{name:"CreateDashboardDialogExtra",disabled:!f},n.a.createElement(va.a,{defaultValue:o,onChange:function(e){var t=Object(l.trim)(e.target.value);i(t),u(""!==t)},onPressEnter:g,placeholder:window.W_L.dashboard_name,"aria-label":window.W_L.dashboard_name,disabled:m,autoFocus:!0})))}s.a.extend(Vp,Yp),Vp.prepareDashboardWidgets=Up,Vp.prepareWidgetsForDashboard=zp,Vp.prototype.canEdit=function(){return Z.canEdit(this)},Vp.prototype.getParametersDefs=function(){var e={},t=A.search;s.a.each(this.widgets,t=>{if(t.getQuery()){var a=t.getParameterMappings();t.getQuery().getParametersDefs(!1).forEach(t=>{var r=a[t.name];r.type===Ip.MappingType.DashboardLevel&&(e[r.mapTo]||(e[r.mapTo]=Hr(t),e[r.mapTo].name=r.mapTo,e[r.mapTo].title=r.title||t.title,e[r.mapTo].locals=[]),e[r.mapTo].locals.push(t))})}});var a=s.a.values(s.a.each(e,e=>{e.setValue(e.value),e.fromUrlParams(t)}));return s.a.sortBy(a,e=>s.a.includes(this.options.globalParamOrder,e.name)?s.a.indexOf(this.options.globalParamOrder,e.name):s.a.size(this.options.globalParamOrder))},Vp.prototype.addWidget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={dashboard_id:this.id,options:Dp(Dp({},t),{},{isHidden:!1,position:{}}),text:"",visualization_id:null,visualization:null};s.a.isString(e)?a.text=e:s.a.isObject(e)&&(a.visualization_id=e.id,a.visualization=e);var r=new Ip(a),n=Fp(this.widgets,r);return r.options.position.col=n.col,r.options.position.row=n.row,r.save().then(()=>(this.widgets=[...this.widgets,r],r))},Vp.prototype.favorite=function(){return Vp.favorite(this)},Vp.prototype.unfavorite=function(){return Vp.unfavorite(this)},Gp.propTypes={dialog:ja.isRequired};var Jp=Sa(Gp);a(1304);function Xp(){return(Xp=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Zp(e){var t=e.show,a=e.completed,r=e.text,o=e.url,i=e.urlText,l=e.onClick;if(!t)return null;var s={children:i,onClick:l};return n.a.createElement("li",{className:me()({done:a})},o?n.a.createElement(h,Xp({href:o},s)):n.a.createElement(ge,Xp({type:"link"},s))," ",r)}function ef(e){e.helpTriggerType;return n.a.createElement(n.a.Fragment,null)}function tf(e){var t=e.icon,a=e.header,o=e.description,i=e.illustration,s=e.helpMessage,c=e.closable,u=e.onClose,d=e.onboardingMode,m=e.showAlertStep,p=e.showDashboardStep,f=e.showDataSourceStep,g=e.showInviteStep,b=e.getStepsItems,h=e.illustrationPath,y={dataSource:f,query:!0,alert:m,dashboard:p,inviteUsers:g},v={dataSource:ee.objectCounters.data_sources>0,query:ee.objectCounters.queries>0,alert:ee.objectCounters.alerts>0,dashboard:ee.objectCounters.dashboards>0,inviteUsers:ee.objectCounters.users>1},w=Object(r.useCallback)(()=>{Jp.showModal()},[]);if(!(!d||Object(l.some)(Object(l.keys)(y),e=>y[e]&&!v[e])))return null;var O=[{key:"dataSources",node:H.isAdmin?n.a.createElement(Zp,{key:"dataSources",show:y.dataSource,completed:v.dataSource,url:"data_sources/new",urlText:window.W_L.connect_new_datasource}):n.a.createElement(Zp,{key:"dataSources",show:y.dataSource,completed:v.dataSource,text:window.W_L.ask_database_info})},{key:"queries",node:n.a.createElement(Zp,{key:"queries",show:y.query,completed:v.query,url:"queries/new",urlText:window.W_L.create_query})},{key:"alerts",node:n.a.createElement(Zp,{key:"alerts",show:y.alert,completed:v.alert,url:"alerts/new",urlText:window.W_L.create_alert})},{key:"dashboards",node:n.a.createElement(Zp,{key:"dashboards",show:y.dashboard,completed:v.dashboard,onClick:w,urlText:window.W_L.create_dashboard})},{key:"users",node:n.a.createElement(Zp,{key:"users",show:y.inviteUsers,completed:v.inviteUsers,url:"users/new",urlText:window.W_L.invite_new_user})}],_=b?b(O):O,E=h||"static/images/illustrations/"+i+".svg";return n.a.createElement("div",{className:"empty-state-wrapper"},n.a.createElement("div",{className:"empty-state bg-white tiled"},n.a.createElement("div",{className:"empty-state__summary"},a&&n.a.createElement("h4",null,a),n.a.createElement("h2",null,n.a.createElement("i",{className:t,"aria-hidden":"true"})),n.a.createElement("p",null,o),n.a.createElement("img",{src:E,alt:i+" Illustration",width:"75%"})),n.a.createElement("div",{className:"empty-state__steps"},n.a.createElement("h4",null,window.W_L.start),n.a.createElement("ol",null,_.map(e=>e.node)),s)),c&&n.a.createElement(ge,{className:"close-button","aria-label":"Close",onClick:u},n.a.createElement(je.a,null)))}Zp.propTypes={show:ae.a.bool.isRequired,completed:ae.a.bool.isRequired,text:ae.a.node,url:ae.a.string,urlTarget:ae.a.string,urlText:ae.a.node,onClick:ae.a.func},Zp.defaultProps={url:null,urlTarget:null,urlText:null,text:null,onClick:null},ef.propTypes={helpTriggerType:ae.a.string.isRequired},tf.propTypes={icon:ae.a.string,header:ae.a.string,description:ae.a.string.isRequired,illustration:ae.a.string.isRequired,illustrationPath:ae.a.string,helpMessage:ae.a.node,closable:ae.a.bool,onClose:ae.a.func,onboardingMode:ae.a.bool,showAlertStep:ae.a.bool,showDashboardStep:ae.a.bool,showDataSourceStep:ae.a.bool,showInviteStep:ae.a.bool,getStepItems:ae.a.func},tf.defaultProps={icon:null,header:null,helpMessage:null,closable:!1,onClose:()=>{},onboardingMode:!1,showAlertStep:!1,showDashboardStep:!1,showDataSourceStep:!0,showInviteStep:!1};var af=tf,rf=a(252),nf=a.n(rf);function of(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function lf(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?of(Object(a),!0).forEach((function(t){sf(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):of(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function sf(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}nf.a.config({placement:"bottomRight",duration:3});var cf={};["success","error","info","warning","warn"].forEach(e=>{cf[e]=function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return nf.a[e](lf(lf({},r),{},{message:t,description:a}))}});var uf=lf(lf({},nf.a),cf),df=()=>B.get("api/settings/organization"),mf=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.W_L.save_success;return B.post("api/settings/organization",e).then(e=>(uf.success(t),e)).catch(()=>{uf.error(window.W_L.save_failed)})};function pf(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ff(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ff(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ff(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var gf=Pn.a.Text;var bf=function(){var e=pf(Object(r.useState)(!1),2),t=e[0],a=e[1];if(!Y.showBeaconConsentMessage||t)return null;var o=()=>{Y.showBeaconConsentMessage=!1,a(!0)},i=e=>{var t=window.W_L.thank_you;e||(t=window.W_L.setting_saved_success),mf({beacon_consent:e},t).finally(o)};return n.a.createElement(se,{name:"BeaconConsent"},n.a.createElement("div",{className:"m-t-10 tiled"},n.a.createElement(vn.a,{title:n.a.createElement(n.a.Fragment,null,window.W_L.share_info," ",n.a.createElement($e,{type:"USAGE_DATA_SHARING"})),bordered:!1},n.a.createElement(gf,null,window.W_L.help_redash,"："),n.a.createElement("div",{className:"m-t-5"},n.a.createElement("ul",null,n.a.createElement("li",null," ",window.W_L.redash_about_1),n.a.createElement("li",null," ",window.W_L.redash_about_2))),n.a.createElement(gf,null,window.W_L.redash_info),n.a.createElement("div",{className:"m-t-5"},n.a.createElement(m.a,{type:"primary",className:"m-r-5",onClick:()=>i(!0)},window.W_L.accept),n.a.createElement(m.a,{type:"default",onClick:()=>i(!1)},window.W_L.reject)),n.a.createElement("div",{className:"m-t-15"},n.a.createElement(gf,{type:"secondary"},window.W_L.set_info_in," ",n.a.createElement(h,{href:"settings/general"},window.W_L.sys_setting)," ",window.W_L.sys_setting_add,"。")))))},hf=a(254),yf=a.n(hf);function vf(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function wf(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?vf(Object(a),!0).forEach((function(t){Of(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):vf(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Of(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var _f=new class{constructor(){Of(this,"_items",[]),Of(this,"_sorted",!1)}get items(){return this._sorted||(this._items=Object(l.sortBy)(this._items,[e=>{return t=e.path,a=yf.a.parse(t),Object(l.filter)(a,l.isObject).length;var t,a},e=>-e.path.length,e=>e.path]),this._sorted=!0),this._items}register(e,t){var a=Object(l.isString)(e)?e:null;this.unregister(a),Object(l.isObject)(t)&&(this._items=[...this.items,wf(wf({},t),{},{id:a})],this._sorted=!1)}unregister(e){Object(l.isString)(e)&&(this._items=Object(l.filter)(this.items,t=>t.id!==e))}navigate(e,t){var a=this._items.find(t=>t.id===e);if(a){var r=a.path;for(var n in t)r=r.replace(":".concat(n),String(t[n]));window.location.href=r}else console.error("No route found with id: ".concat(e))}},Ef=a(93),jf=a.n(Ef);function Sf(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Cf(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Cf(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Cf(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function xf(e){var t=e.title,a=e.resource,o=e.itemUrl,i=e.emptyState,s=Sf(Object(r.useState)([]),2),c=s[0],u=s[1],d=Sf(Object(r.useState)(!0),2),m=d[0],p=d[1];return Object(r.useEffect)(()=>{p(!0),a.favorites().then(e=>{var t=e.results;return u(t)}).finally(()=>p(!1))},[a]),n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"d-flex align-items-center m-b-20"},n.a.createElement("p",{className:"flex-fill f-500 c-black m-0"},t),m&&n.a.createElement(jf.a,null)),!Object(l.isEmpty)(c)&&n.a.createElement("div",{role:"list",className:"list-group"},c.map(e=>n.a.createElement(h,{key:o(e),role:"listitem",className:"list-group-item",href:o(e)},n.a.createElement("span",{className:"btn-favorite m-r-5"},n.a.createElement("i",{className:"fa fa-star","aria-hidden":"true"})),e.name,e.is_draft&&n.a.createElement("span",{className:"label label-default m-l-5"},window.W_L.unpublished)))),Object(l.isEmpty)(c)&&!m&&i)}function Pf(){return n.a.createElement("div",{className:"tile"},n.a.createElement("div",{className:"t-body tb-padding"},n.a.createElement("div",{className:"row home-favorites-list"},n.a.createElement("div",{className:"col-sm-6 m-t-20"},n.a.createElement(xf,{title:window.W_L.my_favorite_dashboard,resource:Vp,itemUrl:e=>e.url,emptyState:n.a.createElement("p",null,n.a.createElement("span",{className:"btn-favorite m-r-5"},n.a.createElement("i",{className:"fa fa-star","aria-hidden":"true"})),n.a.createElement(h,{href:"dashboards"},window.W_L.my_favorite_dashboard))})),n.a.createElement("div",{className:"col-sm-6 m-t-20"},n.a.createElement(xf,{title:window.W_L.my_favorite_query,resource:hr,itemUrl:e=>"queries/".concat(e.id),emptyState:n.a.createElement("p",null,n.a.createElement("span",{className:"btn-favorite m-r-5"},n.a.createElement("i",{className:"fa fa-star","aria-hidden":"true"})),n.a.createElement(h,{href:"queries"},window.W_L.my_favorite_query))})))))}xf.propTypes={title:ae.a.string.isRequired,resource:ae.a.func.isRequired,itemUrl:ae.a.func.isRequired,emptyState:ae.a.node},xf.defaultProps={emptyState:null};a(1305);function Lf(){return n.a.createElement(u.a,{className:"m-b-15",type:"warning",message:n.a.createElement(n.a.Fragment,null,"你已设置参数 ",n.a.createElement("code",null,"ALLOW_PARAMETERS_IN_EMBEDS"),"，但该特征暂时不可用。"," ",n.a.createElement(h,{href:"https://discuss.redash.io/t/support-for-parameters-in-embedded-visualizations/3337",target:"_blank",rel:"noopener noreferrer"},"Read more"),".")})}function kf(){return n.a.createElement(u.a,{className:"m-b-15",type:"warning",message:n.a.createElement(n.a.Fragment,null,window.W_L.email_send," ",n.a.createElement(ge,{type:"link",onClick:()=>{B.post("verification_email/").then(e=>{uf.success(e.message)})}},window.W_L.re_send_email),".")})}function Nf(){return Object(r.useEffect)(()=>{La("view","page","personal_homepage")},[]),n.a.createElement("div",{className:"home-page"},n.a.createElement("div",{className:"container"},Object(l.includes)(Q,"using-deprecated-embed-feature")&&n.a.createElement(Lf,null),Object(l.includes)(Q,"email-not-verified")&&n.a.createElement(kf,null),n.a.createElement(se,{name:"Home.EmptyState"},n.a.createElement(af,{header:window.W_L.redash_welcome,description:window.W_L.redash_desc,illustration:"dashboard",helpMessage:n.a.createElement(ef,{helpTriggerType:"GETTING_STARTED"}),showDashboardStep:!0,showInviteStep:!0,onboardingMode:!0})),n.a.createElement(se,{name:"HomeExtra"}),n.a.createElement(Pf,null),n.a.createElement(bf,null)))}_f.register("Home",ha({path:"/home",title:"DeepBI",render:e=>n.a.createElement(Nf,e)}));a(1306);function Af(e){var t=e.title,a=e.actions;return n.a.createElement("div",{className:"page-header-wrapper"},n.a.createElement("h3",null,t),a&&n.a.createElement("div",{className:"page-header-actions"},a))}Af.propTypes={title:ae.a.string,actions:ae.a.node},Af.defaultProps={title:"",actions:null};a(1307);function Tf(e){var t=e.activeTab,a=e.children;return n.a.createElement("div",{className:"admin-page-layout"},n.a.createElement("div",{className:"container"},n.a.createElement(Af,{title:"Admin"}),n.a.createElement("div",{className:"bg-white tiled"},n.a.createElement(ue.a,{selectedKeys:[t],selectable:!1,mode:"horizontal"},n.a.createElement(ue.a.Item,{key:"system_status"},n.a.createElement(h,{href:"admin/status"},window.W_L.sys_status)),n.a.createElement(ue.a.Item,{key:"jobs"},n.a.createElement(h,{href:"admin/queries/jobs"},window.W_L.task_queen_status)),n.a.createElement(ue.a.Item,{key:"outdated_queries"},n.a.createElement(h,{href:"admin/queries/outdated"},window.W_L.outdated_query))),a)))}Tf.propTypes={activeTab:ae.a.string,children:ae.a.node},Tf.defaultProps={activeTab:"system_status",children:null};var Wf=a(208),If=a.n(Wf),qf=a(157),Df=a.n(qf),Rf=a(79),Mf=a.n(Rf);function zf(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Ff extends n.a.Component{toggleItem(e,t,a){var r=t.is_favorite?t.unfavorite.bind(t):t.favorite.bind(t),n=t.is_favorite;r().then(()=>{t.is_favorite=!n,this.forceUpdate(),a()})}render(){var e=this.props,t=e.item,a=e.onChange,r=t.is_favorite?"fa fa-star":"fa fa-star-o",o=t.is_favorite?window.W_L.add_favorite:window.W_L.remove_favorite;return n.a.createElement(ge,{title:o,"aria-label":o,className:"favorites-control btn-favorite",onClick:e=>this.toggleItem(e,t,a)},n.a.createElement("i",{className:r,"aria-hidden":"true"}))}}zf(Ff,"propTypes",{item:ae.a.shape({is_favorite:ae.a.bool.isRequired}).isRequired,onChange:ae.a.func}),zf(Ff,"defaultProps",{onChange:()=>{}});ae.a.shape({syntax:ae.a.string,options:ae.a.shape({doc:ae.a.string,doc_url:ae.a.string}),type_name:ae.a.string});var Vf=ae.a.shape({columns:ae.a.arrayOf(ae.a.string).isRequired}),Uf=(ae.a.arrayOf(Vf),ae.a.shape({interval:ae.a.number,time:ae.a.string,day_of_week:ae.a.string,until:ae.a.string})),Bf={interval:null,time:null,day_of_week:null,until:null},Hf=ae.a.shape({id:ae.a.number.isRequired,name:ae.a.string.isRequired,email:ae.a.string.isRequired,profileImageUrl:ae.a.string,apiKey:ae.a.string,isDisabled:ae.a.bool}),Yf=ae.a.shape({id:ae.a.number.isRequired,name:ae.a.string.isRequired,icon:ae.a.string.isRequired,type:ae.a.string.isRequired}),Qf=ae.a.shape({id:ae.a.any.isRequired,name:ae.a.string.isRequired,description:ae.a.string,data_source_id:ae.a.any.isRequired,created_at:ae.a.string.isRequired,updated_at:ae.a.string,user:Hf,query:ae.a.string,queryHash:ae.a.string,is_safe:ae.a.bool.isRequired,is_draft:ae.a.bool.isRequired,is_archived:ae.a.bool.isRequired,api_key:ae.a.string.isRequired}),Kf=ae.a.shape({column:ae.a.string,op:ae.a.oneOf([">",">=","<","<=","==","!="]),value:ae.a.oneOfType([ae.a.string,ae.a.number]),custom_subject:ae.a.string,custom_body:ae.a.string}),$f=ae.a.shape({id:ae.a.any,name:ae.a.string,created_at:ae.a.string,last_triggered_at:ae.a.string,updated_at:ae.a.string,rearm:ae.a.number,state:ae.a.oneOf(["ok","triggered","unknown"]),user:Hf,query:Qf,options:ae.a.shape({column:ae.a.string,op:ae.a.string,value:ae.a.oneOfType([ae.a.string,ae.a.number])}).isRequired});function Gf(e,t,a,r){var n=t[a],o=e&&null!=n&&Fa.a.isMoment(n),i=!e&&(null==n||Fa.a.isMoment(n));if(!o&&!i)return new Error("Prop `"+a+"` supplied to `"+r+"` should be a Moment.js instance.")}var Jf=Object(l.wrap)(!1,Gf);function Xf(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Zf(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Zf(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Zf(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function eg(e){var t=e.date,a=e.placeholder,o=e.autoUpdate,i=e.variation,s=function(e){return(e=Object(l.isNil)(e)?null:Fa()(e))&&e.isValid()?e:null}(t),c=Xf(Object(r.useState)(null),2),u=c[0],d=c[1],m=Object(r.useMemo)(()=>s?s.format(Y.dateTimeFormat):null,[s]);return Object(r.useEffect)(()=>{function e(){d(s?s.fromNow():a)}if(e(),o){var t=setInterval(e,3e4);return()=>clearInterval(t)}},[o,s,a]),"timeAgoInTooltip"===i?n.a.createElement(we,{title:u},n.a.createElement("span",{"data-test":"TimeAgo"},m)):n.a.createElement(we,{title:m},n.a.createElement("span",{"data-test":"TimeAgo"},u))}function tg(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ag(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ag(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ag(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}Jf.isRequired=Object(l.wrap)(!0,Gf),eg.propTypes={date:ae.a.oneOfType([ae.a.string,ae.a.number,ae.a.instanceOf(Date),Jf]),placeholder:ae.a.string,autoUpdate:ae.a.bool,variation:ae.a.oneOf(["timeAgoInTooltip"])},eg.defaultProps={date:null,placeholder:"",autoUpdate:!0};var rg={NEVER:"不自动刷新",SECONDS:"秒",MINUTES:"分钟",HOURS:"小时",DAYS:"天",WEEKS:"周",MILLISECONDS:"毫秒"},ng={SECONDS:"s",MINUTES:"m",HOURS:"h",DAYS:"d",WEEKS:"w",MILLISECONDS:"ms"};function og(e,t){if(!e)return"";var a=Fa()(e);return a.isValid()?a.format(t):"-"}function ig(e){return og(e,Y.dateTimeFormat)}function lg(e){return og(e,Y.dateFormat)}function sg(e){var t=tg(e.split(":"),2),a=t[0],r=t[1];return Fa.a.utc().hour(a).minute(r).local().format("HH:mm")}function cg(e){var t="CN"===window.W_L.language_mode?rg:ng;if(!e)return{interval:t.NEVER};var a=t.SECONDS;return e>=60&&(e/=60,a=t.MINUTES),e>=60&&(e/=60,a=t.HOURS),e>=24&&a===t.HOURS&&(e/=24,a=t.DAYS),e>=7&&!(e%7)&&a===t.DAYS&&(e/=7,a=t.WEEKS),{count:e,interval:a}}function ug(e,t){return e+""}function dg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return"-";var a="",r=cg(e),n=r.interval,o=r.count,i=Math.round(o);return 1===i&&t.omitSingleValueNumber||(a="".concat(i," ")),a+=ug(n)}function mg(e){return e.replace(/_/g," ").replace(/(?:^|\s)\S/g,e=>e.toUpperCase())}function pg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return Math.round(e)!==e?e.toFixed(t):e.toString()}function fg(e,t){return function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3?arguments[3]:void 0;if(isNaN(parseFloat(e))||!isFinite(e))return{value:"",unit:"",divisor:1};for(var n=0,o=1;e>=t&&n<a.length-1;)e/=t,o*=t,n+=1;return{value:pg(e,r),unit:a[n],divisor:o}}(e,1024,["bytes","KB","MB","GB","TB","PB"],t)}function gg(e){var t=fg(e),a=t.value,r=t.unit;return a?a+" "+r:"?"}function bg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Fa.a.isMoment(e)?"date"===t?lg(e):ig(e):"boolean"==typeof e?e.toString():e}function hg(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function yg(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?hg(Object(a),!0).forEach((function(t){vg(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):hg(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function vg(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function wg(){return(wg=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Og(){return Object(l.extend)(this(...arguments),{sorter:!0})}var _g={favorites:e=>Object(l.extend)({width:"1%",render:(e,t)=>n.a.createElement(Ff,{item:t})},e),avatar:(e,t)=>(t=Object(l.isFunction)(t)?t:l.identity,Object(l.extend)({width:"1%",render:(e,a)=>n.a.createElement("img",{src:a.user.profile_image_url,className:"profile__image_thumb",alt:t(e.name,a),title:t(e.name,a)})},e)),date:e=>Object(l.extend)({render:e=>lg(e)},e),dateTime:e=>Object(l.extend)({render:e=>ig(e)},e),duration:e=>Object(l.extend)({width:"1%",className:"text-nowrap",render:e=>dg(e)},e),timeAgo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return Object(l.extend)({render:e=>n.a.createElement(eg,wg({date:e},t))},e)},custom:(e,t)=>Object(l.extend)({render:e},t)};_g.date.sortable=Og,_g.dateTime.sortable=Og,_g.duration.sortable=Og,_g.timeAgo.sortable=Og,_g.custom.sortable=Og;class Eg extends n.a.Component{constructor(){super(...arguments),vg(this,"getRowKey",e=>{var t=this.props.rowKey;return t?Object(l.isFunction)(t)?t(e.item):e.item[t]:e.key})}prepareColumns(){var e=this.props,t=e.orderByField,a=e.orderByReverse,r=e.toggleSorting,n=a?"descend":"ascend";return Object(l.map)(Object(l.map)(Object(l.filter)(this.props.columns,e=>!Object(l.isFunction)(e.isAvailable)||e.isAvailable()),e=>Object(l.extend)(e,{orderByField:e.orderByField||e.field})),(e,a)=>{var o=e.sorter?()=>({onClick:()=>r(e.orderByField)}):null,i=Object(l.isFunction)(e.render)?(t,a)=>e.render(t,a.item):l.identity;return Object(l.extend)(Object(l.omit)(e,["field","orderByField","render"]),{key:"column"+a,dataIndex:["item",e.field],defaultSortOrder:e.orderByField===t?n:null,onHeaderCell:o,render:i})})}render(){var e={columns:this.prepareColumns(),dataSource:Object(l.map)(this.props.items,(e,t)=>({key:"row"+t,item:e}))},t=Object(l.isFunction)(this.props.onRowClick)?e=>({onClick:t=>{this.props.onRowClick(t,e.item)}}):null,a=this.props.showHeader;return this.props.loading&&(Object(l.isEmpty)(e.dataSource)?(e.columns=e.columns.map(e=>yg(yg({},e),{},{sorter:!1,render:()=>n.a.createElement(Mf.a,{active:!0,paragraph:!1})})),e.dataSource=Object(l.range)(10).map(e=>({key:"".concat(e)}))):e.loading={indicator:null}),n.a.createElement(Zl.a,wg({className:me()("table-data",{"ant-table-headerless":!a}),showHeader:a,rowKey:this.getRowKey,pagination:!1,onRow:t,"data-test":this.props["data-test"]},e))}}function jg(e){var t=e.title,a=e.value,r=e.loading;return n.a.createElement(Df.a,{spinning:r},n.a.createElement(vn.a,null,t,n.a.createElement("div",{className:"f-20"},a)))}vg(Eg,"propTypes",{loading:ae.a.bool,items:ae.a.arrayOf(ae.a.object),columns:ae.a.arrayOf(ae.a.shape({field:ae.a.string,orderByField:ae.a.string,render:ae.a.func,isAvailable:ae.a.func})),showHeader:ae.a.bool,onRowClick:ae.a.func,orderByField:ae.a.string,orderByReverse:ae.a.bool,toggleSorting:ae.a.func,"data-test":ae.a.string,rowKey:ae.a.oneOfType([ae.a.string,ae.a.func])}),vg(Eg,"defaultProps",{loading:!1,items:[],columns:[],showHeader:!0,onRowClick:null,orderByField:null,orderByReverse:!1,toggleSorting:()=>{}}),jg.propTypes={title:ae.a.string.isRequired,value:ae.a.oneOfType([ae.a.number,ae.a.string]),loading:ae.a.bool.isRequired},jg.defaultProps={value:""};var Sg=[{title:window.W_L.queue,dataIndex:"origin"},{title:window.W_L.query_id,dataIndex:["meta","query_id"]},{title:window.W_L.org_id,dataIndex:["meta","org_id"]},{title:window.W_L.data_source_id,dataIndex:["meta","data_source_id"]},{title:window.W_L.user_id,dataIndex:["meta","user_id"]},_g.custom(e=>e.toString(),{title:window.W_L.scheduled,dataIndex:["meta","scheduled"]}),_g.timeAgo({title:window.W_L.start_time,dataIndex:"started_at"}),_g.timeAgo({title:window.W_L.queue_time,dataIndex:"enqueued_at"})],Cg=[{title:window.W_L.queue,dataIndex:"origin"},{title:window.W_L.job_name,dataIndex:"name"},_g.timeAgo({title:window.W_L.start_time,dataIndex:"started_at"}),_g.timeAgo({title:window.W_L.queue_time,dataIndex:"enqueued_at"})],xg=[_g.custom(e=>n.a.createElement("span",null,n.a.createElement(If.a,{status:{busy:"processing",idle:"default",started:"success",suspended:"warning"}[e]})," ",e),{title:"State",dataIndex:"state"})].concat(Object(l.map)(["Hostname","PID","Name","Queues","Current Job","Successful Jobs","Failed Jobs"],e=>({title:e,dataIndex:e.toLowerCase().replace(/\s/g,"_")}))).concat([_g.dateTime({title:window.W_L.birth_date,dataIndex:"birth_date"}),_g.duration({title:window.W_L.total_work_time,dataIndex:"total_working_time"})]),Pg=Object(l.map)(["Name","Started","Queued"],e=>({title:e,dataIndex:e.toLowerCase()})),Lg={loading:ae.a.bool.isRequired,items:ae.a.arrayOf(ae.a.object).isRequired};function kg(e){var t=e.loading,a=e.items;return n.a.createElement(Zl.a,{loading:t,columns:xg,rowKey:"name",dataSource:a,pagination:{defaultPageSize:25,pageSizeOptions:["10","25","50"],showSizeChanger:!0}})}function Ng(e){var t=e.loading,a=e.items;return n.a.createElement(Zl.a,{loading:t,columns:Pg,rowKey:"name",dataSource:a,pagination:{defaultPageSize:25,pageSizeOptions:["10","25","50"],showSizeChanger:!0}})}function Ag(e){var t=e.loading,a=e.items;return n.a.createElement(Zl.a,{loading:t,columns:Sg,rowKey:"id",dataSource:a,pagination:{defaultPageSize:25,pageSizeOptions:["10","25","50"],showSizeChanger:!0}})}function Tg(e){var t=e.loading,a=e.items;return n.a.createElement(Zl.a,{loading:t,columns:Cg,rowKey:"id",dataSource:a,pagination:{defaultPageSize:25,pageSizeOptions:["10","25","50"],showSizeChanger:!0}})}function Wg(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ig(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ig(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ig(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function qg(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Dg(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?qg(Object(a),!0).forEach((function(t){Mg(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):qg(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Rg(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Mg(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}kg.propTypes=Lg,Ng.propTypes=Lg,Ag.propTypes=Lg,Tg.propTypes=Lg;class zg extends n.a.Component{constructor(){super(...arguments),Mg(this,"state",{activeTab:A.hash,isLoading:!0,error:null,queueCounters:[],overallCounters:{started:0,queued:0},startedJobs:[],workers:[]}),Mg(this,"_refreshTimer",null),Mg(this,"refresh",()=>{B.get("/api/admin/queries/rq_status").then(e=>this.processQueues(e)).catch(e=>this.handleError(e)),this._refreshTimer=setTimeout(this.refresh,6e4)}),Mg(this,"processQueues",e=>{var t=e.queues,a=e.workers,r=Object(l.values)(t).map(e=>{var t=e.started,a=Rg(e,["started"]);return Dg({started:t.length},a)}),n=r.reduce((e,t)=>({started:e.started+t.started,queued:e.queued+t.queued}),{started:0,queued:0}),o=Object(l.flatMap)(Object(l.values)(t),e=>e.started.map(e=>Dg(Dg({},e),{},{enqueued_at:Fa.a.utc(e.enqueued_at),started_at:Fa.a.utc(e.started_at)})));this.setState({isLoading:!1,queueCounters:r,startedJobs:o,overallCounters:n,workers:a})}),Mg(this,"handleError",e=>{this.setState({isLoading:!1,error:e})})}componentDidMount(){La("view","page","admin/rq_status"),this.refresh()}componentWillUnmount(){clearTimeout(this._refreshTimer),this.processQueues=()=>{},this.handleError=()=>{}}render(){var e=this.state,t=e.isLoading,a=e.error,r=e.queueCounters,o=e.startedJobs,i=e.overallCounters,s=e.workers,c=e.activeTab,d=Wg(Object(l.partition)(o,["name","redash.tasks.queries.execution.execute_query"]),2),m=d[0],p=d[1];return n.a.createElement(Tf,{activeTab:"jobs"},n.a.createElement("div",{className:"p-15"},a&&n.a.createElement(u.a,{type:"error",message:window.W_L.loading_failed}),!a&&n.a.createElement(n.a.Fragment,null,n.a.createElement(io.Row,{gutter:15,className:"m-b-15"},n.a.createElement(io.Col,{span:8},n.a.createElement(jg,{title:window.W_L.started_job,value:i.started,loading:t})),n.a.createElement(io.Col,{span:8},n.a.createElement(jg,{title:window.W_L.queen_job,value:i.queued,loading:t}))),n.a.createElement(bo.a,{activeKey:c||"queues",onTabClick:e=>{A.setHash(e),this.setState({activeTab:e})},animated:!1},n.a.createElement(bo.a.TabPane,{key:"queues",tab:"Queues"},n.a.createElement(Ng,{loading:t,items:r})),n.a.createElement(bo.a.TabPane,{key:"workers",tab:"Workers"},n.a.createElement(kg,{loading:t,items:s})),n.a.createElement(bo.a.TabPane,{key:"queries",tab:"Queries"},n.a.createElement(Ag,{loading:t,items:m})),n.a.createElement(bo.a.TabPane,{key:"other",tab:"Other Jobs"},n.a.createElement(Tg,{loading:t,items:p}))))))}}_f.register("Admin.Jobs",ha({path:"/admin/queries/jobs",title:window.W_L.queen_status,render:e=>n.a.createElement(zg,e)}));function Fg(e){var t=e.page,a=e.showPageSizeSelect,r=e.pageSize,o=e.onPageSizeChange,i=e.totalCount,l=e.onChange;return i<=(a?5:r)?null:n.a.createElement("div",{className:"paginator-container"},n.a.createElement(mu.a,{showSizeChanger:a,pageSizeOptions:["5","10","20","50","100"],onShowSizeChange:(e,t)=>o(t),defaultCurrent:t,pageSize:r,total:i,onChange:l}))}function Vg(){return(Vg=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ug(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Bg(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Bg(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Bg(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Hg(e){var t=e.dialog,a=e.tags,o=e.getAvailableTags,i=Ug(Object(r.useState)([]),2),s=i[0],c=i[1],u=Ug(Object(r.useState)(!0),2),d=u[0],m=u[1],p=Ug(Object(r.useState)(()=>Object(l.uniq)(Object(l.map)(a,l.trim))),2),f=p[0],g=p[1],b=Ug(Object(r.useState)(null),2),h=b[0],y=b[1];return Object(r.useEffect)(()=>{h&&!d&&h.focus()},[h,d]),Object(r.useEffect)(()=>{var e=!1;return o().then(t=>{e||(c(Object(l.uniq)(Object(l.compact)(Object(l.map)(t,l.trim)))),m(!1))}),()=>{e=!0}},[o]),n.a.createElement(R.a,Vg({},t.props,{onOk:()=>t.close(f),title:window.W_L.add_edit_tag,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,className:"shortModal",wrapProps:{"data-test":"EditTagsDialog"}}),n.a.createElement(dn.a,{ref:y,mode:"tags",className:"w-100",placeholder:window.W_L.add_more_tag,defaultValue:f,onChange:e=>g(Object(l.compact)(Object(l.map)(e,l.trim))),disabled:d,loading:d},Object(l.map)(s,e=>n.a.createElement(dn.a.Option,{key:e},e))))}Fg.propTypes={page:ae.a.number.isRequired,showPageSizeSelect:ae.a.bool,pageSize:ae.a.number.isRequired,totalCount:ae.a.number.isRequired,onPageSizeChange:ae.a.func,onChange:ae.a.func},Fg.defaultProps={showPageSizeSelect:!1,onChange:()=>{},onPageSizeChange:()=>{}},Hg.propTypes={dialog:ja.isRequired,tags:ae.a.arrayOf(ae.a.string),getAvailableTags:ae.a.func.isRequired},Hg.defaultProps={tags:[]};var Yg=Sa(Hg);function Qg(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Kg(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class $g extends n.a.Component{constructor(){super(...arguments),Kg(this,"editTags",(e,t)=>{Yg.showModal({tags:e,getAvailableTags:t}).onClose(this.props.onEdit)})}renderEditButton(){var e=Object(l.map)(this.props.tags,l.trim);return n.a.createElement(ge,{className:"label label-tag hidden-xs",onClick:()=>this.editTags(e,this.props.getAvailableTags),"data-test":"EditTagsButton"},0===e.length&&n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"zmdi zmdi-plus m-r-5","aria-hidden":"true"}),window.W_L.add_tag),e.length>0&&n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"zmdi zmdi-edit","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Edit")))}render(){var e=this.props,t=e.tags,a=e.tagSeparator;return n.a.createElement("div",{className:"tags-control "+this.props.className,"data-test":"TagsControl"},this.props.children,Object(l.map)(t,(e,t)=>n.a.createElement(n.a.Fragment,{key:e},a&&t>0&&n.a.createElement("span",{className:"tag-separator"},a),n.a.createElement("span",{className:"label label-tag",key:e,title:e,"data-test":"TagLabel"},e))),this.props.canEdit&&this.renderEditButton(),this.props.tagsExtra)}}function Gg(e){var t=e.archivedTooltip;function a(e){var a=e.isDraft,r=e.isArchived,o=Qg(e,["isDraft","isArchived"]);return n.a.createElement($g,o,!r&&a&&n.a.createElement("span",{className:"label label-tag-unpublished"},window.W_L.draft),r&&n.a.createElement(we,{placement:"right",title:t},n.a.createElement("span",{className:"label label-tag-archived"},window.W_L.archived)))}return a.propTypes={isDraft:ae.a.bool,isArchived:ae.a.bool},a.defaultProps={isDraft:!1,isArchived:!1},a}Kg($g,"propTypes",{tags:ae.a.arrayOf(ae.a.string),canEdit:ae.a.bool,getAvailableTags:ae.a.func,onEdit:ae.a.func,className:ae.a.string,tagsExtra:ae.a.node,tagSeparator:ae.a.node,children:ae.a.node}),Kg($g,"defaultProps",{tags:[],canEdit:!1,getAvailableTags:()=>Promise.resolve([]),onEdit:()=>{},className:"",tagsExtra:null,tagSeparator:null,children:null});var Jg=Gg({archivedTooltip:window.W_L.archived_info}),Xg=Gg({archivedTooltip:window.W_L.archived_info});a(591);function Zg(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return eb(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return eb(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eb(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function tb(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class ab extends n.a.Component{get content(){var e=(this.props.schedule||ab.defaultProps.schedule).interval;if(!e)return[window.W_L.flush_never];var t=dg(e,{omitSingleValueNumber:!0}),a=window.W_L.every+"".concat(t),r=window.W_L.every+"".concat(t)+window.W_L.auto_flush,n=this.props.schedule,o=n.time,i=n.day_of_week;return o&&(r+=window.W_L.at+"  ".concat(sg(o))),i&&(r+=window.W_L.on+"  ".concat(i)),[a,r]}render(){if(this.props.isNew)return window.W_L.flush_never;var e=Zg(this.content,2),t=e[0],a=e[1],r=a?n.a.createElement(we,{title:a},t):t;return this.props.isLink?n.a.createElement(ge,{type:"link",className:"schedule-phrase",onClick:this.props.onClick,"data-test":"EditSchedule"},r):r}}function rb(){return(rb=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function nb(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function ob(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function ib(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ob(Object(a),!0).forEach((function(t){lb(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ob(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function lb(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}tb(ab,"propTypes",{schedule:Uf,isNew:ae.a.bool.isRequired,isLink:ae.a.bool,onClick:ae.a.func}),tb(ab,"defaultProps",{schedule:Bf,isLink:!1,onClick:()=>{}});var sb=ae.a.shape({params:ae.a.object.isRequired,isLoaded:ae.a.bool.isRequired,isEmpty:ae.a.bool.isRequired,searchTerm:ae.a.string,updateSearch:ae.a.func.isRequired,selectedTags:ae.a.array.isRequired,updateSelectedTags:ae.a.func.isRequired,orderByField:ae.a.string,orderByReverse:ae.a.bool.isRequired,toggleSorting:ae.a.func.isRequired,page:ae.a.number.isRequired,itemsPerPage:ae.a.number.isRequired,totalItemsCount:ae.a.number.isRequired,pageSizeOptions:ae.a.arrayOf(ae.a.number).isRequired,pageItems:ae.a.array.isRequired,updatePagination:ae.a.func.isRequired,handleError:ae.a.func.isRequired});function cb(e,t,a){class r extends n.a.Component{constructor(e){super(e),lb(this,"_itemsSource",void 0);var r=a(),n=t();this._itemsSource=n,n.setState(ib(ib({},r.getState()),{},{validate:!1})),n.getCallbackContext=()=>this.state,n.onBeforeUpdate=()=>{var e=n.getState();r.setState(e),this.setState(this.getState(ib(ib({},e),{},{isLoaded:!1})))},n.onAfterUpdate=()=>{var e=n.getState();this.setState(this.getState(ib(ib({},e),{},{isLoaded:!0})))},n.onError=e=>this.props.onError(e);var o=this.getState(ib(ib({},n.getState()),{},{isLoaded:!1})),i=n.updatePagination,s=n.toggleSorting,c=n.updateSearch,u=n.updateSelectedTags,d=n.update,m=n.handleError;this.state=ib(ib({},o),{},{toggleSorting:s,updateSearch:Object(l.debounce)(c,200),updateSelectedTags:u,updatePagination:i,update:d,handleError:m})}componentDidMount(){this.state.update()}componentWillUnmount(){this._itemsSource.onBeforeUpdate=()=>{},this._itemsSource.onAfterUpdate=()=>{},this._itemsSource.onError=()=>{}}getState(e){var t=e.isLoaded,a=e.totalCount,r=e.pageItems,n=e.params;return ib(ib({},nb(e,["isLoaded","totalCount","pageItems","params"])),{},{params:ib(ib({},n),Object(l.omit)(this.props,["onError","children"])),isLoaded:t,isEmpty:!t||0===a,totalItemsCount:a||0,pageSizeOptions:Y.pageSizeOptions,pageItems:r||[]})}render(){var t=this.props,a=t.children,r=(t.onError,nb(t,["children","onError"]));return n.a.createElement(e,rb({},r,{controller:this.state}),a)}}return lb(r,"propTypes",{onError:ae.a.func,children:ae.a.node}),lb(r,"defaultProps",{onError:e=>{setTimeout(()=>{throw e})},children:null}),oo()(r,e),r}function ub(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class db{get totalPages(){return Math.ceil(this.totalCount/this.itemsPerPage)}setPage(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(l.isUndefined)(e)||(e=parseInt(e,10)||1,this.page=t?e>=1&&e<=this.totalPages?e:1:e>=1?e:1)}setItemsPerPage(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(l.isUndefined)(e)||(e=parseInt(e,10)||20,this.itemsPerPage=e>=1?e:1,t&&this.setPage(this.page,t))}setTotalCount(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(l.isUndefined)(e)||(e=parseInt(e,10)||0,this.totalCount=e,t&&this.setPage(this.page,t))}constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.page,a=e.itemsPerPage,r=e.totalCount,n=e.validate,o=void 0===n||n;ub(this,"page",1),ub(this,"itemsPerPage",20),ub(this,"totalCount",0),this.setItemsPerPage(a,o),this.setTotalCount(r,o),this.setPage(t,o)}getItemsForPage(e){var t=this.itemsPerPage*(this.page-1),a=t+this.itemsPerPage;return e.slice(t,a)}}function mb(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function pb(e,t){return e?t?"-"+e:e:null}function fb(e){var t=(e=Object(l.isString)(e)?e:"").startsWith("-");return t&&(e=e.substring(1)),{field:""!==e?e:null,reverse:t}}class gb{get compiled(){return pb(this.field,this.reverse)}set compiled(e){var t=fb(e),a=t.field,r=t.reverse;this.field=a,this.reverse=r}setField(e){this.field=Object(l.isString)(e)&&""!==e?e:null}setReverse(e){this.reverse=!!e}constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.orderByField,a=e.orderByReverse,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;mb(this,"field",null),mb(this,"reverse",!1),mb(this,"sortByIteratees",null),this.setField(t),this.setReverse(a),this.sortByIteratees=r}toggleField(e){Object(l.isString)(e)&&""!==e&&(e===this.field?this.reverse=!this.reverse:(this.field=e,this.reverse=!1))}sort(e){if(this.field){var t=this.sortByIteratees&&this.sortByIteratees[this.field];return e=Object(l.sortBy)(e,t?[t]:this.field),this.reverse&&e.reverse(),e}}}class bb{_getRequest(e,t){return this._originalGetRequest({},t)}_processResults(e,t,a){var r=e.results,n=e.count;return{results:this._originalProcessResults(r,a),count:n}}constructor(e){var t=e.getRequest,a=e.doRequest,r=e.processResults;this._originalGetRequest=Object(l.isFunction)(t)?t:l.identity,this._originalDoRequest=a,this._originalProcessResults=Object(l.isFunction)(r)?r:l.identity}fetch(e,t,a){var r=this._getRequest(t,a);return this._originalDoRequest(r,a).then(e=>this._processResults(e,t,a))}}class hb extends bb{constructor(){super(...arguments),function(e,t,a){t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a}(this,"_allItems",[])}_getRequest(e,t){var a=e.searchTerm,r=e.selectedTags;return this._originalGetRequest({q:Object(l.isString)(a)&&""!==a?a:void 0,tags:r},t)}_processResults(e,t,a){var r=t.paginator,n=t.sorter;return this._allItems=this._originalProcessResults(e,a),this._allItems=n.sort(this._allItems),{results:r.getItemsForPage(this._allItems),count:this._allItems.length,allResults:this._allItems}}fetch(e,t,a){if(Object(l.isNil)(e)||e.tags||e.sorting)return super.fetch(e,t,a);var r=t.paginator,n=t.sorter;return e.sorting&&(this._allItems=n.sort(this._allItems)),Promise.resolve({results:r.getItemsForPage(this._allItems),count:this._allItems.length,allResults:this._allItems})}}class yb extends bb{_getRequest(e,t){var a=e.paginator,r=e.sorter,n=e.searchTerm,o=e.selectedTags;return this._originalGetRequest({page:a.page,page_size:a.itemsPerPage,order:r.compiled,q:Object(l.isString)(n)&&""!==n?n:void 0,tags:o},t)}}function vb(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function wb(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Ob(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?wb(Object(a),!0).forEach((function(t){_b(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):wb(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function _b(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Eb{_beforeUpdate(){return Object(l.isFunction)(this.onBeforeUpdate)?Promise.resolve(this.onBeforeUpdate(this.getState(),this.getCallbackContext())):Promise.resolve()}_afterUpdate(){return Object(l.isFunction)(this.onAfterUpdate)?Promise.resolve(this.onAfterUpdate(this.getState(),this.getCallbackContext())):Promise.resolve()}_changed(e){var t={paginator:this._paginator,sorter:this._sorter,searchTerm:this._searchTerm,selectedTags:this._selectedTags},a={},r=Ob(Ob({},this.getCallbackContext()),{},{setCustomParams:e=>{Object(l.extend)(a,e)}});return this._beforeUpdate().then(()=>{var n=Math.random().toString(36).substr(2);return this._currentFetchToken=n,this._fetcher.fetch(e,t,r).then(e=>{var t=e.results,r=e.count,o=e.allResults;if(this._currentFetchToken===n)return this._pageItems=t,this._allItems=o||null,this._paginator.setTotalCount(r),this._params=Ob(Ob({},this._params),a),this._afterUpdate()}).catch(e=>this.handleError(e))})}constructor(e){var t=e.getRequest,a=e.doRequest,r=e.processResults,n=e.isPlainList,o=void 0!==n&&n,i=e.sortByIteratees,s=void 0===i?void 0:i,c=vb(e,["getRequest","doRequest","processResults","isPlainList","sortByIteratees"]);_b(this,"onBeforeUpdate",null),_b(this,"onAfterUpdate",null),_b(this,"onError",null),_b(this,"sortByIteratees",void 0),_b(this,"getCallbackContext",()=>null),_b(this,"updatePagination",e=>{var t=e.page,a=e.itemsPerPage,r=this._paginator,n=r.page,o=r.itemsPerPage;this._paginator.setItemsPerPage(a),this._paginator.setPage(t),this._changed({pagination:{page:n!==this._paginator.page,itemsPerPage:o!==this._paginator.itemsPerPage}})}),_b(this,"toggleSorting",e=>{this._sorter.toggleField(e),this._savedOrderByField=this._sorter.field,this._changed({sorting:!0})}),_b(this,"updateSearch",e=>{this._searchTerm=e,""===e?this._sorter.setField(this._savedOrderByField):this._sorter.setField(null),this._paginator.setPage(1),this._changed({search:!0,pagination:{page:!0}})}),_b(this,"updateSelectedTags",e=>{this._selectedTags=e,this._paginator.setPage(1),this._changed({tags:!0,pagination:{page:!0}})}),_b(this,"update",()=>this._changed()),_b(this,"handleError",e=>{Object(l.isFunction)(this.onError)&&this.onError(e)}),Object(l.isFunction)(t)||(t=l.identity),this._fetcher=o?new hb({getRequest:t,doRequest:a,processResults:r}):new yb({getRequest:t,doRequest:a,processResults:r}),this.sortByIteratees=s,this.setState(c),this._pageItems=[],this._params={}}getState(){return{page:this._paginator.page,itemsPerPage:this._paginator.itemsPerPage,orderByField:this._sorter.field,orderByReverse:this._sorter.reverse,searchTerm:this._searchTerm,selectedTags:this._selectedTags,totalCount:this._paginator.totalCount,pageItems:this._pageItems,allItems:this._allItems,params:this._params}}setState(e){this._paginator=new db(e),this._sorter=new gb(e,this.sortByIteratees),this._searchTerm=e.searchTerm||"",this._selectedTags=e.selectedTags||[],this._savedOrderByField=this._sorter.field}}class jb extends Eb{constructor(e){var t=e.getResource,a=e.getItemProcessor,r=vb(e,["getResource","getItemProcessor"]);a=Object(l.isFunction)(a)?a:()=>null,super(Ob(Ob({},r),{},{doRequest:(e,a)=>t(a)(e),processResults:(e,t)=>{var r=a(t);return r=Object(l.isFunction)(r)?r:l.identity,Object(l.map)(e,e=>r(e,t))}}))}}function Sb(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Cb(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class xb{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._state=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Sb(Object(a),!0).forEach((function(t){Cb(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Sb(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e)}getState(){return Object(l.defaults)(this._state,{page:1,itemsPerPage:Y.pageSize,orderByField:"created_at",orderByReverse:!1,searchTerm:"",tags:[]})}setState(){}}class Pb extends xb{getState(){var e=super.getState(),t=A.search,a=t.q||"",r=""!==a?"":pb(e.orderByField,e.orderByReverse),n=fb(t.order||r),o=n.field,i=n.reverse;return{page:parseInt(t.page,10)||e.page,itemsPerPage:parseInt(t.page_size,10)||e.itemsPerPage,orderByField:o,orderByReverse:i,searchTerm:a}}setState(e){var t=e.page,a=e.itemsPerPage,r=e.orderByField,n=e.orderByReverse,o=e.searchTerm;A.setSearch({page:t,page_size:a,order:pb(r,n),q:""!==o?o:null},!0)}}function Lb(){return(Lb=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function kb(e){return n.a.createElement("div",{className:"text-center"},n.a.createElement(xe,Lb({icon:"fa-spinner fa-2x fa-pulse",message:window.W_L.loading},e)))}function Nb(){return(Nb=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ab(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Tb extends n.a.Component{constructor(){var e;super(...arguments),e=this,Ab(this,"listColumns",[{title:"ID",field:"id",width:"1%",align:"right",sorter:!0},_g.custom.sortable((e,t)=>n.a.createElement(n.a.Fragment,null,n.a.createElement(h,{className:"table-main-title",href:"queries/"+t.id},t.name),n.a.createElement(Jg,{className:"d-block",tags:t.tags,isDraft:t.is_draft,isArchived:t.is_archived})),{title:window.W_L.name,field:"name",width:null}),_g.avatar({field:"user",className:"p-l-0 p-r-0"},e=>window.W_L.create_user+" ".concat(e)),_g.dateTime.sortable({title:window.W_L.create_time,field:"created_at"}),_g.duration.sortable({title:window.W_L.run_time,field:"runtime"}),_g.dateTime.sortable({title:window.W_L.last_exec_datetime,field:"retrieved_at",orderByField:"executed_at"}),_g.custom.sortable((e,t)=>n.a.createElement(ab,{schedule:t.schedule,isNew:t.isNew()}),{title:window.W_L.update_schedule,field:"schedule"})]),Ab(this,"state",{autoUpdate:!0}),Ab(this,"_updateTimer",null),Ab(this,"autoUpdateSwitchId",Object(l.uniqueId)("auto-update-switch")),Ab(this,"update",(function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!t&&e.state.autoUpdate&&e.props.controller.update(),e._updateTimer=setTimeout(e.update,6e4)}))}componentDidMount(){La("view","page","admin/queries/outdated"),this.update(!0)}componentWillUnmount(){clearTimeout(this._updateTimer)}render(){var e=this.props.controller;return n.a.createElement(Tf,{activeTab:e.params.currentPage},n.a.createElement("div",{className:"m-15"},n.a.createElement("div",null,n.a.createElement("label",{htmlFor:this.autoUpdateSwitchId,className:"m-0"},window.W_L.auto_update),n.a.createElement(xo.a,{id:this.autoUpdateSwitchId,className:"m-l-10",checked:this.state.autoUpdate,onChange:e=>this.setState({autoUpdate:e})})),e.params.lastUpdatedAt&&n.a.createElement("div",{className:"m-t-5"},window.W_L.last_update_time,"：",n.a.createElement(eg,{date:1e3*e.params.lastUpdatedAt}))),!e.isLoaded&&n.a.createElement(kb,null),e.isLoaded&&e.isEmpty&&n.a.createElement("div",{className:"text-center p-15"},"There are no outdated queries."),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"bg-white tiled table-responsive"},n.a.createElement(Eg,{items:e.pageItems,columns:this.listColumns,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Fg,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))}}Ab(Tb,"propTypes",{controller:sb.isRequired});var Wb=cb(Tb,()=>new Eb({doRequest:(e,t)=>B.get("/api/admin/queries/outdated").then(e=>{var a=e.queries,r=e.updated_at;return t.setCustomParams({lastUpdatedAt:parseFloat(r)}),a}),processResults:e=>Object(l.map)(e,e=>new hr(e)),isPlainList:!0}),()=>new xb({orderByField:"created_at",orderByReverse:!0}));_f.register("Admin.OutdatedQueries",ha({path:"/admin/queries/outdated",title:window.W_L.out_date_query,render:e=>n.a.createElement(Wb,Nb({},e,{currentPage:"outdated_queries"}))}));var Ib=a(67),qb=a.n(Ib);function Db(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Rb(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Rb(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Rb(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Mb(e){var t=e.info;return t=Object(l.toPairs)(t),n.a.createElement(vn.a,{title:window.W_L.general,size:"small"},0===t.length&&n.a.createElement("div",{className:"text-muted text-center"},window.W_L.no_data),t.length>0&&n.a.createElement(qb.a,{size:"small",itemLayout:"vertical",dataSource:t,renderItem:e=>{var t=Db(e,2),a=t[0],r=t[1];return n.a.createElement(qb.a.Item,{extra:n.a.createElement("span",{className:"badge"},r)},mg(a))}}))}function zb(e){var t=e.info;return n.a.createElement(vn.a,{title:window.W_L.database,size:"small"},0===t.length&&n.a.createElement("div",{className:"text-muted text-center"},window.W_L.no_data),t.length>0&&n.a.createElement(qb.a,{size:"small",itemLayout:"vertical",dataSource:t,renderItem:e=>{var t=Db(e,2),a=t[0],r=t[1];return n.a.createElement(qb.a.Item,{extra:n.a.createElement("span",{className:"badge"},gg(r))},a)}}))}function Fb(e){var t=e.info;return t=Object(l.toPairs)(t),n.a.createElement(vn.a,{title:window.W_L.queue,size:"small"},0===t.length&&n.a.createElement("div",{className:"text-muted text-center"},window.W_L.no_data),t.length>0&&n.a.createElement(qb.a,{size:"small",itemLayout:"vertical",dataSource:t,renderItem:e=>{var t=Db(e,2),a=t[0],r=t[1];return n.a.createElement(qb.a.Item,{extra:n.a.createElement("span",{className:"badge"},r.size)},a)}}))}function Vb(e){var t=e.info,a=t?[n.a.createElement(qb.a.Item,{extra:n.a.createElement("span",{className:"badge"},n.a.createElement(eg,{date:t.lastRefreshAt,placeholder:"n/a"}))},window.W_L.last_fresh),n.a.createElement(qb.a.Item,{extra:n.a.createElement("span",{className:"badge"},n.a.createElement(eg,{date:t.startedAt,placeholder:"n/a"}))},window.W_L.started),n.a.createElement(qb.a.Item,{extra:n.a.createElement("span",{className:"badge"},t.outdatedQueriesCount)},window.W_L.outdated_query_count)]:[];return n.a.createElement(vn.a,{title:window.W_L.manage,size:"small"},!t&&n.a.createElement("div",{className:"text-muted text-center"},window.W_L.no_data),t&&n.a.createElement(qb.a,{size:"small",itemLayout:"vertical",dataSource:a,renderItem:e=>e}))}a(1317);function Ub(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Bb extends n.a.Component{constructor(){super(...arguments),Ub(this,"state",{queues:[],manager:null,databaseMetrics:{},status:{}}),Ub(this,"_refreshTimer",null),Ub(this,"refresh",()=>{B.get("/status.json").then(e=>{this.setState({queues:e.manager.queues,manager:{startedAt:1e3*e.manager.started_at,lastRefreshAt:1e3*e.manager.last_refresh_at,outdatedQueriesCount:e.manager.outdated_queries_count},databaseMetrics:e.database_metrics.metrics||[],status:Object(l.omit)(e,["workers","manager","database_metrics"])})}).catch(e=>this.props.onError(e)),this._refreshTimer=setTimeout(this.refresh,6e4)})}componentDidMount(){La("view","page","admin/status"),this.refresh()}componentWillUnmount(){clearTimeout(this._refreshTimer)}render(){return n.a.createElement(Tf,{activeTab:"system_status"},n.a.createElement("div",{className:"system-status-page"},n.a.createElement("div",{className:"system-status-page-blocks"},n.a.createElement("div",{className:"system-status-page-block"},n.a.createElement(Mb,{info:this.state.status})),n.a.createElement("div",{className:"system-status-page-block"},n.a.createElement(Vb,{info:this.state.manager})),n.a.createElement("div",{className:"system-status-page-block"},n.a.createElement(Fb,{info:this.state.queues})),n.a.createElement("div",{className:"system-status-page-block"},n.a.createElement(zb,{info:this.state.databaseMetrics})))))}}function Hb(){return(Hb=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}Ub(Bb,"propTypes",{onError:ae.a.func}),Ub(Bb,"defaultProps",{onError:()=>{}}),_f.register("Admin.SystemStatus",ha({path:"/admin/status",title:window.W_L.out_date_query,render:e=>n.a.createElement(Bb,e)}));var Yb={"greater than":">","less than":"<",equals:"="},Qb=e=>Object(l.merge)({},e,{options:{op:Yb[e.options.op]||e.options.op}}),Kb={query:()=>B.get("api/alerts"),get:e=>{var t=e.id;return B.get("api/alerts/".concat(t)).then(Qb)},save:e=>B.post((e=>e.id?"api/alerts/".concat(e.id):"api/alerts")(e),(e=>{var t=Hb({},e);return void 0===t.query_id&&(t.query_id=t.query.id,t.destination_id=t.destinations,delete t.query,delete t.destinations),t})(e)),delete:e=>B.delete("api/alerts/".concat(e.id)),mute:e=>B.post("api/alerts/".concat(e.id,"/mute")),unmute:e=>B.delete("api/alerts/".concat(e.id,"/mute"))};function $b(){return($b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Gb(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Jb={unknown:"label-warning",ok:"label-success",triggered:"label-danger"};class Xb extends n.a.Component{constructor(){super(...arguments),Gb(this,"listColumns",[_g.custom.sortable((e,t)=>n.a.createElement("span",{title:t.options.muted?"Muted":"Active"},n.a.createElement("i",{className:"fa fa-bell-".concat(t.options.muted?"slash":"o"," p-r-0"),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},t.options.muted?"Muted":"Active")),{title:n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-bell p-r-0","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Sort by notification status.")),field:"muted",width:"1%"}),_g.custom.sortable((e,t)=>n.a.createElement("div",null,n.a.createElement(h,{className:"table-main-title",href:"alerts/"+t.id},t.name)),{title:window.W_L.name,field:"name"}),_g.custom((e,t)=>t.user.name,{title:window.W_L.create_user,width:"1%"}),_g.custom.sortable((e,t)=>n.a.createElement("div",null,n.a.createElement("span",{className:"label ".concat(Jb[t.state])},Object(l.toUpper)(t.state))),{title:window.W_L.status,field:"state",width:"1%",className:"text-nowrap"}),_g.timeAgo.sortable({title:window.W_L.last_update_time,field:"updated_at",width:"1%"}),_g.dateTime.sortable({title:window.W_L.create_time,field:"created_at",width:"1%"})])}render(){var e=this.props.controller;return n.a.createElement("div",{className:"page-alerts-list"},n.a.createElement("div",{className:"container"},n.a.createElement(Af,{title:e.params.pageTitle,actions:H.hasPermission("list_alerts")?n.a.createElement(h.Button,{block:!0,type:"primary",href:"alerts/new"},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.new_alert):null}),n.a.createElement("div",null,e.isLoaded&&e.isEmpty?n.a.createElement(se,{name:"AlertsList.EmptyState"},n.a.createElement(af,{icon:"fa fa-bell-o",illustration:"alert",description:window.W_L.get_notice_event,helpMessage:n.a.createElement(ef,{helpTriggerType:"ALERTS"}),showAlertStep:!0})):n.a.createElement("div",{className:"table-responsive bg-white tiled"},n.a.createElement(Eg,{loading:!e.isLoaded,items:e.pageItems,columns:this.listColumns,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Fg,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))))}}Gb(Xb,"propTypes",{controller:sb.isRequired});var Zb=cb(Xb,()=>new jb({isPlainList:!0,getRequest:()=>({}),getResource:()=>Kb.query.bind(Kb)}),()=>new xb({orderByField:"created_at",orderByReverse:!0,itemsPerPage:20}));_f.register("Alerts.List",ha({path:"/alerts",title:window.W_L.alerts,render:e=>n.a.createElement(Zb,$b({},e,{currentPage:"alerts"}))}));var eh=a(127),th=a.n(eh);function ah(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return rh(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return rh(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rh(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function nh(e){var t=e.doDelete,a=e.canEdit,o=e.mute,i=e.unmute,l=e.muted,s=ah(Object(r.useState)(!1),2),c=s[0],u=s[1],d=Object(r.useCallback)(e=>{u(!0),e().finally(()=>{u(!1)})},[]),p=Object(r.useCallback)(()=>{R.a.confirm({title:window.W_L.delete_alert,content:window.W_L.delete_alert_confirm,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,okType:"danger",onOk:()=>{u(!0),t().catch(()=>{u(!1)})},maskClosable:!0,autoFocusButton:null})},[t]);return n.a.createElement(aa.a,{className:me()("m-l-5",{disabled:!a}),trigger:[a?"click":void 0],placement:"bottomRight",overlay:n.a.createElement(ue.a,null,n.a.createElement(ue.a.Item,null,l?n.a.createElement(ge,{onClick:()=>d(i)},window.W_L.alert_unmute):n.a.createElement(ge,{onClick:()=>d(o)},window.W_L.alert_mute)),n.a.createElement(ue.a.Item,null,n.a.createElement(ge,{onClick:p},window.W_L.delete)))},n.a.createElement(m.a,{"aria-label":"More actions"},c?n.a.createElement(jf.a,null):n.a.createElement(th.a,{rotate:90,"aria-hidden":"true"})))}nh.propTypes={doDelete:ae.a.func.isRequired,canEdit:ae.a.bool.isRequired,mute:ae.a.func.isRequired,unmute:ae.a.func.isRequired,muted:ae.a.bool},nh.defaultProps={muted:!1};var oh=a(25),ih=a.n(oh);a(1318);function lh(e){var t=e.alert,a=e.editMode,r=e.name,o=e.onChange,i=e.children,l=vy(t);return n.a.createElement("div",{className:"alert-header"},n.a.createElement("div",{className:"alert-title"},n.a.createElement("h3",null,a&&t.query?n.a.createElement(va.a,{className:"f-inherit",placeholder:l,value:r,"aria-label":"Alert title",onChange:e=>o(e.target.value)}):r||l)),n.a.createElement("div",{className:"alert-actions"},i))}lh.propTypes={alert:$f.isRequired,name:ae.a.string,children:ae.a.node,onChange:ae.a.func,editMode:ae.a.bool},lh.defaultProps={name:null,children:null,onChange:null,editMode:!1};var sh=a(209),ch=a.n(sh),uh=a(131),dh=a.n(uh),mh=(a(1319),{">":">",">=":"≥","<":"<","<=":"≤","==":"=","!=":"≠"}),ph=["==","!="];function fh(e){var t=e.children,a=e.minWidth;return n.a.createElement("div",{className:"criteria-disabled-input",style:{minWidth:a}},t)}function gh(e){var t=e.columnNames,a=e.resultValues,r=e.alertOptions,o=e.onChange,i=e.editMode,s=Object(l.isEmpty)(a)?null:Object(l.head)(a)[r.column],c=Object(l.includes)(ph,r.op)?null:isNaN(r.value)?window.W_L.type_not_match_value:isNaN(s)?window.W_L.type_not_match_condition:null,u=n.a.createElement("small",{className:"alert-criteria-hint"},window.W_L.top_value," ",n.a.createElement("code",{className:"p-0"},Object(l.toString)(s)||"unknown"));return n.a.createElement("div",{"data-test":"Criteria"},n.a.createElement("div",{className:"input-title"},n.a.createElement("span",{className:"input-label"},window.W_L.column_value),i?n.a.createElement(dn.a,{value:r.column,onChange:e=>o({column:e}),dropdownMatchSelectWidth:!1,style:{minWidth:100}},t.map(e=>n.a.createElement(dn.a.Option,{key:e},e))):n.a.createElement(fh,{minWidth:70},r.column)),n.a.createElement("div",{className:"input-title"},n.a.createElement("span",{className:"input-label"},window.W_L.condition),i?n.a.createElement(dn.a,{value:r.op,onChange:e=>o({op:e}),optionLabelProp:"label",dropdownMatchSelectWidth:!1,style:{width:55}},n.a.createElement(dn.a.Option,{value:">",label:mh[">"]},mh[">"]," ",window.W_L.great_then),n.a.createElement(dn.a.Option,{value:">=",label:mh[">="]},mh[">="]," ",window.W_L.great_and_equals),n.a.createElement(dn.a.Option,{disabled:!0,key:"dv1"},n.a.createElement(dh.a,{className:"select-option-divider m-t-10 m-b-5"})),n.a.createElement(dn.a.Option,{value:"<",label:mh["<"]},mh["<"]," ",window.W_L.less_then),n.a.createElement(dn.a.Option,{value:"<=",label:mh["<="]},mh["<="]," ",window.W_L.less_and_equals),n.a.createElement(dn.a.Option,{disabled:!0,key:"dv2"},n.a.createElement(dh.a,{className:"select-option-divider m-t-10 m-b-5"})),n.a.createElement(dn.a.Option,{value:"==",label:mh["=="]},mh["=="],"  ",window.W_L.equals),n.a.createElement(dn.a.Option,{value:"!=",label:mh["!="]},mh["!="],"  ",window.W_L.not_equals)):n.a.createElement(fh,{minWidth:50},mh[r.op])),n.a.createElement("div",{className:"input-title"},n.a.createElement("label",{className:"input-label",htmlFor:"threshold-criterion"},window.W_L.threshold),i?n.a.createElement(va.a,{id:"threshold-criterion",style:{width:90},value:r.value,onChange:e=>o({value:e.target.value})}):n.a.createElement(fh,{minWidth:50},r.value)),n.a.createElement("div",{className:"ant-form-item-explain"},u,n.a.createElement("br",null),c&&n.a.createElement("small",null,n.a.createElement(ch.a,{className:"warning-icon-danger"})," ",c)))}fh.propTypes={children:ae.a.node.isRequired,minWidth:ae.a.number.isRequired},gh.propTypes={columnNames:ae.a.arrayOf(ae.a.string).isRequired,resultValues:ae.a.arrayOf(ae.a.object).isRequired,alertOptions:Kf.isRequired,onChange:ae.a.func,editMode:ae.a.bool},gh.defaultProps={onChange:()=>{},editMode:!1};a(1322);function bh(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function hh(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return yh(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return yh(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yh(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var vh=[[window.W_L.second,1],[window.W_L.minute,60],[window.W_L.hour,3600],[window.W_L.day,86400],[window.W_L.week,604800]];function wh(e){var t=e.value,a=e.onChange,o=e.editMode,i=hh(Object(r.useState)(),2),s=i[0],c=i[1],u=hh(Object(r.useState)(),2),d=u[0],m=u[1];if(Object(r.useEffect)(()=>{for(var e=vh.length-1;e>=0;e-=1){var a=hh(vh[e],2)[1];if(t%a==0){c(e),m(t/a);break}}},[t]),!Object(l.isNumber)(d)||!Object(l.isNumber)(s))return null;var p=1!==d?"s":"";if(o)return n.a.createElement(n.a.Fragment,null,n.a.createElement(pn.a,{value:d,onChange:e=>{m(e),a(e*vh[s][1])},min:1,precision:0}),n.a.createElement(dn.a,{value:s,onChange:e=>{c(e),a(d*vh[e][1])}},vh.map((e,t)=>{var a=hh(e,1)[0];return n.a.createElement(dn.a.Option,{value:t,key:a},a,p)})));var f=hh(vh[s],1)[0];return d+" "+Object(l.toLower)(f)+p}function Oh(e){var t=e.value,a=e.onChange,o=hh(Object(r.useState)(t<2?t:2),2),i=o[0],l=o[1];return n.a.createElement("div",{className:"alert-rearm"},n.a.createElement(dn.a,{optionLabelProp:"label",defaultValue:i||0,dropdownMatchSelectWidth:!1,onChange:e=>{l(e),a(e<2?e:3600)}},n.a.createElement(dn.a.Option,{value:0,label:window.W_L.alert_one_time},window.W_L.alert_one_time_tip),n.a.createElement(dn.a.Option,{value:1,label:window.W_L.alert_every_time},window.W_L.alert_every_time_tip),n.a.createElement(dn.a.Option,{value:2,label:window.W_L.alert_most_once},window.W_L.alert_most_once_tip)),2===i&&t&&n.a.createElement(wh,{value:t,onChange:a,editMode:!0}))}function _h(e){var t=e.value,a="";switch(t){case 0:a=window.W_L.alert_one_time_tip;break;case 1:a=window.W_L.alert_every_time_tip;break;default:a=n.a.createElement(n.a.Fragment,null,window.W_L.alert_most_once_tip," ",n.a.createElement(wh,{value:t,editMode:!1}))}return n.a.createElement("span",null,window.W_L.notice_will_send," ",a,".")}function Eh(e){var t=e.editMode,a=bh(e,["editMode"]);return t?n.a.createElement(Oh,a):n.a.createElement(_h,a)}function jh(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Sh(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Sh(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Sh(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Ch(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.initialResults,n=void 0===a?null:a,o=t.debounceTimeout,i=void 0===o?200:o,l=Object(r.useState)(n),s=jh(l,2),c=s[0],u=s[1],d=Object(r.useState)(!1),m=jh(d,2),p=m[0],f=m[1],g=Object(r.useRef)(null),b=Object(r.useRef)(!1),h=Object(Ul.a)(t=>{f(!0),g.current=t,e(t).catch(()=>n).then(e=>{t!==g.current||b.current||(u(e),f(!1))})},i),y=jh(h,1),v=y[0];return Object(r.useEffect)(()=>()=>{b.current=!0},[]),[v,c,p]}function xh(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ph(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ph(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ph(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}wh.propTypes={onChange:ae.a.func,value:ae.a.number.isRequired,editMode:ae.a.bool.isRequired},wh.defaultProps={onChange:()=>{}},Oh.propTypes={onChange:ae.a.func.isRequired,value:ae.a.number.isRequired},_h.propTypes={value:ae.a.number.isRequired},Eh.propTypes={onChange:ae.a.func,value:ae.a.number.isRequired,editMode:ae.a.bool},Eh.defaultProps={onChange:null,editMode:!1};var Lh=dn.a.Option;function kh(e){return null===e?Promise.resolve(null):e?hr.query({q:e}).then(e=>e.results):hr.recent().then(e=>e.filter(e=>!e.is_draft))}function Nh(e){var t=xh(Object(r.useState)(""),2),a=t[0],o=t[1],i=xh(Object(r.useState)(),2),s=i[0],c=i[1],u=xh(Ch(kh,{initialResults:[]}),3),d=u[0],m=u[1],p=u[2],f=window.W_L.search_by_name,g=n.a.createElement("i",{className:"fa fa-times hide-in-percy",role:"button",tabIndex:0,"aria-label":"Clear",onClick:()=>h(null)}),b=n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:me()("fa fa-spinner fa-pulse hide-in-percy",{hidden:!p}),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Searching..."));function h(t){var a=null;t&&((a=Object(l.find)(m,{id:t}))||uf.error("Something went wrong...","Couldn't select query")),o(a?null:""),c(a),e.onChange(a)}if(Object(r.useEffect)(()=>{d(a)},[d,a]),Object(r.useEffect)(()=>{e.selectedQuery&&c(e.selectedQuery)},[e.selectedQuery]),e.disabled)return n.a.createElement(va.a,{value:s&&s.name,"aria-label":"Tied query",placeholder:f,disabled:!0});if("select"===e.type){var y=s?g:null,v=s?s.name:a;return n.a.createElement(dn.a,{showSearch:!0,dropdownMatchSelectWidth:!1,placeholder:f,value:v||void 0,onSearch:o,onChange:h,suffixIcon:p?b:y,notFoundContent:null,filterOption:!1,defaultActiveFirstOption:!1,className:e.className,"data-test":"QuerySelector"},m&&m.map(e=>{var t=e.is_draft;return n.a.createElement(Lh,{value:e.id,key:e.id,disabled:t,className:"query-selector-result","data-test":"QueryId".concat(e.id)},e.name," ",n.a.createElement(Jg,{isDraft:e.is_draft,tags:e.tags,className:me()("inline-tags-control",{disabled:t})}))}))}return n.a.createElement("span",{"data-test":"QuerySelector"},s?n.a.createElement(va.a,{value:s.name,"aria-label":"Tied query",suffix:g,readOnly:!0}):n.a.createElement(va.a,{placeholder:f,value:a,"aria-label":"Tied query",onChange:e=>o(e.target.value),suffix:b}),n.a.createElement("div",{className:"scrollbox",style:{maxHeight:"35vh",marginTop:15}},m&&(m.length?n.a.createElement("ul",{className:"list-group"},m.map(e=>n.a.createElement(ge,{className:me()("query-selector-result","list-group-item",{inactive:e.is_draft}),key:e.id,role:"listitem",onClick:()=>h(e.id),"data-test":"QueryId".concat(e.id)},e.name," ",n.a.createElement(Jg,{isDraft:e.is_draft,tags:e.tags,className:"inline-tags-control"})))):n.a.createElement("div",{className:"text-muted"},window.W_L.find_nothing))))}Nh.propTypes={onChange:ae.a.func.isRequired,selectedQuery:ae.a.object,type:ae.a.oneOf(["select","default"]),className:ae.a.string,disabled:ae.a.bool},Nh.defaultProps={selectedQuery:null,type:"default",className:null,disabled:!1};var Ah=a(677),Th=a.n(Ah);a(1323);function Wh(e){var t=e.query,a=e.queryResult,r=e.onChange,o=e.editMode,i=t&&t.schedule?n.a.createElement("small",null,"Scheduled to refresh"," ",n.a.createElement("i",{className:"alert-query-schedule"},n.a.createElement(ab,{schedule:t.schedule,isNew:!1}))):n.a.createElement("small",null,n.a.createElement(ch.a,{className:"warning-icon-danger"})," ",window.W_L.query_not_setting," ",n.a.createElement("i",null,window.W_L.auto_flush),"."," ",n.a.createElement(we,{title:window.W_L.query_setting_tip},n.a.createElement("a",{role:"presentation"},window.W_L.recommend," ",n.a.createElement(Th.a,null))));return n.a.createElement(n.a.Fragment,null,o?n.a.createElement(Nh,{onChange:r,selectedQuery:t,className:"alert-query-selector",type:"select"}):n.a.createElement(we,{title:window.W_L.open_query_in_new_tab},n.a.createElement(h,{href:"queries/".concat(t.id),target:"_blank",rel:"noopener noreferrer",className:"alert-query-link"},t.name," ",n.a.createElement("i",{className:"fa fa-external-link","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)"))),n.a.createElement("div",{className:"ant-form-item-explain"},t&&i),t&&!a&&n.a.createElement("div",{className:"m-t-30"},n.a.createElement(jf.a,{className:"m-r-5"})," ",window.W_L.load_query_result))}Wh.propTypes={query:Qf,queryResult:ae.a.object,onChange:ae.a.func,editMode:ae.a.bool},Wh.defaultProps={query:null,queryResult:null,onChange:()=>{},editMode:!1};a(1326);function Ih(){return(Ih=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function qh(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Dh(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Dh(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Dh(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Rh(e){var t=e.items,a=e.renderItem,o=e.onItemClick,i=Object(r.useCallback)(e=>{var t=a(e),r=t.content,i=t.className,l=t.isDisabled;return n.a.createElement(qb.a.Item,{className:me()("select-items-list","w-100","p-l-10","p-r-10",{disabled:l},i),onClick:l?null:()=>o(e)},r)},[a,o]);return n.a.createElement(qb.a,{size:"small",dataSource:t,renderItem:i})}function Mh(e){var t=e.dialog,a=e.dialogTitle,o=e.inputPlaceholder,i=e.itemKey,s=e.renderItem,c=e.renderStagedItem,u=e.searchItems,d=e.selectedItemsTitle,p=e.width,f=e.showCount,g=e.extraFooterContent,b=qh(Object(r.useState)([]),2),h=b[0],y=b[1],v=qh(Ch(u,{initialResults:[]}),3),w=v[0],O=v[1],_=v[2],E=O.length>0;Object(r.useEffect)(()=>{w()},[w]);var j=Object(r.useCallback)(e=>{var t=i(e);return!!Object(l.find)(h,e=>i(e)===t)},[h,i]),S=Object(r.useCallback)(e=>{if(j(e)){var t=i(e);y(Object(l.filter)(h,e=>i(e)!==t))}else y([...h,e])},[h,i,j]),C=Object(r.useCallback)(()=>{t.close(h).catch(e=>{e&&uf.error(window.W_L.save_failed)})},[t,h]);return n.a.createElement(R.a,Ih({},t.props,{className:"select-items-dialog",width:p,title:a,footer:n.a.createElement("div",{className:"d-flex align-items-center"},n.a.createElement("span",{className:"flex-fill m-r-5",style:{textAlign:"left",color:"rgba(0, 0, 0, 0.5)"}},g),n.a.createElement(m.a,Ih({},t.props.cancelButtonProps,{onClick:t.dismiss}),window.W_L.cancel),n.a.createElement(m.a,Ih({},t.props.okButtonProps,{onClick:C,disabled:0===h.length||t.props.okButtonProps.disabled,type:"primary"}),window.W_L.save,f&&!Object(l.isEmpty)(h)?" (".concat(Object(l.size)(h),")"):null))}),n.a.createElement("div",{className:"d-flex align-items-center m-b-10"},n.a.createElement("div",{className:"flex-fill"},n.a.createElement(va.a.Search,{onChange:e=>w(e.target.value),placeholder:o,"aria-label":o,autoFocus:!0})),c&&n.a.createElement("div",{className:"w-50 m-l-20"},n.a.createElement("h5",{className:"m-0"},d))),n.a.createElement("div",{className:"d-flex align-items-stretch",style:{minHeight:"30vh",maxHeight:"35vh"}},n.a.createElement("div",{className:"flex-fill scrollbox"},_&&n.a.createElement(kb,{className:""}),!_&&!E&&n.a.createElement(xe,{icon:"fa-search",message:window.W_L.find_nothing,className:""}),!_&&E&&n.a.createElement(Rh,{items:O,renderItem:e=>s(e,{isSelected:j(e)}),onItemClick:S})),c&&n.a.createElement("div",{className:"w-50 m-l-20 scrollbox"},h.length>0&&n.a.createElement(Rh,{items:h,renderItem:e=>c(e,{isSelected:!0}),onItemClick:S}))))}Rh.propTypes={items:ae.a.array,renderItem:ae.a.func,onItemClick:ae.a.func},Rh.defaultProps={items:[],renderItem:()=>{},onItemClick:()=>{}},Mh.propTypes={dialog:ja.isRequired,dialogTitle:ae.a.string,inputPlaceholder:ae.a.string,selectedItemsTitle:ae.a.string,searchItems:ae.a.func.isRequired,itemKey:ae.a.func,renderItem:ae.a.func,renderStagedItem:ae.a.func,width:ae.a.oneOfType([ae.a.string,ae.a.number]),extraFooterContent:ae.a.node,showCount:ae.a.bool},Mh.defaultProps={dialogTitle:window.W_L.add,inputPlaceholder:window.W_L.search,selectedItemsTitle:window.W_L.selected,itemKey:e=>e.id,renderItem:()=>"",renderStagedItem:null,width:"80%",extraFooterContent:null,showCount:!1};var zh=Sa(Mh),Fh="static/images/destinations",Vh={query:()=>B.get("api/destinations"),get:e=>{var t=e.id;return B.get("api/destinations/".concat(t))},types:()=>B.get("api/destinations/types"),create:e=>B.post("api/destinations",e),save:e=>B.post("api/destinations/".concat(e.id),e),delete:e=>{var t=e.id;return B.delete("api/destinations/".concat(t))}},Uh={query:e=>{var t=e.alertId;return B.get("api/alerts/".concat(t,"/subscriptions"))},create:e=>B.post("api/alerts/".concat(e.alert_id,"/subscriptions"),e),delete:e=>B.delete("api/alerts/".concat(e.alert_id,"/subscriptions/").concat(e.id))};function Bh(e){var t=e.isSelected,a=e.isStaged,r=e.alreadyInGroup,o=e.deselectedIcon;return a?n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-remove","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Remove")):r?n.a.createElement(we,{title:window.W_L.selected_ready},n.a.createElement("span",{tabIndex:0},n.a.createElement("i",{className:"fa fa-check","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},window.W_L.selected_ready))):t?n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-check","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Selected")):n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa ".concat(o),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Select"))}function Hh(e){var t=e.featureName,a=e.className,r=e.mode,o=e.adminOnly,i=Se("sr-mail-description");if(!Y.mailSettingsMissing)return null;if(o&&!H.isAdmin)return null;var l=n.a.createElement("span",{id:i},window.W_L.email_need_set,"，“",t," ” ",window.W_L.email_will_work," ",n.a.createElement($e,{type:"MAIL_CONFIG",className:"f-inherit"}));return"icon"===r?n.a.createElement(we,{title:l,placement:"topRight",arrowPointAtCenter:!0},n.a.createElement("span",{className:a,"aria-label":"Mail alert","aria-describedby":i,tabIndex:0},n.a.createElement("i",{className:"fa fa-exclamation-triangle","aria-hidden":"true"}))):n.a.createElement(u.a,{message:l,type:"error",className:a})}Bh.propTypes={isSelected:ae.a.bool,isStaged:ae.a.bool,alreadyInGroup:ae.a.bool,deselectedIcon:ae.a.string},Bh.defaultProps={isSelected:!1,isStaged:!1,alreadyInGroup:!1,deselectedIcon:"fa-angle-double-right"},Hh.propTypes={featureName:ae.a.string.isRequired,className:ae.a.string,mode:ae.a.oneOf(["alert","icon"]),adminOnly:ae.a.bool},Hh.defaultProps={className:null,mode:"alert",adminOnly:!1};a(1327);function Yh(){return(Yh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Qh(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Kh(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Kh(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Kh(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function $h(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Gh(e){return e.destination||(e.destination={id:-1,name:e.user.email,icon:"DEPRECATED",type:"email"}),e}function Jh(e){var t=e.destination,a=t.name,r=t.type,o=e.user,i=e.unsubscribe,l=H.isAdmin||H.id===o.id;return n.a.createElement("li",{className:"destination-wrapper"},n.a.createElement("img",{src:"".concat(Fh,"/").concat(r,".png"),className:"destination-icon",alt:a}),n.a.createElement("span",{className:"flex-fill"},a),"email"===r&&n.a.createElement(Hh,{className:"destination-warning",featureName:"alert emails",mode:"icon"}),l&&n.a.createElement(we,{title:window.W_L.delete,mouseEnterDelay:.5},n.a.createElement(ge,{className:"remove-button",onClick:i},n.a.createElement(je.a,null))))}Jh.propTypes={destination:Yf.isRequired,user:Hf.isRequired,unsubscribe:ae.a.func.isRequired};class Xh extends n.a.Component{constructor(){super(...arguments),$h(this,"state",{dests:[],subs:null}),$h(this,"showAddAlertSubDialog",()=>{var e=this.state,t=e.dests,a=e.subs;zh.showModal({width:570,showCount:!0,extraFooterContent:n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-info-circle","aria-hidden":"true"})," Create new destinations in"," ",n.a.createElement(we,{title:window.W_L.open_new_window},n.a.createElement(h,{href:"destinations/new",target:"_blank"},window.W_L.alert_setting))),dialogTitle:window.W_L.add_alert_setting,inputPlaceholder:window.W_L.search,searchItems:e=>(e=Object(l.toLower)(e),Promise.resolve(t.filter(t=>Object(l.includes)(Object(l.toLower)(t.name),e)))),renderItem:(e,t)=>{var r=t.isSelected,o=!!Object(l.find)(a,t=>t.destination.id===e.id);return{content:n.a.createElement("div",{className:"destination-wrapper"},n.a.createElement("img",{src:"".concat(Fh,"/").concat(e.type,".png"),className:"destination-icon",alt:e.name}),n.a.createElement("span",{className:"flex-fill"},e.name),n.a.createElement(Bh,{isSelected:r,alreadyInGroup:o,deselectedIcon:"fa-plus"})),isDisabled:o,className:r||o?"selected":""}}}).onClose(e=>{var t=Object(l.map)(e,e=>this.subscribe(e));return Promise.all(t).then(()=>{uf.success(window.W_L.subscribed)}).catch(()=>(uf.error(window.W_L.subscribe_failed),Promise.reject(null)))})}),$h(this,"onUserEmailToggle",e=>{e?this.unsubscribe(e):this.subscribe()}),$h(this,"subscribe",e=>{var t={alert_id:this.props.alertId};return e&&(t.destination_id=e.id),Uh.create(t).then(e=>{var t=this.state.subs;this.setState({subs:[...t,Gh(e)]})})}),$h(this,"unsubscribe",e=>{Uh.delete(e).then(()=>{var t=this.state.subs;this.setState({subs:Object(l.without)(t,e)})}).catch(()=>{uf.error(window.W_L.subscribe_failed)})})}componentDidMount(){var e=this.props.alertId;Promise.all([Vh.query(),Uh.query({alertId:e})]).then(e=>{var t=Qh(e,2),a=t[0],r=t[1];r=r.map(Gh),this.setState({dests:a,subs:r})})}render(){if(!this.props.alertId)return null;var e=this.state.subs,t=Object(l.find)(e,{destination:{id:-1},user:{id:H.id}}),a=Object(l.without)(e,t),r=Y.mailSettingsMissing;return n.a.createElement("div",{className:"alert-destinations","data-test":"AlertDestinations"},n.a.createElement(we,{title:window.W_L.add_alert_setting,mouseEnterDelay:.5},n.a.createElement(m.a,{"data-test":"ShowAddAlertSubDialog",type:"primary",size:"small",className:"add-button",onClick:this.showAddAlertSubDialog},n.a.createElement("i",{className:"fa fa-plus f-12 m-r-5","aria-hidden":"true"})," ",window.W_L.add)),n.a.createElement("ul",null,n.a.createElement("li",{className:"destination-wrapper"},n.a.createElement("i",{className:"destination-icon fa fa-envelope","aria-hidden":"true"}),n.a.createElement("span",{className:"flex-fill"},H.email),n.a.createElement(Hh,{className:"destination-warning",featureName:"alert emails",mode:"icon"}),!r&&n.a.createElement(xo.a,{size:"small",className:"toggle-button",checked:!!t,loading:!e,onChange:()=>this.onUserEmailToggle(t),"data-test":"UserEmailToggle"})),a.map(e=>n.a.createElement(Jh,Yh({key:e.id,unsubscribe:()=>this.unsubscribe(e)},e)))))}}function Zh(){return(Zh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ey(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function ty(e){var t=e.children,a=e.label,r=e.className,o=ey(e,["children","label","className"]),i={span:16};return a||(i.offset=4),r=me()("alert-form-item",r),n.a.createElement(ih.a.Item,Zh({labelCol:{span:4},wrapperCol:i,label:a,className:r},o),t)}function ay(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ry(e){var t=e.state,a=e.lastTriggered;return n.a.createElement("div",{className:"alert-state"},n.a.createElement("span",{className:"alert-state-indicator label ".concat(Jb[t])},window.W_L.status,": ",t),"unknown"===t&&n.a.createElement("div",{className:"ant-form-item-explain"},window.W_L.alert_setting_sure),a&&n.a.createElement("div",{className:"ant-form-item-explain"},window.W_L.last_trigger_time," "," ",n.a.createElement("span",{className:"alert-last-triggered"},n.a.createElement(eg,{date:a}))))}$h(Xh,"propTypes",{alertId:ae.a.any.isRequired}),ty.propTypes={children:ae.a.node,label:ae.a.string,className:ae.a.string},ty.defaultProps={children:null,label:null,className:null},ry.propTypes={state:ae.a.string.isRequired,lastTriggered:ae.a.string},ry.defaultProps={lastTriggered:null};class ny extends n.a.Component{constructor(){super(...arguments),ay(this,"state",{unmuting:!1}),ay(this,"unmute",()=>{this.setState({unmuting:!0}),this.props.unmute().finally(()=>{this.setState({unmuting:!1})})})}render(){var e=this.props,t=e.alert,a=e.queryResult,r=e.canEdit,o=e.onEdit,i=e.menuButton,l=t.query,s=t.name,c=t.options,d=t.rearm;return n.a.createElement(n.a.Fragment,null,n.a.createElement(lh,{name:s,alert:t},n.a.createElement(se,{name:"AlertView.HeaderExtra",alert:t}),n.a.createElement(we,{title:r?"":window.W_L.no_permission_edit_alert},n.a.createElement(m.a,{type:"default",onClick:r?o:null,className:me()({disabled:!r})},n.a.createElement("i",{className:"fa fa-edit m-r-5","aria-hidden":"true"}),window.W_L.edit),i)),n.a.createElement("div",{className:"bg-white tiled p-20"},n.a.createElement(io.Row,{type:"flex",gutter:16},n.a.createElement(io.Col,{xs:24,md:16,className:"d-flex"},n.a.createElement(ih.a,{className:"flex-fill"},n.a.createElement(ty,null,n.a.createElement(ry,{state:t.state,lastTriggered:t.last_triggered_at})),n.a.createElement(ty,{label:window.W_L.query},n.a.createElement(Wh,{query:l,queryResult:a})),a&&c&&n.a.createElement(n.a.Fragment,null,n.a.createElement(ty,{label:window.W_L.trigger_condition,className:"alert-criteria"},n.a.createElement(gh,{columnNames:a.getColumnNames(),resultValues:a.getData(),alertOptions:c})),n.a.createElement(ty,{label:window.W_L.notice,className:"form-item-line-height-normal"},n.a.createElement(Eh,{value:d||0}),n.a.createElement("br",null),window.W_L.set," ",c.custom_subject||c.custom_body?window.W_L.custom:window.W_L.default," ",window.W_L.notice_template)))),n.a.createElement(io.Col,{xs:24,md:8},c.muted&&n.a.createElement(u.a,{className:"m-b-20",message:n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-bell-slash-o","aria-hidden":"true"})," ",window.W_L.set_mute),description:n.a.createElement(n.a.Fragment,null,window.W_L.alert_not_sent_info,n.a.createElement("br",null),r&&n.a.createElement(n.a.Fragment,null,window.W_L.reset_alert_sent_info,n.a.createElement(m.a,{size:"small",type:"primary",onClick:this.unmute,loading:this.state.unmuting,className:"m-t-5 m-l-5"},window.W_L.set_unmute))),type:"warning"}),n.a.createElement("h4",null,window.W_L.destination," ",n.a.createElement(we,{title:window.W_L.set_alert_open_tab},n.a.createElement(h,{href:"destinations",target:"_blank"},n.a.createElement("i",{className:"fa fa-external-link f-13","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)")))),n.a.createElement(Xh,{alertId:t.id})))))}}ny.propTypes={alert:$f.isRequired,queryResult:ae.a.object,canEdit:ae.a.bool.isRequired,onEdit:ae.a.func.isRequired,menuButton:ae.a.node.isRequired,unmute:ae.a.func},ny.defaultProps={queryResult:null,unmute:null};a(1339);function oy(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return iy(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return iy(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function iy(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function ly(e){var t=e.alert,a=e.query,o=e.columnNames,i=e.resultValues,s=e.subject,c=e.setSubject,u=e.body,d=e.setBody,m=!(!s&&!u),p=oy(Object(r.useState)(m?1:0),2),f=p[0],g=p[1],b=oy(Object(r.useState)(!1),2),h=b[0],y=b[1],v=function(e,t,a,r){var n=Object(l.isEmpty)(r)?null:Object(l.head)(r)[e.options.column];return{ALERT_STATUS:"TRIGGERED",ALERT_CONDITION:e.options.op,ALERT_THRESHOLD:e.options.value,ALERT_NAME:e.name,ALERT_URL:"".concat(window.location.origin,"/alerts/").concat(e.id),QUERY_NAME:t.name,QUERY_URL:"".concat(window.location.origin,"/queries/").concat(t.id),QUERY_RESULT_VALUE:Object(l.isNull)(n)||Object(l.isUndefined)(n)?"UNKNOWN":n,QUERY_RESULT_ROWS:r,QUERY_RESULT_COLS:a}}(t,a,o,i),w=e=>Qa.a.render(e||"",v);return n.a.createElement("div",{className:"alert-template"},n.a.createElement(dn.a,{value:f,onChange:e=>{e||!m?(g(e),y(!1)):R.a.confirm({title:window.W_L.are_you_sure,content:window.W_L.switch_warning,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,onOk:()=>{c(null),d(null),g(e),y(!1)},maskClosable:!0,autoFocusButton:null})},optionLabelProp:"label",dropdownMatchSelectWidth:!1,style:{width:"fit-content"}},n.a.createElement(dn.a.Option,{value:0,label:window.W_L.use_default_template},window.W_L.default_template),n.a.createElement(dn.a.Option,{value:1,label:window.W_L.use_custom_template},window.W_L.custom_template)),!!f&&n.a.createElement("div",{className:"alert-custom-template","data-test":"AlertCustomTemplate"},n.a.createElement("div",{className:"d-flex align-items-center"},n.a.createElement("h5",{className:"flex-fill"},window.W_L.subject," / ",window.W_L.content),window.W_L.preview," ",n.a.createElement(xo.a,{size:"small",className:"alert-template-preview",value:h,onChange:y})),n.a.createElement(va.a,{value:h?w(s):s,"aria-label":"Subject",onChange:e=>c(e.target.value),disabled:h,"data-test":"CustomSubject"}),n.a.createElement(va.a.TextArea,{value:h?w(u):u,"aria-label":"Body",autoSize:{minRows:9},onChange:e=>d(e.target.value),disabled:h,"data-test":"CustomBody"}),n.a.createElement($e,{type:"ALERT_NOTIF_TEMPLATE_GUIDE",className:"f-13"},n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"})," ",window.W_L.guide_format," ",n.a.createElement("span",{className:"sr-only"},"(",window.W_L.help,")"))))}ly.propTypes={alert:$f.isRequired,query:Qf.isRequired,columnNames:ae.a.arrayOf(ae.a.string).isRequired,resultValues:ae.a.arrayOf(ae.a.any).isRequired,subject:ae.a.string,setSubject:ae.a.func.isRequired,body:ae.a.string,setBody:ae.a.func.isRequired},ly.defaultProps={subject:"",body:""};var sy=ly;function cy(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class uy extends n.a.Component{constructor(){super(...arguments),cy(this,"_isMounted",!1),cy(this,"state",{saving:!1}),cy(this,"save",()=>{this.setState({saving:!0}),this.props.save().catch(()=>{this._isMounted&&this.setState({saving:!1})})}),cy(this,"cancel",()=>{this.props.cancel()})}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}render(){var e=this.props,t=e.alert,a=e.queryResult,r=e.pendingRearm,o=e.onNotificationTemplateChange,i=e.menuButton,l=this.props,s=l.onQuerySelected,c=l.onNameChange,u=l.onRearmChange,d=l.onCriteriaChange,p=t.query,f=t.name,g=t.options,b=this.state.saving;return n.a.createElement(n.a.Fragment,null,n.a.createElement(lh,{name:f,alert:t,onChange:c,editMode:!0},n.a.createElement(se,{name:"AlertEdit.HeaderExtra",alert:t}),n.a.createElement(m.a,{className:"m-r-5",onClick:()=>this.cancel()},n.a.createElement("i",{className:"fa fa-times m-r-5","aria-hidden":"true"}),window.W_L.cancel),n.a.createElement(m.a,{type:"primary",onClick:()=>this.save()},b?n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse m-r-5","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},window.W_L.saving)):n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-check m-r-5","aria-hidden":"true"})),window.W_L.save),i),n.a.createElement("div",{className:"bg-white tiled p-20"},n.a.createElement("div",{className:"d-flex"},n.a.createElement(ih.a,{className:"flex-fill"},n.a.createElement(ty,{label:"{window.W_L.query}"},n.a.createElement(Wh,{query:p,queryResult:a,onChange:s,editMode:!0})),a&&g&&n.a.createElement(n.a.Fragment,null,n.a.createElement(ty,{label:window.W_L.trigger_condition,className:"alert-criteria"},n.a.createElement(gh,{columnNames:a.getColumnNames(),resultValues:a.getData(),alertOptions:g,onChange:d,editMode:!0})),n.a.createElement(ty,{label:window.W_L.trigger_send_notice},n.a.createElement(Eh,{value:r||0,onChange:u,editMode:!0})),n.a.createElement(ty,{label:window.W_L.template},n.a.createElement(sy,{alert:t,query:p,columnNames:a.getColumnNames(),resultValues:a.getData(),subject:g.custom_subject,setSubject:e=>o({custom_subject:e}),body:g.custom_body,setBody:e=>o({custom_body:e})})))),n.a.createElement("div",null,n.a.createElement($e,{className:"f-13",type:"ALERT_SETUP"},window.W_L.setup_tip," ",n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"( ",window.W_L.help," )"))))))}}function dy(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}uy.propTypes={alert:$f.isRequired,queryResult:ae.a.object,pendingRearm:ae.a.number,menuButton:ae.a.node.isRequired,save:ae.a.func.isRequired,cancel:ae.a.func.isRequired,onQuerySelected:ae.a.func.isRequired,onNameChange:ae.a.func.isRequired,onCriteriaChange:ae.a.func.isRequired,onRearmChange:ae.a.func.isRequired,onNotificationTemplateChange:ae.a.func.isRequired},uy.defaultProps={queryResult:null,pendingRearm:null};class my extends n.a.Component{constructor(){super(...arguments),dy(this,"state",{saving:!1}),dy(this,"save",()=>{this.setState({saving:!0}),this.props.save().catch(()=>{this.setState({saving:!1})})})}render(){var e=this.props,t=e.alert,a=e.queryResult,r=e.pendingRearm,o=e.onNotificationTemplateChange,i=this.props,l=i.onQuerySelected,s=i.onNameChange,c=i.onRearmChange,u=i.onCriteriaChange,d=t.query,p=t.name,f=t.options,g=this.state.saving;return n.a.createElement(n.a.Fragment,null,n.a.createElement(lh,{alert:t,name:p,onChange:s,editMode:!0}),n.a.createElement("div",{className:"bg-white tiled p-20"},n.a.createElement("div",{className:"d-flex"},n.a.createElement(ih.a,{className:"flex-fill"},n.a.createElement("div",{className:"m-b-30"},window.W_L.selector_query_tip),n.a.createElement(ty,{label:window.W_L.query},n.a.createElement(Wh,{query:d,queryResult:a,onChange:l,editMode:!0})),a&&f&&n.a.createElement(n.a.Fragment,null,n.a.createElement(ty,{label:window.W_L.trigger_condition,className:"alert-criteria"},n.a.createElement(gh,{columnNames:a.getColumnNames(),resultValues:a.getData(),alertOptions:f,onChange:u,editMode:!0})),n.a.createElement(ty,{label:window.W_L.trigger_send_notice},n.a.createElement(Eh,{value:r||0,onChange:c,editMode:!0})),n.a.createElement(ty,{label:window.W_L.template},n.a.createElement(sy,{alert:t,query:d,columnNames:a.getColumnNames(),resultValues:a.getData(),subject:f.custom_subject,setSubject:e=>o({custom_subject:e}),body:f.custom_body,setBody:e=>o({custom_body:e})}))),n.a.createElement(ty,null,n.a.createElement(m.a,{type:"primary",onClick:this.save,disabled:!d,className:"btn-create-alert"},g&&n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse m-r-5","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"}," ",window.W_L.saving," ")),window.W_L.create_alert))),n.a.createElement($e,{className:"f-13",type:"ALERT_SETUP"},window.W_L.setup_tip,"  ",n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"( ",window.W_L.help," )")))))}}function py(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function fy(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?py(Object(a),!0).forEach((function(t){by(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):py(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function gy(){return(gy=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function by(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}my.propTypes={alert:$f.isRequired,queryResult:ae.a.object,pendingRearm:ae.a.number,onQuerySelected:ae.a.func.isRequired,save:ae.a.func.isRequired,onNameChange:ae.a.func.isRequired,onRearmChange:ae.a.func.isRequired,onCriteriaChange:ae.a.func.isRequired,onNotificationTemplateChange:ae.a.func.isRequired},my.defaultProps={queryResult:null,pendingRearm:null};var hy={NEW:0,VIEW:1,EDIT:2},yy=Object(l.template)("<%= query.name %>: <%= options.column %> <%= options.op %> <%= options.value %>");function vy(e){return e.query?yy(e):window.W_L.new_alert_tip}class wy extends n.a.Component{constructor(){super(...arguments),by(this,"_isMounted",!1),by(this,"state",{alert:null,queryResult:null,pendingRearm:null,canEdit:!1,mode:null}),by(this,"save",()=>{var e=this.state,t=e.alert,a=e.pendingRearm;return t.name=Object(l.trim)(t.name)||vy(t),t.rearm=a||null,Kb.save(t).then(e=>{uf.success(window.W_L.save_success),Ca("alerts/".concat(e.id),!0),this.setState({alert:e,mode:hy.VIEW})}).catch(()=>{uf.error(window.W_L.save_failed)})}),by(this,"onQuerySelected",e=>{this.setState(t=>({alert:gy(t.alert,{query:e}),queryResult:null})),e&&new hr(e).getQueryResultPromise().then(e=>{if(this._isMounted){this.setState({queryResult:e});var t=this.state.alert.options.column,a=e.getColumnNames();t&&Object(l.includes)(a,t)||(t=Object(l.head)(e.getColumnNames())),this.setAlertOptions({column:t})}})}),by(this,"onNameChange",e=>{var t=this.state.alert;this.setState({alert:gy(t,{name:e})})}),by(this,"onRearmChange",e=>{this.setState({pendingRearm:e})}),by(this,"setAlertOptions",e=>{var t=this.state.alert,a=fy(fy({},t.options),e);this.setState({alert:gy(t,{options:a})})}),by(this,"delete",()=>{var e=this.state.alert;return Kb.delete(e).then(()=>{uf.success(window.W_L.alert_delete_success),Ca("alerts")}).catch(()=>{uf.error(window.W_L.alert_delete_failed)})}),by(this,"mute",()=>{var e=this.state.alert;return Kb.mute(e).then(()=>{this.setAlertOptions({muted:!0}),uf.warn(window.W_L.set_mute_success)}).catch(()=>{uf.error(window.W_L.set_mute_failed)})}),by(this,"unmute",()=>{var e=this.state.alert;return Kb.unmute(e).then(()=>{this.setAlertOptions({muted:!1}),uf.success(window.W_L.set_unmute_success)}).catch(()=>{uf.error(window.W_L.set_unmute_failed)})}),by(this,"edit",()=>{var e=this.state.alert.id;Ca("alerts/".concat(e,"/edit"),!0),this.setState({mode:hy.EDIT})}),by(this,"cancel",()=>{var e=this.state.alert.id;Ca("alerts/".concat(e),!0),this.setState({mode:hy.VIEW})})}componentDidMount(){this._isMounted=!0;var e=this.props.mode;if(this.setState({mode:e}),e===hy.NEW)this.setState({alert:{options:{op:">",value:1,muted:!1}},pendingRearm:0,canEdit:!0});else{var t=this.props.alertId;Kb.get({id:t}).then(e=>{if(this._isMounted){var t=H.canEdit(e);t||(this.setState({mode:hy.VIEW}),uf.warn(window.W_L.can_not_edit_alert,window.W_L.no_permission_readonly,{duration:0})),this.setState({alert:e,canEdit:t,pendingRearm:e.rearm}),this.onQuerySelected(e.query)}}).catch(e=>{this._isMounted&&this.props.onError(e)})}}componentWillUnmount(){this._isMounted=!1}render(){var e=this.state.alert;if(!e)return n.a.createElement(kb,{className:"m-t-30"});var t=!!e.options.muted,a=this.state,r=a.queryResult,o=a.mode,i=a.canEdit,l=a.pendingRearm,s=n.a.createElement(nh,{doDelete:this.delete,muted:t,mute:this.mute,unmute:this.unmute,canEdit:i}),c={alert:e,queryResult:r,pendingRearm:l,save:this.save,menuButton:s,onQuerySelected:this.onQuerySelected,onRearmChange:this.onRearmChange,onNameChange:this.onNameChange,onCriteriaChange:this.setAlertOptions,onNotificationTemplateChange:this.setAlertOptions};return n.a.createElement("div",{className:"alert-page"},n.a.createElement("div",{className:"container"},o===hy.NEW&&n.a.createElement(my,c),o===hy.VIEW&&n.a.createElement(ny,gy({canEdit:i,onEdit:this.edit,muted:t,unmute:this.unmute},c)),o===hy.EDIT&&n.a.createElement(uy,gy({cancel:this.cancel},c))))}}by(wy,"propTypes",{mode:ae.a.oneOf(Object(l.values)(hy)),alertId:ae.a.string,onError:ae.a.func}),by(wy,"defaultProps",{mode:null,alertId:null,onError:()=>{}}),_f.register("Alerts.New",ha({path:"/alerts/new",title:window.W_L.new_alert,render:e=>n.a.createElement(wy,gy({},e,{mode:hy.NEW}))})),_f.register("Alerts.View",ha({path:"/alerts/:alertId",title:window.W_L.alert,render:e=>n.a.createElement(wy,gy({},e,{mode:hy.VIEW}))})),_f.register("Alerts.Edit",ha({path:"/alerts/:alertId/edit",title:window.W_L.alert,render:e=>n.a.createElement(wy,gy({},e,{mode:hy.EDIT}))}));var Oy=a(433),_y=a(434),Ey=a.n(_y),jy=(a(1347),/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"Cmd":"Ctrl"),Sy=/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"Option":"Alt";var Cy={};function xy(e,t){e.preventDefault(),e.retunValue=!1,Object(l.each)(Cy[t],e=>e())}var Py={modKey:jy,altKey:Sy,bind:e=>{Object(l.each)(e,(e,t)=>{var a=t.toLowerCase().split(",").map(l.trim);Object(l.each)(a,t=>{Cy[t]=[...Object(l.without)(Cy[t],e),e],Ey.a.bindGlobal(t,xy)})})},unbind:e=>{Object(l.each)(e,(e,t)=>{var a=t.toLowerCase().split(",").map(l.trim);Object(l.each)(a,t=>{Cy[t]=Object(l.without)(Cy[t],e),0===Cy[t].length&&(Cy[t]=void 0,Ey.a.unbind(t))})})}};function Ly(e){var t=e.paramCount,a=e.onClick,r=t?n.a.createElement("i",{className:"fa fa-check","aria-hidden":"true"}):n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Loading..."));return n.a.createElement("div",{className:"parameter-apply-button","data-show":!!t,"data-test":"ParameterApplyButton"},n.a.createElement(If.a,{count:t},n.a.createElement(we,{title:t?"".concat(Py.modKey," + Enter"):null},n.a.createElement("span",null,n.a.createElement(m.a,{onClick:a},r," ",window.W_L.apply_change)))))}Ly.propTypes={onClick:ae.a.func.isRequired,paramCount:ae.a.number.isRequired};var ky=Ly,Ny=document.createElement("canvas");function Ay(){return(Ay=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ty(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}Ny.style.display="none",document.body.appendChild(Ny);var Wy=function(e){var t=e.options,a=Ty(e,["options"]),o=Object(r.useMemo)(()=>{if(t&&t.length>400){var e=Object(l.maxBy)(t,"label.length");if(e){var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body,a=Ny.getContext("2d");if(a){var r=window.getComputedStyle(t);a.font="".concat(r.fontSize," ").concat(r.fontFamily);var n=a.measureText(e),o=n.width;return"actualBoundingBoxLeft"in n&&(o=Math.abs(n.actualBoundingBoxLeft)+Math.abs(n.actualBoundingBoxRight)),o}return null}(e.label);if(a)return a+40}return!0}return!1},[t]);return n.a.createElement(dn.a,Ay({dropdownMatchSelectWidth:o,options:t,allowClear:!0,optionFilterProp:"label"},a))},Iy=a(115),qy=a.n(Iy);function Dy(){return(Dy=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ry(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var My=n.a.forwardRef((e,t)=>{var a=e.defaultValue,r=e.value,o=e.onSelect,i=e.className,l=Ry(e,["defaultValue","value","onSelect","className"]),s=Y.dateFormat||"YYYY-MM-DD",c={};return a&&a.isValid()&&(c.defaultValue=a),(null===r||r&&r.isValid())&&(c.value=r),n.a.createElement(qy.a,Dy({ref:t,className:i},c,{format:s,placeholder:window.W_L.date_select,onChange:o},l))});My.propTypes={defaultValue:Jf,value:Jf,onSelect:ae.a.func,className:ae.a.string},My.defaultProps={defaultValue:null,value:void 0,onSelect:()=>{},className:""};var zy=My;function Fy(){return(Fy=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Vy(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var Uy=n.a.forwardRef((e,t)=>{var a=e.defaultValue,r=e.value,o=e.withSeconds,i=e.onSelect,l=e.className,s=Vy(e,["defaultValue","value","withSeconds","onSelect","className"]),c=(Y.dateFormat||"YYYY-MM-DD")+(o?" HH:mm:ss":" HH:mm"),u={};return a&&a.isValid()&&(u.defaultValue=a),(null===r||r&&r.isValid())&&(u.value=r),n.a.createElement(qy.a,Fy({ref:t,className:l,showTime:!0},u,{format:c,placeholder:window.W_L.datetime_select,onChange:i},s))});Uy.propTypes={defaultValue:Jf,value:Jf,withSeconds:ae.a.bool,onSelect:ae.a.func,className:ae.a.string},Uy.defaultProps={defaultValue:null,value:void 0,withSeconds:!1,onSelect:()=>{},className:""};var By=Uy,Hy=a(319),Yy=a.n(Hy),Qy=a(678),Ky=a.n(Qy),$y=a(679),Gy=a.n($y),Jy=(a(1361),Pn.a.Text);function Xy(e){var t=e.options,a=e.selectedDynamicValue,o=e.onSelect,i=e.enabled,s=e.staticValueLabel,c=n.a.createElement(ue.a,{className:"dynamic-menu",onClick:e=>{var a=e.key;return o(Object(l.get)(t,a,"static"))},selectedKeys:["".concat(Object(l.findIndex)(t,{value:a}))],"data-test":"DynamicButtonMenu"},t.map((e,t)=>n.a.createElement(ue.a.Item,{key:t},e.name," ",e.label&&n.a.createElement("em",null,Object(l.isFunction)(e.label)?e.label():e.label))),i&&n.a.createElement(ue.a.Divider,null),i&&n.a.createElement(ue.a.Item,null,n.a.createElement(Yy.a,null),n.a.createElement(Jy,{type:"secondary"},s))),u=Object(r.useRef)(null);return n.a.createElement("div",{ref:u},n.a.createElement("div",{role:"presentation",onClick:e=>e.stopPropagation()},n.a.createElement(aa.a.Button,{overlay:c,className:"dynamic-button",placement:"bottomRight",trigger:["click"],icon:i?n.a.createElement(Ky.a,{className:"dynamic-icon"}):n.a.createElement(Gy.a,{className:"dynamic-icon"}),getPopupContainer:()=>u.current,"data-test":"DynamicButton"})))}Xy.propTypes={options:ae.a.arrayOf(ae.a.object),selectedDynamicValue:ae.a.oneOfType([Cr,qr]),onSelect:ae.a.func,enabled:ae.a.bool,staticValueLabel:ae.a.string},Xy.defaultProps={options:[],selectedDynamicValue:null,onSelect:()=>{},enabled:!1,staticValueLabel:"Back to Static Value"};var Zy=Xy;a(601);function ev(){return(ev=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function tv(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class av extends n.a.Component{constructor(e){super(e),tv(this,"onDynamicValueSelect",e=>{var t=this.props,a=t.onSelect,r=t.parameter;if("static"===e){var n=r.getExecutionValue();a(n?Fa()(n):null)}else a(e.value);this.dateComponentRef.current.focus()}),this.dateComponentRef=n.a.createRef()}render(){var e=this.props,t=e.type,a=e.value,r=e.className,o=e.dateOptions,i=e.dynamicButtonOptions,s=e.onSelect,c=Pr(a),u=Object(l.includes)(t,"datetime"),d={},m=zy;if(u&&(m=By,Object(l.includes)(t,"with-seconds")&&(d.withSeconds=!0)),(Fa.a.isMoment(a)||null===a)&&(d.value=a),c){var p=a;d.placeholder=p&&p.name,d.value=null}return n.a.createElement("div",{className:me()("date-parameter",r)},n.a.createElement(m,ev({},o,{ref:this.dateComponentRef,className:me()("redash-datepicker",t,{"dynamic-value":c}),onSelect:s,suffixIcon:null},d)),n.a.createElement(Zy,{options:i.options,staticValueLabel:i.staticValueLabel,selectedDynamicValue:c?a:null,enabled:c,onSelect:this.onDynamicValueSelect}))}}tv(av,"propTypes",{type:ae.a.string,className:ae.a.string,value:ae.a.any,parameter:ae.a.any,onSelect:ae.a.func,dynamicButtonOptions:ae.a.shape({staticValueLabel:ae.a.string,options:ae.a.arrayOf(ae.a.shape({name:ae.a.string,value:ae.a.object,label:ae.a.oneOfType([ae.a.string,ae.a.func])}))}),dateOptions:ae.a.any}),tv(av,"defaultProps",{type:"",className:"",value:null,parameter:null,dynamicButtonOptions:{options:[]},onSelect:()=>{}});var rv=av;function nv(){return(nv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var ov=[{name:"Today/Now",value:Lr("d_now"),label:()=>Lr("d_now").value().format("MMM D")},{name:"Yesterday",value:Lr("d_yesterday"),label:()=>Lr("d_yesterday").value().format("MMM D")}];function iv(e){return n.a.createElement(rv,nv({dynamicButtonOptions:{options:ov}},e,{dateOptions:{"aria-label":"Parameter date value"}}))}iv.propTypes={type:ae.a.string,className:ae.a.string,value:ae.a.any,parameter:ae.a.any,onSelect:ae.a.func},iv.defaultProps={type:"",className:"",value:null,parameter:null,onSelect:()=>{}};var lv=iv;function sv(){return(sv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function cv(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var uv=qy.a.RangePicker,dv=n.a.forwardRef((e,t)=>{var a=e.defaultValue,r=e.value,o=e.onSelect,i=e.className,s=cv(e,["defaultValue","value","onSelect","className"]),c=Y.dateFormat||"YYYY-MM-DD",u={};return Object(l.isArray)(a)&&a[0].isValid()&&a[1].isValid()&&(u.defaultValue=a),(null===r||Object(l.isArray)(r)&&r[0].isValid()&&r[1].isValid())&&(u.value=r),n.a.createElement(uv,sv({ref:t,className:i},u,{format:c,onChange:o},s))});dv.propTypes={defaultValue:ae.a.arrayOf(Jf),value:ae.a.arrayOf(Jf),onSelect:ae.a.func,className:ae.a.string},dv.defaultProps={defaultValue:null,value:void 0,onSelect:()=>{},className:""};var mv=dv;function pv(){return(pv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function fv(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var gv=qy.a.RangePicker,bv=n.a.forwardRef((e,t)=>{var a=e.defaultValue,r=e.value,o=e.withSeconds,i=e.onSelect,s=e.className,c=fv(e,["defaultValue","value","withSeconds","onSelect","className"]),u=(Y.dateFormat||"YYYY-MM-DD")+(o?" HH:mm:ss":" HH:mm"),d={};return Object(l.isArray)(a)&&a[0].isValid()&&a[1].isValid()&&(d.defaultValue=a),(null===r||Object(l.isArray)(r)&&r[0].isValid()&&r[1].isValid())&&(d.value=r),n.a.createElement(gv,pv({ref:t,className:s,showTime:!0},d,{format:u,onChange:i},c))});bv.propTypes={defaultValue:ae.a.arrayOf(Jf),value:ae.a.arrayOf(Jf),withSeconds:ae.a.bool,onSelect:ae.a.func,className:ae.a.string},bv.defaultProps={defaultValue:null,value:void 0,withSeconds:!1,onSelect:()=>{},className:""};var hv=bv;function yv(){return(yv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function vv(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function wv(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Ov extends n.a.Component{constructor(e){super(e),wv(this,"onDynamicValueSelect",e=>{var t=this.props,a=t.onSelect,r=t.parameter;if("static"===e){var n=r.getExecutionValue();Object(l.isObject)(n)&&n.start&&n.end?a([Fa()(n.start),Fa()(n.end)]):a(null)}else a(e.value);this.dateRangeComponentRef.current.focus()}),this.dateRangeComponentRef=n.a.createRef()}render(){var e=this.props,t=e.type,a=e.value,r=e.onSelect,o=e.className,i=e.dynamicButtonOptions,s=e.dateRangeOptions,c=(e.parameter,vv(e,["type","value","onSelect","className","dynamicButtonOptions","dateRangeOptions","parameter"])),u=Object(l.includes)(t,"datetime-range"),d=Rr(a),m={},p=mv;return u&&(p=hv,Object(l.includes)(t,"with-seconds")&&(m.withSeconds=!0)),(function(e){return Object(l.isArray)(e)&&2===e.length&&Fa.a.isMoment(e[0])&&Fa.a.isMoment(e[1])}(a)||null===a)&&(m.value=a),d&&(m.placeholder=[a&&a.name],m.value=null),n.a.createElement("div",yv({},c,{className:me()("date-range-parameter",o)}),n.a.createElement(p,yv({},s,{ref:this.dateRangeComponentRef,className:me()("redash-datepicker date-range-input",t,{"dynamic-value":d}),onSelect:r,suffixIcon:null},m)),n.a.createElement(Zy,{options:i.options,staticValueLabel:i.staticValueLabel,selectedDynamicValue:d?a:null,enabled:d,onSelect:this.onDynamicValueSelect}))}}wv(Ov,"propTypes",{type:ae.a.oneOf(["date-range","datetime-range","datetime-range-with-seconds"]).isRequired,className:ae.a.string,value:ae.a.any,parameter:ae.a.any,onSelect:ae.a.func,dynamicButtonOptions:ae.a.shape({staticValueLabel:ae.a.string,options:ae.a.arrayOf(ae.a.shape({name:ae.a.string,value:ae.a.object,label:ae.a.oneOfType([ae.a.string,ae.a.func])}))}),dateRangeOptions:ae.a.any}),wv(Ov,"defaultProps",{type:"date-range",className:"",value:null,parameter:null,dynamicButtonOptions:{options:[]},onSelect:()=>{}});var _v=Ov;function Ev(){return(Ev=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var jv=[{name:"This week",title:window.W_L.this_week,value:Mr("d_this_week"),label:()=>Mr("d_this_week").value()[0].format("MMM D")+" - "+Mr("d_this_week").value()[1].format("MMM D")},{name:"This month",title:window.W_L.this_month,value:Mr("d_this_month"),label:()=>Mr("d_this_month").value()[0].format("MMMM")},{name:"This year",title:window.W_L.this_year,value:Mr("d_this_year"),label:()=>Mr("d_this_year").value()[0].format("YYYY")},{name:"Last week",title:window.W_L.last_week,value:Mr("d_last_week"),label:()=>Mr("d_last_week").value()[0].format("MMM D")+" - "+Mr("d_last_week").value()[1].format("MMM D")},{name:"Last month",title:window.W_L.last_month,value:Mr("d_last_month"),label:()=>Mr("d_last_month").value()[0].format("MMMM")},{name:"Last year",title:window.W_L.last_year,value:Mr("d_last_year"),label:()=>Mr("d_last_year").value()[0].format("YYYY")},{name:"Last 7 days",title:window.W_L.last_7_days,value:Mr("d_last_7_days"),label:()=>Mr("d_last_7_days").value()[0].format("MMM D")+" - Today"},{name:"Last 14 days",title:"window.W_L.last_14_days",value:Mr("d_last_14_days"),label:()=>Mr("d_last_14_days").value()[0].format("MMM D")+" - Today"},{name:"Last 30 days",title:window.W_L.last_30_days,value:Mr("d_last_30_days"),label:()=>Mr("d_last_30_days").value()[0].format("MMM D")+" - Today"},{name:"Last 60 days",title:window.W_L.last_60_days,value:Mr("d_last_60_days"),label:()=>Mr("d_last_60_days").value()[0].format("MMM D")+" - Today"},{name:"Last 90 days",title:window.W_L.last_90_days,value:Mr("d_last_90_days"),label:()=>Mr("d_last_90_days").value()[0].format("MMM D")+" - Today"},{name:"Last 12 months",title:window.W_L.last_12_months,value:Mr("d_last_12_months"),label:null}],Sv=[{name:"Today",value:Mr("d_today"),label:()=>Mr("d_today").value()[0].format("MMM D")},{name:"Yesterday",value:Mr("d_yesterday"),label:()=>Mr("d_yesterday").value()[0].format("MMM D")},...jv];function Cv(e){var t=Object(l.includes)(e.type,"datetime-range")?Sv:jv;return n.a.createElement(_v,Ev({},e,{dynamicButtonOptions:{options:t}}))}Cv.propTypes={type:ae.a.string,className:ae.a.string,value:ae.a.any,parameter:ae.a.any,onSelect:ae.a.func},Cv.defaultProps={type:"",className:"",value:null,parameter:null,onSelect:()=>{}};var xv=Cv;function Pv(){return(Pv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Lv(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function kv(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Nv extends n.a.Component{constructor(e){super(e),this.state={options:[],value:null,loading:!1}}componentDidMount(){this._loadOptions(this.props.queryId)}componentDidUpdate(e){this.props.queryId!==e.queryId&&this._loadOptions(this.props.queryId),this.props.value!==e.value&&this.setValue(this.props.value)}setValue(e){var t=this.state.options;if("multiple"===this.props.mode){e=Object(l.isArray)(e)?e:[e];var a=Object(l.map)(t,e=>e.value),r=Object(l.intersection)(e,a);return this.setState({value:r}),r}return e=void 0!==Object(l.find)(t,e=>e.value===this.props.value)?e:Object(l.get)(Object(l.first)(t),"value"),this.setState({value:e}),e}_loadOptions(e){var t,a=this;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e||e===a.state.queryId){r.next=6;break}return a.setState({loading:!0}),r.next=4,regeneratorRuntime.awrap(a.props.parameter.loadDropdownValues());case 4:t=r.sent,a.props.queryId===e&&a.setState({options:t,loading:!1},()=>{var e=a.setValue(a.props.value);Object(l.isEqual)(e,a.props.value)||a.props.onSelect(e)});case 6:case"end":return r.stop()}}),null,null,null,Promise)}render(){var e=this.props,t=e.className,a=e.mode,r=e.onSelect,o=(e.queryId,e.value,Lv(e,["className","mode","onSelect","queryId","value"])),i=this.state,s=i.loading,c=i.options;return n.a.createElement("span",null,n.a.createElement(Wy,Pv({className:t,disabled:s,loading:s,mode:a,value:this.state.value,onChange:r,options:Object(l.map)(c,e=>{var t=e.value,a=e.name;return{label:String(a),value:t}}),showSearch:!0,showArrow:!0,notFoundContent:Object(l.isEmpty)(c)?window.W_L.no_option:null},o)))}}kv(Nv,"propTypes",{parameter:ae.a.any,value:ae.a.any,mode:ae.a.oneOf(["default","multiple"]),queryId:ae.a.number,onSelect:ae.a.func,className:ae.a.string}),kv(Nv,"defaultProps",{value:null,mode:"default",parameter:null,queryId:null,onSelect:()=>{},className:""});a(1368);function Av(){return(Av=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Tv(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Wv={maxTagCount:3,maxTagTextLength:10,maxTagPlaceholder:e=>"+".concat(e.length," more")};class Iv extends n.a.Component{constructor(e){super(e),Tv(this,"componentDidUpdate",e=>{var t=this.props,a=t.value,r=t.parameter;e.value===a&&e.parameter===r||this.setState({value:r.hasPendingValue?r.pendingValue:a,isDirty:r.hasPendingValue})}),Tv(this,"onSelect",e=>{var t=!Object(l.isEqual)(e,this.props.value);this.setState({value:e,isDirty:t}),this.props.onSelect(e,t)}),this.state={value:e.parameter.hasPendingValue?e.parameter.pendingValue:e.value,isDirty:e.parameter.hasPendingValue}}renderDateParameter(){var e=this.props,t=e.type,a=e.parameter,r=this.state.value;return n.a.createElement(lv,{type:t,className:this.props.className,value:r,parameter:a,onSelect:this.onSelect})}renderDateRangeParameter(){var e=this.props,t=e.type,a=e.parameter,r=this.state.value;return n.a.createElement(xv,{type:t,className:this.props.className,value:r,parameter:a,onSelect:this.onSelect})}renderEnumInput(){var e,t=this.props,a=t.enumOptions,r=t.parameter,o=this.state.value,i=a.split("\n").filter(e=>""!==e);return n.a.createElement(Wy,Av({className:this.props.className,mode:r.multiValuesOptions?"multiple":"default",value:(e=o,r.multiValuesOptions&&null===e?[]:e),onChange:this.onSelect,options:Object(l.map)(i,e=>({label:String(e),value:e})),showSearch:!0,showArrow:!0,notFoundContent:Object(l.isEmpty)(i)?window.W_L.no_option:null},Wv))}renderQueryBasedInput(){var e=this.props,t=e.queryId,a=e.parameter,r=this.state.value;return n.a.createElement(Nv,Av({className:this.props.className,mode:a.multiValuesOptions?"multiple":"default",parameter:a,value:r,queryId:t,onSelect:this.onSelect,style:{minWidth:60}},Wv))}renderNumberInput(){var e=this.props.className,t=this.state.value,a=e=>isNaN(e)?void 0:e;return n.a.createElement(pn.a,{className:e,value:a(t),"aria-label":"Parameter number value",onChange:e=>this.onSelect(a(e))})}renderTextInput(){var e=this.props.className,t=this.state.value;return n.a.createElement(va.a,{className:e,value:t,"aria-label":"Parameter text value","data-test":"TextParamInput",onChange:e=>this.onSelect(e.target.value)})}renderInput(){switch(this.props.type){case"datetime-with-seconds":case"datetime-local":case"date":return this.renderDateParameter();case"datetime-range-with-seconds":case"datetime-range":case"date-range":return this.renderDateRangeParameter();case"enum":return this.renderEnumInput();case"query":return this.renderQueryBasedInput();case"number":return this.renderNumberInput();default:return this.renderTextInput()}}render(){var e=this.state.isDirty;return n.a.createElement("div",{className:"parameter-input","data-dirty":e||null,"data-test":"ParameterValueInput"},this.renderInput())}}Tv(Iv,"propTypes",{type:ae.a.string,value:ae.a.any,enumOptions:ae.a.string,queryId:ae.a.number,parameter:ae.a.any,onSelect:ae.a.func,className:ae.a.string}),Tv(Iv,"defaultProps",{type:"text",value:null,enumOptions:"",queryId:null,parameter:null,onSelect:()=>{},className:""});var qv=Iv;function Dv(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Rv(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Dv(Object(a),!0).forEach((function(t){Mv(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Dv(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Mv(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function zv(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Fv(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Fv(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fv(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Vv(){return(Vv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var Uv=dn.a.Option,Bv={labelCol:{span:6},wrapperCol:{span:16}};function Hv(e){return Object(l.capitalize)(Object(l.words)(e).join(" "))}function Yv(e){var t=e.name,a=e.type,r=e.onChange,o=e.existingNames,i=e.setValidation,s="",c="";return t?Object(l.includes)(o,t)?(s=window.W_L.params_ready_exist,i(!1),c="error"):(function(e){return/-range/.test(e)}(a)&&(s=n.a.createElement(n.a.Fragment,null,window.W_L.query_show_as," ",n.a.createElement("code",{style:{display:"inline-block",color:"inherit"}},"{{".concat(t,".start}} {{").concat(t,".end}}")))),i(!0)):(s=window.W_L.params_name,i(!1)),n.a.createElement(ih.a.Item,Vv({required:!0,label:window.W_L.name,help:s,validateStatus:c},Bv),n.a.createElement(va.a,{onChange:e=>r(e.target.value),autoFocus:!0}))}function Qv(e){var t=zv(Object(r.useState)(Object(l.clone)(e.parameter)),2),a=t[0],o=t[1],i=zv(Object(r.useState)(!0),2),s=i[0],c=i[1],u=zv(Object(r.useState)(),2),d=u[0],p=u[1],f=!e.parameter.name;Object(r.useEffect)(()=>{var t=e.parameter.queryId;t&&hr.get({id:t}).then(p)},[e.parameter.queryId]);var g,b,h,y=Se("paramForm");return n.a.createElement(R.a,Vv({},e.dialog.props,{title:f?window.W_L.new_params:a.name,width:600,footer:[n.a.createElement(m.a,{key:"cancel",onClick:e.dialog.dismiss},window.W_L.cancel),n.a.createElement(m.a,{key:"submit",htmlType:"submit",disabled:!!(!s||""===a.title||"query"===a.type&&!a.queryId),type:"primary",form:y,"data-test":"SaveParameterSettings"},f?window.W_L.new_params:window.W_L.ok_text)]}),n.a.createElement(ih.a,{layout:"horizontal",onFinish:function(){a.title||(a.title=Hv(a.name),o(a)),e.dialog.close(a)},id:y},f&&n.a.createElement(Yv,{name:a.name,onChange:e=>o(Rv(Rv({},a),{},{name:e})),setValidation:c,existingNames:e.existingParams,type:a.type}),n.a.createElement(ih.a.Item,Vv({required:!0,label:window.W_L.title},Bv),n.a.createElement(va.a,{value:Object(l.isNull)(a.title)?Hv(a.name):a.title,onChange:e=>o(Rv(Rv({},a),{},{title:e.target.value})),"data-test":"ParameterTitleInput"})),n.a.createElement(ih.a.Item,Vv({label:window.W_L.type},Bv),n.a.createElement(dn.a,{value:a.type,onChange:e=>o(Rv(Rv({},a),{},{type:e})),"data-test":"ParameterTypeSelect"},n.a.createElement(Uv,{value:"text","data-test":"TextParameterTypeOption"},window.W_L.text),n.a.createElement(Uv,{value:"number","data-test":"NumberParameterTypeOption"},window.W_L.number),n.a.createElement(Uv,{value:"enum"},window.W_L.select),n.a.createElement(Uv,{value:"query"},window.W_L.query_result),n.a.createElement(Uv,{disabled:!0,key:"dv1"},n.a.createElement(dh.a,{className:"select-option-divider"})),n.a.createElement(Uv,{value:"date","data-test":"DateParameterTypeOption"},window.W_L.date_day),n.a.createElement(Uv,{value:"datetime-local","data-test":"DateTimeParameterTypeOption"},window.W_L.date_datetime),n.a.createElement(Uv,{value:"datetime-with-seconds"},window.W_L.date_time_second),n.a.createElement(Uv,{disabled:!0,key:"dv2"},n.a.createElement(dh.a,{className:"select-option-divider"})),n.a.createElement(Uv,{value:"date-range","data-test":"DateRangeParameterTypeOption"},window.W_L.date_range_day),n.a.createElement(Uv,{value:"datetime-range"}," ",window.W_L.date_range_datetime),n.a.createElement(Uv,{value:"datetime-range-with-seconds"},window.W_L.date_range_time_second))),"enum"===a.type&&n.a.createElement(ih.a.Item,Vv({label:window.W_L.value,help:window.W_L.list_select_help},Bv),n.a.createElement(va.a.TextArea,{rows:3,value:a.enumOptions,onChange:e=>o(Rv(Rv({},a),{},{enumOptions:e.target.value}))})),"query"===a.type&&n.a.createElement(ih.a.Item,Vv({label:window.W_L.query_result,help:window.W_L.wait_query},Bv),n.a.createElement(Nh,{selectedQuery:d,onChange:e=>o(Rv(Rv({},a),{},{queryId:e&&e.id})),type:"select"})),("enum"===a.type||"query"===a.type)&&n.a.createElement(ih.a.Item,Vv({className:"m-b-0",label:" ",colon:!1},Bv),n.a.createElement(gn.a,{defaultChecked:!!a.multiValuesOptions,onChange:e=>o(Rv(Rv({},a),{},{multiValuesOptions:e.target.checked?{prefix:"",suffix:"",separator:","}:null})),"data-test":"AllowMultipleValuesCheckbox"},window.W_L.allow_multi)),("enum"===a.type||"query"===a.type)&&a.multiValuesOptions&&n.a.createElement(ih.a.Item,Vv({label:window.W_L.quotation,help:n.a.createElement(n.a.Fragment,null,window.W_L.replace_query_info,": ",n.a.createElement("code",null,(g=a.multiValuesOptions,b=g.prefix,h=g.suffix,[window.W_L.value+"1",window.W_L.value+"2",window.W_L.value+"3"].map(e=>"".concat(b).concat(e).concat(h)).join(","))))},Bv),n.a.createElement(dn.a,{value:a.multiValuesOptions.prefix,onChange:e=>o(Rv(Rv({},a),{},{multiValuesOptions:Rv(Rv({},a.multiValuesOptions),{},{prefix:e,suffix:e})})),"data-test":"QuotationSelect"},n.a.createElement(Uv,{value:""},window.W_L.no_quotation,"(",window.W_L.default,")"),n.a.createElement(Uv,{value:"'"},window.W_L.single_quotation),n.a.createElement(Uv,{value:'"',"data-test":"DoubleQuotationMarkOption"},window.W_L.double_quotation)))))}Yv.propTypes={name:ae.a.string.isRequired,onChange:ae.a.func.isRequired,existingNames:ae.a.arrayOf(ae.a.string).isRequired,setValidation:ae.a.func.isRequired,type:ae.a.string.isRequired},Qv.propTypes={parameter:ae.a.object.isRequired,dialog:ja.isRequired,existingParams:ae.a.arrayOf(ae.a.string)},Qv.defaultProps={existingParams:[]};var Kv=Sa(Qv);a(1369);function $v(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Gv(e){var t=Object(l.extend)({},A.search);e.forEach(e=>{Object(l.extend)(t,e.toUrlParams())}),A.setSearch(t,!0)}class Jv extends n.a.Component{constructor(e){super(e),$v(this,"componentDidUpdate",e=>{var t=this.props,a=t.parameters,r=t.disableUrlUpdate,n=e.parameters!==a,o=e.disableUrlUpdate!==r;n&&this.setState({parameters:a}),!n&&!o||r||Gv(a)}),$v(this,"handleKeyDown",e=>{13===e.keyCode&&(e.ctrlKey||e.metaKey||e.altKey)&&(e.stopPropagation(),this.applyChanges())}),$v(this,"setPendingValue",(e,t,a)=>{var r=this.props.onPendingValuesChange;this.setState(n=>{var o=n.parameters;return a?e.setPendingValue(t):e.clearPendingValue(),r(),{parameters:o}})}),$v(this,"moveParameter",e=>{var t=e.oldIndex,a=e.newIndex,r=this.props.onParametersEdit;t!==a&&this.setState(e=>{var n=e.parameters;return n.splice(a,0,n.splice(t,1)[0]),r(n),{parameters:n}})}),$v(this,"applyChanges",()=>{var e=this.props,t=e.onValuesChange,a=e.disableUrlUpdate;this.setState(e=>{var r=e.parameters,n=r.filter(e=>e.hasPendingValue);return Object(l.forEach)(r,e=>e.applyPendingValue()),a||Gv(r),t(n),{parameters:r}})}),$v(this,"showParameterSettings",(e,t)=>{var a=this.props.onParametersEdit;Kv.showModal({parameter:e}).onClose(r=>{this.setState(n=>{var o=n.parameters,i=Object(l.extend)(e,r);return o[t]=Br(i,i.parentQueryId),a(o),{parameters:o}})})});var t=e.parameters;this.state={parameters:t},e.disableUrlUpdate||Gv(t)}renderParameter(e,t){var a=this.props.editable;return n.a.createElement("div",{key:e.name,className:"di-block","data-test":"ParameterName-".concat(e.name)},n.a.createElement("div",{className:"parameter-heading"},n.a.createElement("label",null,e.title||mg(e.name)),a&&n.a.createElement(ge,{className:"btn btn-default btn-xs m-l-5","aria-label":"Edit",onClick:()=>this.showParameterSettings(e,t),"data-test":"ParameterSettings-".concat(e.name),type:"button"},n.a.createElement("i",{className:"fa fa-cog","aria-hidden":"true"}))),n.a.createElement(qv,{type:e.type,value:e.normalizedValue,parameter:e,enumOptions:e.enumOptions,queryId:e.queryId,onSelect:(t,a)=>this.setPendingValue(e,t,a)}))}render(){var e=this.state.parameters,t=this.props,a=t.sortable,r=t.appendSortableToParent,o=Object(l.size)(Object(l.filter)(e,"hasPendingValue"));return n.a.createElement(ds,{disabled:!a,axis:"xy",useDragHandle:!0,lockToContainerEdges:!0,helperClass:"parameter-dragged",helperContainer:e=>r?e:document.body,updateBeforeSortStart:this.onBeforeSortStart,onSortEnd:this.moveParameter,containerProps:{className:"parameter-container",onKeyDown:o?this.handleKeyDown:null}},e.map((e,t)=>n.a.createElement(us,{key:e.name,index:t},n.a.createElement("div",{className:"parameter-block","data-editable":a||null,"data-test":"ParameterBlock-".concat(e.name)},a&&n.a.createElement(ss,{"data-test":"DragHandle-".concat(e.name)}),this.renderParameter(e,t)))),n.a.createElement(ky,{onClick:this.applyChanges,paramCount:o}))}}function Xv(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Zv(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Zv(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Zv(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function ew(e){var t=e.from,a=Object(r.useMemo)(()=>Fa()(t).valueOf(),[t]),o=Xv(Object(r.useState)(null),2),i=o[0],l=o[1];return Object(r.useEffect)(()=>{function e(){var e=Fa.a.now()-a,t=e>36e5?"HH:mm:ss":"mm:ss";l(Fa.a.utc(e).format(t))}e();var t=setInterval(e,1e3);return()=>clearInterval(t)},[a]),n.a.createElement("span",{className:"rd-timer"},i)}$v(Jv,"propTypes",{parameters:ae.a.arrayOf(ae.a.instanceOf(Va)),editable:ae.a.bool,sortable:ae.a.bool,disableUrlUpdate:ae.a.bool,onValuesChange:ae.a.func,onPendingValuesChange:ae.a.func,onParametersEdit:ae.a.func,appendSortableToParent:ae.a.bool}),$v(Jv,"defaultProps",{parameters:[],editable:!1,sortable:!1,disableUrlUpdate:!1,onValuesChange:()=>{},onPendingValuesChange:()=>{},onParametersEdit:()=>{},appendSortableToParent:!0}),ew.propTypes={from:ae.a.oneOfType([ae.a.string,ae.a.number,ae.a.instanceOf(Date),Jf])},ew.defaultProps={from:null};a(1370);function tw(e){var t=e.visualization,a=Op[t.type];return n.a.createElement("span",{className:"visualization-name"},a&&t.name!==a.name?t.name:null)}tw.propTypes={visualization:Zr.isRequired};var aw=tw;a(1371);function rw(){return(rw=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function nw(e){var t=e.query,a=e.visualization,r=e.readOnly;return n.a.createElement(e=>{return r?n.a.createElement("span",e):n.a.createElement(h,rw({href:(o=null,a&&(o="TABLE"===a.type?"table":a.id),t.getUrl(!1,o))},e));var o},{className:"query-link"},n.a.createElement(aw,{visualization:a})," ",n.a.createElement("span",null,t.name))}nw.propTypes={query:ae.a.object.isRequired,visualization:Zr,readOnly:ae.a.bool},nw.defaultProps={visualization:null,readOnly:!1};var ow=nw;function iw(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function lw(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?iw(Object(a),!0).forEach((function(t){sw(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):iw(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function sw(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var cw="###Redash::Filters::SelectAll###",uw=ae.a.shape({name:ae.a.string.isRequired,friendlyName:ae.a.string.isRequired,multiple:ae.a.bool,current:ae.a.oneOfType([ae.a.any,ae.a.arrayOf(ae.a.any)]),values:ae.a.arrayOf(ae.a.any).isRequired}),dw=ae.a.arrayOf(uw);function mw(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!Object(l.isArray)(e))return[];var a=e;return Object(l.isArray)(t)&&t.length>0&&(a=a.filter(e=>Object(l.every)(t,t=>{var a=e[t.name],r=Object(l.isArray)(t.current)?t.current:[t.current];return Object(l.some)(r,e=>Fa.a.isMoment(a)?a.isSame(e):e===a||String(a)===e)}))),a}function pw(e){var t=e.filters,a=e.onChange;return 0===t.length?null:(a=function(e,t){return(a,r)=>{if(Object(l.isArray)(r))r=Object(l.map)(r,e=>a.values[Object(l.toNumber)(e.key)]||e.key);else{var n=a.values[Object(l.toNumber)(r.key)];r=void 0!==n?n:r.key}a.multiple&&Object(l.includes)(r,cw)&&(r=[...a.values]),a.multiple&&Object(l.includes)(r,"###Redash::Filters::Clear###")&&(r=[]),e=Object(l.map)(e,e=>e.name===a.name?lw(lw({},a),{},{current:r}):e),t(e)}}(t,a),n.a.createElement("div",{className:"filters-wrapper","data-test":"Filters"},n.a.createElement("div",{className:"container bg-white"},n.a.createElement("div",{className:"row"},Object(l.map)(t,e=>{var t=Object(l.map)(e.values,(t,a)=>n.a.createElement(dn.a.Option,{key:a},bg(t,Object(l.get)(e,"column.type"))));return n.a.createElement("div",{key:e.name,className:"col-sm-6 p-l-0 filter-container","data-test":"FilterName-".concat(e.name)},n.a.createElement("label",null,e.friendlyName),0===t.length&&n.a.createElement(dn.a,{className:"w-100",disabled:!0,value:"No values"}),t.length>0&&n.a.createElement(dn.a,{labelInValue:!0,className:"w-100",mode:e.multiple?"multiple":"default",value:Object(l.isArray)(e.current)?Object(l.map)(e.current,t=>({key:"".concat(Object(l.indexOf)(e.values,t)),label:bg(t)})):{key:"".concat(Object(l.indexOf)(e.values,e.current)),label:bg(e.current)},allowClear:e.multiple,optionFilterProp:"children",showSearch:!0,maxTagCount:3,maxTagTextLength:10,maxTagPlaceholder:e=>"+".concat(e.length," more"),onChange:t=>a(e,t)},!e.multiple&&t,e.multiple&&[n.a.createElement(dn.a.Option,{key:"###Redash::Filters::Clear###","data-test":"ClearOption"},n.a.createElement("i",{className:"fa fa-square-o m-r-5","aria-hidden":"true"}),window.W_L.clear),n.a.createElement(dn.a.Option,{key:cw,"data-test":"SelectAllOption"},n.a.createElement("i",{className:"fa fa-check-square-o m-r-5","aria-hidden":"true"}),window.W_L.select_all),n.a.createElement(dn.a.OptGroup,{key:"Values",label:window.W_L.value},t)]))})))))}pw.propTypes={filters:dw.isRequired,onChange:ae.a.func},pw.defaultProps={onChange:()=>{}};var fw=pw;function gw(e){var t=Object(l.invoke)(e,"getStatus");return Object(r.useMemo)(()=>function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return{status:t||Object(l.invoke)(e,"getStatus")||null,columns:Object(l.invoke)(e,"getColumns")||[],rows:Object(l.invoke)(e,"getData")||[],filters:Object(l.invoke)(e,"getFilters")||[],updatedAt:Object(l.invoke)(e,"getUpdatedAt")||null,retrievedAt:Object(l.get)(e,"query_result.retrieved_at",null),truncated:Object(l.invoke)(e,"getTruncated")||null,log:Object(l.invoke)(e,"getLog")||[],error:Object(l.invoke)(e,"getError")||null,runtime:Object(l.invoke)(e,"getRuntime")||null,metadata:Object(l.get)(e,"query_result.data.metadata",{})}}(e,t),[e,t])}function bw(e){var t=Object(r.useRef)();return t.current=Object(l.isFunction)(e)?e:l.noop,Object(r.useCallback)((function(){return t.current(...arguments)}),[])}var hw=a(680),yw=a.n(hw),vw=a(681),ww=a.n(vw),Ow=a(682),_w=a.n(Ow),Ew=a(683),jw=a.n(Ew),Sw=a(684),Cw=a.n(Sw),xw=a(685),Pw=a.n(xw),Lw=a(686),kw=a.n(Lw),Nw=a(687),Aw=a.n(Nw),Tw=a(688),Ww=a.n(Tw),Iw=a(689),qw=a.n(Iw),Dw=a(690),Rw=a.n(Dw),Mw=a(691),zw=a.n(Mw),Fw=a(692),Vw=a.n(Fw),Uw=a(693),Bw=a.n(Uw),Hw=a(694),Yw=a.n(Hw),Qw=a(695),Kw=a.n(Qw),$w=a(696),Gw=a.n($w),Jw=a(697),Xw=a.n(Jw),Zw=a(698),eO=a.n(Zw),tO=a(699),aO=a.n(tO),rO=a(700),nO=a.n(rO),oO=a(701),iO=a.n(oO),lO=a(702),sO=a.n(lO),cO=a(703),uO=a.n(cO),dO=a(704),mO=a.n(dO),pO=a(705),fO=a.n(pO),gO=a(706),bO=a.n(gO),hO=a(707),yO=a.n(hO),vO=a(708),wO=a.n(vO),OO=a(709),_O=a.n(OO),EO=a(710),jO=a.n(EO),SO=a(711),CO=a.n(SO),xO=a(712),PO=a.n(xO),LO=a(713),kO=a.n(LO),NO=a(714),AO=a.n(NO),TO=a(715),WO=a.n(TO),IO=a(716),qO=a.n(IO),DO=a(717),RO=a.n(DO);function MO(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function zO(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function FO(e){return function(t){var a;return a=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?MO(Object(a),!0).forEach((function(t){zO(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):MO(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({HelpTriggerComponent:$e,LinkComponent:h,choroplethAvailableMaps:{countries:{name:window.W_L.country,url:yw.a,fieldNames:{name:window.W_L.short_name,name_long:window.W_L.full_name,abbrev:window.W_L.abbreviated_name,iso_a2:"ISO code(2 letters)",iso_a3:"ISO code(3 letters)",iso_n3:"ISO code(3 digits)"}},china:{name:"中国行政区划图",url:jw.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_110000:{name:"(110000)北京市行政区划图",url:Cw.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_120000:{name:"(120000)天津市行政区划图",url:Pw.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_130000:{name:"(130000)河北省行政区划图",url:kw.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_140000:{name:"(140000)山西省行政区划图",url:Aw.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_150000:{name:"(150000)内蒙古行政区划图",url:Ww.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_210000:{name:"(210000)辽宁省行政区划图",url:qw.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_220000:{name:"(220000)吉林省行政区划图",url:Rw.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_230000:{name:"(230000)黑龙江省行政区划图",url:zw.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_310000:{name:"(310000)上海市行政区划图",url:Vw.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_320000:{name:"(320000)江苏省行政区划图",url:Bw.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_330000:{name:"(330000)浙江省行政区划图",url:Yw.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_340000:{name:"(340000)安徽省行政区划图",url:Kw.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_350000:{name:"(350000)福建省行政区划图",url:Gw.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_360000:{name:"(360000)江西省行政区划图",url:Xw.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_370000:{name:"(370000)山东省行政区划图",url:eO.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_410000:{name:"(410000)河南省行政区划图",url:aO.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_420000:{name:"(420000)湖北省行政区划图",url:nO.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_430000:{name:"(430000)湖南省行政区划图",url:iO.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_440000:{name:"(440000)广东省行政区划图",url:sO.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_450000:{name:"(450000)广西行政区划图",url:uO.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_460000:{name:"(460000)海南省行政区划图",url:mO.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_500000:{name:"(500000)重庆市行政区划图",url:fO.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_510000:{name:"(510000)四川省行政区划图",url:bO.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_520000:{name:"(520000)贵州省行政区划图",url:yO.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_530000:{name:"(530000)云南省行政区划图",url:wO.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_540000:{name:"(540000)西藏行政区划图",url:_O.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_610000:{name:"(610000)陕西省行政区划图",url:jO.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_620000:{name:"(620000)甘肃省行政区划图",url:CO.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_630000:{name:"(630000)青海省行政区划图",url:PO.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_640000:{name:"(640000)宁夏行政区划图",url:kO.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_650000:{name:"(650000)新疆行政区划图",url:AO.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_710000:{name:"(710000)台湾行政区划图",url:WO.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_810000:{name:"(810000)香港行政区划图",url:qO.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},china_820000:{name:"(820000)澳门行政区划图",url:RO.a,fieldNames:{name:"简称",adcode:"行政区划编码(6字母)"}},usa:{name:"USA",url:ww.a,fieldNames:{name:"Name",ns_code:"USA ANSI Code(8 character)",geoid:"Geographic ID",usps_abbrev:"USPS Abbreviation",fips_code:"FIPS Code (2-character)"}},subdiv_japan:{name:"Japan/Prefectures",url:_w.a,fieldNames:{name:"Name",name_alt:"Name (alternative)",name_local:"Name (local)",iso_3166_2:"ISO-3166-2",postal:"Postal Code",type:"Type",type_en:"Type (EN)",region:"Region",region_code:"Region Code"}}}},Object(l.pick)(Y,["dateFormat","dateTimeFormat","integerFormat","floatFormat","booleanValues","tableCellMaxJSONSize","allowCustomJSVisualizations","hidePlotlyModeBar"])),Object(l.extend)(Do,a),n.a.createElement(e,t)}}var VO=FO((function(e){var t=e.type,a=e.data,o=e.options,i=e.visualizationName,s=e.addonBefore,c=e.addonAfter,u=jp(e,["type","data","options","visualizationName","addonBefore","addonAfter"]),d=Object(r.useRef)(),m=Object(r.useRef)(),p=Op[t],f=p.Renderer,g=(0,p.getOptions)(o,a);return Object(l.isEqual)(d.current,g)&&(g=d.current),d.current=g,Object(r.useEffect)(()=>{m.current&&m.current.reset()},[o,a]),n.a.createElement("div",{className:"visualization-renderer"},s,n.a.createElement(j,{ref:m,renderError:()=>n.a.createElement(E,null,window.W_L.Error_while_rendering_visualization)},n.a.createElement("div",{className:"visualization-renderer-wrapper"},n.a.createElement(f,Ep({options:g,data:a,visualizationName:i},u)))),c)})),UO=FO((function(e){var t=e.type,a=e.options,o=e.data,i=Cp(e,["type","options","data"]),l=Op[t],s=l.Editor,c=l.getOptions,u=Object(r.useMemo)(()=>c(a,o),[a,o]);return n.a.createElement(s,Sp({options:u,data:o},i))}));function BO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return HO(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return HO(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function HO(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function YO(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function QO(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?YO(Object(a),!0).forEach((function(t){KO(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):YO(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function KO(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function $O(e,t){return 0===e.length||0===t.length?e:Object(l.map)(e,e=>{var a=Object(l.find)(t,t=>t.name===e.name);return a?QO(QO({},e),{},{current:a.current}):e})}function GO(e){var t=gw(e.queryResult),a=BO(Object(r.useState)(()=>$O(t.filters,e.filters)),2),o=a[0],i=a[1],s=Object(r.useRef)();s.current=o;var c=bw(t=>{var a,r;r=o,(a=t).length===r.length&&(a=Object(l.fromPairs)(Object(l.map)(a,e=>[e.name,e])),r=Object(l.fromPairs)(Object(l.map)(r,e=>[e.name,e])),Object(l.isEqual)(a,r))||(i(t),e.onFiltersChange(t))});Object(r.useEffect)(()=>{c($O(t.filters,e.filters))},[t.filters,e.filters,c]),Object(r.useEffect)(()=>{c($O(s.current,e.filters))},[e.filters,c]);var u=Object(r.useMemo)(()=>({columns:t.columns,rows:mw(t.rows,o)}),[t,o]),d=e.showFilters,m=e.visualization,p=QO({},m.options);return"TABLE"===m.type&&(p.paginationSize="widget"===e.context?"small":"default"),n.a.createElement(VO,{key:"visualization".concat(m.id),type:m.type,options:p,data:u,visualizationName:m.name,addonBefore:d&&n.a.createElement(fw,{filters:o,onChange:c})})}function JO(){return(JO=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function XO(e){var t=e.dialog,a=e.widget,r=e.filters;return n.a.createElement(R.a,JO({},t.props,{title:n.a.createElement(n.a.Fragment,null,n.a.createElement(aw,{visualization:a.visualization})," ",n.a.createElement("span",null,a.getQuery().name)),width:"95%",footer:n.a.createElement(m.a,{onClick:t.dismiss},window.W_L.close)}),n.a.createElement(GO,{visualization:a.visualization,queryResult:a.getQueryResult(),filters:r,context:"widget"}))}GO.propTypes={visualization:Zr.isRequired,queryResult:ae.a.object.isRequired,showFilters:ae.a.bool,filters:dw,onFiltersChange:ae.a.func,context:ae.a.oneOf(["query","widget"]).isRequired},GO.defaultProps={showFilters:!0,filters:[],onFiltersChange:()=>{}},XO.propTypes={dialog:ja.isRequired,widget:ae.a.object.isRequired,filters:dw},XO.defaultProps={filters:[]};var ZO=Sa(XO),e_=a(82),t_=a.n(e_),a_=a(315),r_=a.n(a_);a(1372);function n_(){return(n_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function o_(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i_(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return i_(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i_(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function l_(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var s_="dashboard-add-new",c_="dashboard-map-to-existing",u_="widget-level",d_="static-value";function m_(e){return Object(l.fromPairs)(Object(l.map)(e,e=>{var t=Object(l.extend)({},e);switch(e.type){case s_:case c_:t.type=Tp.DashboardLevel,t.value=null;break;case d_:t.type=Tp.StaticValue,t.param=Hr(e.param),t.param.setValue(t.value),t.value=t.param.value;break;case u_:t.type=Tp.WidgetLevel,t.value=null}return delete t.param,[t.name,t]}))}function p_(e,t){var a=[];return Object(l.each)(e,e=>{e.type===Tp.DashboardLevel&&Object(l.each)(t,t=>{var r=t.options.parameterMappings;Object(l.each)(r,r=>{r.type===Tp.DashboardLevel&&r.mapTo===e.mapTo&&r.title!==e.title&&(r.title=e.title,a.push(t))})})}),a}class f_ extends n.a.Component{constructor(){super(...arguments),l_(this,"formItemProps",{labelCol:{span:5},wrapperCol:{span:16},className:"form-item"}),l_(this,"updateSourceType",e=>{var t=this.props.mapping.mapTo,a=this.props.existingParamNames;e!==c_||Object(l.includes)(a,t)||(t=a[0]),this.updateParamMapping({type:e,mapTo:t})}),l_(this,"updateParamMapping",e=>{var t=this.props,a=t.onChange,r=t.mapping,n=Object(l.extend)({},r,e);n.value!==r.value&&(n.param=Hr(n.param),n.param.setValue(n.value)),Object(l.has)(e,"type")&&(e.type===d_?n.value=n.param.value:n.value=null),a(n)})}renderMappingTypeSelector(){var e=Object(l.isEmpty)(this.props.existingParamNames);return n.a.createElement(Kn.a.Group,{value:this.props.mapping.type,onChange:e=>this.updateSourceType(e.target.value)},n.a.createElement(Kn.a,{className:"radio",value:s_,"data-test":"NewDashboardParameterOption"},window.W_L.new_dashboard_parm),n.a.createElement(Kn.a,{className:"radio",value:c_,disabled:e},window.W_L.exist_dashboard_parm," ",e?n.a.createElement(we,{title:window.W_L.dashboard_param_error},n.a.createElement(Io.a,null)):null),n.a.createElement(Kn.a,{className:"radio",value:u_,"data-test":"WidgetParameterOption"},window.W_L.widget_parm),n.a.createElement(Kn.a,{className:"radio",value:d_,"data-test":"StaticValueOption"},window.W_L.static_value))}renderDashboardAddNew(){var e=this.props.mapping.mapTo;return n.a.createElement(va.a,{value:e,"aria-label":"Parameter name (key)",onChange:e=>this.updateParamMapping({mapTo:e.target.value})})}renderDashboardMapToExisting(){var e=this.props,t=e.mapping,a=e.existingParamNames,r=Object(l.map)(a,e=>({label:e,value:e}));return n.a.createElement(dn.a,{value:t.mapTo,onChange:e=>this.updateParamMapping({mapTo:e}),options:r})}renderStaticValue(){var e=this.props.mapping;return n.a.createElement(qv,{type:e.param.type,value:e.param.normalizedValue,enumOptions:e.param.enumOptions,queryId:e.param.queryId,parameter:e.param,onSelect:e=>this.updateParamMapping({value:e})})}renderInputBlock(){switch(this.props.mapping.type){case s_:return["Key",window.W_L.enter_parm_name,this.renderDashboardAddNew()];case c_:return["Key",window.W_L.select_parm,this.renderDashboardMapToExisting()];case d_:return["Value",null,this.renderStaticValue()];default:return[]}}render(){var e=this.props.inputError,t=o_(this.renderInputBlock(),3),a=t[0],r=t[1],o=t[2];return n.a.createElement(ih.a,{layout:"horizontal"},n.a.createElement(ih.a.Item,n_({label:window.W_L.source},this.formItemProps),this.renderMappingTypeSelector()),n.a.createElement(ih.a.Item,n_({style:{height:60,visibility:o?"visible":"hidden"},label:a},this.formItemProps,{validateStatus:e?"error":"",help:e||r}),o))}}l_(f_,"propTypes",{mapping:ae.a.object,existingParamNames:ae.a.arrayOf(ae.a.string),onChange:ae.a.func,inputError:ae.a.string}),l_(f_,"defaultProps",{mapping:{},existingParamNames:[],onChange:()=>{},inputError:null});class g_ extends n.a.Component{constructor(e){super(e),l_(this,"onVisibleChange",e=>{e?this.show():this.hide()}),l_(this,"onChange",e=>{var t=null;e.type===s_&&(Object(l.isEmpty)(e.mapTo)?t=window.W_L.code_mast_have_value:Object(l.includes)(this.props.existingParamNames,e.mapTo)&&(t=window.W_L.exist_save_parm)),this.setState({mapping:e,inputError:t})}),l_(this,"save",()=>{this.props.onChange(this.props.mapping,this.state.mapping),this.hide()}),l_(this,"show",()=>{this.setState({visible:!0,mapping:Object(l.clone)(this.props.mapping)})}),l_(this,"hide",()=>{this.setState({visible:!1})}),this.state={visible:!1,mapping:Object(l.clone)(this.props.mapping),inputError:null}}renderContent(){var e=this.state,t=e.mapping,a=e.inputError;return n.a.createElement("div",{className:"parameter-mapping-editor","data-test":"EditParamMappingPopover"},n.a.createElement("header",null,window.W_L.edit_source_value," ",n.a.createElement($e,{type:"VALUE_SOURCE_OPTIONS"})),n.a.createElement(f_,{mapping:t,existingParamNames:this.props.existingParamNames,onChange:this.onChange,inputError:a}),n.a.createElement("footer",null,n.a.createElement(m.a,{onClick:this.hide},window.W_L.cancel),n.a.createElement(m.a,{onClick:this.save,disabled:!!a,type:"primary"},window.W_L.ok_text)))}render(){var e=this.state,t=e.visible,a=e.mapping;return n.a.createElement(hn.a,{placement:"left",trigger:"click",content:this.renderContent(),visible:t,onVisibleChange:this.onVisibleChange},n.a.createElement(m.a,{size:"small",type:"dashed","data-test":"EditParamMappingButton-".concat(a.param.name)},n.a.createElement(r_.a,null)))}}l_(g_,"propTypes",{mapping:ae.a.object.isRequired,existingParamNames:ae.a.arrayOf(ae.a.string).isRequired,onChange:ae.a.func.isRequired});class b_ extends n.a.Component{constructor(){super(...arguments),l_(this,"state",{showPopup:!1,title:""}),l_(this,"onPopupVisibleChange",e=>{this.setState({showPopup:e,title:e?this.getMappingTitle():""})}),l_(this,"onEditingTitleChange",e=>{this.setState({title:e.target.value})}),l_(this,"save",()=>{var e=Object(l.extend)({},this.props.mapping,{title:this.state.title});this.props.onChange(e),this.hide()}),l_(this,"hide",()=>{this.setState({showPopup:!1})})}getMappingTitle(){var e=this.props.mapping;if(Object(l.isString)(e.title)&&""!==e.title)return e.title;if(e.type===c_){var t=Object(l.find)(this.props.existingParams,{name:e.mapTo});t&&(e=t)}return e.title||e.param.title}renderPopover(){var e=this.props.mapping.param.title;return n.a.createElement("div",{className:"parameter-mapping-title-editor"},n.a.createElement(va.a,{size:"small",value:this.state.title,placeholder:e,"aria-label":"Edit parameter title",onChange:this.onEditingTitleChange,onPressEnter:this.save,maxLength:100,autoFocus:!0}),n.a.createElement(m.a,{size:"small",type:"dashed",onClick:this.hide},n.a.createElement(je.a,null)),n.a.createElement(m.a,{size:"small",type:"dashed",onClick:this.save},n.a.createElement(jn.a,null)))}renderEditButton(){return this.props.mapping.type===d_?n.a.createElement(we,{placement:"right",title:window.W_L.title_set_hidden_in_widget},n.a.createElement("span",{tabIndex:0},n.a.createElement("i",{className:"fa fa-eye-slash","aria-hidden":"true"}))):n.a.createElement(hn.a,{placement:"right",trigger:"click",content:this.renderPopover(),visible:this.state.showPopup,onVisibleChange:this.onPopupVisibleChange},n.a.createElement(m.a,{size:"small",type:"dashed"},n.a.createElement(r_.a,null)))}render(){var e=this.props.mapping.type===d_;return n.a.createElement("div",{className:me()("parameter-mapping-title",{disabled:e})},n.a.createElement("span",{className:"text"},this.getMappingTitle()),this.renderEditButton())}}l_(b_,"propTypes",{existingParams:ae.a.arrayOf(ae.a.object),mapping:ae.a.object.isRequired,onChange:ae.a.func.isRequired}),l_(b_,"defaultProps",{existingParams:[]});class h_ extends n.a.Component{static getStringValue(e){return e?e instanceof Object&&"start"in e&&"end"in e?"".concat(e.start," ~ ").concat(e.end):"object"==typeof e?Object(l.map)(e,e=>this.getStringValue(e)).join(", "):e.toString():""}static getDefaultValue(e,t){var a=e.type,r=e.mapTo,n=e.name,o=e.param;if(a===c_&&r!==n){var i=Object(l.find)(t,{name:r});i&&(o=i)}else a===d_&&(o=Hr(o).setValue(e.value));var s=Va.getExecutionValue(o);return o.hasDynamicValue&&(s=o.normalizedValue.name),this.getStringValue(s)}static getSourceTypeLabel(e){var t=e.type,a=e.mapTo;switch(t){case s_:case c_:return n.a.createElement(r.Fragment,null,window.W_L.dashboard_parm," ",n.a.createElement(t_.a,{className:"tag"},a));case u_:return window.W_L.widget_parm;case d_:return window.W_L.static_value;default:return""}}updateParamMapping(e,t){var a=[...this.props.mappings],r=Object(l.findIndex)(a,e);r>=0?a[r]=t:a.push(t),this.props.onChange(a)}render(){var e=this.props.existingParams,t=this.props.mappings.map(e=>({mapping:e}));return n.a.createElement("div",{className:"parameters-mapping-list"},n.a.createElement(Zl.a,{dataSource:t,size:"middle",pagination:!1,rowKey:(e,t)=>"row".concat(t)},n.a.createElement(Zl.a.Column,{title:window.W_L.name,dataIndex:"mapping",key:"title",render:t=>n.a.createElement(b_,{existingParams:e,mapping:t,onChange:e=>this.updateParamMapping(t,e)})}),n.a.createElement(Zl.a.Column,{title:window.W_L.code,dataIndex:"mapping",key:"keyword",className:"keyword",render:e=>n.a.createElement("code",null,"{{ ".concat(e.name," }}"))}),n.a.createElement(Zl.a.Column,{title:window.W_L.default_value,dataIndex:"mapping",key:"value",render:e=>this.constructor.getDefaultValue(e,this.props.existingParams)}),n.a.createElement(Zl.a.Column,{title:window.W_L.source,dataIndex:"mapping",key:"source",render:t=>{var a=e.filter(e=>e.type===t.param.type).map(e=>e.name);return n.a.createElement(r.Fragment,null,this.constructor.getSourceTypeLabel(t)," ",n.a.createElement(g_,{mapping:t,existingParamNames:a,onChange:(e,t)=>this.updateParamMapping(e,t)}))}})))}}function y_(){return(y_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function v_(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function w_(e,t){return Object(l.map)(Object(l.sortBy)(e,e=>e.name),e=>{var a;switch(e.type){case d_:return[e.name,e.value];case u_:return[e.name,e.param.value];case s_:case c_:return a=Object(l.find)(t,t=>t.name===e.mapTo),[e.name,a?a.value:null]}})}l_(h_,"propTypes",{mappings:ae.a.arrayOf(ae.a.object),existingParams:ae.a.arrayOf(ae.a.object),onChange:ae.a.func}),l_(h_,"defaultProps",{mappings:[],existingParams:[],onChange:()=>{}});class O_ extends n.a.Component{constructor(e){super(e),v_(this,"originalParamValuesSnapshot",null);var t=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return Object(l.map)(e,e=>{var r=Object(l.extend)({},e),n=Object(l.includes)(a,e.mapTo);switch(r.param=Object(l.find)(t,t=>t.name===e.name),e.type){case Tp.DashboardLevel:r.type=n?c_:s_,r.value=null;break;case Tp.StaticValue:r.type=d_,r.param=Hr(r.param),r.param.setValue(r.value);break;case Tp.WidgetLevel:r.type=u_,r.value=null}return r})}(e.widget.options.parameterMappings,e.widget.query.getParametersDefs(),Object(l.map)(this.props.dashboard.getParametersDefs(),e=>e.name));this.originalParamValuesSnapshot=w_(t,this.props.dashboard.getParametersDefs()),this.state={saveInProgress:!1,parameterMappings:t}}saveWidget(){var e=this.props.widget;this.setState({saveInProgress:!0});var t=m_(this.state.parameterMappings);e.options.parameterMappings=t;var a=!Object(l.isMatch)(this.originalParamValuesSnapshot,w_(this.state.parameterMappings,this.props.dashboard.getParametersDefs())),r=[e,...p_(e.options.parameterMappings,this.props.dashboard.widgets)];Promise.all(Object(l.map)(r,e=>e.save())).then(()=>{this.props.dialog.close(a)}).catch(()=>{uf.error("Widget cannot be updated")}).finally(()=>{this.setState({saveInProgress:!1})})}updateParamMappings(e){this.setState({parameterMappings:e})}render(){var e=this.props.dialog;return n.a.createElement(R.a,y_({},e.props,{title:window.W_L.params,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,onOk:()=>this.saveWidget(),okButtonProps:{loading:this.state.saveInProgress},width:700}),this.state.parameterMappings.length>0&&n.a.createElement(h_,{mappings:this.state.parameterMappings,existingParams:this.props.dashboard.getParametersDefs(),onChange:e=>this.updateParamMappings(e)}))}}v_(O_,"propTypes",{dashboard:ae.a.object.isRequired,widget:ae.a.object.isRequired,dialog:ja.isRequired});var __=Sa(O_);a(1373);function E_(){return(E_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function j_(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function S_(e){var t=e.extraOptions,a=e.showDeleteOption,r=e.onDelete,o=n.a.createElement(ue.a,{"data-test":"WidgetDropdownButtonMenu"},t,a&&t&&n.a.createElement(ue.a.Divider,null),a&&n.a.createElement(ue.a.Item,{onClick:r},window.W_L.delete));return n.a.createElement("div",{className:"widget-menu-regular"},n.a.createElement(aa.a,{overlay:o,placement:"bottomRight",trigger:["click"]},n.a.createElement(ge,{className:"action p-l-15 p-r-15","data-test":"WidgetDropdownButton","aria-label":"More options"},n.a.createElement("i",{className:"zmdi zmdi-more-vert","aria-hidden":"true"}))))}function C_(e){var t=e.onClick;return n.a.createElement("div",{className:"widget-menu-remove"},n.a.createElement(ge,{className:"action",title:"{window.W_L.delete}",onClick:t,"data-test":"WidgetDeleteButton","aria-label":"Close"},n.a.createElement("i",{className:"zmdi zmdi-close","aria-hidden":"true"})))}S_.propTypes={extraOptions:ae.a.node,showDeleteOption:ae.a.bool,onDelete:ae.a.func},S_.defaultProps={extraOptions:null,showDeleteOption:!1,onDelete:()=>{}},C_.propTypes={onClick:ae.a.func},C_.defaultProps={onClick:()=>{}};class x_ extends n.a.Component{constructor(){super(...arguments),j_(this,"deleteWidget",()=>{var e=this.props,t=e.widget,a=e.onDelete;R.a.confirm({title:window.W_L.delete_widget,content:window.W_L.delete_widget_confirm,cancelText:window.W_L.cancel,okText:window.W_L.ok_text,okType:"danger",onOk:()=>t.delete().then(a),maskClosable:!0,autoFocusButton:null})})}componentDidMount(){La("view","widget",this.props.widget.id)}render(){var e=this.props,t=e.className,a=e.children,r=e.header,o=e.footer,i=e.canEdit,s=e.isPublic,c=e.menuOptions,u=e.tileProps,d=!s&&(i||!Object(l.isEmpty)(c));return n.a.createElement("div",{className:"widget-wrapper"},n.a.createElement("div",E_({className:me()("tile body-container",t)},u),n.a.createElement("div",{className:"widget-actions"},d&&n.a.createElement(S_,{extraOptions:c,showDeleteOption:i,onDelete:this.deleteWidget}),i&&n.a.createElement(C_,{onClick:this.deleteWidget})),n.a.createElement("div",{className:"body-row widget-header"},r),a,o&&n.a.createElement("div",{className:"body-row tile__bottom-control"},o)))}}j_(x_,"propTypes",{widget:ae.a.object.isRequired,className:ae.a.string,children:ae.a.node,header:ae.a.node,footer:ae.a.node,canEdit:ae.a.bool,isPublic:ae.a.bool,refreshStartedAt:Jf,menuOptions:ae.a.node,tileProps:ae.a.object,onDelete:ae.a.func}),j_(x_,"defaultProps",{className:"",children:null,header:null,footer:null,canEdit:!1,isPublic:!1,refreshStartedAt:null,menuOptions:null,tileProps:{},onDelete:()=>{}});var P_=x_;function L_(){return(L_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function k_(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function N_(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return A_(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return A_(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A_(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function T_(e){var t=e.widget,a=e.canEditDashboard,r=e.onParametersEdit,o=(e.isShowReport,H.hasPermission("view_query")),i=a&&!Object(l.isEmpty)(Object(l.invoke)(t,"query.getParametersDefs")),s=t.getQueryResult(),c=!s||!s.isEmpty||s.isEmpty(),u=e=>s.getLink(t.getQuery().id,e),d=e=>s.getName(t.getQuery().name,e);return Object(l.compact)([n.a.createElement(ue.a.Item,{key:"download_csv",disabled:c},c?window.W_L.save_as_csv:n.a.createElement(h,{href:u("csv"),download:d("csv"),target:"_self"},window.W_L.save_as_csv)),n.a.createElement(ue.a.Item,{key:"download_tsv",disabled:c},c?window.W_L.save_as_tsv:n.a.createElement(h,{href:u("tsv"),download:d("tsv"),target:"_self"},window.W_L.save_as_tsv)),n.a.createElement(ue.a.Item,{key:"download_excel",disabled:c},c?window.W_L.save_as_excel:n.a.createElement(h,{href:u("xlsx"),download:d("xlsx"),target:"_self"},window.W_L.save_as_excel)),(o||i)&&n.a.createElement(ue.a.Divider,{key:"divider"}),o&&n.a.createElement(ue.a.Item,{key:"view_query"},n.a.createElement(h,{href:t.getQuery().getUrl(!0,t.visualization.id)},window.W_L.edit_query)),i&&n.a.createElement(ue.a.Item,{key:"edit_parameters",onClick:r},window.W_L.edit_param)])}function W_(e){var t=e.refreshStartedAt;return n.a.createElement("div",{className:"refresh-indicator"},n.a.createElement("div",{className:"refresh-icon"},n.a.createElement("i",{className:"zmdi zmdi-refresh zmdi-hc-spin","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Refreshing...")),n.a.createElement(ew,{from:t}))}function I_(e){var t=e.widget,a=e.refreshStartedAt,r=e.parameters,o=e.isEditing,i=e.onParametersUpdate,s=e.onParametersEdit,c=H.hasPermission("view_query");return n.a.createElement(n.a.Fragment,null,n.a.createElement(W_,{refreshStartedAt:a}),n.a.createElement("div",{className:"t-header widget clearfix"},n.a.createElement("div",{className:"th-title"},n.a.createElement("p",null,n.a.createElement(ow,{query:t.getQuery(),visualization:t.visualization,readOnly:!c})),!Object(l.isEmpty)(t.getQuery().description)&&n.a.createElement(We,{className:"text-muted markdown query--description"},Ie.markdown.toHTML(t.getQuery().description||"")))),!Object(l.isEmpty)(r)&&n.a.createElement("div",{className:"m-b-10"},n.a.createElement(Jv,{parameters:r,sortable:o,appendSortableToParent:!1,onValuesChange:i,onParametersEdit:s})))}function q_(e){var t=e.widget,a=e.isPublic,o=e.onRefresh,i=e.onExpand,s=t.getQueryResult(),c=Object(l.invoke)(s,"getUpdatedAt"),u=N_(Object(r.useState)(),2),d=u[0],m=u[1],p=e=>{d||(m(e),o().finally(()=>m(null)))};return s?n.a.createElement(n.a.Fragment,null,n.a.createElement("span",null,!a&&!!s&&n.a.createElement(ge,{className:"refresh-button hidden-print btn btn-sm btn-default btn-transparent",onClick:()=>p(1),"data-test":"RefreshButton"},n.a.createElement("i",{className:me()("zmdi zmdi-refresh",{"zmdi-hc-spin":1===d}),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},1===d?"Refreshing, please wait. ":"Press to refresh. ")," ",n.a.createElement(eg,{date:c})),n.a.createElement("span",{className:"visible-print"},n.a.createElement("i",{className:"zmdi zmdi-time-restore","aria-hidden":"true"})," ",ig(c)),a&&n.a.createElement("span",{className:"small hidden-print"},n.a.createElement("i",{className:"zmdi zmdi-time-restore","aria-hidden":"true"})," ",n.a.createElement(eg,{date:c}))),n.a.createElement("span",null,!a&&n.a.createElement(ge,{className:"btn btn-sm btn-default hidden-print btn-transparent btn__refresh",onClick:()=>p(2)},n.a.createElement("i",{className:me()("zmdi zmdi-refresh",{"zmdi-hc-spin":2===d}),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},2===d?"Refreshing, please wait.":"Press to refresh.")),n.a.createElement(ge,{className:"btn btn-sm btn-default hidden-print btn-transparent btn__refresh",onClick:i},n.a.createElement("i",{className:"zmdi zmdi-fullscreen","aria-hidden":"true"})))):null}W_.propTypes={refreshStartedAt:Jf},W_.defaultProps={refreshStartedAt:null},I_.propTypes={widget:ae.a.object.isRequired,refreshStartedAt:Jf,parameters:ae.a.arrayOf(ae.a.object),isEditing:ae.a.bool,onParametersUpdate:ae.a.func,onParametersEdit:ae.a.func},I_.defaultProps={refreshStartedAt:null,onParametersUpdate:()=>{},onParametersEdit:()=>{},isEditing:!1,parameters:[]},q_.propTypes={widget:ae.a.object.isRequired,isPublic:ae.a.bool,onRefresh:ae.a.func.isRequired,onExpand:ae.a.func.isRequired},q_.defaultProps={isPublic:!1};class D_ extends n.a.Component{constructor(e){super(e),k_(this,"onLocalFiltersChange",e=>{this.setState({localFilters:e})}),k_(this,"expandWidget",()=>{ZO.showModal({widget:this.props.widget,filters:this.state.localFilters})}),k_(this,"editParameterMappings",()=>{var e=this.props,t=e.widget,a=e.dashboard,r=e.onRefresh,n=e.onParameterMappingsChange;__.showModal({dashboard:a,widget:t}).onClose(e=>{e&&r(),n(),this.setState({localParameters:t.getLocalParameters()})})}),this.state={localParameters:e.widget.getLocalParameters(),localFilters:e.filters}}componentDidMount(){var e=this.props,t=e.widget,a=e.onLoad;La("view","query",t.visualization.query.id,{dashboard:!0}),La("view","visualization",t.visualization.id,{dashboard:!0}),a()}renderVisualization(){var e=this.props,t=e.widget,a=e.filters,r=t.getQueryResult();switch(r&&r.getStatus()){case"failed":return n.a.createElement("div",{className:"body-row-auto scrollbox"},r.getError()&&n.a.createElement("div",{className:"alert alert-danger m-5"},window.W_L.query_error,"： ",n.a.createElement("strong",null,r.getError())));case"done":return n.a.createElement("div",{className:"body-row-auto scrollbox"},n.a.createElement(GO,{visualization:t.visualization,queryResult:r,filters:a,onFiltersChange:this.onLocalFiltersChange,context:"widget"}));default:return n.a.createElement("div",{className:"body-row-auto spinner-container",role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("div",{className:"spinner"},n.a.createElement("i",{className:"zmdi zmdi-refresh zmdi-hc-spin zmdi-hc-5x","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Loading...")))}}render(){var e=this.props,t=e.widget,a=e.isLoading,r=e.isPublic,o=e.canEdit,i=e.isEditing,s=e.onRefresh,c=e.isShowReport,u=this.state.localParameters,d=t.getQueryResult(),m=a&&!(!d||!d.getStatus());return n.a.createElement(P_,L_({},this.props,{className:"widget-visualization",menuOptions:T_({widget:t,canEditDashboard:o,onParametersEdit:this.editParameterMappings,isShowReport:c}),header:n.a.createElement(I_,{widget:t,refreshStartedAt:m?t.refreshStartedAt:null,parameters:u,isEditing:i,onParametersUpdate:s,onParametersEdit:e=>{var a=Object(l.map)(e,"name");t.options.paramOrder=a,t.save("options",{paramOrder:a})}}),footer:n.a.createElement(q_,{widget:t,isPublic:r,onRefresh:s,onExpand:this.expandWidget}),tileProps:{"data-refreshing":m}}),this.renderVisualization())}}k_(D_,"propTypes",{widget:ae.a.object.isRequired,dashboard:ae.a.object.isRequired,filters:dw,isPublic:ae.a.bool,isLoading:ae.a.bool,canEdit:ae.a.bool,isEditing:ae.a.bool,onLoad:ae.a.func,onRefresh:ae.a.func,onDelete:ae.a.func,onParameterMappingsChange:ae.a.func,isShowReport:ae.a.bool}),k_(D_,"defaultProps",{filters:[],isPublic:!1,isLoading:!1,canEdit:!1,isEditing:!1,onLoad:()=>{},onRefresh:()=>{},onDelete:()=>{},onParameterMappingsChange:()=>{},isShowReport:!0});var R_=D_;a(1374);function M_(){return(M_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function z_(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return F_(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return F_(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F_(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function V_(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function U_(e){var t=e.dialog,a=e.isNew,o=V_(e,["dialog","isNew"]),i=z_(Object(r.useState)(Object(l.toString)(o.text)),2),s=i[0],c=i[1],u=z_(Object(r.useState)(null),2),d=u[0],m=u[1];Object(r.useEffect)(()=>{c(o.text),m(Ie.markdown.toHTML(o.text))},[o.text]);var p=z_(Object(Ul.a)(()=>{m(Ie.markdown.toHTML(s))},200),1)[0],f=Object(r.useCallback)(e=>{c(e.target.value),p()},[p]),g=Object(r.useCallback)(()=>{t.close(s).catch(()=>{uf.error(a?window.W_L.widget_will_not_add:window.W_L.widget_will_not_save)})},[t,a,s]),b=Object(r.useCallback)(()=>{var e=o.text;s!==e?R.a.confirm({title:window.W_L.quit_edit,content:window.W_L.quit_edit_confirm,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,okType:"danger",onOk:()=>t.dismiss(),maskClosable:!0,autoFocusButton:null,style:{top:170}}):t.dismiss()},[t,s,o.text]);return n.a.createElement(R.a,M_({},t.props,{title:a?window.W_L.add_text:window.W_L.edit_text,onOk:g,okText:a?window.W_L.add_to_dashboard:window.W_L.save,cancelText:window.W_L.save,onCancel:b,width:500,wrapProps:{"data-test":"TextboxDialog"}}),n.a.createElement("div",{className:"textbox-dialog"},n.a.createElement(va.a.TextArea,{className:"resize-vertical",rows:"5",value:s,"aria-label":"Textbox widget content",onChange:f,autoFocus:!0,placeholder:window.W_L.input_text}),n.a.createElement("small",null,window.W_L.support_basic," ",n.a.createElement(h,{target:"_blank",rel:"noopener noreferrer",href:"https://www.markdownguide.org/cheat-sheet/#basic-syntax"},n.a.createElement(we,{title:window.W_L.open_markdown},"Markdown")),"；",n.a.createElement(h,{target:"_blank",rel:"noopener noreferrer",href:"https://www.runoob.com/markdown/md-tutorial.html"},n.a.createElement(we,{title:window.W_L.open_markdown_teach},window.W_L.open_markdown_teach," ")),"。"),s&&n.a.createElement(n.a.Fragment,null,n.a.createElement(dh.a,{dashed:!0}),n.a.createElement("strong",{className:"preview-title"},window.W_L.preview,"："),n.a.createElement(We,{className:"preview markdown"},d))))}U_.propTypes={dialog:ja.isRequired,isNew:ae.a.bool,text:ae.a.string},U_.defaultProps={isNew:!1,text:""};var B_=Sa(U_);function H_(){return(H_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Y_(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Q_(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Q_(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Q_(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function K_(e){var t=e.widget,a=e.canEdit,o=Y_(Object(r.useState)(t.text),2),i=o[0],l=o[1],s=[n.a.createElement(ue.a.Item,{key:"edit",onClick:()=>{B_.showModal({text:t.text}).onClose(e=>(t.text=e,l(e),t.save()))}},window.W_L.edit)];return t.width?n.a.createElement(P_,H_({},e,{menuOptions:a?s:null,className:"widget-text"}),n.a.createElement(We,{className:"body-row-auto scrollbox t-body p-15 markdown"},Ie.markdown.toHTML(i||""))):null}K_.propTypes={widget:ae.a.object.isRequired,canEdit:ae.a.bool},K_.defaultProps={canEdit:!1};var $_=K_;function G_(){return(G_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var J_=function(e){return n.a.createElement(P_,G_({},e,{className:"d-flex justify-content-center align-items-center widget-restricted"}),n.a.createElement("div",{className:"t-body scrollbox"},n.a.createElement("div",{className:"text-center"},n.a.createElement("h1",null,n.a.createElement("span",{className:"zmdi zmdi-lock"})),n.a.createElement("p",{className:"text-muted"},window.W_L.widget_have_no_access))))};function X_(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Z_(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Z_(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Z_(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function eE(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var tE=[".widget-header",".visualization-renderer",".scrollbox .alert",".spinner-container",".tile__bottom-control"].join(",");class aE{constructor(e){eE(this,"widgets",{}),eE(this,"interval",null),eE(this,"onHeightChange",null),eE(this,"add",e=>{this.isEmpty()&&this.start();var t='[data-widgetid="{0}"]'.replace("{0}",e);this.widgets[e]=[function(){var e=document.querySelector(t);if(e){var a=e.querySelectorAll(tE);return Object(l.reduce)(a,(e,t)=>e+(t?t.getBoundingClientRect().height:0),0)}}]}),eE(this,"remove",e=>{this.exists(e)&&(this.widgets[e.toString()]=!1,this.isEmpty()&&this.stop())}),eE(this,"exists",e=>!!this.widgets[e.toString()]),eE(this,"isEmpty",()=>!Object(l.some)(this.widgets)),eE(this,"checkHeightChanges",()=>{Object.keys(this.widgets).filter(this.exists).forEach(e=>{var t=X_(this.widgets[e],2),a=t[0],r=t[1],n=a();n&&n!==r&&(this.widgets[e][1]=n,this.onHeightChange(e,n))})}),eE(this,"start",()=>{this.stop(),this.interval=setInterval(this.checkHeightChanges,200)}),eE(this,"stop",()=>{clearInterval(this.interval)}),eE(this,"resume",()=>{this.isEmpty()||this.start()}),eE(this,"destroy",()=>{this.stop(),this.widgets=null}),this.onHeightChange=e}update(e){var t=e.filter(e=>e.options.position.autoHeight).map(e=>e.id.toString());t.filter(e=>!Object(l.includes)(Object.keys(this.widgets),e)).forEach(this.add),Object.keys(this.widgets).filter(e=>!Object(l.includes)(t,e)).forEach(this.remove)}}a(1375),a(1376);function rE(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var nE=Object(Oy.WidthProvider)(Oy.Responsive),oE=ae.a.shape({id:ae.a.number.isRequired,options:ae.a.shape({position:ae.a.shape({col:ae.a.number.isRequired,row:ae.a.number.isRequired,sizeY:ae.a.number.isRequired,minSizeY:ae.a.number.isRequired,maxSizeY:ae.a.number.isRequired,sizeX:ae.a.number.isRequired,minSizeX:ae.a.number.isRequired,maxSizeX:ae.a.number.isRequired}).isRequired}).isRequired}),iE="single-column",lE="multi-column",sE=n.a.memo((function(e){var t=e.widget,a=e.dashboard,r=e.onLoadWidget,o=e.onRefreshWidget,i=e.onRemoveWidget,l=e.onParameterMappingsChange,s=e.isEditing,c=e.canEdit,u=e.isPublic,d=e.isLoading,m=e.filters,p=e.isShowReport,f=t.type,g=()=>i(t.id);return f===Pp?n.a.createElement(R_,{isShowReport:p,widget:t,dashboard:a,filters:m,isEditing:s,canEdit:c,isPublic:u,isLoading:d,onLoad:()=>r(t),onRefresh:()=>o(t),onDelete:g,onParameterMappingsChange:l}):f===xp?n.a.createElement($_,{widget:t,canEdit:c,isPublic:u,onDelete:g}):n.a.createElement(J_,{widget:t})}),(e,t)=>e.widget===t.widget&&e.canEdit===t.canEdit&&e.isPublic===t.isPublic&&e.isLoading===t.isLoading&&e.filters===t.filters&&e.isEditing===t.isEditing);class cE extends n.a.Component{static normalizeFrom(e){var t=e.id,a=e.options.position;return{i:t.toString(),x:a.col,y:a.row,w:a.sizeX,h:a.sizeY,minW:a.minSizeX,maxW:a.maxSizeX,minH:a.minSizeY,maxH:a.maxSizeY}}constructor(e){super(e),rE(this,"mode",null),rE(this,"autoHeightCtrl",null),rE(this,"onLayoutChange",(e,t)=>{if(t[lE]&&this.setState({layouts:t}),this.mode=document.body.offsetWidth<=Ta?iE:lE,this.mode!==iE){var a=Object(l.chain)(t[lE]).keyBy("i").mapValues(this.normalizeTo).value();this.props.onLayoutChange(a)}}),rE(this,"onBreakpointChange",e=>{this.mode=e,this.props.onBreakpointChange(e===iE)}),rE(this,"onWidgetHeightUpdated",(e,t)=>{this.setState(a=>{var r=a.layouts,n=Object(l.cloneDeep)(r[lE]),o=Object(l.find)(n,{i:e.toString()});return o&&(o.h=Math.ceil((t+Aa)/Na)),{layouts:{[lE]:n}}})}),rE(this,"onWidgetResize",(e,t,a)=>{t.h!==a.h&&this.autoHeightCtrl.remove(Number(a.i)),this.autoHeightCtrl.resume()}),rE(this,"normalizeTo",e=>({col:e.x,row:e.y,sizeX:e.w,sizeY:e.h,autoHeight:this.autoHeightCtrl.exists(e.i)})),this.state={layouts:{},disableAnimations:!0},this.autoHeightCtrl=new aE(this.onWidgetHeightUpdated),this.autoHeightCtrl.update(this.props.widgets)}componentDidMount(){this.onBreakpointChange(document.body.offsetWidth<=Ta?iE:lE),setTimeout(()=>{this.setState({disableAnimations:!1})},50)}componentDidUpdate(){this.autoHeightCtrl.update(this.props.widgets)}componentWillUnmount(){this.autoHeightCtrl.destroy()}render(){var e=this.props,t=e.onLoadWidget,a=e.onRefreshWidget,r=e.onRemoveWidget,o=e.onParameterMappingsChange,i=e.filters,l=e.dashboard,s=e.isPublic,c=e.isEditing,u=e.widgets,d=e.isShowReport,m=me()("dashboard-wrapper",c?"editing-mode":"preview-mode");return n.a.createElement("div",{className:m},n.a.createElement(nE,{draggableCancel:"input,.sortable-container",className:me()("layout",{"disable-animations":this.state.disableAnimations}),cols:{[lE]:ka,[iE]:1},rowHeight:Na-Aa,margin:[Aa,Aa],isDraggable:c,isResizable:c,onResizeStart:this.autoHeightCtrl.stop,onResizeStop:this.onWidgetResize,layouts:this.state.layouts,onLayoutChange:this.onLayoutChange,onBreakpointChange:this.onBreakpointChange,breakpoints:{[lE]:Ta,[iE]:0}},u.map(e=>n.a.createElement("div",{key:e.id,"data-grid":cE.normalizeFrom(e),"data-widgetid":e.id,"data-test":"WidgetId".concat(e.id),className:me()("dashboard-widget-wrapper",{"widget-auto-height-enabled":this.autoHeightCtrl.exists(e.id)})},n.a.createElement(sE,{dashboard:l,widget:e,filters:i,isPublic:s,isLoading:e.loading,isEditing:c,canEdit:l.canEdit(),onLoadWidget:t,onRefreshWidget:a,isShowReport:d,onRemoveWidget:r,onParameterMappingsChange:o})))))}}rE(cE,"propTypes",{isEditing:ae.a.bool.isRequired,isPublic:ae.a.bool,dashboard:ae.a.object.isRequired,widgets:ae.a.arrayOf(oE).isRequired,filters:dw,onBreakpointChange:ae.a.func,onLoadWidget:ae.a.func,onRefreshWidget:ae.a.func,onRemoveWidget:ae.a.func,onLayoutChange:ae.a.func,onParameterMappingsChange:ae.a.func,isShowReport:ae.a.bool}),rE(cE,"defaultProps",{isPublic:!1,filters:[],onLoadWidget:()=>{},onRefreshWidget:()=>{},onRemoveWidget:()=>{},onLayoutChange:()=>{},onBreakpointChange:()=>{},onParameterMappingsChange:()=>{},isShowReport:!0});var uE=cE;function dE(){return(dE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function mE(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function pE(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?mE(Object(a),!0).forEach((function(t){fE(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):mE(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function fE(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function gE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return bE(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return bE(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bE(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function hE(e){var t=e.query,a=e.visualization,o=e.onChange,i=Object(r.useMemo)(()=>t?Object(l.groupBy)(t.visualizations,"type"):{},[t]),s=Se("visualization-select"),c=Object(r.useCallback)(e=>{var a=t?Object(l.find)(t.visualizations,{id:e}):null;o(a||null)},[t,o]);if(!t)return null;var u={BOXPLOT:window.W_L.BOXPLOT,CHART:window.W_L.CHART,CHOROPLETH:window.W_L.CHOROPLETH,COHORT:window.W_L.COHORT,COUNTER:window.W_L.COUNTER,DETAILS:window.W_L.DETAILS,FUNNEL:window.W_L.FUNNEL,MAP:window.W_L.MAP,PIVOT:window.W_L.PIVOT,SANKEY:window.W_L.SANKEY,SUNBURST_SEQUENCE:window.W_L.SUNBURST_SEQUENCE,TABLE:window.W_L.TABLE,WORD_CLOUD:window.W_L.WORD_CLOUD};return n.a.createElement("div",null,n.a.createElement("div",{className:"form-group"},n.a.createElement("label",{htmlFor:s},window.W_L.select_view),n.a.createElement(dn.a,{id:s,className:"w-100",value:a?a.id:void 0,onChange:c},Object(l.map)(i,(e,t)=>n.a.createElement(dn.a.OptGroup,{key:t,label:u[t]},Object(l.map)(e,e=>n.a.createElement(dn.a.Option,{key:"".concat(e.id),value:e.id},e.name)))))))}function yE(e){var t=e.dialog,a=e.dashboard,o=gE(Object(r.useState)(null),2),i=o[0],s=o[1],c=gE(Object(r.useState)(null),2),u=c[0],d=c[1],m=gE(Object(r.useState)([]),2),p=m[0],f=m[1],g=Object(r.useCallback)(e=>{s(null),d(null),f([]),e&&hr.get({id:e}).then(e=>{if(e){var t=Object(l.map)(a.getParametersDefs(),e=>e.name);s(e),f(Object(l.map)(e.getParametersDefs(),e=>({name:e.name,type:Object(l.includes)(t,e.name)?c_:s_,mapTo:e.name,value:e.normalizedValue,title:"",param:e}))),e.visualizations.length>0&&d(Object(l.first)(e.visualizations))}})},[a]),b=Object(r.useCallback)(()=>{t.close({visualization:u,parameterMappings:p}).catch(()=>{uf.error(window.W_L.widget_not_add)})},[t,u,p]),h=a.getParametersDefs(),y=Se("parameter-mappings");return n.a.createElement(R.a,dE({},t.props,{title:window.W_L.add_widget,onOk:b,okButtonProps:pE(pE({},t.props.okButtonProps),{},{disabled:!i||t.props.okButtonProps.disabled}),okText:window.W_L.add_widget_to_dashboard,cancelText:window.W_L.cancel,width:700}),n.a.createElement("div",{"data-test":"AddWidgetDialog"},n.a.createElement(Nh,{onChange:e=>g(e?e.id:null)}),i&&n.a.createElement(hE,{query:i,visualization:u,onChange:d}),p.length>0&&[n.a.createElement("label",{key:"parameters-title",htmlFor:y},window.W_L.params),n.a.createElement(h_,{key:"parameters-list",id:y,mappings:p,existingParams:h,onChange:f})]))}hE.propTypes={query:ae.a.object,visualization:ae.a.object,onChange:ae.a.func},hE.defaultProps={query:null,visualization:null,onChange:()=>{}},yE.propTypes={dialog:ja.isRequired,dashboard:ae.a.object.isRequired};var vE=Sa(yE);function wE(){return(wE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function OE(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function _E(e){var t=e.imageUrl,a=e.roundedImage,r=e.title,o=e.body,i=e.children,l=e.className,s=OE(e,["imageUrl","roundedImage","title","body","children","className"]);return n.a.createElement("div",wE({},s,{className:l+" w-100 d-flex align-items-center"}),n.a.createElement("img",{src:""+t,"data-pr":"",width:"32",data:t,height:"32",className:me()({"profile__image--settings":a},"m-r-5"),alt:window.W_L.icon}),n.a.createElement("div",{className:"flex-fill"},n.a.createElement("div",null,r),o&&n.a.createElement("div",{className:"text-muted"},o)),i)}function EE(e){var t=e.user,a=e.withLink,r=e.children,o=OE(e,["user","withLink","children"]),i=a?n.a.createElement(h,{href:"users/"+t.id},t.name):t.name;return n.a.createElement(_E,wE({},o,{imageUrl:t.profile_image_url,title:i,body:t.email}),r)}function jE(e){var t=e.dataSource,a=e.withLink,r=e.children,o=OE(e,["dataSource","withLink","children"]),i="/static/images/db-logos/".concat(t.type,".png"),l=a?n.a.createElement(h,{href:"data_sources/"+t.id},t.name):t.name;return n.a.createElement(_E,wE({},o,{imageUrl:i,title:l}),r)}function SE(e){return Object(l.find)([Object(l.get)(e,"response.data.message"),Object(l.get)(e,"response.statusText"),"Unknown error"],l.isString)}function CE(e){return"api/users/".concat(e.id,"/disable")}_E.propTypes={imageUrl:ae.a.string.isRequired,title:ae.a.node.isRequired,body:ae.a.node,roundedImage:ae.a.bool,className:ae.a.string,children:ae.a.node},_E.defaultProps={body:null,roundedImage:!0,className:"",children:null},EE.propTypes={user:ae.a.shape({profile_image_url:ae.a.string.isRequired,name:ae.a.string.isRequired,email:ae.a.string.isRequired}).isRequired,withLink:ae.a.bool,children:ae.a.node},EE.defaultProps={withLink:!1,children:null},jE.propTypes={dataSource:ae.a.shape({name:ae.a.string.isRequired,type:ae.a.string.isRequired}).isRequired,withLink:ae.a.bool,children:ae.a.node},jE.defaultProps={withLink:!1,children:null};var xE={query:e=>B.get("api/users",{params:e}),get:e=>{var t=e.id;return B.get("api/users/".concat(t))},create:e=>B.post("api/users",e),save:e=>B.post("api/users/".concat(e.id),e),enableUser:function(e){var t=ke(e.name);return B.delete(CE(e)).then(a=>(uf.success(window.W_L.account+t+window.W_L.activated+"！"),e.is_disabled=!1,e.profile_image_url=a.profile_image_url,a)).catch(e=>{uf.error(window.W_L.Cannot_enable_user,SE(e))})},disableUser:function(e){var t=ke(e.name);return B.post(CE(e)).then(a=>(uf.warning(window.W_L.account+t+window.W_L.terminated+"。"),e.is_disabled=!0,e.profile_image_url=a.profile_image_url,a)).catch(e=>{uf.error(window.W_L.Cannot_deactivate_user,SE(e))})},deleteUser:function(e){var t=ke(e.name);return B.delete("api/users/".concat(e.id)).then(e=>(uf.warning(window.W_L.account+t+window.W_L.has_been_deleted+"!"),e)).catch(e=>{uf.error(window.W_L.Cannot_delete_user,SE(e))})},convertUserInfo:function(e){return{id:e.id,name:e.name,email:e.email,profileImageUrl:e.profile_image_url,apiKey:e.api_key,groupIds:e.groups,isDisabled:e.is_disabled,isInvitationPending:e.is_invitation_pending}},regenerateApiKey:function(e){return B.post("api/users/".concat(e.id,"/regenerate_api_key")).then(e=>(uf.success(window.W_L.api_Key_has_been_regenerated),e.api_key)).catch(e=>{uf.error(window.W_L.failed_to_regenerate_api_key,SE(e))})},sendPasswordReset:function(e){return B.post("api/users/".concat(e.id,"/reset_password")).then(e=>{if(Y.mailSettingsMissing)return uf.warning(window.W_L.the_email_server_is_not_configured),e.reset_link;uf.success(window.W_L.password_reset_email_has_been_sent)}).catch(e=>{uf.error(window.W_L.the_password_reset_email_was_not_sent_successfully,SE(e))})},resendInvitation:function(e){return B.post("api/users/".concat(e.id,"/invite")).then(e=>{if(Y.mailSettingsMissing)return uf.warning(window.W_L.the_email_server_is_not_configured),e.invite_link;uf.success(window.W_L.user_invitation_email_has_been_sent)}).catch(e=>{uf.error(window.W_L.the_user_invitation_email_failed_to_be_sent,SE(e))})}};a(1377);function PE(){return(PE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function LE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return kE(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return kE(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function kE(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var NE=dn.a.Option;function AE(e){e.context;return n.a.createElement(n.a.Fragment,null,window.W_L.mange_permissions,n.a.createElement("div",{className:"modal-header-desc"},window.W_L.can_not_manage_permissions,n.a.createElement($e,{type:"MANAGE_PERMISSIONS"})))}function TE(e){var t=e.onSelect,a=e.shouldShowUser,o=LE(Object(r.useState)(!0),2),i=o[0],s=o[1],c=LE(Object(r.useState)([]),2),u=c[0],d=c[1],m=LE(Object(r.useState)(""),2),p=m[0],f=m[1],g=Object(r.useCallback)(Object(l.debounce)(e=>(e=>xE.query({q:e}).then(e=>e.results).catch(()=>[]))(e).then(d).finally(()=>s(!1)),200),[]);return Object(r.useEffect)(()=>{s(!0),g(p)},[g,p]),n.a.createElement(dn.a,{className:"w-100 m-b-10",placeholder:window.W_L.add_user,showSearch:!0,onSearch:f,suffixIcon:i?n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Loading...")):n.a.createElement("i",{className:"fa fa-search","aria-hidden":"true"}),filterOption:!1,notFoundContent:null,value:void 0,getPopupContainer:e=>e.parentNode,onSelect:t},u.filter(a).map(e=>n.a.createElement(NE,{key:e.id,value:e.id},n.a.createElement(EE,{user:e}))))}function WE(e){var t,a=e.dialog,o=e.author,i=e.context,s=e.aclUrl,c=LE(Object(r.useState)(!0),2),u=c[0],d=c[1],p=LE(Object(r.useState)([]),2),f=p[0],g=p[1],b=(t=s,{loadGrantees:Object(r.useCallback)(()=>B.get(t).then(e=>{var t=[];return Object(l.each)(e,(e,a)=>{e.forEach(e=>{e.accessType=mg(a),t.push(e)})}),t}),[t]),addPermission:Object(r.useCallback)((function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"modify";return B.post(t,{access_type:a,user_id:e}).catch(()=>uf.error(window.W_L.unauthorized))}),[t]),removePermission:Object(r.useCallback)((function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"modify";return B.delete(t,{data:{access_type:a,user_id:e}}).catch(()=>uf.error(window.W_L.can_not_delete_user))}),[t])}),h=b.loadGrantees,y=b.addPermission,v=b.removePermission,w=Object(r.useCallback)(()=>{d(!0),h().then(g).catch(()=>uf.error(window.W_L.fail_load_list)).finally(()=>d(!1))},[h]),O=Object(r.useCallback)(e=>e.id===o.id||!!Object(l.get)(Object(l.find)(f,{id:e.id}),"accessType"),[o.id,f]);return Object(r.useEffect)(()=>{w()},[s,w]),n.a.createElement(R.a,PE({},a.props,{className:"permissions-editor-dialog",title:n.a.createElement(AE,{context:i}),footer:n.a.createElement(m.a,{onClick:a.dismiss},window.W_L.close)}),n.a.createElement(TE,{onSelect:e=>y(e).then(w),shouldShowUser:e=>!O(e)}),n.a.createElement("div",{className:"d-flex align-items-center m-t-5"},n.a.createElement("h5",{className:"flex-fill"},window.W_L.user_permissions),u&&n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},window.W_L.loading))),n.a.createElement("div",{className:"scrollbox p-5",style:{maxHeight:"40vh"}},n.a.createElement(qb.a,{size:"small",dataSource:[o,...f],renderItem:e=>n.a.createElement(qb.a.Item,null,n.a.createElement(EE,{key:e.id,user:e},e.id===o.id?n.a.createElement(t_.a,{className:"m-0"},window.W_L.author):n.a.createElement(we,{title:"{window.W_L.remove_user_permission}"},n.a.createElement(ge,{"aria-label":"{window.W_L.remove_user_permission}",onClick:()=>v(e.id).then(w)},n.a.createElement("i",{className:"fa fa-remove clickable","aria-hidden":"true"})))))})))}AE.propTypes={context:ae.a.oneOf([window.W_L.queries,window.W_L.dashboards])},AE.defaultProps={context:window.W_L.queries},TE.propTypes={onSelect:ae.a.func,shouldShowUser:ae.a.func},TE.defaultProps={onSelect:()=>{},shouldShowUser:()=>!0},WE.propTypes={dialog:ja.isRequired,author:ae.a.object.isRequired,context:ae.a.oneOf([window.W_L.query,window.W_L.dashboards]),aclUrl:ae.a.string.isRequired},WE.defaultProps={context:window.W_L.query};var IE=Sa(WE),qE=a(159),DE=a.n(qE);function RE(){return(RE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}class ME extends n.a.Component{constructor(e){super(e),function(e,t,a){t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a}(this,"copy",()=>{this.ref.current.select();try{if(!document.execCommand("copy"))throw new Error;this.setState({copied:window.W_L.copy_success})}catch(e){this.setState({copied:window.W_L.copy_failed})}this.resetCopyState=setTimeout(()=>this.setState({copied:null}),2e3)}),this.state={copied:null},this.ref=n.a.createRef(),this.copyFeatureSupported=document.queryCommandSupported("copy"),this.resetCopyState=null}componentWillUnmount(){this.resetCopyState&&clearTimeout(this.resetCopyState)}render(){var e=n.a.createElement(we,{title:this.state.copied||window.W_L.copy},n.a.createElement(ge,{onClick:this.copy},n.a.createElement(DE.a,null)));return n.a.createElement(va.a,RE({},this.props,{ref:this.ref,addonAfter:this.copyFeatureSupported&&e}))}}function zE(){return(zE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function FE(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class VE extends n.a.Component{constructor(e){super(e),FE(this,"formItemProps",{labelCol:{span:8},wrapperCol:{span:16},style:{marginBottom:7}}),FE(this,"enableAccess",()=>{var e=this.props.dashboard;this.setState({saving:!0}),B.post(this.apiUrl).then(t=>{e.publicAccessEnabled=!0,e.public_url=t.public_url}).catch(()=>{uf.error(window.W_L.open_share_dashboard_failed)}).finally(()=>{this.setState({saving:!1})})}),FE(this,"disableAccess",()=>{var e=this.props.dashboard;this.setState({saving:!0}),B.delete(this.apiUrl).then(()=>{e.publicAccessEnabled=!1,delete e.public_url}).catch(()=>{uf.error(window.W_L.close_share_dashboard_failed)}).finally(()=>{this.setState({saving:!1})})}),FE(this,"onChange",e=>{e?this.enableAccess():this.disableAccess()});var t=this.props.dashboard;this.state={saving:!1},this.apiUrl=Object(l.replace)("api/dashboards/{id}/share","{id}",t.id),this.enabled=this.props.hasOnlySafeQueries||t.publicAccessEnabled}static get headerContent(){return n.a.createElement(n.a.Fragment,null,window.W_L.share_dashboard,n.a.createElement("div",{className:"modal-header-desc"},window.W_L.share_dashboard_tip,n.a.createElement($e,{type:"SHARE_DASHBOARD"})))}render(){var e=this.props,t=e.dialog,a=e.dashboard;return n.a.createElement(R.a,zE({},t.props,{title:this.constructor.headerContent,footer:null}),n.a.createElement(ih.a,{layout:"horizontal"},!this.props.hasOnlySafeQueries&&n.a.createElement(ih.a.Item,null,n.a.createElement(u.a,{message:window.W_L.secret_address_tip,type:"error"})),n.a.createElement(ih.a.Item,zE({label:window.W_L.allow_public},this.formItemProps),n.a.createElement(xo.a,{checked:a.publicAccessEnabled,onChange:this.onChange,loading:this.state.saving,disabled:!this.enabled,"data-test":"PublicAccessEnabled"})),a.public_url&&n.a.createElement(ih.a.Item,zE({label:window.W_L.secret_address},this.formItemProps),n.a.createElement(ME,{value:a.public_url,"data-test":"SecretAddress"}))))}}FE(VE,"propTypes",{dashboard:ae.a.object.isRequired,hasOnlySafeQueries:ae.a.bool.isRequired,dialog:ja.isRequired});var UE=Sa(VE);function BE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return HE(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return HE(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function HE(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function YE(){var e=BE(Object(r.useState)(Object(l.has)(A.search,"fullscreen")),2),t=e[0],a=e[1];Object(r.useEffect)(()=>{document.body.classList.toggle("headless",t),A.setSearch({fullscreen:!!t||null},!0)},[t]);return[t,()=>a(!t)]}function QE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return KE(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return KE(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function KE(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function $E(e){var t=Z.getDashboardRefreshIntervals();return Object(l.max)([30,Object(l.min)(t),e])}function GE(e){var t=QE(Object(r.useState)(function(){var e=parseFloat(A.search.refresh);return Object(l.isNaN)(e)?null:$E(e)}()),2),a=t[0],n=t[1],o=bw(e);return Object(r.useEffect)(()=>{if(A.setSearch({refresh:a||null},!0),a){var e=setInterval(o,1e3*a);return()=>clearInterval(e)}},[a,o]),Object(r.useMemo)(()=>[a,e=>n($E(e)),()=>n(null)],[a])}function JE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return XE(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return XE(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function XE(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var ZE="saved",ej="saving",tj="saving_failed";function aj(e,t){var a=JE(Object(r.useState)(e&&Object(l.has)(A.search,"edit")),2),n=a[0],o=a[1],i=JE(Object(r.useState)(ZE),2),s=i[0],c=i[1],u=JE(Object(r.useState)([]),2),d=u[0],m=u[1],p=JE(Object(r.useState)(!1),2),f=p[0],g=p[1];Object(r.useEffect)(()=>{A.setSearch({edit:!!n||null},!0)},[n]),Object(r.useEffect)(()=>{f&&s===ZE&&(g(!1),o(!1))},[f,s]);var b=Object(r.useCallback)(a=>{if(e){var r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(l.pickBy)(t,(t,a)=>{var r=Object(l.find)(e,{id:Number(a)}).options.position;return!Object(l.isMatch)(r,t)})}(t,a);c(ej),m(a);var n=Object(l.map)(r,(e,a)=>{var r=Object(l.find)(t,{id:Number(a)});return r?r.save("options",{position:e}):Promise.resolve()});return Promise.all(n).then(()=>c(ZE)).catch(()=>{c(tj),uf.error("Error saving changes.")})}c(ZE)},[e,t]),h=Object(r.useCallback)((function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return c(ej),Object(l.debounce)(()=>b(...t),2e3)()}),[b]),y=Object(r.useCallback)(()=>b(d),[d,b]),v=Object(r.useCallback)(t=>{t||s===ZE?o(e&&t):g(!0)},[s,e]);return{editingLayout:e&&n,setEditingLayout:v,saveDashboardLayout:n?h:b,retrySaveDashboardLayout:y,doneBtnClickedWhileSaving:f,dashboardStatus:s}}function rj(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function nj(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?rj(Object(a),!0).forEach((function(t){oj(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):rj(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function oj(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ij(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return lj(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return lj(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lj(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function sj(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object(l.isEmpty)(t)?e:e.filter(e=>Object.values(e.getParameterMappings()).filter(e=>"dashboard-level"===e.type).some(e=>{var a=e.mapTo;return Object(l.includes)(t.map(e=>e.name),a)}))}var cj=function(e){var t=ij(Object(r.useState)(e),2),a=t[0],n=t[1],o=ij(Object(r.useState)([]),2),i=o[0],s=o[1],c=ij(Object(r.useState)(!1),2),u=c[0],d=c[1],m=ij(Object(r.useState)(!1),2),p=m[0],f=m[1],g=Object(r.useMemo)(()=>a.getParametersDefs(),[a]),b=!a.is_archived&&Z.canEdit(a),h=Object(r.useMemo)(()=>!a.is_archived&&Object(l.has)(a,"user.id")&&(H.id===a.user.id||H.isAdmin),[a]),y=Object(r.useMemo)(()=>Object(l.every)(a.widgets,e=>!e.getQuery()||e.getQuery().is_safe),[a]),v=Object(r.useCallback)(()=>{var e="api/dashboards/".concat(a.id,"/acl");IE.showModal({aclUrl:e,context:"dashboard",author:a.user})},[a]),w=Object(r.useCallback)((function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return n(t=>Object(l.extend)({},t,e)),e=nj(nj({},e),{},{id:a.id}),t&&(e=nj(nj({},e),{},{version:a.version})),Vp.save(e).then(t=>{n(a=>Object(l.extend)({},a,Object(l.pick)(t,Object(l.keys)(e)))),Object(l.has)(e,"name")&&A.setPath(Ze.parse(t.url).pathname,!0)}).catch(e=>{var t=Object(l.get)(e,"response.status");403===t?uf.error("Dashboard update failed","Permission Denied."):409===t&&uf.error(window.W_F.dashboard_has_changed,window.W_F.dashboard_has_changed_tip,{duration:null})})}),[a]),O=Object(r.useCallback)(()=>{La("toggle_published","dashboard",a.id),w({is_draft:!a.is_draft},!1)},[a,w]),_=Object(r.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.getParametersDefs(),n(e=>Object(l.extend)({},e)),e.load(t).catch(e=>{if(!(e instanceof vr))return Promise.reject(e)}).finally(()=>n(e=>Object(l.extend)({},e)))}),[]),E=Object(r.useCallback)(e=>_(e,!0),[_]),j=Object(r.useCallback)(e=>{n(t=>Object(l.extend)({},t,{widgets:t.widgets.filter(t=>void 0!==t.id&&t.id!==e)}))},[]),S=Object(r.useRef)();S.current=a;var C=Object(r.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=sj(S.current.widgets,t),r=Object(l.compact)(a.map(t=>_(t,e).catch(e=>e)));return Promise.all(r).then(()=>{var e=Object(l.compact)(Object(l.map)(S.current.widgets,e=>e.getQueryResult())),t=Mp(S.current,e,A.search);s(t)})}),[_]),x=Object(r.useCallback)(e=>{u||(d(!0),C(!0,e).finally(()=>d(!1)))},[u,C]),P=Object(r.useCallback)(()=>{La("archive","dashboard",a.id),Vp.delete(a).then(e=>n(t=>Object(l.extend)({},t,Object(l.pick)(e,["is_archived"]))))},[a]),L=Object(r.useCallback)(()=>{var e=()=>n(e=>Object(l.extend)({},e));UE.showModal({dashboard:a,hasOnlySafeQueries:y}).onClose(e).onDismiss(e)},[a,y]),k=Object(r.useCallback)(()=>{B_.showModal({isNew:!0}).onClose(e=>a.addWidget(e).then(()=>n(e=>Object(l.extend)({},e))))},[a]),N=Object(r.useCallback)(()=>{vE.showModal({dashboard:a}).onClose(e=>{var t=e.visualization,r=e.parameterMappings;return a.addWidget(t,{parameterMappings:m_(r)}).then(e=>{var t=[e,...p_(e.options.parameterMappings,a.widgets)];return Promise.all(t.map(e=>e.save())).then(()=>n(e=>Object(l.extend)({},e)))})})},[a]),T=ij(GE(x),3),W=T[0],I=T[1],q=T[2],D=ij(YE(),2),R=D[0],M=D[1],z=aj(!p&&b,a.widgets);return Object(r.useEffect)(()=>{n(e),C()},[e]),Object(r.useEffect)(()=>{document.title=a.name},[a.name]),Object(r.useEffect)(()=>{C()},[a.dashboard_filters_enabled]),nj(nj({dashboard:a,globalParameters:g,refreshing:u,filters:i,setFilters:s,loadDashboard:C,refreshDashboard:x,updateDashboard:w,togglePublished:O,archiveDashboard:P,loadWidget:_,refreshWidget:E,removeWidget:j,canEditDashboard:b,isDashboardOwnerOrAdmin:h,refreshRate:W,setRefreshRate:I,disableRefreshRate:q},z),{},{gridDisabled:p,setGridDisabled:f,fullscreen:R,toggleFullscreen:M,showShareDashboardDialog:L,showAddTextboxDialog:k,showAddWidgetDialog:N,managePermissions:v})};function uj(){return(uj=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function dj(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class mj extends n.a.Component{constructor(e){super(e),dj(this,"startEditing",()=>{this.props.isEditable&&this.setState({editing:!0})}),dj(this,"stopEditing",e=>{var t=Object(l.trim)(e);this.props.ignoreBlanks&&""===t||t===this.props.value||this.props.onDone(t),this.setState({editing:!1})}),dj(this,"handleKeyDown",e=>{13!==e.keyCode||e.shiftKey?27===e.keyCode&&this.setState({editing:!1}):(e.preventDefault(),this.stopEditing(e.target.value))}),dj(this,"renderNormal",()=>this.props.value?n.a.createElement("span",{role:"presentation",onFocus:this.startEditing,onClick:this.startEditing,className:this.props.isEditable?"editable":""},this.props.value):n.a.createElement("a",{className:"clickable",onClick:this.startEditing},this.props.placeholder)),dj(this,"renderEdit",()=>{var e=this.props,t=e.multiline,a=e.value,r=e.editorProps,o=t?va.a.TextArea:va.a;return n.a.createElement(o,uj({defaultValue:a,"aria-label":"Editing",onBlur:e=>this.stopEditing(e.target.value),onKeyDown:this.handleKeyDown,autoFocus:!0},r))}),this.state={editing:e.defaultEditing}}componentDidUpdate(e,t){!this.state.editing&&t.editing&&this.props.onStopEditing()}render(){return n.a.createElement("span",{className:me()("edit-in-place",{active:this.state.editing},this.props.className)},this.state.editing?this.renderEdit():this.renderNormal())}}function pj(e){return e.tags||[]}function fj(e){return B.get(e).then(pj)}dj(mj,"propTypes",{ignoreBlanks:ae.a.bool,isEditable:ae.a.bool,placeholder:ae.a.string,value:ae.a.string,onDone:ae.a.func.isRequired,onStopEditing:ae.a.func,multiline:ae.a.bool,editorProps:ae.a.object,defaultEditing:ae.a.bool}),dj(mj,"defaultProps",{ignoreBlanks:!1,isEditable:!0,placeholder:"",value:"",onStopEditing:()=>{},multiline:!1,editorProps:{},defaultEditing:!1});var gj=a(44),bj=a.n(gj),hj=a(320),yj=a.n(hj),vj=a(424),wj=a.n(vj),Oj=a(425),_j=a.n(Oj);a(1378);function Ej(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function jj(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ej(Object(a),!0).forEach((function(t){Sj(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ej(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Sj(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Cj(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return xj(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return xj(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xj(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var Pj=n.a.forwardRef((e,t)=>{var a=e.dashboardId,o=Cj(Object(r.useState)(!1),2),i=o[0],l=o[1],s=Cj(Object(r.useState)(1),2),c=s[0],u=s[1],d=[{id:1,title:window.W_L.example1,image:yj.a},{id:2,title:window.W_L.example2,image:wj.a},{id:3,title:window.W_L.example3,image:_j.a},{id:999,title:window.W_L.more,image:yj.a}],p=Cj(Object(r.useState)(!1),2),f=p[0],g=p[1],b=Cj(Object(r.useState)(!1),2),h=b[0],y=b[1],v=Cj(Object(r.useState)(null),2),w=v[0],O=v[1],_=()=>{l(!0)};n.a.useImperativeHandle(t,()=>({openModal:_}));var E=e=>{if("TABLE"===e.visualization.type)return"table";var t=e.visualization.options.globalSeriesType;return!!["column","line","pie","area"].includes(t)&&("column"===t?"bar":t)},j=e=>{var t,a;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.map(e=>{var t,a;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(t=E(e))){r.next=6;break}return r.next=4,regeneratorRuntime.awrap(B.get("/api/queries/".concat(e.visualization.query.id,"/results/").concat(e.visualization.query.latest_query_data_id,".json")));case 4:return a=r.sent,r.abrupt("return",{id:e.visualization.query.id,latest_query_data_id:e.visualization.query.latest_query_data_id,chart_name:e.visualization.query.name,chart_type:t,data:a.query_result.data,columnMapping:e.visualization.options.columnMapping});case 6:case"end":return r.stop()}}),null,null,null,Promise)}),r.next=3,regeneratorRuntime.awrap(Promise.all(t));case 3:return a=r.sent,r.abrupt("return",a.filter(Boolean));case 5:case"end":return r.stop()}}),null,null,null,Promise)},S=e=>{var t,a;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:return t=jj(jj({},e),{},{template_id:c}),r.next=3,regeneratorRuntime.awrap(B.post("/api/pretty_dashboard",t));case 3:return a=r.sent,r.abrupt("return",a);case 5:case"end":return r.stop()}}),null,null,null,Promise)},C=()=>{f||l(!1)};return n.a.createElement(n.a.Fragment,null,n.a.createElement(_e.a,{title:window.W_L.prettify_dashboard,visible:i,onClose:C,closable:!1,mask:!1,footer:n.a.createElement("div",{className:"drawer-footer"},n.a.createElement(m.a,{loading:f,className:"finish-button",type:"primary",onClick:()=>{var e,t;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:return g(!0),r.prev=1,r.next=4,regeneratorRuntime.awrap(B.get("/api/dashboards/".concat(a)).then(e=>{var t;return regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(!(e.widgets&&e.widgets.length>0)){a.next=7;break}return a.next=3,regeneratorRuntime.awrap(j(e.widgets));case 3:return t=a.sent,a.abrupt("return",{dashboard_name:e.name,dashboard_id:e.id,query_result:t});case 7:throw new Error(window.W_L.no_dashboard_data);case 8:case"end":return a.stop()}}),null,null,null,Promise)}).catch(e=>{throw console.error(e),e}));case 4:return e=r.sent,r.next=7,regeneratorRuntime.awrap(S(e));case 7:(t=r.sent)&&200===t.code?(bj.a.success(window.W_L.submit_success),regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(B.get("/api/pretty_dashboard"));case 2:case"end":return e.stop()}}),null,null,null,Promise)):bj.a.error(t.data||window.W_L.submit_fail),g(!1),r.next=17;break;case 12:r.prev=12,r.t0=r.catch(1),g(!1),console.error(r.t0),bj.a.error(window.W_L.submit_fail);case 17:case"end":return r.stop()}}),null,null,[[1,12]],Promise)}},window.W_L.apply),n.a.createElement(m.a,{className:"cancel-button",onClick:C},window.W_L.close))},n.a.createElement("div",{className:"template-container"},d.map(e=>n.a.createElement("div",{key:e.id,className:"template-item",onClick:()=>{return t=e.id,void u(t);var t}},n.a.createElement("p",null,e.title),n.a.createElement("div",{className:"template-div"},n.a.createElement("img",{alt:"example",src:e.image,className:"template-img ".concat(c===e.id?"template-item-selected":"")}),n.a.createElement("div",{className:"template-overlay ".concat(999===e.id?"always-show":"")},n.a.createElement("button",{className:"preview-button ".concat(999===e.id?"coming-soon-button":""),onClick:t=>{t.stopPropagation(),(e=>{999!==e.id&&(O(e.image),y(!0))})(e)}},999===e.id?window.W_L.coming_soon:window.W_L.preview))),999!==e.id&&n.a.createElement(gn.a,{checked:c===e.id,className:"template-checkbox"}))))),n.a.createElement(R.a,{className:"preview-modal",visible:h,onCancel:()=>y(!1),footer:null,closable:!1,width:"80%"},n.a.createElement("img",{alt:"example",style:{width:"100%"},src:w})))});a(1379);function Lj(){return fj("api/dashboards/tags").then(e=>Object(l.map)(e,e=>e.name))}function kj(e){return e?"primary":"default"}function Nj(e){var t=e.dashboardConfiguration,a=t.dashboard,r=t.canEditDashboard,o=t.updateDashboard,i=t.editingLayout;return n.a.createElement("div",{className:"title-with-tags"},n.a.createElement("div",{className:"page-title"},n.a.createElement(Ff,{item:a}),n.a.createElement("h3",null,n.a.createElement(mj,{isEditable:i,onDone:e=>o({name:e}),value:a.name,ignoreBlanks:!0})),n.a.createElement(we,{title:a.user.name,placement:"bottom"},n.a.createElement("img",{src:a.user.profile_image_url,className:"profile-image",alt:a.user.name}))),n.a.createElement(Xg,{tags:a.tags,isDraft:a.is_draft,isArchived:a.is_archived,canEdit:r,getAvailableTags:Lj,onEdit:e=>o({tags:e})}))}function Aj(e){var t=e.dashboardConfiguration,a=t.refreshRate,r=t.setRefreshRate,o=t.disableRefreshRate,i=t.refreshing,s=t.refreshDashboard,c=Z.getDashboardRefreshIntervals(),u=Y.dashboardRefreshIntervals;return n.a.createElement(m.a.Group,null,n.a.createElement(we,{title:a?window.W_L.auto_flush_hz+" ".concat(dg(a)):null},n.a.createElement(m.a,{type:kj(a),onClick:()=>s()},n.a.createElement("i",{className:me()("zmdi zmdi-refresh m-r-5",{"zmdi-hc-spin":i}),"aria-hidden":"true"}),a?dg(a):window.W_L.flush)),n.a.createElement(aa.a,{trigger:["click"],placement:"bottomRight",overlay:n.a.createElement(ue.a,{onClick:e=>{var t=e.key,a=parseFloat(t);a?(r(a),s()):o()},selectedKeys:["".concat(a)]},u.map(e=>n.a.createElement(ue.a.Item,{key:"".concat(e),disabled:!Object(l.includes)(c,e)},dg(e))),a&&n.a.createElement(ue.a.Item,{key:null},window.W_L.stop_auto_flush))},n.a.createElement(m.a,{className:"icon-button hidden-xs",type:kj(a)},n.a.createElement("i",{className:"fa fa-angle-down","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Split button!"))))}function Tj(e){var t=e.dashboardConfiguration,a=t.dashboard,r=t.setEditingLayout,o=t.togglePublished,i=t.archiveDashboard,l=t.managePermissions,s=t.gridDisabled,c=t.isDashboardOwnerOrAdmin;return n.a.createElement(aa.a,{trigger:["click"],placement:"bottomRight",overlay:n.a.createElement(ue.a,{"data-test":"DashboardMoreButtonMenu"},n.a.createElement(ue.a.Item,{className:me()({hidden:s})},n.a.createElement(ge,{onClick:()=>r(!0)},window.W_L.edit)),Y.showPermissionsControl&&c&&n.a.createElement(ue.a.Item,null,n.a.createElement(ge,{onClick:l},window.W_L.mange_permissions)),!Y.disablePublish&&!a.is_draft&&n.a.createElement(ue.a.Item,null,n.a.createElement(ge,{onClick:o},window.W_L.draft)),n.a.createElement(ue.a.Item,null,n.a.createElement(ge,{onClick:()=>{R.a.confirm({title:window.W_L.dashboard_archived,content:window.W_L.are_you_sure+' "'.concat(a.name,'" ')+window.W_L.dashboard_archived,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,okType:"danger",onOk:i,maskClosable:!0,autoFocusButton:null})}},window.W_L.archived)))},n.a.createElement(m.a,{className:"icon-button m-l-5","data-test":"DashboardMoreButton","aria-label":"More actions"},n.a.createElement(th.a,{rotate:90,"aria-hidden":"true"})))}function Wj(e){var t=e.dashboardConfiguration,a=e.headerExtra,r=t.dashboard,o=t.togglePublished,i=t.canEditDashboard,l=t.fullscreen,s=t.toggleFullscreen,c=t.showShareDashboardDialog,u=t.updateDashboard,d=r.is_draft,p=!r.is_draft,f=i&&!r.is_draft,g=!Y.disablePublicUrls&&(r.publicAccessEnabled||f),b=i,h=n.a.useRef();return n.a.createElement("div",{className:"dashboard-control"},n.a.createElement(Pj,{ref:h,dashboardId:r.id}),r.can_edit&&r.is_archived&&n.a.createElement(m.a,{onClick:()=>{La("unarchive","dashboard",r.id),u({is_archived:!1},!1)}},"Unarchive"),!r.is_archived&&n.a.createElement("span",{className:"hidden-print"},n.a.createElement(m.a,{className:"m-r-5",onClick:()=>{h.current&&h.current.openModal()}},n.a.createElement("span",{className:"fa fa-magic m-r-5"})," ",window.W_L.prettify_dashboard),d&&n.a.createElement(m.a,{className:"m-r-5 hidden-xs",onClick:o},n.a.createElement("span",{className:"fa fa-paper-plane m-r-5"})," ",window.W_L.publish),n.a.createElement(Aj,{dashboardConfiguration:t}),p&&n.a.createElement(we,{className:"hidden-xs",title:window.W_L.dis_en_able_fullscreen},n.a.createElement(m.a,{type:kj(l),className:"icon-button m-l-5",onClick:s,"aria-label":"Toggle fullscreen display"},n.a.createElement("i",{className:"zmdi zmdi-fullscreen","aria-hidden":"true"}))),a,g&&n.a.createElement(we,{title:window.W_L.share_dashboard_setting},n.a.createElement(m.a,{className:"icon-button m-l-5",type:kj(r.publicAccessEnabled),onClick:c,"data-test":"OpenShareForm","aria-label":"Share"},n.a.createElement("i",{className:"zmdi zmdi-share","aria-hidden":"true"}))),b&&n.a.createElement(Tj,{dashboardConfiguration:t})))}function Ij(e){var t,a=e.dashboardConfiguration,r=e.headerExtra,o=a.setEditingLayout,i=a.doneBtnClickedWhileSaving,l=a.dashboardStatus,s=a.retrySaveDashboardLayout;return t=l===ZE?n.a.createElement("span",{className:"save-status"},window.W_L.saved):l===ej?n.a.createElement("span",{className:"save-status","data-saving":!0},window.W_L.saving):n.a.createElement("span",{className:"save-status","data-error":!0},window.W_L.save_failed),n.a.createElement("div",{className:"dashboard-control"},t,l===tj?n.a.createElement(m.a,{type:"primary",onClick:s},window.W_L.retry):n.a.createElement(m.a,{loading:i,type:"primary",onClick:()=>o(!1)},!i&&n.a.createElement("i",{className:"fa fa-check m-r-5","aria-hidden":"true"})," ",window.W_L.save),r)}function qj(e){var t=e.dashboardConfiguration,a=e.headerExtra,r=t.editingLayout?Ij:Wj;return n.a.createElement("div",{className:"dashboard-header"},n.a.createElement(Nj,{dashboardConfiguration:t}),n.a.createElement(r,{dashboardConfiguration:t,headerExtra:a}))}Nj.propTypes={dashboardConfiguration:ae.a.object.isRequired},Aj.propTypes={dashboardConfiguration:ae.a.object.isRequired},Tj.propTypes={dashboardConfiguration:ae.a.object.isRequired},Wj.propTypes={dashboardConfiguration:ae.a.object.isRequired,headerExtra:ae.a.node},Ij.propTypes={dashboardConfiguration:ae.a.object.isRequired,headerExtra:ae.a.node},qj.propTypes={dashboardConfiguration:ae.a.object.isRequired,headerExtra:ae.a.node};a(1380);function Dj(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Rj(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Rj(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Rj(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Mj(){return(Mj=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function zj(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Fj(e){var t=e.dashboardConfiguration,a=t.dashboard,r=t.updateDashboard;return n.a.createElement("div",{className:"m-b-10 p-15 bg-white tiled"},n.a.createElement(gn.a,{checked:!!a.dashboard_filters_enabled,onChange:e=>{var t=e.target;return r({dashboard_filters_enabled:t.checked})},"data-test":"DashboardFiltersCheckbox"},window.W_L.dashboard_filter))}function Vj(e){var t=e.dashboardConfiguration,a=e.className,r=zj(e,["dashboardConfiguration","className"]),o=t.showAddTextboxDialog,i=t.showAddWidgetDialog;return n.a.createElement("div",Mj({className:me()("add-widget-container",a)},r),n.a.createElement("h2",null,n.a.createElement("i",{className:"zmdi zmdi-widgets","aria-hidden":"true"}),n.a.createElement("span",{className:"hidden-xs hidden-sm"},window.W_L.dashboard_widget_info)),n.a.createElement("div",null,n.a.createElement(m.a,{className:"m-r-15",onClick:o,"data-test":"AddTextboxButton"},window.W_L.add_text),n.a.createElement(m.a,{type:"primary",onClick:i,"data-test":"AddWidgetButton"},window.W_L.add_widget)))}function Uj(e){var t=cj(e.dashboard),a=t.dashboard,o=t.filters,i=t.setFilters,s=t.loadDashboard,c=t.loadWidget,u=t.removeWidget,d=t.saveDashboardLayout,m=t.globalParameters,p=t.updateDashboard,f=t.refreshDashboard,g=t.refreshWidget,b=t.editingLayout,h=t.setGridDisabled,y=e.isShowReport,v=Dj(Object(r.useState)(null),2),w=v[0],O=v[1],_=Dj(Object(r.useState)({}),2),E=_[0],j=_[1];return Object(r.useEffect)(()=>{if(w)return Gr(w,()=>{if(b){var e=window.getComputedStyle(w,null),t=w.getBoundingClientRect(),a=parseFloat(e.paddingLeft)||0,r=parseFloat(e.paddingRight)||0;j({left:Math.round(t.left)+r,width:w.clientWidth-a-r})}window.dispatchEvent(new Event("resize"))})},[w,b]),n.a.createElement("div",{className:"container",ref:O,"data-test":"DashboardId".concat(a.id,"Container")},y&&n.a.createElement(qj,{dashboardConfiguration:t,headerExtra:n.a.createElement(se,{name:"Dashboard.HeaderExtra",dashboard:a,dashboardConfiguration:t})}),y&&!Object(l.isEmpty)(m)&&n.a.createElement("div",{className:"dashboard-parameters m-b-10 p-15 bg-white tiled","data-test":"DashboardParameters"},n.a.createElement(Jv,{parameters:m,onValuesChange:f,sortable:b,onParametersEdit:e=>{var t=Object(l.map)(e,"name");p({options:{globalParamOrder:t}})}})),y&&!Object(l.isEmpty)(o)&&n.a.createElement("div",{className:"m-b-10 p-15 bg-white tiled","data-test":"DashboardFilters"},n.a.createElement(fw,{filters:o,onChange:i})),y&&b&&n.a.createElement(Fj,{dashboardConfiguration:t}),n.a.createElement("div",{id:"dashboard-container"},n.a.createElement(uE,{isShowReport:y,dashboard:a,widgets:a.widgets,filters:o,isEditing:b,onLayoutChange:b?d:()=>{},onBreakpointChange:h,onLoadWidget:c,onRefreshWidget:g,onRemoveWidget:u,onParameterMappingsChange:s})),y&&b&&n.a.createElement(Vj,{dashboardConfiguration:t,style:E}))}function Bj(e){var t=e.dashboardSlug,a=e.dashboardId,o=e.onError,i=e.isShowReport,l=Dj(Object(r.useState)(null),2),s=l[0],c=l[1],u=bw(o);return Object(r.useEffect)(()=>{Vp.get({id:a,slug:t}).then(e=>{La("view","dashboard",e.id),c(e),a||A.setPath(Ze.parse(e.url).pathname,!0);var t=null;t&&clearTimeout(t),t=setTimeout(()=>{var e=document.querySelector(".dashbord_page");if(e){var t=e.scrollHeight,a=e.clientHeight;e.scrollTo({top:t-a,behavior:"smooth"})}},80)}).catch(u)},[a,t,u]),n.a.createElement("div",{className:"dashboard-page"},s&&n.a.createElement(Uj,{isShowReport:i,dashboard:s}))}Fj.propTypes={dashboardConfiguration:ae.a.object.isRequired},Vj.propTypes={dashboardConfiguration:ae.a.object.isRequired,className:ae.a.string},Uj.propTypes={dashboard:ae.a.object.isRequired},Bj.propTypes={dashboardSlug:ae.a.string,dashboardId:ae.a.string,onError:ae.a.func,isShowReport:ae.a.bool},Bj.defaultProps={dashboardSlug:null,dashboardId:null,onError:ae.a.func,isShowReport:!0};var Hj=Bj;function Yj(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Qj(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Yj(Object(a),!0).forEach((function(t){Kj(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Yj(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Kj(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function $j(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Gj(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Gj(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Gj(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}_f.register("Dashboards.LegacyViewOrEdit",ha({path:"/dashboard/:dashboardSlug",render:e=>n.a.createElement(Bj,e)})),_f.register("Dashboards.ViewOrEdit",ha({path:"/dashboards/:dashboardId([^-]+)(-.*)?",render:e=>n.a.createElement(Bj,e)}));function Jj(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Xj(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Xj(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xj(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}a(1381);var Zj=()=>{var e,t,a,r,n,o,i=[{table_name:{tableName:[{name:"order_details.csv"},{name:"order_list.csv"},{name:"sales_target.csv"}]},Charttable_id:0,label:"csv数据源",id:0,type:"csv",title:"新对话1",uuid:Date.now(),messages:[{content:"这是一个示例数据源，请在下方输入文字进行聊天，用户选择的数据包含三个表格：'order_details.csv'，包含订单详情；'order_list.csv'，包括订单列表；以及'sales_target.csv'，包含销售目标。",sender:"bot",Cardloading:!1,time:(e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),n=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),"".concat(t,"-").concat(a,"-").concat(r," ").concat(n,":").concat(o))}]}],l=e=>{sessionStorage.setItem("Chart_Dialogue",JSON.stringify(e))},s=()=>JSON.parse(sessionStorage.getItem("Chart_Dialogue")),c=e=>{sessionStorage.setItem("Chart_Dashboard",JSON.stringify(e))},u=()=>JSON.parse(sessionStorage.getItem("Chart_Dashboard")),d=e=>{var t=m();t.length>=10&&t.splice(0,1);var a=t.findIndex(t=>t.uuid===e[0].uuid);a>=0?t[a].messages=e[0].messages:t.push(e[0]),localStorage.setItem("Chart_All",JSON.stringify(t))},m=()=>JSON.parse(localStorage.getItem("Chart_All"))||[];return{getAutopilotStorage:()=>JSON.parse(sessionStorage.getItem("Chart_Dialogue_Autopilot")),addAutopilotStorage:e=>{sessionStorage.setItem("Chart_Dialogue_Autopilot",JSON.stringify(e))},addDashboard:c,getDashboard:u,addDialogueStorage:l,getDialogueStorage:s,addChatList:(e,t)=>{if(e.length<=0)return sessionStorage.setItem("Chart_Dialogue",JSON.stringify(i)),void document.dispatchEvent(new CustomEvent("dialogueUpdated",{detail:i}));var a=[];(a="chat"===t?s():u())&&a.length>0&&(a[a.length-1].messages=e),"chat"===t?l(a):c(a),"chat"===t&&a&&a.length>0&&a[a.length-1].messages.length>=2&&d(a)},getAllStorage:m,setDialogueStorageDashboardId:e=>{var t=u();t&&t.length>0&&(t[0].dashboardId=e),c(t)}}};function eS(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return tS(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return tS(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tS(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}a(1385);var aS=e=>{var t=e.CharttableItem,a=e.chat_type,o=e.Charttable,i=e.loadingMask,l=(e=>{var t=eS(Object(r.useState)(!0),2),a=t[0],n=t[1],o=eS(Object(r.useState)(0),2),i=o[0],l=o[1];return Object(r.useEffect)(()=>{var t=document.querySelector(e);if(t){var r=()=>{var e=t.scrollTop;e>i&&e>100?a&&n(!1):a||n(!0),l(e)};return t.addEventListener("scroll",r),()=>{t.removeEventListener("scroll",r)}}},[i,a,e]),a})(".dialogue-content-all");return n.a.createElement(n.a.Fragment,null,o&&t&&t.label&&n.a.createElement("div",{className:"".concat("report"===a?"dialogue-top report-top":"dialogue-top"," ").concat(l?"":"hidden")},"viewConversation"!==a&&n.a.createElement(m.a,{disabled:i,type:"primary",size:"small",onClick:()=>{return t=()=>{e.closeDialogue()},void("autopilot"!==a?R.a.confirm({title:window.W_L.reset_dialogue,content:window.W_L.reset_dialogue_confirm,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,okType:"danger",onOk:t,onCancel:null,maskClosable:!0,autoFocusButton:null}):t());var t},style:{borderRadius:"20px",fontSize:"13px",paddingLeft:"15px",paddingRight:"15px"},ghost:!0},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"autopilot"===a?window.W_L.auto_pilot:window.W_L.new_dialogue)))},rS=(a(1386),e=>{var t=e.loadingMask;return n.a.createElement("div",{className:"overlay"},n.a.createElement(m.a,{className:"overlay-btn",onClick:()=>{e.onUse()},loading:t},t?window.W_L.init_config:window.W_L.start_use))}),nS=a(718),oS=a.n(nS),iS=a(426),lS=a.n(iS),sS=a(719),cS=a.n(sS),uS=a(175),dS=a.n(uS),mS=a(245),pS=a.n(mS);a(602);function fS(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function gS(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function bS(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return hS(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return hS(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function hS(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var yS=Object(r.forwardRef)((e,t)=>{var a=e.SelectLoading,o=e.editData,i=e.closeEditData,l=e.submit,s=e.source_item,c=bS(Object(r.useState)([]),2),u=c[0],d=c[1],m=bS(Object(r.useState)({}),2),p=m[0],f=m[1],g=bS(Object(r.useState)(!1),2),b=g[0],h=g[1],y=[{title:window.W_L.field_name,dataIndex:"name",key:"name",render:(e,t)=>n.a.createElement(we,{title:e},n.a.createElement("span",{style:{display:"inline-block",maxWidth:"100px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},e))},{title:window.W_L.description,dataIndex:"comment",key:"comment",render:(e,t)=>n.a.createElement(va.a,{type:"text",placeholder:window.W_L.field_description,value:e,style:{border:"none !important"},onChange:e=>v(e,t)})},{title:window.W_L.detection,dataIndex:"is_pass",key:"is_pass",render:(e,t)=>n.a.createElement("div",null,1===e?n.a.createElement("span",{style:{color:"#52c41a"}},window.W_L.pass):n.a.createElement("span",{style:{color:"#f5222d"}},window.W_L.fail))}];Object(r.useEffect)(()=>{h(a)},[a]),Object(r.useEffect)(()=>{o&&o.length>0&&(d(o),w(o[0]))},[o]);var v=(e,t)=>{var a=e.target.value,r=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?fS(Object(a),!0).forEach((function(t){gS(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):fS(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},p).field_desc.map(e=>(e.name===t.name&&(e.comment=a),e)),n=u.map(e=>(e.table_name===p.table_name&&(e.field_desc=r),e));d(n)},w=e=>{var t=e;t.field_desc=e.field_desc.filter(e=>0===e.is_pass),f(t)},O=p.field_desc&&p.field_desc.length>0,_=u&&u.length>0;return n.a.createElement("div",null,n.a.createElement("p",{className:"edit-back",onClick:()=>{i()}},n.a.createElement(Yy.a,{style:{fontSize:"18px"}})),n.a.createElement("button",{onClick:()=>{l(u)},disabled:b,className:"submit-btn"},window.W_L.submit),n.a.createElement("div",{className:"select-content-item"},n.a.createElement("div",{style:{position:"absolute",bottom:"-30px",fontSize:"12px"}},n.a.createElement(we,{title:window.W_L.source_tooltip},n.a.createElement(pS.a,{style:{marginRight:"5px"}})),window.W_L.source_second_tooltip),n.a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"baseline"}},n.a.createElement("div",{className:"select-main",style:{margin:"0"}},n.a.createElement("ul",{className:_?"":"flex-center",style:{height:"15vh"}},_&&u.map((e,t)=>n.a.createElement("li",{key:t},n.a.createElement("span",{onClick:()=>w(e),style:{color:e.table_name===p.table_name?"#2196F3":"#333",textAlign:"center",display:"block"}},"csv"===s.type?e.table_comment:e.table_name)))))),n.a.createElement("div",{className:"table-columns"},O&&n.a.createElement("div",{className:"table-columns-item"},n.a.createElement("span",null,"csv"===s.type?p.table_comment:p.table_name),n.a.createElement(va.a,{placeholder:window.W_L.sheet_description,style:{padding:"2px",maxWidth:"30%"},type:"text",disabled:"csv"===s.type,value:"csv"===s.type?p.table_name:p.table_comment,onChange:e=>{var t=e.target.value,a=u.map(e=>(e.table_name===p.table_name&&(e.table_comment=t),e));d(a)}})),n.a.createElement("div",{className:O?"":"flex-center",style:{width:"54vw",overflowY:"scroll",height:O?"35vh":"38vh"}},O&&n.a.createElement(Zl.a,{dataSource:p.field_desc,columns:y,size:"small",rowKey:e=>e.name,pagination:!1})))))});function vS(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function wS(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?vS(Object(a),!0).forEach((function(t){OS(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):vS(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function OS(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _S(e){return Object(l.map)(e,e=>Object(l.isObject)(e)?e:{name:e})}var ES={query:()=>B.get("api/data_sources"),get:e=>{var t=e.id;return B.get("api/data_sources/".concat(t))},types:()=>B.get("api/data_sources/types"),create:e=>B.post("api/data_sources",e),save:e=>B.post("api/data_sources/".concat(e.id),e),test:e=>B.post("api/data_sources/".concat(e.id,"/test")),delete:e=>{var t=e.id;return B.delete("api/data_sources/".concat(t))},fetchSchema:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a={};return t&&(a.refresh=!0),B.get("api/data_sources/".concat(e.id,"/schema"),{params:a}).then(e=>Object(l.has)(e,"job")?lr(e.job.id).catch(t=>1===t.code?[]:Promise.reject(new Error(e.job.error))):Object(l.has)(e,"schema")?e.schema:Promise.reject()).then(e=>Object(l.map)(e,e=>wS(wS({},e),{},{columns:_S(e.columns)})))}};function jS(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function SS(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?jS(Object(a),!0).forEach((function(t){CS(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):jS(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function CS(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function xS(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return PS(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return PS(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function PS(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var LS=Object(r.forwardRef)((e,t)=>{var a=e.confirmLoading,o=e.Charttable,i=e.chat_type,l=e.onChange,s=e.onSuccess,c=e.percent,u=xS(Object(r.useState)([]),2),d=u[0],m=u[1],p=xS(Object(r.useState)({type:"mysql"}),2),f=p[0],g=p[1],b=xS(Object(r.useState)(),2),y=b[0],v=b[1],w=xS(Object(r.useState)([]),2),O=w[0],_=w[1],E=xS(Object(r.useState)([]),2),j=E[0],S=E[1],C=xS(Object(r.useState)({}),2),x=C[0],P=C[1],L=xS(Object(r.useState)([]),2),k=L[0],N=L[1],A=xS(Object(r.useState)([]),2),T=A[0],W=A[1],I=xS(Object(r.useState)([]),2),q=I[0],D=I[1],R=xS(Object(r.useState)(!1),2),M=R[0],z=R[1],F=xS(Object(r.useState)(!1),2),V=F[0],U=F[1],H=xS(Object(r.useState)(!1),2),Y=H[0],Q=H[1],K=xS(Object(r.useState)(!0),2),$=K[0],G=K[1],J=xS(Object(r.useState)([]),2),X=J[0],Z=J[1],ee=xS(Object(r.useState)(!1),2),te=ee[0],ae=ee[1],re=[{title:window.W_L.field_name,dataIndex:"name",key:"name",render:(e,t)=>n.a.createElement(we,{title:t.name},n.a.createElement("span",{className:"field-name"},t.name))},{title:window.W_L.description,dataIndex:"comment",key:"comment",render:(e,t)=>n.a.createElement(va.a,{type:"text",value:e,style:{border:"none !important"},placeholder:window.W_L.field_description,onChange:e=>ce(e,t)})}];Object(r.useEffect)(()=>{var e,t;regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,regeneratorRuntime.awrap(B.get("/api/data_sources"));case 3:e=a.sent,t=e.map(e=>SS(SS({},e),{},{value:e.id,label:e.name,type:e.type})),"report"!==i&&t.unshift({label:window.W_L.excel_upload,value:0,type:"csv",id:0}),m(t),a.next=12;break;case 9:a.prev=9,a.t0=a.catch(0),console.error("error",a.t0);case 12:case"end":return a.stop()}}),null,null,[[0,9]],Promise)},[i]),Object(r.useEffect)(()=>{G(a),a||ae(!1)},[a]);var ne=e=>{Z(e)},oe=()=>{g({type:""}),v(""),_([]),S([]),P({}),N([]),W([]),D([]),U(!1),Q(!1)},ie=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return new Promise((a,r)=>{var n=0,o=setInterval(()=>{var i;return regeneratorRuntime.async((function(l){for(;;)switch(l.prev=l.next){case 0:return++n>t&&(clearInterval(o),r([])),l.prev=2,l.next=5,regeneratorRuntime.awrap(B.get("/api/data_sources/".concat(e,"/schema")));case 5:(i=l.sent).schema&&(clearInterval(o),a(i.schema)),l.next=13;break;case 9:l.prev=9,l.t0=l.catch(2),clearInterval(o),r(l.t0);case 13:case"end":return l.stop()}}),null,null,[[2,9]],Promise)},200)})},le=(e,t)=>{var a,r,n,o,i;return regeneratorRuntime.async((function(l){for(;;)switch(l.prev=l.next){case 0:if(l.prev=0,r=(e,t)=>e.map((e,a)=>SS(SS({},e),{},{label:"csv"===t?e.source_name:e.name,value:a,name:"csv"===t?e.file_name:e.name,checked:!1})),"csv"!==t){l.next=10;break}return l.next=5,regeneratorRuntime.awrap(B.get("api/upload"));case 5:n=l.sent,o=n.data,a=r(o,t),l.next=14;break;case 10:return l.next=12,regeneratorRuntime.awrap(ie(e));case 12:i=l.sent,a=r(i,t);case 14:_(a),l.next=20;break;case 17:l.prev=17,l.t0=l.catch(0),console.error("error",l.t0);case 20:case"end":return l.stop()}}),null,null,[[0,17]],Promise)},se=function(e){var t,a,r,n,o,i=arguments;return regeneratorRuntime.async((function(l){for(;;)switch(l.prev=l.next){case 0:return t=i.length>1&&void 0!==i[1]?i[1]:null,z(!0),a={table_name:"",table_comment:"",field_desc:[]},l.next=5,regeneratorRuntime.awrap(B.get("/api/data_table/columns/".concat(y,"/").concat("csv"===f.type?e.file_name:e.name)));case 5:r=l.sent,0!==Object.keys(r).length?(a.table_name=r.table_name,a.table_comment=r.table_desc||"",a.field_desc=r.table_columns_info.field_desc):(a.table_name="csv"===f.type?e.file_name:e.name,a.table_comment="csv"===f.type?e.source_name:"","csv"!==f.type&&e.columns.forEach((t,r)=>{var n={name:"pg"===f.type?t.name:t,comment:e.comment[r]||"",in_use:1};a.field_desc.push(n)})),(n=j.find(e=>e.table_name===a.table_name))||S(e=>[...e,a]),t||P(n||a),o=a.field_desc.filter(e=>1===e.in_use).map(e=>e.name),t||W(o),D(e=>[...e,{table_name:a.table_name,selectedRowKeys:o}]),z(!1);case 14:case"end":return l.stop()}}),null,null,null,Promise)},ce=(e,t)=>{var a=e.target.value,r=SS({},x);r.field_desc=r.field_desc.map(e=>(e.name===t.name&&(e.comment=a),e)),P(r);var n=j.map(e=>(e.table_name===r.table_name&&(e.field_desc=r.field_desc),e));S(n)},ue={selectedRowKeys:T,onChange:(e,t)=>{W(e);var a=SS({},x);a.field_desc=a.field_desc.map(t=>(t.in_use=e.includes(t.name)?1:0,t)),P(a);var r=j.map(e=>(e.table_name===a.table_name&&(e.field_desc=a.field_desc),e));S(r);var n=q.find(e=>e.table_name===a.table_name);D(n?q.map(t=>(t.table_name===a.table_name&&(t.selectedRowKeys=e),t)):t=>[...t,{table_name:a.table_name,selectedRowKeys:e}])}},de=function(){var e,t,a,r,n,o,i=arguments;return regeneratorRuntime.async((function(l){for(;;)switch(l.prev=l.next){case 0:if(e=i.length>0&&void 0!==i[0]?i[0]:[],ae(!0),t=[],a=[],r={},!(e.length>0)){l.next=14;break}return t=e.map(e=>({name:e.table_name})),n=t.map(t=>{var r,n;return regeneratorRuntime.async((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,regeneratorRuntime.awrap(B.get("/api/data_table/columns/".concat(y,"/").concat(t.name)));case 2:(r=o.sent)&&(n={table_name:r.table_name,table_comment:r.table_desc||"",field_desc:r.table_columns_info.field_desc},e.forEach(e=>{e.table_name===r.table_name&&(n.table_comment=e.table_comment,n.field_desc.forEach((t,a)=>{e.field_desc.forEach(e=>{t.name===e.name&&(n.field_desc[a].comment=e.comment)})}))}),a.push(n));case 4:case"end":return o.stop()}}),null,null,null,Promise)}),l.next=10,regeneratorRuntime.awrap(Promise.all(n));case 10:s(200,a,f,r={tableName:t},""),l.next=19;break;case 14:o=k.filter(e=>e.checked),t=o.map(e=>({name:e.name})),r={tableName:t},a=j.filter(e=>o.some(t=>t.name===e.table_name)),s(200,a,f,r,"firstTableData");case 19:case"end":return l.stop()}}),null,null,null,Promise)},me=d.map(e=>{var t=e.type,a=e.value,r=e.label;return n.a.createElement(dn.a.Option,{key:a,value:a},n.a.createElement(oS.a,null,n.a.createElement("div",{"aria-label":r,style:{display:"flex",alignItems:"center"}},n.a.createElement("span",{role:"img",style:{marginRight:"5px"}},n.a.createElement("img",{src:"".concat("static/images/db-logos","/").concat(t,".png"),alt:t,style:{width:"30px",height:"30px"}})),r)))}),pe=()=>n.a.createElement("div",{style:{textAlign:"center",display:"flex",flexDirection:"column",color:"#8f8f8f"}},n.a.createElement(cS.a,{style:{fontSize:"30px"}}),window.W_L.no_data);Object(r.useImperativeHandle)(t,()=>({editTableData:ne}));var fe=O&&O.length>0,ge=x&&x.table_name&&x.field_desc.length>0;return!o&&n.a.createElement("div",{className:"flex-column vertical-layout"},n.a.createElement("div",{className:"dislogue-caption"},n.a.createElement("h1",null,"Hi !"),n.a.createElement("span",null,"chat"===i?window.W_L.chat_start:"autopilot"===i?window.W_L.AutoPilot_start:window.W_L.report_start,n.a.createElement(h,{href:"/data_sources"},window.W_L.add_datasource))),n.a.createElement("div",{className:"select-content"},n.a.createElement(Df.a,{spinning:$,className:te?"dislogue-spin":""},X&&X.length>0?n.a.createElement(yS,{SelectLoading:$,editData:X,closeEditData:()=>{Z([])},submit:de,source_item:f}):n.a.createElement("div",{className:"select-content-item"},n.a.createElement("div",{style:{position:"absolute",bottom:"-4.5vh",fontSize:"12px"}},n.a.createElement(we,{title:window.W_L.source_tooltip},n.a.createElement(dS.a,{style:{marginRight:"3px"}})),window.W_L.source_first_tooltip),n.a.createElement("div",{style:{display:"flex",alignItems:"baseline"}},n.a.createElement("span",{className:"select-content-item-span"},window.W_L.data_source,n.a.createElement(we,{title:window.W_L.source_tooltip,placement:"bottom"},n.a.createElement(Lt.a,{style:{marginLeft:"1vw"}}))),n.a.createElement("div",null,n.a.createElement(dn.a,{style:{width:120},showSearch:!0,defaultValue:y,className:"dialogue-content-select",placeholder:window.W_L.select_data_source,optionFilterProp:"children",onChange:e=>{oe();var t=d.find(t=>t.value===e),a=t?t.type:null;l(a,e,t),g(t),v(e),le(e,a)},optionSelectedBg:"#eff0f4",disabled:$,filterOption:(e,t)=>{var a;return(null!==(a=null==t?void 0:t.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())}},me),n.a.createElement("div",{className:"select-main"},n.a.createElement("ul",{className:fe?"":"flex-center"},fe&&n.a.createElement("div",{className:"flex-end"},n.a.createElement("span",null,window.W_L.select_all),n.a.createElement(gn.a,{indeterminate:V,checked:Y,onChange:e=>function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t){G(!0),U(!1),Q(e.target.checked);var a=[],r=[];O.forEach(t=>{a.push(SS(SS({},t),{},{checked:e.target.checked})),!t.checked&&e.target.checked&&r.push(se(t,"all"))}),_(a),N(e.target.checked?a:[]),e.target.checked?Promise.all(r).then(e=>{G(!1)}):(N([]),P({}),S([]),W([]),D([]),G(!1))}}(e,"all")})),fe?O.map((e,t)=>n.a.createElement("li",{key:t},n.a.createElement(we,{title:e.label},n.a.createElement("span",{onClick:()=>(e=>{if(!M){var t=j.find(t=>t.table_name===e.name);t?(P(t),W(t.field_desc.filter(e=>1===e.in_use).map(e=>e.name))):se(e)}})(e),style:{color:e.label===x.table_name?"#2196F3":"#333"}},e.label)),n.a.createElement(gn.a,{checked:e.checked,onChange:t=>((e,t)=>{_([...O.map(a=>a.name===t.name?SS(SS({},a),{},{checked:e.target.checked}):a)]),e.target.checked?(N([...k,SS(SS({},t),{},{checked:!0})]),se(t)):(N(k.filter(e=>e.name!==t.name)),S(j.filter(e=>e.table_name!==t.name)),D(q.filter(e=>e.table_name!==t.name)),k.length<1&&P({})),N(e=>(e.length===O.length?(U(!1),Q(!0)):e.length>0?(U(!0),Q(!1)):(U(!1),Q(!1)),e))})(t,e)}))):n.a.createElement(pe,null))))),n.a.createElement("div",{className:"table-columns"},ge&&n.a.createElement("div",{className:"table-columns-item"},n.a.createElement("span",null,"csv"===f.type?x.table_comment:x.table_name),n.a.createElement(va.a,{placeholder:window.W_L.sheet_description,style:{padding:"2px",maxWidth:"60%"},type:"text",disabled:"csv"===f.type,value:"csv"===f.type?x.table_name:x.table_comment,onChange:e=>{var t=e.target.value;P(e=>SS(SS({},e),{},{table_comment:t}));var a=SS({},x);a.table_comment=t;var r=j.map(e=>(e.table_name===a.table_name&&(e.table_comment=a.table_comment),e));S(r)}})),n.a.createElement("div",{className:ge?"":"flex-center",style:{width:"65vw",overflowY:"scroll",height:ge?"27vh":"45vh"}},ge?n.a.createElement(Zl.a,{rowSelection:SS({type:"checkbox"},ue),dataSource:x.field_desc,columns:re,size:"small",rowKey:e=>e.name,pagination:!1}):n.a.createElement(pe,null))),k&&k.length>0&&n.a.createElement("button",{onClick:de,disabled:$,className:"submit-btn"},window.W_L.submit," ",k.length))),$&&te&&n.a.createElement("div",{className:"dislogue-progress"},n.a.createElement(lS.a,{width:80,type:"circle",percent:c}),n.a.createElement("p",null,window.W_L.ai_understanding_data))))}),kS=a(324);function NS(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return AS(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return AS(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function AS(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var TS=Object(r.memo)(e=>{var t=e.content,a=Object(r.useRef)(null),o=NS(Object(r.useState)({}),2),i=o[0],l=o[1];Object(r.useEffect)(()=>{var e=JSON.parse(t);l(e)},[t]),Object(r.useEffect)(()=>{try{var e=null;if(a.current){if(e=kS.b(a.current),"color"in i&&delete i.color,"series"in i)for(var t=0;t<i.series.length;++t)"lineStyle"in i.series[t]&&delete i.series[t].lineStyle;e.setOption(i)}return window.addEventListener("resize",s),()=>{e&&e.dispose(),window.removeEventListener("resize",s)}}catch(e){console.log("Error in EChartsChart: ",e)}},[i]);var s=()=>{if(a.current){var e=kS.a(a.current);e&&e.resize()}};return n.a.createElement("div",{ref:a,className:"w-full h-500"})}),WS=(a(1397),a(307)),IS=a.n(WS),qS=a(427);function DS(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return RS(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return RS(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function RS(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}a(1398);var MS=Object(r.memo)(e=>{var t=e.title,a=e.content,o=Object(r.useRef)(null);Object(r.useEffect)(()=>{if(a){var e=a,t=document.createElement("div");t.innerHTML=e,o.current.append(t);try{t.querySelectorAll("script").forEach(e=>{window.eval(e.innerText)})}catch(e){}}},[a]);var i=(()=>{var e=DS(Object(r.useState)(!1),2),t=e[0],a=e[1];return{loading:t,exportPDF:(e,t)=>{var r,n,o;return regeneratorRuntime.async((function(i){for(;;)switch(i.prev=i.next){case 0:t&&(a(!0),r=t.offsetWidth/4,n=t.offsetHeight/4,14400,n>14400&&(o=14400/n,n=14400,r*=o),IS()(t,{scale:2,useCORS:!0,allowTaint:!1,ignoreElements:e=>"ignoreBtnElement"===e.id}).then(t=>{var o,i=t.getContext("2d");i&&(i.mozImageSmoothingEnabled=!1,i.webkitImageSmoothingEnabled=!1,i.msImageSmoothingEnabled=!1,i.imageSmoothingEnabled=!1);var l=t.toDataURL("image/webp",.7),s=new Image;s.src=l,s.onload=function(){var t;s.width/=2,s.height/=2,s.style.transform="scale(0.5)",o=r>n?"l":"p",(t=new qS.default(o,"mm",[r,n])).addImage(l,"jpeg",0,0,r,n),t.save("".concat(e,".pdf")),a(!1)}}));case 1:case"end":return i.stop()}}),null,null,null,Promise)}}})(),l=i.loading,s=i.exportPDF;return n.a.createElement("div",{className:"auto_pilot"},n.a.createElement("div",{className:"auto_pilot_icon",onClick:()=>{s(t,o.current)}},n.a.createElement("svg",{t:"1701955188289",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3387",width:"2rem",height:"2rem"},n.a.createElement("path",{d:"M704 0H192c-35.328 0-64 28.672-64 64v320h576c35.328 0 64 28.672 64 64v415.744c0 35.328-28.672 64-64 64H128v31.744c0 35.328 28.672 64 64 64h768c35.328 0 64-28.672 64-64v-640L704 0z",fill:"#EAEAEA","p-id":"3388"}),n.a.createElement("path",{d:"M704 0v256c0 35.328 28.672 64 64 64h256L704 0z",fill:"#434854","p-id":"3389"}),n.a.createElement("path",{d:"M768 320l256 256V320z",opacity:".1","p-id":"3390"}),n.a.createElement("path",{d:"M704 832c0 17.92-14.336 31.744-31.744 31.744H31.744C13.824 863.744 0 849.408 0 832V480.256c0-17.92 14.336-31.744 31.744-31.744h640c17.92 0 31.744 14.336 31.744 31.744V832z",fill:"#CD4050","p-id":"3391"}),n.a.createElement("path",{d:"M192 544.256h-48.128c-8.704 0-15.872 7.168-15.872 15.872v192c0 8.704 7.168 15.872 15.872 15.872s15.872-7.168 15.872-15.872v-79.872h31.744c35.328 0 64-28.672 64-64s-28.16-64-63.488-64z m158.72 0c34.816 0 62.976 27.648 64 62.464v97.792c0 34.816-27.648 62.976-62.464 64h-49.664c-8.704 0-15.36-6.656-15.872-14.848V560.64c0-8.704 6.656-15.36 14.848-15.872h49.152z m227.328 0c8.704 0 15.872 7.168 15.872 15.872S586.752 576 578.048 576h-80.384v64h48.128c8.704 0 15.872 7.168 15.872 15.872s-7.168 15.872-15.872 15.872h-48.128v79.872c0 8.704-7.168 15.872-15.872 15.872s-15.872-7.168-15.872-15.872v-192c0-8.704 7.168-15.872 15.872-15.872h96.256zM350.72 576h-31.744v159.744h31.744c17.408 0 31.232-13.824 31.744-30.72v-97.28C382.976 590.336 368.64 576 350.72 576zM192 576c17.92 0 31.744 14.336 31.744 31.744S209.92 640 192 640h-31.744v-64H192z",fill:"#FFFFFF","p-id":"3392"})),n.a.createElement("p",null,window.W_L.download),l&&n.a.createElement(jf.a,null)),n.a.createElement("div",{ref:o}))}),zS=(a(1399),(e,t)=>n.a.createElement("div",{className:"content_loading"},n.a.createElement("div",{className:"point1"}),n.a.createElement("div",{className:"point2"}),n.a.createElement("div",{className:"point3"}))),FS=a(720),VS=a.n(FS);a(1400);function US(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return BS(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return BS(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function BS(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var HS=e=>{var t=e.logData,a=e.Cardloading,r=US(n.a.useState(!1),2),o=r[0],i=r[1],l=US(n.a.useState([]),2),s=l[0],c=l[1],u=US(n.a.useState("生成中"),2),d=u[0],p=u[1],f=n.a.useRef(null);n.a.useEffect(()=>{if(t&&t.length>0){var e=t.slice(s.length),a=f.current,r=/\n/g;if(e.some(e=>r.test(e))){var n=e.map(e=>e.replace(/\n\n/g,"<br />"));c(e=>[...e,...n])}else c(t=>[...t,...e]);setTimeout(()=>{a.scrollTop=a.scrollHeight},0)}},[t,s.length]);var g=()=>{try{var e=f.current,t=document.createRange();t.selectNode(e);var a=window.getSelection();a.rangeCount>0&&a.removeAllRanges(),a.addRange(t),document.execCommand("copy"),a.removeAllRanges(),bj.a.success(window.W_L.copy_success)}catch(e){bj.a.error(window.W_L.copy_failed)}};return n.a.createElement("div",{className:"log_terminal"},n.a.createElement("div",{className:"log_terminal_header"},a?n.a.createElement(zS,null):n.a.createElement("div",null),n.a.createElement("div",{className:"log_terminal_header_title",onClick:()=>{t&&0===t.length||("生成中"===d?(p("隐藏"),f.current.style.height="170px"):(p("生成中"),f.current.style.height="0px"))}},d)),n.a.createElement("div",{className:"log_terminal_content_div"},n.a.createElement(we,{title:window.W_L.copy},n.a.createElement(m.a,{icon:n.a.createElement(DE.a,null),style:{position:"absolute",color:"#9d9d9d"},type:"text",size:"small",className:"copy_btn",onClick:g})),n.a.createElement(we,{title:"全屏"},n.a.createElement(m.a,{icon:n.a.createElement(VS.a,null),style:{position:"absolute",color:"#9d9d9d"},type:"text",size:"small",className:"compress_btn",onClick:()=>{i(!0)}})),n.a.createElement(R.a,{visible:o,onCancel:()=>i(!1),footer:null,closable:!1,width:"80%",className:"log_terminal_modal"},n.a.createElement("div",{className:"log_terminal_content_div"},n.a.createElement(we,{title:window.W_L.copy},n.a.createElement(m.a,{icon:n.a.createElement(DE.a,null),style:{position:"absolute",color:"#9d9d9d"},type:"text",size:"small",className:"copy_btn",onClick:g})),n.a.createElement("div",{className:"log_terminal_content",style:{height:"auto",maxHeight:"470px"}},s&&s.length>0&&s.map((e,t)=>n.a.createElement("div",{key:t,className:"log-item",dangerouslySetInnerHTML:{__html:e}}))))),n.a.createElement("div",{className:"log_terminal_content",ref:f},s&&s.length>0&&s.map((e,t)=>n.a.createElement("div",{key:t,className:"log-item",dangerouslySetInnerHTML:{__html:e}})))))},YS=(a(603),a(1403),e=>{var t=e.sender;e.source;return n.a.createElement("div",{className:"copy".concat(t)})});a(1404);function QS(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return KS(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return KS(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function KS(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var $S=Zj().getAutopilotStorage,GS=va.a.TextArea,JS=e=>{var t=e.databases_type,a=QS(Object(r.useState)(!1),2),o=a[0],i=a[1],l=QS(Object(r.useState)(""),2),s=l[0],c=l[1],u=QS(Object(r.useState)(""),2),d=u[0],p=u[1],f=QS(Object(r.useState)(!0),2),g=f[0],b=f[1],h=()=>{if(s&&d){var e=$S();if(e&&e.length>0&&e[0].table_name&&e[0].table_name.tableName&&e[0].table_name.tableName.length>0){i(!0);var a=[],r=e[0].table_name.tableName.map(t=>{var r;return regeneratorRuntime.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,regeneratorRuntime.awrap(B.get("/api/data_table/columns/".concat(e[0].Charttable_id,"/").concat(t.name)));case 2:r=n.sent,a.push({table_name:r.table_name,table_comment:r.table_desc,field_desc:r.table_columns_info.field_desc});case 4:case"end":return n.stop()}}),null,null,null,Promise)});Promise.all(r).then(()=>{var r,n,o;r=e[0].Charttable_id,n={databases_desc:"",table_desc:a},regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return o={databases_id:r,databases_type:t.current,report_name:s,report_desc:d,db_comment:n},e.next=3,regeneratorRuntime.awrap(B.post("/api/auto_pilot",o).then(e=>{i(!1),200===e.code?(b(!1),bj.a.success(window.W_L.submit_success+" "+window.W_L.submit_success_tip),_f.navigate("Dialogue.List.autopilot_list")):bj.a.error(e.data)}).catch(e=>{i(!1),bj.a.error(window.W_L.submit_fail)}));case 3:case"end":return e.stop()}}),null,null,null,Promise)}).catch(e=>{console.log(e,"first_error"),i(!1)})}}};return n.a.createElement("div",{style:{width:"100%"}},n.a.createElement(uu.a,{size:"small",column:1,bordered:!0,className:"my-custom-label"},n.a.createElement(uu.a.Item,{label:window.W_L.report_name},n.a.createElement(va.a,{bordered:!1,placeholder:window.W_L.report_name_tip,value:s,onChange:e=>c(e.target.value)})),n.a.createElement(uu.a.Item,{label:window.W_L.report_desc},n.a.createElement(GS,{style:{resize:"none"},rows:10,placeholder:window.W_L.report_desc_tip,bordered:!1,value:d,onChange:e=>p(e.target.value)}))),n.a.createElement("div",{className:"gpt-descriptions-btn"},n.a.createElement("div",{style:{fontSize:"14px"}},n.a.createElement(he.a,{title:window.W_L.report_name_and_report_desc_tip},n.a.createElement(dS.a,{style:{marginRight:"3px"}})),window.W_L.please_complete_report_name_and_report_desc),g&&n.a.createElement(m.a,{style:{width:"100px"},block:!0,type:"primary",disabled:o,onClick:()=>h()},n.a.createElement("i",{className:"fa fa-check m-r-5","aria-hidden":"true"}),window.W_L.submit)))};a(604);function XS(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ZS(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ZS(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ZS(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var eC=e=>{var t=e.databases_type,a=e.chat_type,o=e.autopilot,i=e.chart,l=e.source,s=e.logData,c=e.index,u=e.Cardloading,d=e.sender,m=e.time,p=e.ChangeScrollTop,f=e.retry,g=Object(r.useRef)(),b=XS(Object(r.useState)(""),2),h=b[0],y=b[1],v=XS(Object(r.useState)(!1),2),w=v[0],O=v[1];Object(r.useEffect)(()=>{if(/\n/g.test(l)){var e=l.replace(/\n/g,"<br />");y(e)}else y(l);setTimeout(()=>{p()},0)},[l,p]);var _=Object(r.useMemo)(()=>0===c?null:n.a.createElement(HS,{Cardloading:u,logData:s}),[c,u,s]),E=Object(r.useMemo)(()=>i?n.a.createElement(TS,{content:i}):null,[i]),j=Object(r.useMemo)(()=>n.a.createElement("div",{style:{overflowWrap:"break-word"},ref:g,dangerouslySetInnerHTML:{__html:h}}),[h]),S=Object(r.useMemo)(()=>"autopilot"===a?n.a.createElement(JS,{databases_type:t}):n.a.createElement("div",{className:"Chat ".concat(d)},l),[a,d,l]);Object(r.useMemo)(()=>o?n.a.createElement(MS,{content:o}):null,[o]);return n.a.createElement("div",{className:"message ".concat(a),onMouseLeave:()=>O(!1)},n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"info".concat(d,"-time")},"autopilot"===a?"":m),n.a.createElement("div",{className:"chat".concat(d),onMouseEnter:()=>O(!0)},"autopilot"!==a&&n.a.createElement("img",{src:"user"===d?H.profile_image_url:vt.a,alt:""}),"user"===d?S:n.a.createElement("div",{className:"Chat ".concat(d)},_,E,j)),w&&!u&&"autopilot"!==a&&n.a.createElement(YS,{index:c,source:l,sender:d,retry:f})))};eC.propTypes={title:te.PropTypes.string,source:te.PropTypes.string},eC.defaultProps={title:"",source:""};var tC=eC,aC=a(722),rC=a.n(aC),nC=a(721),oC=a.n(nC);function iC(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function lC(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?iC(Object(a),!0).forEach((function(t){sC(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):iC(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function sC(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var cC=va.a.TextArea,uC=Object(r.forwardRef)((e,t)=>{var a=e.Charttable,o=e.confirmLoading,i=e.onChange,l=e.sendTableDate,s=e.loadingMask,c=e.onUse,u=e.messages,d=e.ChangeScrollTop,m=e.loadingState,p=e.stopSend,f=e.inputMessage,g=(e.newInputMessage,e.setState),b=e.handleSendMessage,h=e.chat_type,y=e.retry,v=e.onOpenKeyClick,w=e.onSuccess,O=e.percent,_=e.databases_type,E=Object(r.useRef)(null),j=e=>{E.current.editTableData(e)};return Object(r.useEffect)(()=>{sessionStorage.getItem("reloaded")||(sessionStorage.setItem("reloaded","true"),setTimeout(()=>{window.location.reload()},1))},[]),Object(r.useImperativeHandle)(t,()=>({sourceEdit:j})),n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"dialogue-content-all"},n.a.createElement("div",{className:"dialogue-content-message"},n.a.createElement("div",{className:"dialogue-content-message-auto"},n.a.createElement(LS,{ref:E,onSuccess:w,chat_type:h,Charttable:a,confirmLoading:o,onChange:i,percent:O}),1!==l&&u.length<=0&&a?n.a.createElement(rS,{loadingMask:s,Charttable:a,onUse:c}):null,u.map((e,t)=>n.a.createElement("div",{key:t,className:"chat-content",style:{margin:"report"===h?"0 30px":"",marginTop:0===t?"30px":""}},n.a.createElement(tC,{databases_type:_,chat_type:h,autopilot:e.autopilot,chart:e.chart,logData:e.logData,sender:e.sender,time:e.time,Cardloading:e.Cardloading,source:e.content,index:t,ChangeScrollTop:d,retry:y})))))),"viewConversation"!==h&&n.a.createElement("div",{className:"main-all",style:{width:"report"===h?"90%":"80%"}},m&&u.length>0&&n.a.createElement("div",{className:"gpt-section-btn-list"},n.a.createElement("button",{className:"gpt-btn-item",onClick:p},n.a.createElement(oC.a,{className:"gpt-btn-item-img"}),n.a.createElement("div",{className:"gpt-btn-item-txt"},window.W_L.stop_generation))),"autopilot"===h?"":n.a.createElement("div",{className:"dialogue-content-bottom"},n.a.createElement("div",{className:"open-key",style:{display:"none"},onClick:v}),n.a.createElement(cC,{bordered:!1,style:{resize:"none",maxHeight:"100px !important",fontSize:"15px",border:"none !important"},value:f,className:"gpt-input",onChange:e=>{if(e&&e.target){var t=e.target.value;g(e=>lC(lC({},e),{},{inputMessage:t,newInputMessage:t}))}},placeholder:window.W_L.send_me_instructions,autoSize:{minRows:1,maxRows:4},onPressEnter:e=>{e.preventDefault(),b()}}),n.a.createElement("div",{className:"gpt-input-middle"},n.a.createElement(rC.a,{onClick:b,style:{color:f?"":"#ccc",fontSize:"20px",marginRight:"15px"}})))))}),dC=(a(1409),e=>n.a.createElement("div",{className:"menumask"}));a(1410);function mC(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function pC(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?mC(Object(a),!0).forEach((function(t){fC(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):mC(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function fC(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function gC(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return bC(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return bC(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bC(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var hC=e=>{var t=e.chat_type,a=e.sendUrl,o=e.uuid,i=Object(r.useRef)(),l=Object(r.useRef)(),s=Object(r.useRef)([]),c=Object(r.useRef)(),u=Object(r.useRef)(null),d=Object(r.useRef)({}),m=Object(r.useRef)(null),p=Object(r.useRef)(null),f=gC(Object(r.useState)(null),2),g=f[0],b=f[1],h=gC(Object(r.useState)(null),2),y=h[0],v=h[1],w=gC(Object(r.useState)(!1),2),O=w[0],_=w[1],E=gC(Object(r.useState)(!1),2),j=E[0],S=E[1],C=gC(Object(r.useState)(0),2),x=C[0],P=C[1],L=gC(Object(r.useState)(!1),2),k=L[0],N=L[1],A=gC(Object(r.useState)([]),2),T=A[0],W=A[1],I=gC(Object(r.useState)({}),2),q=I[0],D=I[1],R=Object(r.useRef)(),M=Object(r.useRef)(),z=gC(Object(r.useState)(!1),2),F=z[0],V=z[1],U=Object(r.useRef)("mysql"),H=gC(Object(r.useState)(0),2),Y=H[0],Q=H[1],K=null,$=gC(Object(r.useState)({messages:[],inputMessage:"",lockReconnect:!1,data_type:null,newInputMessage:"",logData:[]}),2),G=$[0],J=$[1];Object(r.useEffect)(()=>{},[t]),Object(r.useEffect)(()=>{G.logData&&(s.current=G.logData)},[G.logData]),Object(r.useEffect)(()=>{Z(),oe()},[]),Object(r.useEffect)(()=>{o&&Z()},[o]),Object(r.useEffect)(()=>{R.current=q},[q]),Object(r.useEffect)(()=>{M.current=T},[T]),Object(r.useEffect)(()=>{p.current=y},[y]);var X=Object(r.useCallback)((function(e,a,r,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i={state:e,database:U.current,sender:a,chat_type:t,data:{data_type:r,databases_id:u.current||0,language_mode:window.W_L.language_mode,content:n},id:o};Wt.send(JSON.stringify(i))}),[G]),Z=function(){if("chat"===t||"report"===t||"autopilot"===t){var e=[];switch(t){case"chat":e=Ie();break;case"report":e=Te()}e&&e.length>0?(v(e[0].table_name),se("",e[0].Charttable_id),U.current=e[0].type,d.current={label:e[0].label,id:e[0].id,type:e[0].type},e[0].dashboardId?(a(e[0].dashboardId),se("dashboard_id",e[0].dashboardId)):("report"===t&&a("new_report"),se("dashboard_id",null)),e[0].messages&&e[0].messages.length>0?(J(t=>pC(pC({},t),{},{messages:e[0].messages})),N(!1),S(!0),ve("edit"),P(0)):pe()):("report"===t&&a(""),v(null),se(null,null),J(e=>pC(pC({},e),{},{messages:[]})),N(!1),P(0),S(!1),d.current={})}else if("viewConversation"===t){var r=De();if(r&&r.length>0&&o){var n=r.filter(e=>e.uuid===o);v(n[0].table_name),se("",n[0].Charttable_id),d.current={label:n[0].label,id:n[0].id,type:n[0].type},n[0].messages&&n[0].messages.length>0&&(J(e=>pC(pC({},e),{},{messages:n[0].messages})),N(!1),P(1),S(!0))}}},ee=()=>{var e,a;v(M.current),e=[],(a=pC({table_name:M.current,Charttable_id:u.current},d.current)).title=window.W_L.new_dialogue+String(De().length+1),a.uuid=Date.now(),a.messages=[],e.push(a),"report"===t?Ae(e):"chat"===t?We(e):"autopilot"===t&&Re(e)},te=Object(r.useCallback)((e,t,a,r,n)=>{if(!qt)return bj.a.error(window.W_L.connection_seems_lost),V(!1),void oe();u.current=a.id,d.current={label:a.label,id:a.id,type:a.type},U.current=a.type,V(!0),J(e=>pC(pC({},e),{},{data_type:"mysql_comment"})),n&&W(r),D({table_desc:t});var o=t.map(e=>{var t=e.field_desc.filter(e=>1===e.in_use);return{table_name:e.table_name,table_comment:e.table_comment,field_desc:t}});X(e,"bi","mysql_comment",{databases_desc:"",table_desc:o})},[J,X]),ae=(e,t)=>{var a=JSON.parse(JSON.stringify(e));return t.table_desc.forEach((e,t)=>{var r=a.table_desc.findIndex((t,a)=>e.table_name===t.table_name);-1!==r?(a.table_desc[r].table_comment=e.table_comment,e.field_desc.forEach((e,t)=>{var n=a.table_desc[r].field_desc.findIndex((t,a)=>e.name===t.name);-1!==n?(a.table_desc[r].field_desc[n].comment=e.comment,a.table_desc[r].field_desc[n].in_use=e.in_use,a.table_desc[r].field_desc[n].is_pass=e.is_pass):a.table_desc[r].field_desc.push(e)})):a.table_desc.push(e)}),a},re=function(e,t){var a,r,n,o=arguments;return regeneratorRuntime.async((function(i){for(;;)switch(i.prev=i.next){case 0:a=o.length>2&&void 0!==o[2]?o[2]:null;try{r=ae(R.current,t),n=r.table_desc.map(t=>{var a;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:return a={table_name:t.table_name,table_inuse:!0,table_desc:t.table_comment,table_columns_info:{field_desc:t.field_desc}},r.next=3,regeneratorRuntime.awrap(B.post("/api/data_table/columns/".concat(e,"/").concat(t.table_name),a));case 3:case"end":return r.stop()}}),null,null,null,Promise)}),Promise.all(n).then(()=>{a&&pe()})}catch(e){V(!1)}case 2:case"end":return i.stop()}}),null,null,null,Promise)},ne=Object(r.useCallback)(()=>{qt?(Wt.onclose=e=>{J(e=>pC(pC({},e),{},{messages:e.messages.map((t,a)=>a===e.messages.length-1&&"bot"===t.sender&&t.Cardloading?pC(pC({},t),{},{content:window.W_L.connection_seems_lost,Cardloading:!1}):t)})),N(!1),P(0),qt=!1,me()},Wt.onmessage=e=>{var r,n,o;return regeneratorRuntime.async((function(i){for(;;)switch(i.prev=i.next){case 0:if(i.prev=0,"user"===(r=JSON.parse(e.data)).receiver&&(J(e=>pC(pC({},e),{},{messages:e.messages.map((t,a)=>a===e.messages.length-1&&"bot"===t.sender?pC(pC({},t),{},{content:r.data.content,Cardloading:!1,time:Fa()().format("YYYY-MM-DD HH:mm")}):t)})),_(!1),he()),500!==r.state){i.next=11;break}if("bi"===r.receiver&&"mysql_comment_first"===r.data.data_type&&(P(0),N(!1),_(!1)),V(!1),"log"!==r.receiver){i.next=9;break}return bj.a.error(r.data.content),i.abrupt("return");case 9:return me(),i.abrupt("return");case 11:if("bi"!==r.receiver){i.next=46;break}if("mysql_code"!==r.data.data_type){i.next=17;break}fe("mysql_code"),Se(r.data.content,r.data.name,r.id),i.next=44;break;case 17:if("ask_data"!==r.data.data_type){i.next=22;break}fe("ask_data"),Pe("","ask_data",r.id),i.next=44;break;case 22:if("chart_code"!==r.data.data_type){i.next=27;break}fe("chart_code");try{m.current?xe(JSON.parse(r.data.content),"edit",r.id):xe(JSON.parse(r.data.content),null,r.id)}catch(e){X(500,"bi","chart_code",e,r.id)}i.next=44;break;case 27:if("mysql_comment"!==r.data.data_type){i.next=43;break}return fe("mysql_comment"),i.prev=29,n=JSON.parse(JSON.stringify(r.data.content.table_desc)),i.next=33,regeneratorRuntime.awrap(be(n));case 33:(o=i.sent).length>0?(bj()(window.W_L.please_fill_in_the_description),V(!1),l.current.sourceEdit(o),re(u.current,r.data.content)):(ee(),V(!1),"report"===t&&a("new_report"),re(u.current,r.data.content,"success")),Q(0),i.next=41;break;case 38:i.prev=38,i.t0=i.catch(29),me();case 41:i.next=44;break;case 43:"mysql_comment_first"===r.data.data_type?(J("autopilot"===t?{messages:[{content:r.data.content,sender:"bot",Cardloading:!1,time:Fa()().format("YYYY-MM-DD HH:mm")},{content:"",sender:"user",time:Fa()().format("YYYY-MM-DD HH:mm")}]}:{messages:[{content:r.data.content,sender:"bot",Cardloading:!1,time:Fa()().format("YYYY-MM-DD HH:mm")}],data_type:"mysql_comment_first"}),N(!1),P(1),S(!0),_(!1),bj.a.success(window.W_L.configuration_completed+" "+t=="autopilot"?"":window.W_L.start_the_dialogue,{icon:"👏"})):"mysql_comment_second"===r.data.data_type?(J(e=>pC({},e)),N(!1),P(1),X(200,"user","question",G.newInputMessage)):"delete_chart"===r.data.data_type?(fe("delete_chart"),Pe(r.data.content,"delete",r.id)):"table_code"===r.data.data_type&&(fe("table_code"),m.current?Le("edit",r.id):Le(null,r.id));case 44:i.next=56;break;case 46:if("log"!==r.receiver){i.next=55;break}if(r.data.content){i.next=49;break}return i.abrupt("return");case 49:if("data_check"!==r.data.data_type){i.next=52;break}return Q(r.data.content),i.abrupt("return");case 52:J(e=>({messages:e.messages.map((t,a)=>a===e.messages.length-1&&"bot"===t.sender?pC(pC({},t),{},{logData:[...t.logData||[],r.data.content]}):t)})),i.next=56;break;case 55:"python"===r.receiver&&"echart_code"===r.data.data_type&&(J(e=>({messages:e.messages.map((t,a)=>a===e.messages.length-1&&"bot"===t.sender?pC(pC({},t),{},{chart:r.data.content}):t)})),he());case 56:i.next=61;break;case 58:i.prev=58,i.t1=i.catch(0),console.log(i.t1,"socket_error");case 61:case"end":return i.stop()}}),null,null,[[0,58],[29,38]],Promise)}):Ft()},[G,J,e]),oe=Object(r.useCallback)(()=>{Ft(),ne()},[]),ie=()=>{if("chat"===t||"report"===t){var e=c.current,a=c.current[c.current.length-1];a&&"bot"===a.sender&&a.Cardloading&&e.pop(),qe(e,t)}};Object(r.useEffect)(()=>{c.current=G.messages},[G.messages]),Object(r.useEffect)(()=>{var e=()=>{ie()};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e),ie()}},[]);var le=Object(r.useCallback)((function(e){oe()}),[J,ne,oe]),se=Object(r.useCallback)((e,t)=>{if("dashboard_id"===e)return m.current=t,void b(t);u.current=t},[]),ce=Object(r.useCallback)(e=>{if(ne(),!qt)return bj.a.error(window.W_L.connection_failed),P(0),_(!1),void oe();if(p.current&&p.current.tableName.length>0&&0===x){J(t=>pC(pC({},t),{},{data_type:e})),N(!0),_(!0);var t=[],a=p.current.tableName.map(e=>{var a;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,regeneratorRuntime.awrap(B.get("/api/data_table/columns/".concat(u.current,"/").concat(e.name)));case 2:a=r.sent,t.push({table_name:a.table_name,table_comment:a.table_desc,field_desc:(n=a.table_columns_info,n.field_desc.filter(e=>1===e.in_use))});case 4:case"end":return r.stop()}var n}),null,null,null,Promise)});Promise.all(a).then(()=>{X(200,"bi",e,{databases_desc:"",table_desc:t})}).catch(e=>{console.log(e,"first_error"),N(!1),_(!1),P(0)})}},[G,J,ne,oe,X]),ue=Object(r.useCallback)(()=>{var e,t;return regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(ne(),e=G.inputMessage,t=G.messages,""!==e.trim()){a.next=4;break}return a.abrupt("return");case 4:if(J(a=>pC(pC({},a),{},{newInputMessage:e,messages:[...t,{content:e,sender:"user",time:Fa()().format("YYYY-MM-DD HH:mm")},{content:"",sender:"bot",Cardloading:!0}],inputMessage:"",data_type:"question"})),_(!0),he(),!(0===x&&t.length>=1)){a.next=10;break}return ce("mysql_comment_second"),a.abrupt("return");case 10:X(200,"user","question",e);case 11:case"end":return a.stop()}}),null,null,null,Promise)},[G,J,ne,he,X,ce]),de=Object(r.useCallback)(()=>{G.inputMessage,G.messages;if(!Rt&&!O)return qt?void(j&&p.current&&p.current.tableName.length>0&&ue()):(bj.a.error(window.W_L.connection_failed),P(0),_(!1),void oe())},[G,J,oe,ue]),me=Object(r.useCallback)(()=>{Rt||(bj.a.error(window.W_L.connection_failed),_(!1))},[J]),pe=Object(r.useCallback)(()=>{ce("mysql_comment_first")},[ce]),fe=Object(r.useCallback)(e=>{J(t=>pC(pC({},t),{},{data_type:e}))},[J]),ge=Object(r.useCallback)(()=>{Rt||bj.a.success(window.W_L.report_generation_completed)},[]);var be=Object(r.useCallback)(e=>e.filter(e=>e.field_desc.some(e=>1!==e.is_pass)),[]),he=Object(r.useCallback)(()=>{"viewConversation"!==t&&(K&&clearTimeout(K),K=setTimeout(()=>{var e=document.querySelector(".dialogue-content-all");if(e){var t=e.scrollHeight,a=e.clientHeight;e.scrollTo({top:t-a,behavior:"smooth"})}},50))},[]),ye=Object(r.useCallback)(()=>{setTimeout(()=>{he()},100)},[]),ve=Object(r.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Wt&&Wt.close(),P("edit"===e?1:0),_(!1),Ht(!0),he(),oe()}),[J,oe]),we=Object(r.useCallback)(e=>{a(e),Ne(e)},[]),Oe=Object(r.useCallback)(e=>{},[J,X]),_e=Object(r.useCallback)(()=>{},[J,i]),Ee=((e,t,a)=>{var n=$j(Object(r.useState)({SelectValue:null,sqlId:null}),2),o=n[0],i=n[1],l=Object(r.useRef)(null),s=Object(r.useRef)(null);Object(r.useEffect)(()=>{o.sqlId&&(l.current=o.sqlId)},[o.sqlId]),Object(r.useEffect)(()=>{e&&(s.current=e)},[e]);var c=Object(r.useCallback)((e,a,r,n)=>{var o;return regeneratorRuntime.async((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,regeneratorRuntime.awrap(B.get("/api/query_results/".concat(e.job.query_result_id)));case 3:if(0!==(o=i.sent).query_result.data.rows.length){i.next=7;break}return t(500,"bi","mysql_code","sql没有查询到数据",n),i.abrupt("return");case 7:if("test"!==a){i.next=12;break}return i.next=10,regeneratorRuntime.awrap(m(o.query_result.query,r,n));case 10:i.next=13;break;case 12:t(200,"bi","mysql_code",o.query_result.data,n);case 13:i.next=17;break;case 15:i.prev=15,i.t0=i.catch(0);case 17:case"end":return i.stop()}}),null,null,[[0,15]],Promise)},[t,m]),u=Object(r.useCallback)((function(e,r,n,o){var i,l,s,u,d=arguments;return regeneratorRuntime.async((function(m){for(;;)switch(m.prev=m.next){case 0:i=d.length>4&&void 0!==d[4]?d[4]:50,l=0,s=!1,u=setInterval(()=>{var d;return regeneratorRuntime.async((function(m){for(;;)switch(m.prev=m.next){case 0:if(!(++l>i)){m.next=5;break}return clearInterval(u),a(),m.abrupt("return");case 5:return m.prev=5,m.next=8,regeneratorRuntime.awrap(B.get("/api/jobs/".concat(e.job.id)));case 8:if(!(d=m.sent).job.query_result_id||s){m.next=16;break}return s=!0,clearInterval(u),m.next=14,regeneratorRuntime.awrap(c(d,r,n,o));case 14:m.next=20;break;case 16:if(!d.job.error){m.next=20;break}return clearInterval(u),t(500,"bi","mysql_code",d.job.error,o),m.abrupt("return");case 20:m.next=24;break;case 22:m.prev=22,m.t0=m.catch(5);case 24:case"end":return m.stop()}}),null,null,[[5,22]],Promise)},200);case 4:case"end":return m.stop()}}),null,null,null,Promise)}),[a,t,c]),d=Object(r.useCallback)((e,a)=>{var r,n;return regeneratorRuntime.async((function(o){for(;;)switch(o.prev=o.next){case 0:return r={id:e.id,parameters:{},apply_auto_limit:!0,max_age:0},o.prev=1,o.next=4,regeneratorRuntime.awrap(B.post("/api/queries/".concat(e.id,"/results"),r));case 4:return n=o.sent,o.next=7,regeneratorRuntime.awrap(u(n,"execute",null,a));case 7:o.next=12;break;case 9:o.prev=9,o.t0=o.catch(1),t(500,"bi","mysql_code","",a);case 12:case"end":return o.stop()}}),null,null,[[1,9]],Promise)},[u,t]),m=Object(r.useCallback)((e,t,a)=>{var r,n;return regeneratorRuntime.async((function(o){for(;;)switch(o.prev=o.next){case 0:return r={data_source_id:s.current,latest_query_data_id:null,name:t,options:{apply_auto_limit:!0,parameters:[]},query:e,schedule:null,tags:[]},o.prev=1,o.next=4,regeneratorRuntime.awrap(B.post("/api/queries",r));case 4:return n=o.sent,i(e=>Qj(Qj({},e),{},{sqlId:n.id})),o.next=8,regeneratorRuntime.awrap(d(n,a));case 8:o.next=12;break;case 10:o.prev=10,o.t0=o.catch(1);case 12:case"end":return o.stop()}}),null,null,[[1,10]],Promise)},[d]),p=Object(r.useCallback)((e,t,a)=>{var r,n;return regeneratorRuntime.async((function(o){for(;;)switch(o.prev=o.next){case 0:return r={apply_auto_limit:!0,data_source_id:s.current,max_age:0,parameters:{},query:e},o.prev=1,o.next=4,regeneratorRuntime.awrap(B.post("/api/query_results",r));case 4:return n=o.sent,o.next=7,regeneratorRuntime.awrap(u(n,"test",t,a));case 7:o.next=11;break;case 9:o.prev=9,o.t0=o.catch(1);case 11:case"end":return o.stop()}}),null,null,[[1,9]],Promise)},[u]);return{state:o,saveSql:m,executeSql:d,testAndVerifySql:p,findJob:u,findQueryResult:c,new_sql:l}})(u.current,X,me),je=Ee.new_sql,Se=Ee.testAndVerifySql,Ce=((e,t,a,n,o,i,l,s)=>{var c=Jj(Object(r.useState)({dashboard_id:null}),2),u=c[0],d=c[1],m=Object(r.useRef)(null);Object(r.useEffect)(()=>{l&&(m.current=l)},[l]);var p=Object(r.useCallback)((function(t){var a,r,n,o,l,s=arguments;return regeneratorRuntime.async((function(c){for(;;)switch(c.prev=c.next){case 0:return a=s.length>1&&void 0!==s[1]?s[1]:null,r=s.length>2?s[2]:void 0,n=i.current,o={description:"",name:window.W_L.CHART,query_id:n,type:"CHART",options:{alignYAxesAtZero:!1,globalSeriesType:t[0].globalSeriesType,coefficient:1,columnMapping:t[0].columnMapping,dateTimeFormat:"DD/MM/YY HH:mm",direction:{type:"counterclockwise"},error_y:{type:"data",visible:!0},legend:{enabled:!0,placement:"auto",traceorder:"normal"},missingValuesAsZero:!0,numberFormat:"0,0[.]00000",percentFormat:"0[.]00%",series:{stacking:null,error_y:{type:"data",visible:!0}},seriesOptions:{},showDataLabels:!0,sizemode:"diameter",sortX:!1,textFormat:"",valuesOptions:{},xAxis:{type:"category",labels:{enabled:!0}},yAxis:[{type:"linear"},{type:"linear",opposite:!0}]}},c.prev=4,c.next=7,regeneratorRuntime.awrap(B.post("/api/visualizations",o));case 7:if(l=c.sent,"edit"!==a){c.next=13;break}return c.next=11,regeneratorRuntime.awrap(h(l,a,r));case 11:c.next=15;break;case 13:return c.next=15,regeneratorRuntime.awrap(f(null,r));case 15:c.next=20;break;case 17:c.prev=17,c.t0=c.catch(4),e(500,"bi","chart_code",c.t0,r);case 20:case"end":return c.stop()}}),null,null,[[4,17]],Promise)}),[u,h,f]),f=Object(r.useCallback)((function(){var t,a,r,n,o,l,s=arguments;return regeneratorRuntime.async((function(c){for(;;)switch(c.prev=c.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:null,a=s.length>1?s[1]:void 0,r=i.current,n=n,o={id:r,is_draft:!0,version:1},c.prev=5,c.next=8,regeneratorRuntime.awrap(B.post("/api/queries/".concat(r),o));case 8:if(l=c.sent,!n||!n.dashboard_id){c.next=14;break}return c.next=12,regeneratorRuntime.awrap(h(l,t,a));case 12:c.next=16;break;case 14:return c.next=16,regeneratorRuntime.awrap(b(t,a));case 16:c.next=21;break;case 18:c.prev=18,c.t0=c.catch(5),e(500,"bi","chart_code",c.t0,a);case 21:case"end":return c.stop()}}),null,null,[[5,18]],Promise)}),[u,o,h,b,e]),g=e=>{var t;return regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,regeneratorRuntime.awrap(B.get("/api/dashboards?order&page=1&page_size=20&q=".concat(e)));case 2:(t=a.sent).results.length>0&&t.results.forEach((t,a)=>regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(t.name!==e){a.next=4;break}return a.next=3,regeneratorRuntime.awrap(B.delete("/api/dashboards/".concat(t.id)));case 3:a.sent;case 4:case"end":return a.stop()}}),null,null,null,Promise));case 4:case"end":return a.stop()}}),null,null,null,Promise)},b=Object(r.useCallback)((function(){var e,a,r,n,o=arguments;return regeneratorRuntime.async((function(i){for(;;)switch(i.prev=i.next){case 0:return e=o.length>0&&void 0!==o[0]?o[0]:null,a=o.length>1?o[1]:void 0,r={name:window.W_L.temporary_dashboard},i.prev=3,i.next=6,regeneratorRuntime.awrap(g(window.W_L.temporary_dashboard));case 6:return i.next=8,regeneratorRuntime.awrap(B.post("/api/dashboards",r));case 8:return n=i.sent,t("dashboard_id",n.id),i.next=12,regeneratorRuntime.awrap(h(n,e,a));case 12:i.next=16;break;case 14:i.prev=14,i.t0=i.catch(3);case 16:case"end":return i.stop()}}),null,null,[[3,14]],Promise)}),[d,t,h]),h=Object(r.useCallback)((function(t){var a,r,o,i,l=arguments;return regeneratorRuntime.async((function(c){for(;;)switch(c.prev=c.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:null,r=l.length>2?l[2]:void 0,o=m.current?m.current:t.id,c.prev=3,c.next=6,regeneratorRuntime.awrap(B.get("/api/dashboards/".concat(o)));case 6:if(i=c.sent,"delete"!==a){c.next=10;break}return _(t,i,r),c.abrupt("return");case 10:if("ask_data"!==a){c.next=13;break}return O(i,a,r),c.abrupt("return");case 13:if("getPath"!==a&&"delGetPath"!==a){c.next=18;break}return e(200,"bi","getPath"===a?"chart_code":"delete_chart",i,r),s(o),n(),c.abrupt("return");case 18:return c.next=20,regeneratorRuntime.awrap(y(i,a,r));case 20:c.next=24;break;case 22:c.prev=22,c.t0=c.catch(3);case 24:case"end":return c.stop()}}),null,null,[[3,22]],Promise)}),[u,d,e,_,O,a,n,y,t,s,m]),y=Object(r.useCallback)((e,t,a)=>{var r,n;return regeneratorRuntime.async((function(o){for(;;)switch(o.prev=o.next){case 0:return r=i.current,o.prev=1,o.next=4,regeneratorRuntime.awrap(B.get("/api/queries/".concat(r)));case 4:return n=o.sent,o.next=7,regeneratorRuntime.awrap(v(n,e,t,a));case 7:o.next=11;break;case 9:o.prev=9,o.t0=o.catch(1);case 11:case"end":return o.stop()}}),null,null,[[1,9]],Promise)},[u,v]),v=Object(r.useCallback)((e,t,a,r)=>{var n,o,i;return regeneratorRuntime.async((function(l){for(;;)switch(l.prev=l.next){case 0:return n=m.current,o={created_at:new Date,dashboard_id:n,options:{isHidden:!1,parameterMappings:{},position:{autoHeight:!1,col:0,maxSizeX:6,maxSizeY:1e3,minSizeX:1,minSizeY:5,row:0,sizeX:6,sizeY:12}},text:"",visualization_id:e.visualizations[e.visualizations.length-1].id,width:1},l.prev=2,l.next=5,regeneratorRuntime.awrap(B.post("/api/widgets",o));case 5:return i=l.sent,l.next=8,regeneratorRuntime.awrap(w(i,t,a,r));case 8:l.next=12;break;case 10:l.prev=10,l.t0=l.catch(2);case 12:case"end":return l.stop()}}),null,null,[[2,10]],Promise)},[u,w]),w=Object(r.useCallback)((e,t,a,r)=>{var n,o,i;return regeneratorRuntime.async((function(l){for(;;)switch(l.prev=l.next){case 0:return(n=e.options).position.row=12*t.widgets.length,o={dashboard_id:e.dashboard_id,id:e.id,options:n,text:"",visualization_id:e.visualization.id,width:1},l.prev=3,l.next=6,regeneratorRuntime.awrap(B.post("/api/widgets/".concat(e.id),o));case 6:return i=l.sent,l.next=9,regeneratorRuntime.awrap(O(i,a,r));case 9:l.next=14;break;case 11:l.prev=11,l.t0=l.catch(3),console.log(l.t0,"saveReport_error");case 14:case"end":return l.stop()}}),null,null,[[3,11]],Promise)},[O]),O=Object(r.useCallback)((t,a,r)=>{var o,l,c,u,d;return regeneratorRuntime.async((function(p){for(;;)switch(p.prev=p.next){case 0:if(o=m.current,l=i.current,p.prev=2,"ask_data"!==a){p.next=8;break}return c=[],u=t.widgets.map((e,t)=>{var a;return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(B.get("/api/queries/".concat(e.visualization.query.id,"/results/").concat(e.visualization.query.latest_query_data_id,".json")));case 2:a=t.sent,c.push({data:a.query_result.data,table_name:e.visualization.query.name});case 4:case"end":return t.stop()}}),null,null,null,Promise)}),Promise.all(u).then(t=>{e(200,"bi","ask_data",c,r)}),p.abrupt("return");case 8:return p.next=10,regeneratorRuntime.awrap(B.get("/api/queries/".concat(l,"/results/").concat(t.visualization.query.latest_query_data_id,".json")));case 10:d=p.sent,"edit"!==a?(s(o),e(200,"bi","chart_code",d,r),n()):h(d,"getPath",r),p.next=16;break;case 14:p.prev=14,p.t0=p.catch(2);case 16:case"end":return p.stop()}}),null,null,[[2,14]],Promise)},[u,e,i,h]),_=Object(r.useCallback)((e,t,a)=>{var r;return regeneratorRuntime.async((function(n){for(;;)switch(n.prev=n.next){case 0:try{r=t.widgets.map((t,a)=>regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(!e.includes(t.visualization.query.name)){a.next=3;break}return a.next=3,regeneratorRuntime.awrap(B.delete("/api/widgets/".concat(t.id)));case 3:case"end":return a.stop()}}),null,null,null,Promise)),Promise.all(r).then(e=>{h(e,"delGetPath",a)})}catch(e){}case 1:case"end":return n.stop()}}),null,null,null,Promise)},[h]);return{DashId:m,saveChart:p,dashboardsId:h}})(X,se,e,ge,p.current,je,g,we),xe=Ce.saveChart,Pe=Ce.dashboardsId,Le=Ce.publishQuery,ke=Zj(),Ne=ke.setDialogueStorageDashboardId,Ae=ke.addDashboard,Te=ke.getDashboard,We=ke.addDialogueStorage,Ie=ke.getDialogueStorage,qe=ke.addChatList,De=ke.getAllStorage,Re=ke.addAutopilotStorage,Me=G.messages,ze=G.inputMessage,Fe=G.newInputMessage;return n.a.createElement("div",{className:"dialogue-content"},n.a.createElement(aS,{loadingMask:k,Charttable:y,CharttableItem:d.current,closeDialogue:()=>{ie(),"report"===t?Ae([]):"chat"===t?We([]):"autopilot"===t&&Re([]),l.current.sourceEdit([]),Z("report")},chat_type:t}),O&&n.a.createElement(dC,null),n.a.createElement(uC,{databases_type:U,ref:l,Charttable:y,onUse:pe,sendTableDate:x,onChange:le,confirmLoading:F,loadingMask:k,messages:Me,ChangeScrollTop:ye,loadingState:O,stopSend:ve,inputMessage:ze,newInputMessage:Fe,setState:J,handleSendMessage:de,chat_type:t,retry:Oe,onOpenKeyClick:_e,onSuccess:te,percent:Y,sourceTypeRef:U}))},yC=(a(1411),a(723)),vC=a.n(yC);function wC(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return OC(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return OC(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function OC(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var _C=e=>{var t=wC(Object(r.useState)([]),2),a=t[0],o=t[1],i=wC(Object(r.useState)(""),2),l=i[0],s=i[1];Object(r.useEffect)(()=>{o(JSON.parse(localStorage.getItem("Chart_All"))||[])},[]);var c=t=>()=>{s(t.uuid),e.switchMode(t)};return n.a.createElement(n.a.Fragment,null,a&&a.length>0&&n.a.createElement("div",{className:"dia-main"},n.a.createElement(()=>n.a.createElement("div",{className:"dia-top"},n.a.createElement("img",{src:vt.a,alt:""}),n.a.createElement("span",null,"DeepBI")),null),n.a.createElement(()=>n.a.createElement("div",{className:"dia-content"},a.map((e,t)=>n.a.createElement("div",{className:"flex-d dia-info",key:t},n.a.createElement("div",{className:"dia-chats"},n.a.createElement("div",{className:"dia-chat",onClick:c(e)},n.a.createElement(vC.a,{style:{color:l===e.uuid?"#4974d1":"#fff",fontSize:"21px"}}),n.a.createElement("div",{className:"dia-chat-name"},e.messages[1].content||e.title)))))),null)))};var EC=function(e){var t=e.chatType;return n.a.createElement("div",{style:{flex:"1 1 0%",overflow:"auto",display:"flex",flexDirection:"column",justifyContent:"center"}},n.a.createElement("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNDEiIHZpZXdCb3g9IjAgMCA2NCA0MSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCiAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAxKSIgZmlsbD0ibm9uZSIgZmlsbFJ1bGU9ImV2ZW5vZGQiPg0KICAgIDxlbGxpcHNlIGZpbGw9IiNkZGQiIGN4PSIzMiIgY3k9IjMzIiByeD0iMzIiIHJ5PSI3IiAvPg0KICAgIDxnIGZpbGxSdWxlPSJub256ZXJvIiBzdHJva2U9IiM5OTkiPg0KICAgICAgPHBhdGgNCiAgICAgICAgZD0iTTU1IDEyLjc2TDQ0Ljg1NCAxLjI1OEM0NC4zNjcuNDc0IDQzLjY1NiAwIDQyLjkwNyAwSDIxLjA5M2MtLjc0OSAwLTEuNDYuNDc0LTEuOTQ3IDEuMjU3TDkgMTIuNzYxVjIyaDQ2di05LjI0eiIgLz4NCiAgICAgIDxwYXRoDQogICAgICAgIGQ9Ik00MS42MTMgMTUuOTMxYzAtMS42MDUuOTk0LTIuOTMgMi4yMjctMi45MzFINTV2MTguMTM3QzU1IDMzLjI2IDUzLjY4IDM1IDUyLjA1IDM1aC00MC4xQzEwLjMyIDM1IDkgMzMuMjU5IDkgMzEuMTM3VjEzaDExLjE2YzEuMjMzIDAgMi4yMjcgMS4zMjMgMi4yMjcgMi45Mjh2LjAyMmMwIDEuNjA1IDEuMDA1IDIuOTAxIDIuMjM3IDIuOTAxaDE0Ljc1MmMxLjIzMiAwIDIuMjM3LTEuMzA4IDIuMjM3LTIuOTEzdi0uMDA3eiINCiAgICAgICAgZmlsbD0iI2UxZTFlMSIgLz4NCiAgICA8L2c+DQogIDwvZz4NCjwvc3ZnPg==",alt:"noData",style:{width:"120px",height:"120px",margin:"0 auto"}}),n.a.createElement("p",{style:{textAlign:"center",marginTop:"20px",fontSize:"14px",fontWeight:"bold"}},"report"===t?window.W_L.start_your_dialogue:window.W_L.no_dialogue))};a(397);function jC(){return(jC=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function SC(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return CC(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return CC(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function CC(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function xC(e){var t=e.chatType,a=SC(n.a.useState(""),2),r=a[0],o=a[1],i=SC(n.a.useState(0),2),l=i[0],s=i[1],c=SC(n.a.useState(""),2),u=c[0],d=c[1],m=SC(n.a.useState(!1),2),p=m[0],f=m[1];return n.a.createElement("div",{className:"page-alerts-list"},"viewConversation"===t&&n.a.createElement(_C,{chat_type:t,switchMode:e=>{d(e.uuid)}}),n.a.createElement("div",{style:{display:"flex",flexDirection:"column",flex:1,position:"relative",background:"rgb(250, 250, 250)",overflow:"auto"}},"viewConversation"!==t||u?n.a.createElement(hC,{chat_type:t,sendUrl:e=>{if("new_report"===e)return f(!0),o(""),void s(e=>e+1);f(!1),o(e),s(e=>e+1)},key:t,uuid:u}):n.a.createElement(EC,{chatType:t})),"report"===t&&r?n.a.createElement("div",{style:{flex:"1",overflow:"auto"},className:"dashbord_page"},n.a.createElement(Hj,{key:l,isShowReport:!1,dashboardId:r,dashboardSlug:"-",onError:()=>{}})):null,"report"===t&&p&&n.a.createElement(EC,{chatType:t}))}function PC(){return(PC=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function LC(e){return n.a.createElement("div",{className:"text-center"},n.a.createElement(xe,PC({icon:"fa-search",message:window.W_L.find_nothing},e)))}_f.register("Dialogue.List.autopilot",ha({path:"/autopilot",title:"autopilot",render:e=>n.a.createElement(xC,jC({},e,{chatType:"autopilot"}))})),_f.register("Dialogue.List.Dialogue",ha({path:"/dialogue-list",title:"Dialogue",render:e=>n.a.createElement(xC,jC({},e,{chatType:"viewConversation"}))})),_f.register("Dialogue.List.Report",ha({path:"/report-route",title:"Report",render:e=>n.a.createElement(xC,jC({},e,{chatType:"report"}))})),_f.register("Dialogue.List",ha({path:"/",title:window.W_L.dialogue,render:e=>n.a.createElement(xC,jC({},e,{currentPage:"testdialogue",chatType:"chat"}))}));a(1414);function kC(){return(kC=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function NC(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var AC={className:ae.a.string,children:ae.a.node},TC={className:null,children:null};function WC(e){var t=e.className,a=e.children,r=NC(e,["className","children"]);return n.a.createElement("div",kC({className:me()("layout-sidebar",t)},r),n.a.createElement("div",null,a))}function IC(e){var t=e.className,a=e.children,r=NC(e,["className","children"]);return n.a.createElement("div",kC({className:me()("layout-content",t)},r),n.a.createElement("div",null,a))}function qC(e){var t=e.children,a=e.className,r=void 0===a?void 0:a,o=NC(e,["children","className"]);return n.a.createElement("div",kC({className:me()("layout-with-sidebar",r)},o),t)}WC.propTypes=AC,WC.defaultProps=TC,IC.propTypes=AC,IC.defaultProps=TC,qC.propTypes=AC,qC.defaultProps=TC,qC.Sidebar=WC,qC.Content=IC;var DC=a(250),RC=a.n(DC);function MC(){return(MC=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function zC(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return FC(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return FC(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function FC(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function VC(){var e=zC(Object(r.useState)([]),2),t=e[0],a=e[1],o=zC(Object(r.useState)(!0),2),i=o[0],l=o[1],s=[{title:window.W_L.name,dataIndex:"report_name",width:null,align:"center",render:(e,t)=>n.a.createElement(n.a.Fragment,null,n.a.createElement(h,{className:"table-main-title",href:"autopilot/"+t.id},t.report_name))},{title:window.W_L.create_time,dataIndex:"created_at",align:"center"},{title:window.W_L.task_status,dataIndex:"is_generate",align:"center",render:(e,t)=>n.a.createElement(n.a.Fragment,null,0===t.is_generate&&n.a.createElement(t_.a,{color:"gold"},window.W_L.waiting),1===t.is_generate&&n.a.createElement(t_.a,{color:"blue"},window.W_L.generating),2===t.is_generate&&n.a.createElement(t_.a,{color:"green"},window.W_L.success),-1===t.is_generate&&n.a.createElement(t_.a,{color:"red"},window.W_L.fail))},{title:"",dataIndex:"actions",width:50,align:"center",render:(e,t)=>n.a.createElement(n.a.Fragment,null,n.a.createElement(RC.a,{style:{color:"#f08282",fontSize:"15px"},onClick:()=>c(t.id)}))}],c=e=>regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:R.a.confirm({title:window.W_L.confirm_delete,content:window.W_L.confirm_delete_tip,onOk:()=>regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,regeneratorRuntime.awrap(B.delete("/api/auto_pilot/delete/".concat(e)));case 3:200===t.sent.code?(bj.a.success(window.W_L.delete_success),u()):bj.a.error(window.W_L.delete_fail),t.next=9;break;case 7:t.prev=7,t.t0=t.catch(0);case 9:case"end":return t.stop()}}),null,null,[[0,7]],Promise),onCancel(){}});case 1:case"end":return t.stop()}}),null,null,null,Promise),u=()=>{var e;return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return l(!0),t.next=3,regeneratorRuntime.awrap(B.get("/api/auto_pilot"));case 3:200===(e=t.sent).code&&(e.data.sort((function(e,t){return Date.parse(t.created_at)-Date.parse(e.created_at)})),a(e.data)),l(!1);case 6:case"end":return t.stop()}}),null,null,null,Promise)};return Object(r.useEffect)(()=>{u()},[]),n.a.createElement("div",{className:"page-queries-list"},n.a.createElement("div",{className:"container"},n.a.createElement(Af,{title:window.W_L.all_autopilot,actions:n.a.createElement(h.Button,{block:!0,type:"primary",href:"autopilot"},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.auto_pilot)}),n.a.createElement(qC,null,n.a.createElement(qC.Content,null,n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"bg-white tiled table-responsive"},n.a.createElement(Zl.a,{className:"table-data",rowKey:"id",size:"middle",columns:s,dataSource:t,pagination:!1,loading:i,locale:{emptyText:n.a.createElement(LC,{className:""})}})))))))}function UC(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return BC(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return BC(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function BC(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function HC(e){var t=UC(Object(r.useState)({}),2),a=t[0],o=t[1],i=UC(Object(r.useState)(!0),2),l=i[0],s=i[1];return Object(r.useEffect)(()=>{var t,a;t=e.autopilotId,regeneratorRuntime.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(B.get("/api/auto_pilot/".concat(t)));case 2:200===(a=e.sent).code?o(a.data):o({}),s(!1);case 5:case"end":return e.stop()}}),null,null,null,Promise)},[]),n.a.createElement("div",{className:"auto-pilot-list"},n.a.createElement(Mf.a,{loading:l,active:!0,paragraph:{rows:10}},n.a.createElement("div",{className:"message"},n.a.createElement("div",{className:"auto-pilot"},n.a.createElement("div",{className:"chat user autopilot-item"},n.a.createElement("p",null,window.W_L.report_name,":",a.report_name),n.a.createElement("p",null,window.W_L.report_desc,":",a.report_desc),n.a.createElement(HS,{Cardloading:!1,logData:a.chat_log}),a.html_code?n.a.createElement(MS,{title:a.report_name,content:a.html_code}):n.a.createElement("div",{style:{textAlign:"center",marginTop:"50px"}},n.a.createElement("svg",{t:"1701954689007",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1988",width:"200",height:"200"},n.a.createElement("path",{d:"M777 806.7c0 38.7-31.1 70.3-69.7 70.3H225.9c-38.7 0-69.9-31.6-69.9-70.3V174.4c0-38.7 31.2-70.4 69.9-70.4h481.4c38.7 0 69.7 31.7 69.7 70.4v632.3z",fill:"#FFFFFF","p-id":"1989"}),n.a.createElement("path",{d:"M707.3 886H225.9c-43.5 0-78.9-35.8-78.9-79.3V174.4c0-43.5 35.4-79.4 78.9-79.4h481.4c43.5 0 79.7 35.9 79.7 79.4v632.3c0 43.5-36.2 79.3-79.7 79.3zM225.9 113c-33.7 0-59.9 27.7-59.9 61.4v632.3c0 33.7 26.2 61.3 59.9 61.3h481.4c33.7 0 60.7-27.6 60.7-61.3V174.4c0-33.7-27-61.4-60.7-61.4H225.9z",fill:"#282828","p-id":"1990"}),n.a.createElement("path",{d:"M732 763.1c0 33.3-26.1 60.9-59.4 60.9H251.7c-33.3 0-59.7-27.6-59.7-60.9V226.9c0-33.3 26.4-60.9 59.7-60.9h420.9c33.3 0 59.4 27.5 59.4 60.9v536.2z",fill:"#50BCFF","p-id":"1991"}),n.a.createElement("path",{d:"M361.8 251.9H208.6c-4.9 0-8.9-4-8.9-8.9s4-8.9 8.9-8.9h153.1c4.9 0 8.9 4 8.9 8.9s-3.9 8.9-8.8 8.9zM549.2 313H208.6c-4.9 0-8.9-4-8.9-8.9s4-8.9 8.9-8.9h340.5c4.9 0 8.9 4 8.9 8.9s-3.9 8.9-8.8 8.9zM652 448.4H208.6c-4.9 0-8.9-4-8.9-8.9s4-8.9 8.9-8.9H652c4.9 0 8.9 4 8.9 8.9s-4 8.9-8.9 8.9zM588.4 515.8H208.6c-4.9 0-8.9-4-8.9-8.9s4-8.9 8.9-8.9h379.7c4.9 0 8.9 4 8.9 8.9 0.1 4.9-3.9 8.9-8.8 8.9z",fill:"#282828","p-id":"1992"}),n.a.createElement("path",{d:"M673.3 113.3c0 19.6-15.9 35.5-35.5 35.5h-346c-19.6 0-35.5-15.9-35.5-35.5v-6.7c0-19.6 15.9-35.5 35.5-35.5h346c19.6 0 35.5 15.9 35.5 35.5v6.7z",fill:"#1A6DFF","p-id":"1993"}),n.a.createElement("path",{d:"M637.8 157.6h-346c-24.5 0-44.4-19.9-44.4-44.4v-6.7c0-24.5 19.9-44.4 44.4-44.4h346c24.5 0 44.4 19.9 44.4 44.4v6.7c0 24.5-19.9 44.4-44.4 44.4zM291.9 80c-14.7 0-26.6 11.9-26.6 26.6v6.7c0 14.7 11.9 26.6 26.6 26.6h346c14.7 0 26.6-11.9 26.6-26.6v-6.7c0-14.7-11.9-26.6-26.6-26.6h-346z",fill:"#282828","p-id":"1994"}),n.a.createElement("path",{d:"M849.7 758.4c0 106.3-86.2 192.4-192.4 192.4-106.3 0-192.4-86.2-192.4-192.4C464.8 652.1 551 566 657.3 566c106.2 0 192.4 86.1 192.4 192.4z",fill:"#FFFFFF","p-id":"1995"}),n.a.createElement("path",{d:"M657.3 959.7c-111 0-201.3-90.3-201.3-201.3s90.3-201.3 201.3-201.3 201.3 90.3 201.3 201.3-90.3 201.3-201.3 201.3z m0-384.8c-101.2 0-183.5 82.3-183.5 183.5S556.1 942 657.3 942s183.6-82.3 183.6-183.6c-0.1-101.2-82.4-183.5-183.6-183.5z",fill:"#282828","p-id":"1996"}),n.a.createElement("path",{d:"M657.3 553.6v204.9h203.6c-0.2-112.7-91.2-204-203.6-204.9z",fill:"#1A6DFF","p-id":"1997"}),n.a.createElement("path",{d:"M860.9 767.3H657.3c-4.9 0-8.9-4-8.9-8.9V553.6c0-2.4 0.9-4.6 2.6-6.3 1.7-1.7 3.6-2.4 6.3-2.6 116.9 0.9 212.2 96.8 212.4 213.7 0 2.4-0.9 4.6-2.6 6.3-1.6 1.7-3.9 2.6-6.2 2.6z m-194.8-17.8h185.6C847 649.3 766.2 568 666.1 562.7v186.8z",fill:"#282828","p-id":"1998"}),n.a.createElement("path",{d:"M794.1 903.7c-2.3 0-4.6-0.9-6.3-2.6L652.1 764.7c-3.5-3.5-3.4-9.1 0-12.6 3.5-3.5 9.1-3.4 12.6 0l135.7 136.5c3.5 3.5 3.4 9.1 0 12.6-1.8 1.7-4 2.5-6.3 2.5z",fill:"#282828","p-id":"1999"})),n.a.createElement("p",{style:{marginTop:"20px"}},window.W_L.task_processing)))))))}function YC(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return QC(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return QC(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function QC(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function KC(){var e=Object(r.useRef)(),t=YC(Object(r.useState)([]),2),a=t[0],o=t[1],i=YC(Object(r.useState)(!0),2),l=i[0],s=i[1],c=[{title:window.W_L.name,dataIndex:"report_name",width:null,align:"center",render:(e,t)=>n.a.createElement(n.a.Fragment,null,n.a.createElement("span",{className:"table-main-title",style:{color:"#2196f3",cursor:"pointer"},onClick:()=>u(t)},t.report_name))},{title:window.W_L.create_time,dataIndex:"created_at",align:"center"},{title:window.W_L.task_status,dataIndex:"is_generate",align:"center",render:(e,t)=>n.a.createElement(n.a.Fragment,null,0===t.is_generate&&n.a.createElement(t_.a,{color:"gold"},window.W_L.waiting),1===t.is_generate&&n.a.createElement(t_.a,{color:"blue"},window.W_L.generating),2===t.is_generate&&n.a.createElement(t_.a,{color:"green"},window.W_L.success),-1===t.is_generate&&n.a.createElement(t_.a,{color:"red"},window.W_L.fail))},{title:"",dataIndex:"actions",width:50,align:"center",render:(e,t)=>n.a.createElement(n.a.Fragment,null,n.a.createElement(RC.a,{style:{color:"#f08282",fontSize:"15px"},onClick:()=>d(t.id)}))}],u=e=>{var t,a;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(2!==e.is_generate||!e.html_name){r.next=6;break}t=e.html_name.split(".")[0],a=window.location.protocol+"//"+window.location.host+"/pretty_dashboard/"+t,window.open(a),r.next=16;break;case 6:r.t0=e.is_generate,r.next=0===r.t0?9:1===r.t0?11:-1===r.t0?13:15;break;case 9:return bj.a.error(window.W_L.waiting),r.abrupt("break",16);case 11:return bj.a.error(window.W_L.generating),r.abrupt("break",16);case 13:return bj.a.error(window.W_L.fail),r.abrupt("break",16);case 15:return r.abrupt("break",16);case 16:case"end":return r.stop()}}),null,null,null,Promise)},d=e=>regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:R.a.confirm({title:window.W_L.confirm_delete,content:window.W_L.confirm_delete_tip,onOk:()=>regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,regeneratorRuntime.awrap(B.delete("/api/pretty_dashboard/delete/".concat(e)));case 3:200===t.sent.code?(bj.a.success(window.W_L.delete_success),m()):bj.a.error(window.W_L.delete_fail),t.next=9;break;case 7:t.prev=7,t.t0=t.catch(0);case 9:case"end":return t.stop()}}),null,null,[[0,7]],Promise),onCancel(){}});case 1:case"end":return t.stop()}}),null,null,null,Promise),m=()=>{var e;return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return s(!0),t.next=3,regeneratorRuntime.awrap(B.get("/api/pretty_dashboard"));case 3:200===(e=t.sent).code&&(e.data.sort((function(e,t){return Date.parse(t.created_at)-Date.parse(e.created_at)})),o(e.data)),s(!1);case 6:case"end":return t.stop()}}),null,null,null,Promise)};Object(r.useEffect)(()=>{m()},[]);return n.a.createElement("div",{className:"page-queries-list"},n.a.createElement(Pj,{ref:e}),n.a.createElement("div",{className:"container"},n.a.createElement(Af,{title:window.W_L.dashboards_prettify_all}),n.a.createElement(qC,null,n.a.createElement(qC.Content,null,n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"bg-white tiled table-responsive"},n.a.createElement(Zl.a,{className:"table-data",rowKey:"id",size:"middle",columns:c,dataSource:a,pagination:!1,loading:l,locale:{emptyText:n.a.createElement(LC,{className:""})}})))))))}_f.register("Dialogue.List.autopilot_list",ha({path:"/autopilot_list",title:"autopilot_list",render:e=>n.a.createElement(VC,MC({},e,{chatType:"autopilot"}))})),_f.register("Dialogue.List.autopilot_view",ha({path:"/autopilot/:autopilotId",render:e=>n.a.createElement(HC,e)})),_f.register("Dialogue.List.dashboards_prettify",ha({path:"/dashboards_prettify",title:"dashboards_prettify",render:e=>n.a.createElement(KC,e)}));a(1417);function $C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return GC(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return GC(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function GC(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var JC=function(e){var t=e.tagsUrl,a=e.showUnselectAll,o=void 0!==a&&a,i=e.onUpdate,s=$C(Object(r.useState)([]),2),c=s[0],u=s[1],d=$C(Object(r.useState)([]),2),m=d[0],p=d[1];Object(r.useEffect)(()=>{var e=!1;return fj(t).then(t=>{e||u(t)}),()=>{e=!0}},[t]);var f=Object(r.useCallback)((e,t)=>{var a;a=e.shiftKey?Object(l.includes)(m,t)?Object(l.difference)(m,[t]):[...m,t]:Object(l.includes)(m,t)&&1===m.length?[]:[t],p(a),i&&i([...a])},[m,i]),g=Object(r.useCallback)(()=>{p([]),i&&i([])},[i]);return 0===c.length?null:n.a.createElement("div",{className:"tags-list"},n.a.createElement("div",{className:"tags-list-title"},n.a.createElement("span",{className:"tags-list-label"},window.W_L.tag),o&&m.length>0&&n.a.createElement(ge,{type:"link",onClick:g},n.a.createElement(je.a,null),"clear selection")),n.a.createElement("div",{className:"tiled"},n.a.createElement(ue.a,{className:"invert-stripe-position",mode:"inline",selectedKeys:m},Object(l.map)(c,e=>n.a.createElement(ue.a.Item,{key:e.name,className:"m-0"},n.a.createElement(ge,{className:"d-flex align-items-center justify-content-between",onClick:t=>f(t,e.name)},n.a.createElement("span",{className:"max-character col-xs-11"},e.name),n.a.createElement(If.a,{count:e.count})))))))};function XC(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ZC(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ZC(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ZC(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function ex(e){var t=e.placeholder,a=e.value,o=e.showIcon,i=e.onChange,l=e.label,s=XC(Object(r.useState)(a),2),c=s[0],u=s[1];Object(r.useEffect)(()=>{u(a)},[a]);var d=Object(r.useCallback)(e=>{var t=e.target.value;u(t),i(t)},[i]),m=o?va.a.Search:va.a;return n.a.createElement("div",{className:"m-b-10"},n.a.createElement(m,{className:"form-control",placeholder:t,value:c,"aria-label":l,onChange:d}))}function tx(e){var t=e.items,a=e.selected;return 0===(t=Object(l.filter)(t,e=>!Object(l.isFunction)(e.isAvailable)||e.isAvailable())).length?null:n.a.createElement("div",{className:"m-b-10 tags-list tiled"},n.a.createElement(ue.a,{className:"invert-stripe-position",mode:"inline",selectable:!1,selectedKeys:[a]},Object(l.map)(t,e=>n.a.createElement(ue.a.Item,{key:e.key,className:"m-0"},n.a.createElement(h,{href:e.href},Object(l.isString)(e.icon)&&""!==e.icon&&n.a.createElement("span",{className:"btn-favorite m-r-5"},n.a.createElement("i",{className:e.icon,"aria-hidden":"true"})),Object(l.isFunction)(e.icon)&&(e.icon(e)||null),e.title)))))}function ax(e){var t=e.icon;return n.a.createElement("span",{className:"btn-favorite m-r-5"},n.a.createElement("i",{className:t,"aria-hidden":"true"}))}function rx(e){var t=e.user;return Object(l.isString)(t.profile_image_url)&&""!==t.profile_image_url?n.a.createElement("img",{src:t.profile_image_url,className:"profile__image--sidebar m-r-5",width:"13",alt:t.name}):null}function nx(e){var t=e.url,a=e.onChange,r=e.showUnselectAll;return""===t?null:n.a.createElement("div",{className:"m-b-10"},n.a.createElement(JC,{tagsUrl:t,onUpdate:a,showUnselectAll:r}))}function ox(){return(ox=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ix(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return lx(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return lx(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lx(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function sx(e,t,a){var o=ix(Object(r.useState)({isAvailable:!1}),2),i=o[0],s=o[1],c=ix(Object(r.useState)([]),2),u=c[0],d=c[1];Object(r.useEffect)(()=>{d([])},[e.pageItems,i.isAvailable]);var m=Object(r.useMemo)(()=>{var t=e.pageItems;return 0!==t.length&&0!==u.length&&Object(l.intersection)(u,t).length===t.length},[u,e.pageItems]),p=Object(r.useCallback)(()=>{d(m?[]:e.pageItems)},[m,e.pageItems]),f=Object(r.useCallback)(e=>{Object(l.includes)(u,e)?d(Object(l.filter)(u,t=>t!==e)):d([...u,e])},[u]),g=Object(r.useMemo)(()=>_g.custom((e,t)=>n.a.createElement(gn.a,{checked:Object(l.includes)(u,t),onChange:()=>f(t)}),{title:()=>n.a.createElement(gn.a,{checked:m,onChange:p}),field:"id",width:"1%"}),[u,m,p,f]),b=Object(r.useCallback)((function(e){return a?n.a.createElement(a,ox({onStateChange:s},e)):null}),[a]);return Object(r.useMemo)(()=>({areExtraActionsAvailable:i.isAvailable,listColumns:i.isAvailable?[g,...t]:t,Component:b,selectedItems:u,setSelectedItems:d}),[i,t,g,u,b])}function cx(e){var t=e.objectType,a=e.tags;return n.a.createElement(xe,{icon:"fa-tags"},"No ",t," found tagged with ",n.a.createElement($g,{className:"inline-tags-control",tags:Array.from(a),tagSeparator:"+"}),".")}function ux(e){var t=e.page,a=e.searchTerm,n=e.selectedTags;if(""!==a)return r.createElement(xe,{message:window.W_L.find_nothing,icon:"fa-search"});if(n.length>0)return r.createElement(cx,{objectType:"dashboards",tags:n});switch(t){case"favorites":return r.createElement(xe,{message:window.W_L.show_my_favorite_dashboard,icon:"fa-star"});case"my":var o=H.hasPermission("create_dashboard")?r.createElement("span",null,r.createElement(m.a,{type:"primary",size:"small",onClick:()=>Jp.showModal()},window.W_L.create_first_dashboard)," ",r.createElement($e,{className:"f-14",type:"DASHBOARDS",showTooltip:!1},window.W_L.need_help,"?")):r.createElement("span",null,window.W_L.no_data);return r.createElement(xe,{icon:"fa-search"},o);default:return r.createElement(se,{name:"DashboardList.EmptyState"},r.createElement(af,{icon:"zmdi zmdi-view-quilt",description:window.W_L.see_big_picture,illustration:"dashboard",helpMessage:r.createElement(ef,{helpTriggerType:"DASHBOARDS"}),showDashboardStep:!0}))}}ex.propTypes={value:ae.a.string.isRequired,placeholder:ae.a.string,showIcon:ae.a.bool,onChange:ae.a.func.isRequired,label:ae.a.string},ex.defaultProps={placeholder:window.W_L.search,showIcon:!1,label:"Search"},tx.propTypes={items:ae.a.arrayOf(ae.a.shape({key:ae.a.string.isRequired,href:ae.a.string.isRequired,title:ae.a.string.isRequired,icon:ae.a.func,isAvailable:ae.a.func})),selected:ae.a.string},tx.defaultProps={items:[],selected:null},ax.propTypes={icon:ae.a.string.isRequired},rx.propTypes={user:ae.a.shape({profile_image_url:ae.a.string,name:ae.a.string}).isRequired},nx.propTypes={url:ae.a.string.isRequired,onChange:ae.a.func.isRequired,showUnselectAll:ae.a.bool,unselectAllButtonTitle:ae.a.string},cx.propTypes={objectType:ae.a.string.isRequired,tags:ae.a.oneOfType([ae.a.array,ae.a.objectOf(Set)]).isRequired},ux.propTypes={page:te.string.isRequired,searchTerm:te.string.isRequired,selectedTags:te.array.isRequired};a(1418);function dx(){return(dx=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var mx=[{key:"all",href:"dashboards",title:window.W_L.all_dashboard,icon:()=>n.a.createElement(ax,{icon:"zmdi zmdi-view-quilt"})},{key:"my",href:"dashboards/my",title:window.W_L.my_dashboard,icon:()=>n.a.createElement(rx,{user:H})},{key:"favorites",href:"dashboards/favorites",title:window.W_L.my_favorite_dashboard,icon:()=>n.a.createElement(ax,{icon:"fa fa-star"})}],px=[_g.favorites({className:"p-r-0"}),_g.custom.sortable((e,t)=>n.a.createElement(n.a.Fragment,null,n.a.createElement(h,{className:"table-main-title",href:t.url,"data-test":"DashboardId".concat(t.id)},t.name),n.a.createElement(Xg,{className:"d-block",tags:t.tags,isDraft:t.is_draft,isArchived:t.is_archived})),{title:window.W_L.name,field:"name",width:null}),_g.custom((e,t)=>t.user.name,{title:window.W_L.create_user,width:"1%"}),_g.dateTime.sortable({title:window.W_L.create_time,field:"created_at",width:"1%"})];function fx(e){return n.a.createElement(se,dx({name:"DashboardList.Actions"},e))}function gx(e){var t=e.controller,a=sx(t,px,fx),r=a.areExtraActionsAvailable,o=a.listColumns,i=a.Component,l=a.selectedItems,s=t.pageItems&&t.pageItems.length>0?t.pageItems.filter(e=>e.name!==window.W_L.temporary_dashboard):[];return n.a.createElement("div",{className:"page-dashboard-list"},n.a.createElement("div",{className:"container"},n.a.createElement(Af,{title:t.params.pageTitle,actions:H.hasPermission("create_dashboard")?n.a.createElement(m.a,{block:!0,type:"primary",onClick:()=>Jp.showModal()},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.create):null}),n.a.createElement(qC,null,n.a.createElement(qC.Sidebar,{className:"m-b-0"},n.a.createElement(ex,{placeholder:window.W_L.search_dashboard,label:window.W_L.search_dashboard,value:t.searchTerm,onChange:t.updateSearch}),n.a.createElement(tx,{items:mx,selected:t.params.currentPage}),n.a.createElement(nx,{url:"api/dashboards/tags",onChange:t.updateSelectedTags,showUnselectAll:!0})),n.a.createElement(qC.Content,null,n.a.createElement("div",{"data-test":"DashboardLayoutContent"},t.isLoaded&&t.isEmpty?n.a.createElement(ux,{page:t.params.currentPage,searchTerm:t.searchTerm,selectedTags:t.selectedTags}):n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:me()({"m-b-10":r})},n.a.createElement(i,{selectedItems:l})),n.a.createElement("div",{className:"bg-white tiled table-responsive"},n.a.createElement(Eg,{items:s,loading:!t.isLoaded,columns:o,orderByField:t.orderByField,orderByReverse:t.orderByReverse,toggleSorting:t.toggleSorting}),n.a.createElement(Fg,{showPageSizeSelect:!0,totalCount:t.totalItemsCount,pageSize:t.itemsPerPage,onPageSizeChange:e=>t.updatePagination({itemsPerPage:e}),page:t.page,onChange:e=>t.updatePagination({page:e})}))))))))}gx.propTypes={controller:sb.isRequired};var bx=cb(gx,()=>new jb({getResource(e){var t=e.params.currentPage;return{all:Vp.query.bind(Vp),my:Vp.myDashboards.bind(Vp),favorites:Vp.favorites.bind(Vp)}[t]},getItemProcessor:()=>e=>new Vp(e)}),()=>new Pb({orderByField:"created_at",orderByReverse:!0}));function hx(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function yx(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function vx(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?yx(Object(a),!0).forEach((function(t){wx(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):yx(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function wx(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ox(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _x(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _x(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _x(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Ex(e){var t=e.apiKey,a=e.currentRoute,o=e.renderChildren,i=Ox(Object(r.useState)(!1),2),l=i[0],s=i[1],c=Object(r.useContext)(_).handleError;return Object(r.useEffect)(()=>{var e=!1;return X.setApiKey(t),X.loadConfig().then(()=>{e||s(!0)}).catch(()=>{e||s(!1)}),()=>{e=!0}},[t]),!l||Y.disablePublicUrls?null:n.a.createElement(n.a.Fragment,{key:a.key},o(vx(vx({},a.routeParams),{},{pageTitle:a.title,onError:c,apiKey:t})))}function jx(e){var t=e.render,a=e.getApiKey;return vx(vx({},hx(e,["render","getApiKey"])),{},{render:e=>n.a.createElement(Ex,{apiKey:a(e),currentRoute:e,renderChildren:t})})}_f.register("Dashboards.List",ha({path:"/dashboards",title:window.W_L.dashboards,render:e=>n.a.createElement(bx,dx({},e,{currentPage:"all"}))})),_f.register("Dashboards.Favorites",ha({path:"/dashboards/favorites",title:window.W_L.my_favorite_dashboard,render:e=>n.a.createElement(bx,dx({},e,{currentPage:"favorites"}))})),_f.register("Dashboards.My",ha({path:"/dashboards/my",title:window.W_L.my_dashboard,render:e=>n.a.createElement(bx,dx({},e,{currentPage:"my"}))})),Ex.propTypes={apiKey:ae.a.string.isRequired,renderChildren:ae.a.func},Ex.defaultProps={renderChildren:()=>null};a(1419);function Sx(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Cx(e){var t=e.dashboard,a=cj(t),r=a.globalParameters,o=a.filters,i=a.setFilters,s=a.refreshDashboard,c=a.loadWidget,u=a.refreshWidget;return n.a.createElement("div",{className:"container p-t-10 p-b-20"},n.a.createElement(Af,{title:t.name}),!Object(l.isEmpty)(r)&&n.a.createElement("div",{className:"m-b-10 p-15 bg-white tiled"},n.a.createElement(Jv,{parameters:r,onValuesChange:s})),!Object(l.isEmpty)(o)&&n.a.createElement("div",{className:"m-b-10 p-15 bg-white tiled"},n.a.createElement(fw,{filters:o,onChange:i})),n.a.createElement("div",{id:"dashboard-container"},n.a.createElement(uE,{dashboard:t,widgets:t.widgets,filters:o,isEditing:!1,isPublic:!0,onLoadWidget:c,onRefreshWidget:u})))}Cx.propTypes={dashboard:ae.a.object.isRequired};class xx extends n.a.Component{constructor(){super(...arguments),Sx(this,"state",{loading:!0,dashboard:null})}componentDidMount(){Vp.getByToken({token:this.props.token}).then(e=>this.setState({dashboard:e,loading:!1})).catch(e=>this.props.onError(e))}render(){var e=this.state,t=e.loading,a=e.dashboard;return n.a.createElement("div",{className:"public-dashboard-page"},t?n.a.createElement("div",{className:"container loading-message"},n.a.createElement(xe,{className:"",icon:"fa-spinner fa-2x fa-pulse",message:"Loading..."})):n.a.createElement(Cx,{dashboard:a}))}}Sx(xx,"propTypes",{token:ae.a.string.isRequired,onError:ae.a.func}),Sx(xx,"defaultProps",{onError:()=>{}}),_f.register("Dashboards.ViewShared",jx({path:"/public/dashboards/:token",render:e=>n.a.createElement(xx,e),getApiKey:e=>e.routeParams.token}));a(1420);function Px(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Lx(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Lx(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Lx(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function kx(){return(kx=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Nx(e){var t=e.item,a=e.keySuffix,r={key:"card".concat(a),className:"visual-card",onClick:t.onClick,children:n.a.createElement(n.a.Fragment,null,n.a.createElement("img",{alt:t.title,src:t.imgSrc}),n.a.createElement("h3",null,t.title))};return t.href?n.a.createElement(h,kx({href:t.href},r)):n.a.createElement(ge,kx({type:"link"},r))}function Ax(e){var t=e.items,a=void 0===t?[]:t,o=e.showSearch,i=void 0!==o&&o,s=Px(Object(r.useState)(""),2),c=s[0],u=s[1],d=a.filter(e=>Object(l.isEmpty)(c)||Object(l.includes)(e.title.toLowerCase(),c.toLowerCase()));return n.a.createElement("div",{"data-test":"CardsList"},i&&n.a.createElement("div",{className:"row p-10"},n.a.createElement("div",{className:"col-md-4 col-md-offset-4"},n.a.createElement(va.a.Search,{placeholder:"{window.W_L.search}","aria-label":"{window.W_L.search}",onChange:e=>u(e.target.value),autoFocus:!0}))),Object(l.isEmpty)(d)?n.a.createElement(LC,{className:""}):n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-lg-12 d-inline-flex flex-wrap visual-card-list"},d.map((e,t)=>n.a.createElement(Nx,{key:t,item:e,keySuffix:t.toString()})))))}Ax.propTypes={items:ae.a.arrayOf(ae.a.shape({title:ae.a.string.isRequired,imgSrc:ae.a.string.isRequired,onClick:ae.a.func,href:ae.a.string})),showSearch:ae.a.bool};var Tx=a(435),Wx=a.n(Tx);function Ix(){return(Ix=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function qx(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Dx(e){var t=e.collapsed,a=e.children,r=e.className,o=qx(e,["collapsed","children","className"]);return n.a.createElement(Mm.a,Ix({},o,{activeKey:t?null:"content",className:me()(r,"ant-collapse-headerless")}),n.a.createElement(Mm.a.Panel,{key:"content",header:""},a))}function Rx(e){var t=e.title,a=e.name;return t||mg(a)}Dx.propTypes={collapsed:ae.a.bool,children:ae.a.node,className:ae.a.string},Dx.defaultProps={collapsed:!0,children:null,className:""};var Mx=a(308),zx=a.n(Mx);a(1426);function Fx(){return(Fx=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var Vx=Object(r.forwardRef)((function(e,t){return n.a.createElement("div",{className:"ace-editor-input","data-test":e["data-test"]},n.a.createElement(zx.a,Fx({ref:t,mode:"sql",theme:"textmate",height:"100px",editorProps:{$blockScrolling:1/0},showPrintMargin:!1},e)))}));function Ux(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Bx(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var Hx=a(321),Yx=a.n(Hx),Qx=a(322),Kx=a.n(Qx);function $x(){return($x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Gx(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Jx(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Xx(e){e.form,e.field;var t=Jx(e,["form","field"]);return n.a.createElement(va.a,t)}function Zx(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function eP(){return(eP=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function tP(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function aP(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function rP(){return(rP=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function nP(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function oP(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?nP(Object(a),!0).forEach((function(t){iP(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):nP(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function iP(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function lP(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var sP=ae.a.shape({name:ae.a.string.isRequired,title:ae.a.string,type:ae.a.oneOf(["ace","text","textarea","email","password","number","checkbox","file","select","content"]).isRequired,initialValue:ae.a.oneOfType([ae.a.string,ae.a.number,ae.a.bool,ae.a.arrayOf(ae.a.string),ae.a.arrayOf(ae.a.number)]),content:ae.a.node,mode:ae.a.string,required:ae.a.bool,extra:ae.a.bool,readOnly:ae.a.bool,autoFocus:ae.a.bool,minLength:ae.a.number,placeholder:ae.a.string,contentAfter:ae.a.oneOfType([ae.a.node,ae.a.func]),loading:ae.a.bool,props:ae.a.object}),cP={checkbox:function(e){e.form;var t=e.field,a=Bx(e,["form","field"]),r=Rx(t);return n.a.createElement(gn.a,a,r)},file:function(e){var t=e.form,a=e.field,r=Gx(e,["form","field"]),o=a.name,i=a.initialValue,l=t.getFieldValue,s=void 0!==l(o)&&l(o)!==i;return n.a.createElement(Yx.a,$x({},r,{beforeUpload:()=>!1}),n.a.createElement(m.a,{disabled:s},n.a.createElement(Kx.a,null)," ",window.W_L.upload))},select:function(e){e.form;var t=e.field,a=tP(e,["form","field"]),r=t.readOnly;return n.a.createElement(dn.a,eP({},a,{optionFilterProp:"children",loading:t.loading||!1,mode:t.mode,getPopupContainer:e=>e.parentNode}),t.options&&t.options.map(e=>n.a.createElement(dn.a.Option,{key:"".concat(e.value),value:e.value,disabled:r},e.name||e.value)))},number:function(e){e.form,e.field;var t=Zx(e,["form","field"]);return n.a.createElement(pn.a,t)},textarea:function(e){e.form,e.field;var t=aP(e,["form","field"]);return n.a.createElement(va.a.TextArea,t)},ace:function(e){e.form,e.field;var t=Ux(e,["form","field"]);return n.a.createElement(Vx,t)},content:function(e){return e.field.content}};function uP(e){var t=e.form,a=e.field,r=lP(e,["form","field"]),o=a.name,i=a.type,s=a.readOnly,c=a.autoFocus,u=Rx(a),d=oP(oP({},a.props),{},{className:"w-100",name:o,type:i,readOnly:s,autoFocus:c,placeholder:a.placeholder,"data-test":u},r),m=Object(l.get)(cP,i,Xx);return n.a.createElement(m,rP({},d,{form:t,field:a}))}function dP(e,t,a){var r=new Array(t.length);return Object.keys(e).forEach(n=>{var o=t.indexOf(n),i={name:n,title:e[n].title,type:e[n].type,placeholder:Object(l.isNil)(e[n].default)?null:e[n].default.toString(),required:e[n].required,extra:e[n].extra,initialValue:a[n]};"select"===i.type&&(i.placeholder="Select an option",i.options=e[n].options),o>-1?r[o]=i:r.push(i)}),r}function mP(e){Object(l.each)(e.properties,(t,a)=>{"password"!==a&&"passwd"!==a||(t.type="password"),a.endsWith("File")&&(t.type="file"),"boolean"===t.type&&(t.type="checkbox"),"string"===t.type&&(t.type="text"),Object(l.isEmpty)(t.enum)||(t.type="select",t.options=Object(l.map)(t.enum,e=>({value:e,name:e}))),Object(l.isEmpty)(t.extendedEnum)||(t.type="select",t.options=t.extendedEnum),t.required=Object(l.includes)(e.required,a),t.extra=Object(l.includes)(e.extra_options,a)}),e.order=e.order||[]}function pP(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.properties;Object.keys(a).forEach(e=>{var r=a[e];if(Object(l.isUndefined)(r.default)||"checkbox"!==r.type||(t[e]=r.default),"select"===r.type){var n=Object(l.map)(r.options,e=>e.value);t[e]=Object(l.includes)(n,r.default)?r.default:n[0]}})}uP.propTypes={field:sP.isRequired};var fP={getFields:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{options:{}},a=e.configuration_schema;mP(a);var r=Object.keys(t.options).length>0;r||pP(a,t.options);var o=!t.id,i=[{name:"name",title:window.W_L.name,type:"text",required:!0,initialValue:t.name,contentAfter:n.a.createElement("hr"),placeholder:"My ".concat(e.name),autoFocus:o},...dP(a.properties,a.order,t.options)];return i},updateTargetWithValues:function(e,t){e.name=t.name,Object.keys(t).forEach(a=>{"name"!==a&&(e.options[a]=t[a])})},getBase64:function(e){return new Promise((t,a)=>{var r=new FileReader;r.readAsDataURL(e),r.onload=()=>t(r.result.substr(r.result.indexOf(",")+1)),r.onerror=e=>a(e)})},hasFilledExtraField:function(e,t){var a=Object(l.get)(e,"configuration_schema.extra_options",[]);return Object(l.some)(a,a=>{var r=Object(l.get)(e,["configuration_schema","properties",a,"default"]),n=Object(l.get)(t,["options",a]);return!Object(l.isNil)(n)&&n!==r})}};a(1443);function gP(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return bP(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return bP(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bP(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var hP=ae.a.shape({name:ae.a.string.isRequired,callback:ae.a.func.isRequired,type:ae.a.string,pullRight:ae.a.bool,disabledWhenDirty:ae.a.bool}),yP=ae.a.shape({validateFieldsAndScroll:ae.a.func}),vP=e=>{var t=e.type,a=e.required,r=e.minLength,n=a,o=r&&Object(l.includes)(["text","email","password"],t),i="email"===t;return[n&&{required:a,message:window.W_L.required},o&&{min:r,message:window.W_L.short},i&&{type:"email",message:window.W_L.email_error}].filter(e=>e)};function wP(e){var t=e.fields,a=e.feedbackIcons,r=e.form;return t.map(e=>{var t=e.name,o=e.type,i=e.initialValue,s=e.contentAfter,c=Rx(e),u={name:t,className:"m-b-10",hasFeedback:"checkbox"!==o&&"file"!==o&&a,label:"checkbox"===o?"":c,rules:vP(e),valuePropName:"checkbox"===o?"checked":"value",initialValue:i};return"file"===o&&(u.valuePropName="data-value",u.getValueFromEvent=e=>{e&&e.fileList[0]&&fP.getBase64(e.file).then(e=>{r.setFieldsValue({[t]:e})})}),n.a.createElement(n.a.Fragment,{key:t},n.a.createElement(ih.a.Item,u,n.a.createElement(uP,{field:e,form:r})),Object(l.isFunction)(s)?s(r.getFieldValue(t)):s)})}wP.propTypes={fields:ae.a.arrayOf(sP),feedbackIcons:ae.a.bool,form:yP.isRequired},wP.defaultProps={fields:[],feedbackIcons:!1};var OP=(e,t)=>(t.inProgress?e.add(t.actionName):e.delete(t.actionName),new Set(e));function _P(e){var t=e.actions,a=e.isFormDirty,o=gP(Object(r.useReducer)(OP,new Set),2),i=o[0],s=o[1],c=Object(r.useCallback)(e=>{var t=e.name;Object(l.isFunction)(e.callback)&&(s({actionName:t,inProgress:!0}),e.callback(()=>{s({actionName:t,inProgress:!1})}))},[]);return t.map(e=>n.a.createElement(m.a,{key:e.name,htmlType:"button",className:me()("m-t-10",{"pull-right":e.pullRight}),type:e.type,disabled:a&&e.disableWhenDirty,loading:i.has(e.name),onClick:()=>c(e)},e.name))}function EP(e){var t=e.id,a=e.fields,o=e.actions,i=e.feedbackIcons,s=e.hideSubmitButton,c=e.defaultShowExtraFields,u=e.saveText,d=e.onSubmit,p=gP(Object(r.useState)(!1),2),f=p[0],g=p[1],b=gP(Object(r.useState)(!1),2),h=b[0],y=b[1],v=gP(Object(r.useState)(c),2),w=v[0],O=v[1],_=gP(ih.a.useForm(),1)[0],E=Object(l.filter)(a,{extra:!0}),j=Object(l.difference)(a,E),S=Object(r.useCallback)(e=>{g(!0),e=function(e,t){return Object(l.mapValues)(t,(t,a)=>{var r=(Object(l.find)(e,{name:a})||{}).initialValue;return null!=r&&""!==r||""!==t?t:null})}(a,e),d(e,e=>{g(!1),y(!1),uf.success(e)},e=>{g(!1),uf.error(e)})},[a,d]),C=Object(r.useCallback)(e=>{var t=e.errorFields;_.scrollToField(t[0].name)},[_]);return n.a.createElement(ih.a,{form:_,onFieldsChange:()=>{y(!0)},id:t,className:"dynamic-form",layout:"vertical",onFinish:S,onFinishFailed:C},n.a.createElement(wP,{fields:j,feedbackIcons:i,form:_}),!Object(l.isEmpty)(E)&&n.a.createElement("div",{className:"extra-options"},n.a.createElement(m.a,{type:"dashed",block:!0,className:"extra-options-button",onClick:()=>O(e=>!e)},window.W_L.add_params,n.a.createElement("i",{className:me()("fa m-l-5",{"fa-caret-up":w,"fa-caret-down":!w}),"aria-hidden":"true"})),n.a.createElement(Dx,{collapsed:!w,className:"extra-options-content"},n.a.createElement(wP,{fields:E,feedbackIcons:i,form:_}))),!s&&n.a.createElement(m.a,{className:"w-100 m-t-20",type:"primary",htmlType:"submit",disabled:f},u),n.a.createElement(_P,{actions:o,isFormDirty:h}))}function jP(){return(jP=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function SP(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}_P.propTypes={actions:ae.a.arrayOf(hP),isFormDirty:ae.a.bool},_P.defaultProps={actions:[],isFormDirty:!1},EP.propTypes={id:ae.a.string,fields:ae.a.arrayOf(sP),actions:ae.a.arrayOf(hP),feedbackIcons:ae.a.bool,hideSubmitButton:ae.a.bool,defaultShowExtraFields:ae.a.bool,saveText:ae.a.string,onSubmit:ae.a.func},EP.defaultProps={id:null,fields:[],actions:[],feedbackIcons:!1,hideSubmitButton:!1,defaultShowExtraFields:!1,saveText:window.W_L.save,onSubmit:()=>{}};var CP=Wx.a.Step,xP=va.a.Search,PP=0,LP=1,kP=2;class NP extends n.a.Component{constructor(){super(...arguments),SP(this,"state",{searchText:"",selectedType:null,savingSource:!1,currentStep:PP}),SP(this,"formId",Object(l.uniqueId)("sourceForm")),SP(this,"selectType",e=>{this.setState({selectedType:e,currentStep:LP})}),SP(this,"resetType",()=>{this.state.currentStep===LP&&this.setState({searchText:"",selectedType:null,currentStep:PP})}),SP(this,"createSource",(e,t,a)=>{var r=this.state,n=r.selectedType;r.savingSource||(this.setState({savingSource:!0,currentStep:kP}),this.props.onCreate(n,e).then(e=>{t(window.W_L.save_success),this.props.dialog.close({success:!0,data:e})}).catch(e=>{this.setState({savingSource:!1,currentStep:LP}),a(Object(l.get)(e,"response.data.message",window.W_L.save_failed))}))})}renderTypeSelector(){var e=this.props.types,t=this.state.searchText,a=e.filter(e=>Object(l.isEmpty)(t)||Object(l.includes)(e.name.toLowerCase(),t.toLowerCase()));return n.a.createElement("div",{className:"m-t-10"},n.a.createElement(xP,{placeholder:window.W_L.search,"aria-label":window.W_L.search,onChange:e=>this.setState({searchText:e.target.value}),autoFocus:!0,"data-test":"SearchSource"}),n.a.createElement("div",{className:"scrollbox p-5 m-t-10",style:{minHeight:"30vh",maxHeight:"40vh"}},Object(l.isEmpty)(a)?n.a.createElement(LC,{className:""}):n.a.createElement(qb.a,{size:"small",dataSource:a,renderItem:e=>this.renderItem(e)})))}renderForm(){var e=this.props,t=e.imageFolder,a=e.helpTriggerPrefix,r=this.state.selectedType,o=fP.getFields(r),i="".concat(a).concat(Object(l.toUpper)(r.type));return n.a.createElement("div",null,n.a.createElement("div",{className:"d-flex justify-content-center align-items-center"},n.a.createElement("img",{className:"p-5",src:"".concat(t,"/").concat(r.type,".png"),alt:r.name,width:"48"}),n.a.createElement("h4",{className:"m-0"},r.name)),n.a.createElement("div",{className:"text-right"},Ye[i]&&n.a.createElement($e,{className:"f-13",type:i},window.W_L.setting_info," ",n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(",window.W_L.help,")"))),n.a.createElement(EP,{id:this.formId,fields:o,onSubmit:this.createSource,feedbackIcons:!0,hideSubmitButton:!0}),"databricks"===r.type&&n.a.createElement("small",null,window.W_L.jdbc_info," ",n.a.createElement(h,{href:"https://databricks.com/spark/odbc-driver-download",target:"_blank",rel:"noopener noreferrer"},window.W_L.jdbc_download_name),"."))}renderItem(e){var t=this.props.imageFolder;return n.a.createElement(qb.a.Item,{className:"p-l-10 p-r-10 clickable",onClick:()=>this.selectType(e)},n.a.createElement(_E,{title:e.name,imageUrl:"".concat(t,"/").concat(e.type,".png"),roundedImage:!1,"data-test":"PreviewItem","data-test-type":e.type},n.a.createElement("i",{className:"fa fa-angle-double-right","aria-hidden":"true"})))}render(){var e=this.state,t=e.currentStep,a=e.savingSource,r=this.props,o=r.dialog,i=r.sourceType;return n.a.createElement(R.a,jP({},o.props,{title:window.W_L.create+" ".concat(i),footer:t===PP?[n.a.createElement(m.a,{key:"cancel",onClick:()=>o.dismiss(),"data-test":"CreateSourceCancelButton"},window.W_L.cancel),n.a.createElement(m.a,{key:"submit",type:"primary",disabled:!0},window.W_L.create)]:[n.a.createElement(m.a,{key:"previous",onClick:this.resetType},window.W_L.previous),n.a.createElement(m.a,{key:"submit",htmlType:"submit",form:this.formId,type:"primary",loading:a,"data-test":"CreateSourceSaveButton"},window.W_L.create)]}),n.a.createElement("div",{"data-test":"CreateSourceDialog"},n.a.createElement(Wx.a,{className:"hidden-xs m-b-10",size:"small",current:t,progressDot:!0},t===LP?n.a.createElement(CP,{title:window.W_L.type_select,className:"clickable",onClick:this.resetType}):n.a.createElement(CP,{title:window.W_L.type}),n.a.createElement(CP,{title:window.W_L.setting}),n.a.createElement(CP,{title:window.W_L.done})),t===PP&&this.renderTypeSelector(),t!==PP&&this.renderForm()))}}SP(NP,"propTypes",{dialog:ja.isRequired,types:ae.a.arrayOf(ae.a.object),sourceType:ae.a.string.isRequired,imageFolder:ae.a.string.isRequired,helpTriggerPrefix:ae.a.string,onCreate:ae.a.func.isRequired}),SP(NP,"defaultProps",{types:[],helpTriggerPrefix:null});var AP=Sa(NP);var TP=function(e,t,a){return ht.add(e,t),function(e){var t=ht.getActiveItem(A.path);return n.a.createElement("div",{className:"settings-screen"},n.a.createElement("div",{className:"container"},n.a.createElement(Af,{title:window.W_L.setting}),n.a.createElement("div",{className:"bg-white tiled"},n.a.createElement(ue.a,{selectedKeys:[t&&t.title],selectable:!1,mode:"horizontal"},ht.getAvailableItems().map(e=>n.a.createElement(ue.a.Item,{key:e.title},n.a.createElement(h,{href:e.path,"data-test":"SettingsScreenItem"},e.title)))),n.a.createElement("div",{className:"p-15"},n.a.createElement("div",null,n.a.createElement(a,e))))))}};function WP(){return(WP=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function IP(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}le("DataSourcesListComponent",(function(e){var t=e.dataSources,a=e.onClickCreate,r=t.map(e=>({title:e.name,imgSrc:"".concat("static/images/db-logos","/").concat(e.type,".png"),href:"data_sources/".concat(e.id)}));return Object(l.isEmpty)(t)?n.a.createElement("div",{className:"text-center"},window.W_L.no_datasource,Z.isCreateDataSourceEnabled()&&n.a.createElement("div",{className:"m-t-5"},n.a.createElement(ge,{type:"link",onClick:a,"data-test":"CreateDataSourceLink"},window.W_L.connect_new_datasource)," ")):n.a.createElement(Ax,{items:r})}));class qP extends n.a.Component{constructor(){var e;super(...arguments),e=this,IP(this,"state",{dataSourceTypes:[],dataSources:[],loading:!0}),IP(this,"newDataSourceDialog",null),IP(this,"createDataSource",(e,t)=>{var a={options:{},type:e.type};return fP.updateTargetWithValues(a,t),ES.create(a).then(e=>(this.setState({loading:!0}),ES.query().then(e=>this.setState({dataSources:e,loading:!1})),e))}),IP(this,"showCreateSourceDialog",()=>{La("view","page","data_sources/new"),this.newDataSourceDialog=AP.showModal({types:Object(l.reject)(this.state.dataSourceTypes,"deprecated"),sourceType:window.W_L.data_source,imageFolder:"static/images/db-logos",helpTriggerPrefix:"DS_",onCreate:this.createDataSource}),this.newDataSourceDialog.onClose((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.newDataSourceDialog=null,t.success&&Ca("data_sources/".concat(t.data.id))})).onDismiss(()=>{this.newDataSourceDialog=null,Ca("data_sources",!0)})})}componentDidMount(){Promise.all([ES.query(),ES.types()]).then(e=>this.setState({dataSources:e[0],dataSourceTypes:e[1],loading:!1},()=>{this.props.isNewDataSourcePage&&(Z.canCreateDataSource()?this.showCreateSourceDialog():Ca("data_sources",!0))})).catch(e=>this.props.onError(e))}componentWillUnmount(){this.newDataSourceDialog&&this.newDataSourceDialog.dismiss()}render(){var e={type:"primary",onClick:Z.isCreateDataSourceEnabled()?this.showCreateSourceDialog:null,disabled:!Z.isCreateDataSourceEnabled(),"data-test":"CreateDataSourceButton"};return n.a.createElement("div",null,n.a.createElement("div",{className:"m-b-15"},n.a.createElement(m.a,e,n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.new_data_source),n.a.createElement(se,{name:"DataSourcesListExtra"})),this.state.loading?n.a.createElement(kb,{className:""}):n.a.createElement(se,{name:"DataSourcesListComponent",dataSources:this.state.dataSources,onClickCreate:this.showCreateSourceDialog}))}}IP(qP,"propTypes",{isNewDataSourcePage:ae.a.bool,onError:ae.a.func}),IP(qP,"defaultProps",{isNewDataSourcePage:!1,onError:()=>{}});var DP=TP("DataSources.List",{permission:"admin",title:window.W_L.data_source,path:"data_sources",order:1},qP);function RP(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}_f.register("DataSources.List",ha({path:"/data_sources",title:window.W_L.data_source,render:e=>n.a.createElement(DP,e)})),_f.register("DataSources.New",ha({path:"/data_sources/new",title:window.W_L.data_source,render:e=>n.a.createElement(DP,WP({},e,{isNewDataSourcePage:!0}))}));class MP extends n.a.Component{constructor(){super(...arguments),RP(this,"state",{dataSource:null,type:null,loading:!0}),RP(this,"saveDataSource",(e,t,a)=>{var r=this.state.dataSource;fP.updateTargetWithValues(r,e),ES.save(r).then(()=>t(window.W_L.save_success)).catch(e=>{var t=Object(l.get)(e,"response.data.message",window.W_L.save_failed);a(t)})}),RP(this,"deleteDataSource",e=>{var t=this.state.dataSource;R.a.confirm({title:window.W_L.delete_datasource,content:window.W_L.delete_datasource_confirm,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,okType:"danger",onOk:()=>{ES.delete(t).then(()=>{uf.success(window.W_L.datasource_delete_success),Ca("data_sources")}).catch(()=>{e()})},onCancel:e,maskClosable:!0,autoFocusButton:null})}),RP(this,"testConnection",e=>{var t=this.state.dataSource;ES.test({id:t.id}).then(t=>{t.ok?uf.success(window.W_L.connect_success):uf.error(window.W_L.connect_failed,t.message,{duration:10}),e()}).catch(()=>{uf.error(window.W_L.connect_failed,window.W_L.connect_failed_tip,{duration:10}),e()})})}componentDidMount(){ES.get({id:this.props.dataSourceId}).then(e=>{var t=e.type;this.setState({dataSource:e}),ES.types().then(e=>this.setState({type:Object(l.find)(e,{type:t}),loading:!1}))}).catch(e=>this.props.onError(e))}renderForm(){var e=this.state,t=e.dataSource,a=e.type,r=fP.getFields(a,t),o="DS_".concat(Object(l.toUpper)(a.type)),i={fields:r,type:a,actions:[{name:window.W_L.delete,type:"danger",callback:this.deleteDataSource},{name:window.W_L.connect_test,pullRight:!0,callback:this.testConnection,disableWhenDirty:!0}],onSubmit:this.saveDataSource,feedbackIcons:!0,defaultShowExtraFields:fP.hasFilledExtraField(a,t)};return n.a.createElement("div",{className:"row","data-test":"DataSource"},n.a.createElement("div",{className:"text-right m-r-10"},Ye[o]&&n.a.createElement($e,{className:"f-13",type:o},"Setup Instructions ",n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(help)"))),n.a.createElement("div",{className:"text-center m-b-10"},n.a.createElement("img",{className:"p-5",src:"".concat("static/images/db-logos","/").concat(a.type,".png"),alt:a.name,width:"64"}),n.a.createElement("h3",{className:"m-0"},a.name)),n.a.createElement("div",{className:"col-md-4 col-md-offset-4 m-b-10"},n.a.createElement(EP,i)))}render(){return this.state.loading?n.a.createElement(kb,{className:""}):this.renderForm()}}RP(MP,"propTypes",{dataSourceId:ae.a.string.isRequired,onError:ae.a.func}),RP(MP,"defaultProps",{onError:()=>{}});var zP=TP("DataSources.Edit",null,MP);function FP(){return(FP=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function VP(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}_f.register("DataSources.Edit",ha({path:"/data_sources/:dataSourceId",title:window.W_L.data_source,render:e=>n.a.createElement(zP,e)}));class UP extends n.a.Component{constructor(){super(...arguments),VP(this,"state",{destinationTypes:[],destinations:[],loading:!0}),VP(this,"createDestination",(e,t)=>{var a={options:{},type:e.type};return fP.updateTargetWithValues(a,t),Vh.create(a).then(e=>(this.setState({loading:!0}),Vh.query().then(e=>this.setState({destinations:e,loading:!1})),e))}),VP(this,"showCreateSourceDialog",()=>{AP.showModal({types:Object(l.reject)(this.state.destinationTypes,"deprecated"),sourceType:window.W_L.alert_setting,imageFolder:Fh,onCreate:this.createDestination}).onClose((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.success&&Ca("destinations/".concat(e.data.id))})).onDismiss(()=>{Ca("destinations",!0)})})}componentDidMount(){Promise.all([Vh.query(),Vh.types()]).then(e=>this.setState({destinations:e[0],destinationTypes:e[1],loading:!1},()=>{this.props.isNewDestinationPage&&(Z.canCreateDestination()?this.showCreateSourceDialog():Ca("destinations",!0))})).catch(e=>this.props.onError(e))}renderDestinations(){var e=this.state.destinations,t=e.map(e=>({title:e.name,imgSrc:"".concat(Fh,"/").concat(e.type,".png"),href:"destinations/".concat(e.id)}));return Object(l.isEmpty)(e)?n.a.createElement("div",{className:"text-center"},window.W_L.no_alert_setting,Z.isCreateDestinationEnabled()&&n.a.createElement("div",{className:"m-t-5"},n.a.createElement(ge,{type:"link",onClick:this.showCreateSourceDialog},window.W_L.add_alert_setting)," ")):n.a.createElement(Ax,{items:t})}render(){var e={type:"primary",onClick:Z.isCreateDestinationEnabled()?this.showCreateSourceDialog:null,disabled:!Z.isCreateDestinationEnabled()};return n.a.createElement("div",null,n.a.createElement("div",{className:"m-b-15"},n.a.createElement(m.a,e,n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.add_alert_setting)),this.state.loading?n.a.createElement(kb,{className:""}):this.renderDestinations())}}VP(UP,"propTypes",{isNewDestinationPage:ae.a.bool,onError:ae.a.func}),VP(UP,"defaultProps",{isNewDestinationPage:!1,onError:()=>{}});var BP=TP("AlertDestinations.List",{permission:"admin",title:window.W_L.alert_setting,path:"destinations",order:4},UP);function HP(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}_f.register("AlertDestinations.List",ha({path:"/destinations",title:window.W_L.alert_setting,render:e=>n.a.createElement(BP,e)})),_f.register("AlertDestinations.New",ha({path:"/destinations/new",title:window.W_L.alert_setting,render:e=>n.a.createElement(BP,FP({},e,{isNewDestinationPage:!0}))}));class YP extends n.a.Component{constructor(){super(...arguments),HP(this,"state",{destination:null,type:null,loading:!0}),HP(this,"saveDestination",(e,t,a)=>{var r=this.state.destination;fP.updateTargetWithValues(r,e),Vh.save(r).then(()=>t(window.W_L.save_success)).catch(e=>{var t=Object(l.get)(e,"response.data.message",window.W_L.save_failed);a(t)})}),HP(this,"deleteDestination",e=>{var t=this.state.destination;R.a.confirm({title:window.W_L.delete_alert,content:window.W_L.delete_alert_confirm,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,okType:"danger",onOk:()=>{Vh.delete(t).then(()=>{uf.success(window.W_L.alert_delete_success),Ca("destinations")}).catch(()=>{e()})},onCancel:e,maskClosable:!0,autoFocusButton:null})})}componentDidMount(){Vh.get({id:this.props.destinationId}).then(e=>{var t=e.type;this.setState({destination:e}),Vh.types().then(e=>this.setState({type:Object(l.find)(e,{type:t}),loading:!1}))}).catch(e=>this.props.onError(e))}renderForm(){var e=this.state,t=e.destination,a=e.type,r={fields:fP.getFields(a,t),type:a,actions:[{name:window.W_L.delete,type:"danger",callback:this.deleteDestination}],onSubmit:this.saveDestination,defaultShowExtraFields:fP.hasFilledExtraField(a,t),feedbackIcons:!0};return n.a.createElement("div",{className:"row","data-test":"Destination"},n.a.createElement("div",{className:"text-center m-b-10"},n.a.createElement("img",{className:"p-5",src:"".concat(Fh,"/").concat(a.type,".png"),alt:a.name,width:"64"}),n.a.createElement("h3",{className:"m-0"},a.name)),n.a.createElement("div",{className:"col-md-4 col-md-offset-4 m-b-10"},n.a.createElement(EP,r)))}render(){return this.state.loading?n.a.createElement(kb,{className:""}):this.renderForm()}}HP(YP,"propTypes",{destinationId:ae.a.string.isRequired,onError:ae.a.func}),HP(YP,"defaultProps",{onError:()=>{}});var QP=TP("AlertDestinations.Edit",null,YP);function KP(){return(KP=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function $P(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}_f.register("AlertDestinations.Edit",ha({path:"/destinations/:destinationId",title:window.W_L.alert_setting,render:e=>n.a.createElement(QP,e)}));class GP extends n.a.Component{constructor(){super(...arguments),$P(this,"state",{name:""}),$P(this,"save",()=>{this.props.dialog.close({name:this.state.name})})}render(){var e=this.props.dialog;return n.a.createElement(R.a,KP({},e.props,{title:window.W_L.create_role,okText:window.W_L.create,cancelText:window.W_L.cancel,onOk:()=>this.save()}),n.a.createElement(va.a,{className:"form-control",defaultValue:this.state.name,onChange:e=>this.setState({name:e.target.value}),onPressEnter:()=>this.save(),placeholder:window.W_L.role_name,"aria-label":window.W_L.role_name,autoFocus:!0}))}}$P(GP,"propTypes",{dialog:ja.isRequired});var JP=Sa(GP),XP={query:()=>B.get("api/groups"),get:e=>{var t=e.id;return B.get("api/groups/".concat(t))},create:e=>B.post("api/groups",e),save:e=>B.post("api/groups/".concat(e.id),e),delete:e=>B.delete("api/groups/".concat(e.id)),members:e=>{var t=e.id;return B.get("api/groups/".concat(t,"/members"))},addMember:(e,t)=>{var a=e.id;return B.post("api/groups/".concat(a,"/members"),t)},removeMember:e=>{var t=e.id,a=e.userId;return B.delete("api/groups/".concat(t,"/members/").concat(a))},dataSources:e=>{var t=e.id;return B.get("api/groups/".concat(t,"/data_sources"))},addDataSource:(e,t)=>{var a=e.id;return B.post("api/groups/".concat(a,"/data_sources"),t)},removeDataSource:e=>{var t=e.id,a=e.dataSourceId;return B.delete("api/groups/".concat(t,"/data_sources/").concat(a))},updateDataSource:(e,t)=>{var a=e.id,r=e.dataSourceId;return B.post("api/groups/".concat(a,"/data_sources/").concat(r),t)}};function ZP(){return(ZP=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function eL(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function tL(e){var t=e.group,a=e.title,r=e.onClick,o=e.children,i=eL(e,["group","title","onClick","children"]);if(!t)return null;var s=n.a.createElement(m.a,ZP({},i,{type:"danger",onClick:e=>function(e,t,a){R.a.confirm({title:window.W_L.del_role,content:window.W_L.del_role_confirm,okText:window.W_L.ok_text,okType:"danger",cancelText:window.W_L.cancel,onOk:()=>{XP.delete(t).then(()=>{uf.success(window.W_L.del_role_success),a()})}})}(0,t,r)}),o);return Object(l.isString)(a)&&""!==a?n.a.createElement(we,{placement:"top",title:a,mouseLeaveDelay:0},s):s}function aL(){return(aL=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function rL(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}tL.propTypes={group:ae.a.object,title:ae.a.string,onClick:ae.a.func,children:ae.a.node},tL.defaultProps={group:null,title:null,onClick:()=>{},children:null};class nL extends n.a.Component{constructor(){super(...arguments),rL(this,"listColumns",[_g.custom((e,t)=>n.a.createElement("div",null,n.a.createElement(h,{href:"groups/"+t.id},t.name),"builtin"===t.type&&n.a.createElement("span",{className:"label label-default m-l-10"},window.W_L.built_in)),{field:"name",width:null}),_g.custom((e,t)=>n.a.createElement(m.a.Group,null,n.a.createElement(h.Button,{href:"groups/".concat(t.id)},window.W_L.members),H.isAdmin&&n.a.createElement(h.Button,{href:"groups/".concat(t.id,"/data_sources")},window.W_L.data_source)),{width:"1%",className:"text-nowrap"}),_g.custom((e,t)=>{var a="builtin"!==t.type;return n.a.createElement(tL,{className:"w-100",disabled:!a,group:t,title:a?null:window.W_L.built_in_role_delete_tip,onClick:()=>this.onGroupDeleted()},window.W_L.delete)},{width:"1%",className:"text-nowrap p-l-0",isAvailable:()=>H.isAdmin})]),rL(this,"createGroup",()=>{JP.showModal().onClose(e=>XP.create(e).then(e=>Ca("groups/".concat(e.id))))}),rL(this,"onGroupDeleted",()=>{this.props.controller.updatePagination({page:1}),this.props.controller.update()})}render(){var e=this.props.controller;return n.a.createElement("div",{"data-test":"GroupList"},H.isAdmin&&n.a.createElement("div",{className:"m-b-15"},n.a.createElement(m.a,{type:"primary",onClick:this.createGroup},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.create_role)),!e.isLoaded&&n.a.createElement(kb,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement(LC,{className:""}),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive"},n.a.createElement(Eg,{items:e.pageItems,columns:this.listColumns,showHeader:!1,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Fg,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))}}rL(nL,"propTypes",{controller:sb.isRequired});var oL=TP("Groups.List",{permission:"list_users",title:window.W_L.role,path:"groups",order:3},cb(nL,()=>new jb({isPlainList:!0,getRequest:()=>({}),getResource:()=>XP.query.bind(XP)}),()=>new xb({orderByField:"name",itemsPerPage:10})));_f.register("Groups.List",ha({path:"/groups",title:window.W_L.role,render:e=>n.a.createElement(oL,aL({},e,{currentPage:"groups"}))}));var iL=a(247),lL=a.n(iL);function sL(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function cL(e){var t=e.group,a=e.onChange,r=sL(e,["group","onChange"]);if(!t)return null;var o=H.isAdmin&&"builtin"!==t.type;return n.a.createElement("h3",r,n.a.createElement(mj,{className:"edit-in-place",isEditable:o,ignoreBlanks:!0,onDone:e=>function(e,t,a){e.name=t,XP.save(e),a()}(t,e,a),value:t.name}))}function uL(e){var t=e.controller,a=e.group,r=e.items,o=e.canAddMembers,i=e.onAddMembersClick,l=e.canAddDataSources,s=e.onAddDataSourcesClick,c=e.onGroupDeleted,u=a&&H.isAdmin&&"builtin"!==a.type;return n.a.createElement(n.a.Fragment,null,n.a.createElement(tx,{items:r,selected:t.params.currentPage}),o&&n.a.createElement(m.a,{className:"w-100 m-t-5",type:"primary",onClick:i},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.add_user),l&&n.a.createElement(m.a,{className:"w-100 m-t-5",type:"primary",onClick:s},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.add_datasource),u&&n.a.createElement(n.a.Fragment,null,n.a.createElement(dh.a,{dashed:!0,className:"m-t-10 m-b-10"}),n.a.createElement(tL,{className:"w-100",group:a,onClick:c},window.W_L.del_role)))}function dL(){return(dL=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function mL(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}cL.propTypes={group:ae.a.shape({name:ae.a.string.isRequired}),onChange:ae.a.func},cL.defaultProps={group:null,onChange:()=>{}},uL.propTypes={controller:sb.isRequired,group:ae.a.object,items:ae.a.array.isRequired,canAddMembers:ae.a.bool,onAddMembersClick:ae.a.func,canAddDataSources:ae.a.bool,onAddDataSourcesClick:ae.a.func,onGroupDeleted:ae.a.func},uL.defaultProps={group:null,canAddMembers:!1,onAddMembersClick:null,canAddDataSources:!1,onAddDataSourcesClick:null,onGroupDeleted:null};class pL extends n.a.Component{constructor(){super(...arguments),mL(this,"groupId",parseInt(this.props.controller.params.groupId,10)),mL(this,"group",null),mL(this,"sidebarMenu",[{key:"users",href:"groups/".concat(this.groupId),title:window.W_L.members},{key:"datasources",href:"groups/".concat(this.groupId,"/data_sources"),title:window.W_L.data_source,isAvailable:()=>H.isAdmin}]),mL(this,"listColumns",[_g.custom((e,t)=>n.a.createElement(jE,{dataSource:t,withLink:!0}),{title:window.W_L.name,field:"name",width:null}),_g.custom((e,t)=>{var a=n.a.createElement(ue.a,{selectedKeys:[t.view_only?"viewonly":"full"],onClick:e=>this.setDataSourcePermissions(t,e.key)},n.a.createElement(ue.a.Item,{key:"full"},window.W_L.full_access),n.a.createElement(ue.a.Item,{key:"viewonly"},window.W_L.view_only));return n.a.createElement(aa.a,{trigger:["click"],overlay:a},n.a.createElement(m.a,{className:"w-100","aria-label":"Permissions"},t.view_only?window.W_L.view_only:window.W_L.full_access,n.a.createElement(lL.a,{"aria-hidden":"true"})))},{width:"1%",className:"p-r-0",isAvailable:()=>H.isAdmin}),_g.custom((e,t)=>n.a.createElement(m.a,{className:"w-100",type:"danger",onClick:()=>this.removeGroupDataSource(t)},"Remove"),{width:"1%",isAvailable:()=>H.isAdmin})]),mL(this,"removeGroupDataSource",e=>{XP.removeDataSource({id:this.groupId,dataSourceId:e.id}).then(()=>{this.props.controller.updatePagination({page:1}),this.props.controller.update()}).catch(()=>{uf.error(window.W_L.datasource_delete_failed)})}),mL(this,"setDataSourcePermissions",(e,t)=>{var a="full"!==t;XP.updateDataSource({id:this.groupId,dataSourceId:e.id},{view_only:a}).then(()=>{e.view_only=a,this.forceUpdate()}).catch(()=>{uf.error(window.W_L.change_datasource_permission_failed)})}),mL(this,"addDataSources",()=>{var e=ES.query(),t=Object(l.map)(this.props.controller.allItems,e=>e.id);zh.showModal({dialogTitle:window.W_L.new_data_source,inputPlaceholder:window.W_L.search_database,selectedItemsTitle:window.W_L.new_data_source,searchItems:t=>(t=Object(l.toLower)(t),e.then(e=>Object(l.filter)(e,e=>Object(l.includes)(Object(l.toLower)(e.name),t)))),renderItem:(e,a)=>{var r=a.isSelected,o=Object(l.includes)(t,e.id);return{content:n.a.createElement(jE,{dataSource:e},n.a.createElement(Bh,{isSelected:r,alreadyInGroup:o})),isDisabled:o,className:r||o?"selected":""}},renderStagedItem:(e,t)=>{var a=t.isSelected;return{content:n.a.createElement(jE,{dataSource:e},n.a.createElement(Bh,{isSelected:a,isStaged:!0}))}}}).onClose(e=>{var t=Object(l.map)(e,e=>XP.addDataSource({id:this.groupId},{data_source_id:e.id}));return Promise.all(t).then(()=>this.props.controller.update())})})}componentDidMount(){XP.get({id:this.groupId}).then(e=>{this.group=e,this.forceUpdate()}).catch(e=>{this.props.controller.handleError(e)})}render(){var e=this.props.controller;return n.a.createElement("div",{"data-test":"Group"},n.a.createElement(cL,{className:"d-block m-t-0 m-b-15",group:this.group,onChange:()=>this.forceUpdate()}),n.a.createElement(qC,null,n.a.createElement(qC.Sidebar,null,n.a.createElement(uL,{controller:e,group:this.group,items:this.sidebarMenu,canAddDataSources:H.isAdmin,onAddDataSourcesClick:this.addDataSources,onGroupDeleted:()=>Ca("groups")})),n.a.createElement(qC.Content,null,!e.isLoaded&&n.a.createElement(kb,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement("div",{className:"text-center"},n.a.createElement("p",null,window.W_L.group_no_datasource),H.isAdmin&&n.a.createElement(m.a,{type:"primary",onClick:this.addDataSources},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.new_data_source)),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive"},n.a.createElement(Eg,{items:e.pageItems,columns:this.listColumns,showHeader:!1,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Fg,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))))}}mL(pL,"propTypes",{controller:sb.isRequired});var fL=TP("Groups.DataSources",null,cb(pL,()=>new jb({isPlainList:!0,getRequest:(e,t)=>({id:t.params.groupId}),getResource:()=>XP.dataSources.bind(XP)}),()=>new xb({orderByField:"name"})));function gL(){return(gL=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function bL(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}_f.register("Groups.DataSources",ha({path:"/groups/:groupId/data_sources",title:window.W_L.group_datasource,render:e=>n.a.createElement(fL,dL({},e,{currentPage:"datasources"}))}));class hL extends n.a.Component{constructor(){super(...arguments),bL(this,"groupId",parseInt(this.props.controller.params.groupId,10)),bL(this,"group",null),bL(this,"sidebarMenu",[{key:"users",href:"groups/".concat(this.groupId),title:window.W_L.members},{key:"datasources",href:"groups/".concat(this.groupId,"/data_sources"),title:window.W_L.data_source,isAvailable:()=>H.isAdmin}]),bL(this,"listColumns",[_g.custom((e,t)=>n.a.createElement(EE,{user:t,withLink:!0}),{title:window.W_L.name,field:"name",width:null}),_g.custom((e,t)=>this.group?"builtin"===this.group.type&&H.id===t.id?null:n.a.createElement(m.a,{className:"w-100",type:"danger",onClick:e=>this.removeGroupMember(e,t)},window.W_L.remove):null,{width:"1%",isAvailable:()=>H.isAdmin})]),bL(this,"removeGroupMember",(e,t)=>XP.removeMember({id:this.groupId,userId:t.id}).then(()=>{this.props.controller.updatePagination({page:1}),this.props.controller.update()}).catch(()=>{uf.error(window.W_L.remove_member_failed)})),bL(this,"addMembers",()=>{var e=Object(l.map)(this.props.controller.allItems,e=>e.id);zh.showModal({dialogTitle:window.W_L.add_member,inputPlaceholder:window.W_L.search_member,selectedItemsTitle:window.W_L.add_member,searchItems:e=>xE.query({q:e}).then(e=>e.results),renderItem:(t,a)=>{var r=a.isSelected,o=Object(l.includes)(e,t.id);return{content:n.a.createElement(EE,{user:t},n.a.createElement(Bh,{isSelected:r,alreadyInGroup:o})),isDisabled:o,className:r||o?"selected":""}},renderStagedItem:(e,t)=>{var a=t.isSelected;return{content:n.a.createElement(EE,{user:e},n.a.createElement(Bh,{isSelected:a,isStaged:!0}))}}}).onClose(e=>{var t=Object(l.map)(e,e=>XP.addMember({id:this.groupId},{user_id:e.id}));return Promise.all(t).then(()=>this.props.controller.update())})})}componentDidMount(){XP.get({id:this.groupId}).then(e=>{this.group=e,this.forceUpdate()}).catch(e=>{this.props.controller.handleError(e)})}render(){var e=this.props.controller;return n.a.createElement("div",{"data-test":"Group"},n.a.createElement(cL,{className:"d-block m-t-0 m-b-15",group:this.group,onChange:()=>this.forceUpdate()}),n.a.createElement(qC,null,n.a.createElement(qC.Sidebar,null,n.a.createElement(uL,{controller:e,group:this.group,items:this.sidebarMenu,canAddMembers:H.isAdmin,onAddMembersClick:this.addMembers,onGroupDeleted:()=>Ca("groups")})),n.a.createElement(qC.Content,null,!e.isLoaded&&n.a.createElement(kb,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement("div",{className:"text-center"},n.a.createElement("p",null,window.W_L.role_no_member),H.isAdmin&&n.a.createElement(m.a,{type:"primary",onClick:this.addMembers},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.add_member)),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive"},n.a.createElement(Eg,{items:e.pageItems,columns:this.listColumns,showHeader:!1,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Fg,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))))}}bL(hL,"propTypes",{controller:sb.isRequired});var yL=TP("Groups.Members",null,cb(hL,()=>new jb({isPlainList:!0,getRequest:(e,t)=>({id:t.params.groupId}),getResource:()=>XP.members.bind(XP)}),()=>new xb({orderByField:"name"})));function vL(e){var t=e.page,a=e.searchTerm,r=e.selectedTags;if(""!==a)return n.a.createElement(xe,{message:window.W_L.find_nothing,icon:"fa-search"});if(r.length>0)return n.a.createElement(cx,{objectType:"queries",tags:r});switch(t){case"favorites":return n.a.createElement(xe,{message:window.W_L.my_favorite_query,icon:"fa-star"});case"archive":return n.a.createElement(xe,{message:window.W_L.archived_query,icon:"fa-archive"});case"my":var o=H.hasPermission("create_query")?n.a.createElement("span",null,n.a.createElement(h.Button,{href:"queries/new",type:"primary",size:"small"},window.W_L.create_query)," ",n.a.createElement($e,{className:"f-13",type:"QUERIES",showTooltip:!1},window.W_L.need_help,"?")):n.a.createElement("span",null,window.W_L.find_nothing);return n.a.createElement(xe,{icon:"fa-search"},o);default:return n.a.createElement(se,{name:"QueriesList.EmptyState"},n.a.createElement(af,{icon:"fa fa-code",illustration:"query",description:window.W_L.get_data_from_datasource,helpMessage:n.a.createElement(ef,{helpTriggerType:"QUERIES"})}))}}_f.register("Groups.Members",ha({path:"/groups/:groupId",title:window.W_L.members,render:e=>n.a.createElement(yL,gL({},e,{currentPage:"users"}))})),vL.propTypes={page:ae.a.string.isRequired,searchTerm:ae.a.string.isRequired,selectedTags:ae.a.array.isRequired};a(1444);function wL(){return(wL=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var OL=[{key:"all",href:"queries",title:window.W_L.all_queries,icon:()=>n.a.createElement(ax,{icon:"fa fa-code"})},{key:"my",href:"queries/my",title:window.W_L.my_queries,icon:()=>n.a.createElement(rx,{user:H})},{key:"favorites",href:"queries/favorites",title:window.W_L.my_favorite_query,icon:()=>n.a.createElement(ax,{icon:"fa fa-star"})},{key:"archive",href:"queries/archive",title:window.W_L.archived_query,icon:()=>n.a.createElement(ax,{icon:"fa fa-archive"})}],_L=[_g.favorites({className:"p-r-0"}),_g.custom.sortable((e,t)=>n.a.createElement(n.a.Fragment,null,n.a.createElement(h,{className:"table-main-title",href:"queries/"+t.id},t.name),n.a.createElement(Jg,{className:"d-block",tags:t.tags,isDraft:t.is_draft,isArchived:t.is_archived})),{title:window.W_L.name,field:"name",width:null}),_g.custom((e,t)=>t.user.name,{title:window.W_L.create_user,width:"1%"}),_g.dateTime.sortable({title:window.W_L.create_time,field:"created_at",width:"1%"}),_g.dateTime.sortable({title:window.W_L.last_exec_datetime,field:"retrieved_at",orderByField:"executed_at",width:"1%"}),_g.custom.sortable((e,t)=>n.a.createElement(ab,{schedule:t.schedule,isNew:t.isNew()}),{title:window.W_L.auto_flush,field:"schedule",width:"1%"})];function EL(e){return n.a.createElement(se,wL({name:"QueriesList.Actions"},e))}function jL(e){var t=e.controller,a=Object(r.useRef)();a.current=t,Object(r.useEffect)(()=>{var e=A.listen((e,t)=>{var r=A.search.q||"";"PUSH"===t&&r!==a.current.searchTerm&&a.current.updateSearch(r)});return()=>{e()}},[]);var o=sx(t,_L,EL),i=o.areExtraActionsAvailable,l=o.listColumns,s=o.Component,c=o.selectedItems;return n.a.createElement("div",{className:"page-queries-list"},n.a.createElement("div",{className:"container"},n.a.createElement(Af,{title:t.params.pageTitle,actions:H.hasPermission("create_query")?n.a.createElement(h.Button,{block:!0,type:"primary",href:"queries/new"},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.new_query):null}),n.a.createElement(qC,null,n.a.createElement(qC.Sidebar,{className:"m-b-0"},n.a.createElement(ex,{placeholder:window.W_L.search_query,label:window.W_L.search_query,value:t.searchTerm,onChange:t.updateSearch}),n.a.createElement(tx,{items:OL,selected:t.params.currentPage}),n.a.createElement(nx,{url:"api/queries/tags",onChange:t.updateSelectedTags,showUnselectAll:!0})),n.a.createElement(qC.Content,null,t.isLoaded&&t.isEmpty?n.a.createElement(vL,{page:t.params.currentPage,searchTerm:t.searchTerm,selectedTags:t.selectedTags}):n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:me()({"m-b-10":i})},n.a.createElement(s,{selectedItems:c})),n.a.createElement("div",{className:"bg-white tiled table-responsive"},n.a.createElement(Eg,{items:t.pageItems,loading:!t.isLoaded,columns:l,orderByField:t.orderByField,orderByReverse:t.orderByReverse,toggleSorting:t.toggleSorting}),n.a.createElement(Fg,{showPageSizeSelect:!0,totalCount:t.totalItemsCount,pageSize:t.itemsPerPage,onPageSizeChange:e=>t.updatePagination({itemsPerPage:e}),page:t.page,onChange:e=>t.updatePagination({page:e})})))))))}jL.propTypes={controller:sb.isRequired};var SL=cb(jL,()=>new jb({getResource(e){var t=e.params.currentPage;return{all:hr.query.bind(hr),my:hr.myQueries.bind(hr),favorites:hr.favorites.bind(hr),archive:hr.archive.bind(hr)}[t]},getItemProcessor:()=>e=>new hr(e)}),()=>new Pb({orderByField:"created_at",orderByReverse:!0}));_f.register("Queries.List",ha({path:"/queries",title:window.W_L.all_queries,render:e=>n.a.createElement(SL,wL({},e,{currentPage:"all"}))})),_f.register("Queries.Favorites",ha({path:"/queries/favorites",title:window.W_L.my_favorite_query,render:e=>n.a.createElement(SL,wL({},e,{currentPage:"favorites"}))})),_f.register("Queries.Archived",ha({path:"/queries/archive",title:window.W_L.archived_query,render:e=>n.a.createElement(SL,wL({},e,{currentPage:"archive"}))})),_f.register("Queries.My",ha({path:"/queries/my",title:window.W_L.my_queries,render:e=>n.a.createElement(SL,wL({},e,{currentPage:"my"}))}));var CL=a(423);a(1445);function xL(){return(xL=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function PL(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function LL(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?PL(Object(a),!0).forEach((function(t){kL(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):PL(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function kL(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function NL(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return AL(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return AL(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function AL(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function TL(e){var t=e.toggleShortcut,a=e.direction,o=e.sizeAttribute,i=e.children,l=NL(Object(r.useState)(0),2),s=l[0],c=l[1],u=Object(r.useRef)(),d=Object(r.useRef)(!1),m=Object(r.useRef)(!1),p="horizontal"===a?"width":"height";o=o||p;var f=Object(r.useCallback)(()=>u.current?Math.floor(u.current.getBoundingClientRect()[p]):0,[p]),g=Object(r.useRef)(null),b=Object(r.useCallback)(()=>{if(u.current){var e,t=Qr.a.select(u.current);null===g.current?(e="0px",g.current="".concat(f(),"px")):(e=g.current,g.current=null),t.style(o,g.current||"0px").transition().duration(200).ease("swing").style(o,e),c(parseInt(e)||0)}},[f,o]),h=Object(r.useMemo)(()=>n.a.createElement("span",{className:"react-resizable-handle react-resizable-handle-".concat(a),role:"separator",onClick:()=>{!d.current&&m.current||b(),d.current=!1,m.current=!1}}),[a,b]);Object(r.useEffect)(()=>{if(t){var e={[t]:b};return Py.bind(e),()=>{Py.unbind(e)}}},[t,b]);var y=Object(r.useMemo)(()=>({onResizeStart:()=>{c(f())},onResize:(e,t)=>{Qr.a.select(u.current).style(o,"".concat(t.size[p],"px")),c(t.size[p]),m.current=!0},onResizeStop:()=>{m.current&&(g.current=null)}}),[p,f,o]),v=Object(r.useMemo)(()=>({onMouseDown:e=>{"touchstart"===e.type&&(d.current=!0),c(f())}}),[f]);return i?(i=n.a.createElement(i.type,LL(LL({},i.props),{},{ref:u})),n.a.createElement(CL.Resizable,xL({className:"resizable-component",axis:"horizontal"===a?"x":"y",resizeHandles:["horizontal"===a?"e":"s"],handle:h,width:"horizontal"===a?s:0,height:"vertical"===a?s:0,minConstraints:[0,0]},y,{draggableOpts:v}),i)):null}TL.propTypes={direction:ae.a.oneOf(["horizontal","vertical"]),sizeAttribute:ae.a.string,toggleShortcut:ae.a.string,children:ae.a.element},TL.defaultProps={direction:"horizontal",sizeAttribute:null,toggleShortcut:null,children:null};var WL=a(724),IL=a.n(WL),qL={sql:e=>IL.a.format(Object(l.trim)(e)),json:e=>JSON.stringify(JSON.parse(e),null,4)};function DL(e){return e in qL}function RL(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t=t||{view_only:!0},Object(r.useMemo)(()=>({isNew:Object(l.isNil)(e.id),isDraft:e.is_draft,isArchived:e.is_archived,canCreate:H.hasPermission("create_query"),canView:H.hasPermission("view_query"),canEdit:H.hasPermission("edit_query")&&Z.canEdit(e),canViewSource:H.hasPermission("view_source"),canExecute:!Object(l.isEmpty)(e.query)&&Z.canRun(e)&&(e.is_safe||H.hasPermission("execute_query")&&!t.view_only),canFork:H.hasPermission("edit_query")&&!t.view_only,canSchedule:H.hasPermission("schedule_query")}),[e,t.view_only])}function ML(e,t){var a=bw(t);return Object(r.useCallback)(()=>{new Promise((e,t)=>{R.a.confirm({title:window.W_L.archived_search,content:n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"m-b-5"},window.W_L.archived_confirm),n.a.createElement("div",null,window.W_L.archived_tip)),okText:window.W_L.ok_text,cancelText:window.W_L.cancel,okType:"danger",onOk:()=>{e()},onCancel:()=>{t()},maskClosable:!0,autoFocusButton:null})}).then(()=>function(e){return hr.delete({id:e.id}).then(()=>Object(l.extend)(e.clone(),{is_archived:!0,schedule:null})).catch(e=>(uf.error(window.W_L.archived_failed),Promise.reject(e)))}(e)).then(a)},[e,a])}function zL(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function FL(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?zL(Object(a),!0).forEach((function(t){VL(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):zL(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function VL(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class UL extends(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error)){constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e),this.detailedMessage=t}}class BL extends UL{constructor(){super(window.W_L.change_not_save,n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"m-b-5"},window.W_L.query_has_change),n.a.createElement("div",null,window.W_L.self_copy_save_and_reload)))}}function HL(){return new Promise((e,t)=>{R.a.confirm({title:window.W_L.overwrite_query,content:n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"m-b-5"},window.W_L.query_has_change),n.a.createElement("div",null,window.W_L.overwrite_query_confirm)),okText:window.W_L.ok_text,cancelText:window.W_L.cancel,okType:"danger",onOk:()=>{e()},onCancel:()=>{t()},maskClosable:!0,autoFocusButton:null})})}function YL(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.canOverwrite,r=void 0!==a&&a;return Object(l.isObject)(e.options)&&e.options.parameters&&(e.options=FL(FL({},e.options),{},{parameters:Object(l.map)(e.options.parameters,e=>e.toSaveableObject())})),hr.save(e).catch(t=>409===Object(l.get)(t,"response.status")?r?HL().then(()=>hr.save(Object(l.omit)(e,["version"]))).catch(()=>Promise.reject(new BL)):Promise.reject(new BL):Promise.reject(new UL(window.W_L.save_failed)))}function QL(e,t){var a=bw(t);return Object(r.useCallback)((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.successMessage,o=void 0===n?window.W_L.save_success:n;if(Object(l.isObject)(t)){if(e.isNew())return void a(Object(l.extend)(e.clone(),t));t=FL(FL({},t),{},{id:e.id,version:e.version})}else t=Object(l.pick)(e,["id","version","schedule","query","description","name","data_source_id","options","latest_query_data_id","is_draft","tags"]);return YL(t,{canOverwrite:Z.canEdit(e)}).then(r=>{Object(l.isNil)(o)||uf.success(o),a(Object(l.extend)(e.clone(),r.id!==e.id?r:Object(l.pick)(r,Object(l.uniq)(["id","version",...Object(l.keys)(t)]))))}).catch(e=>{var t={};e instanceof BL&&(t.duration=null),uf.error(e.message,e.detailedMessage,t)})}),[e,a])}var KL=a(436),$L=a.n(KL);function GL(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return JL(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return JL(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function JL(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function XL(e){var t=GL(Object(r.useState)(!1),2),a=t[0],n=t[1],o=Object(r.useCallback)(()=>{var t="duplicatedQueryTab/".concat(Math.random().toString()),a=window.open("",t);n(!0),hr.fork({id:e.id}).then(e=>{a.location=function(e){var t=C.a.parse(window.location.search);e=$L.a.parse(e);var a=C.a.parse(e.search);return $L.a.format(Object(l.extend)(Object(l.pick)(e,["protocol","auth","host","pathname","hash"]),{search:C.a.stringify(Object(l.extend)(t,a))}))}(e.getUrl(!0))}).finally(()=>{n(!1)})},[e.id]);return[a,a?l.noop:o]}a(1504);function ZL(){return(ZL=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ek(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function tk(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class ak extends n.a.Component{constructor(e){super(e),tk(this,"state",{copied:null}),tk(this,"copy",()=>{window.getSelection().selectAllChildren(this.ref.current);try{if(!document.execCommand("copy"))throw new Error;this.setState({copied:window.W_L.copy_success})}catch(e){this.setState({copied:window.W_L.copy_failed})}window.getSelection().removeAllRanges(),this.resetCopyState=setTimeout(()=>this.setState({copied:null}),2e3)}),this.ref=n.a.createRef(),this.copyFeatureEnabled=e.copyable&&document.queryCommandSupported("copy"),this.resetCopyState=null}componentWillUnmount(){this.resetCopyState&&clearTimeout(this.resetCopyState)}render(){var e=this.props,t=(e.copyable,e.children),a=ek(e,["copyable","children"]),r=n.a.createElement(we,{title:this.state.copied||window.W_L.copy},n.a.createElement(m.a,{icon:n.a.createElement(DE.a,null),type:"dashed",size:"small",onClick:this.copy}));return n.a.createElement("div",{className:"code-block"},n.a.createElement("code",ZL({},a,{ref:this.ref}),t),this.copyFeatureEnabled&&r)}}tk(ak,"propTypes",{copyable:ae.a.bool,children:ae.a.node}),tk(ak,"defaultProps",{copyable:!1,children:null});a(1505);function rk(){return(rk=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function nk(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ok(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ok(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ok(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function ik(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function lk(e){var t=e.dialog,a=ik(e,["dialog"]),o=nk(Object(r.useState)(a.query),2),i=o[0],s=o[1],c=nk(Object(r.useState)(!1),2),u=c[0],d=c[1],p=Object(r.useCallback)(()=>{d(!0),B.post("api/queries/".concat(i.id,"/regenerate_api_key")).then(e=>{d(!1),s(Object(l.extend)(i.clone(),{api_key:e.api_key}))}).catch(()=>{d(!1),uf.error(window.W_L.fail_update_api_key)})},[i]),f=Object(r.useMemo)(()=>({csvUrl:"".concat(Y.basePath,"api/queries/").concat(i.id,"/results.csv?api_key=").concat(i.api_key),jsonUrl:"".concat(Y.basePath,"api/queries/").concat(i.id,"/results.json?api_key=").concat(i.api_key)}),[i.id,i.api_key]),g=f.csvUrl,b=f.jsonUrl,h=Se("csv-results-label"),y=Se("json-results-label");return n.a.createElement(R.a,rk({},t.props,{width:600,footer:n.a.createElement(m.a,{onClick:()=>t.close(i)},window.W_L.close)}),n.a.createElement("div",{className:"query-api-key-dialog-wrapper"},n.a.createElement("h5",null,"API Key"),n.a.createElement("div",{className:"m-b-20"},n.a.createElement(va.a.Group,{compact:!0},n.a.createElement(va.a,{readOnly:!0,value:i.api_key,"aria-label":"Query API Key"}),Z.canEdit(i)&&n.a.createElement(m.a,{disabled:u,loading:u,onClick:p},window.W_L.re_generate))),n.a.createElement("h5",null,window.W_L.api_example,"："),n.a.createElement("div",{className:"m-b-10"},n.a.createElement("span",{id:h},window.W_L.result_as_csv,"："),n.a.createElement(ak,{"aria-labelledby":h,copyable:!0},g)),n.a.createElement("div",null,n.a.createElement("span",{id:y},window.W_L.result_as_json,"："),n.a.createElement(ak,{"aria-labelledby":y,copyable:!0},b))))}lk.propTypes={dialog:ja.isRequired,query:ae.a.shape({id:ae.a.number.isRequired,api_key:ae.a.string,can_edit:ae.a.bool}).isRequired};var sk=Sa(lk);a(1506);function ck(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return uk(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return uk(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function uk(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function dk(){return fj("api/queries/tags").then(e=>Object(l.map)(e,e=>e.name))}function mk(e){var t=e.query,a=e.dataSource,o=e.sourceMode,i=e.selectedVisualization,s=e.headerExtra,c=e.tagsExtra,u=e.onChange,d=ti()({minWidth:768}),p=RL(t,a),f=function(e,t){var a=QL(e,t);return Object(r.useCallback)(t=>{La("edit_name","query",e.id);var r={name:t},n={};e.is_draft&&Y.autoPublishNamedQueries&&t!==window.W_L.new_query&&(r.is_draft=!1,n.successMessage=window.W_L.query_save_publish_success),a(r,n)},[e.id,e.is_draft,a])}(t,u),g=function(e,t){var a=QL(e,t);return Object(r.useCallback)(t=>{La("edit_tags","query",e.id),a({tags:t})},[e.id,a])}(t,u),b=ML(t,u),y=function(e,t){var a=QL(e,t);return Object(r.useCallback)(()=>{La("toggle_published","query",e.id),a({is_draft:!1})},[e.id,a])}(t,u),v=function(e,t){var a=QL(e,t);return Object(r.useCallback)(()=>{La("toggle_published","query",e.id),a({is_draft:!0})},[e.id,a])}(t,u),w=ck(XL(t),2),O=w[0],_=w[1],E=function(e,t){var a=bw(t);return Object(r.useCallback)(()=>{sk.showModal({query:e}).onClose(a)},[e,a])}(t,u),j=function(e){return Object(r.useCallback)(()=>{IE.showModal({aclUrl:"api/queries/".concat(e.id,"/acl"),context:"query",author:e.user})},[e.id,e.user])}(t),S=Object(r.useMemo)(()=>{return e=[{fork:{isEnabled:!p.isNew&&p.canFork&&!O,title:n.a.createElement(n.a.Fragment,null,window.W_L.copy," ",n.a.createElement("i",{className:"fa fa-external-link m-l-5","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)")),onClick:_}},{archive:{isAvailable:!p.isNew&&p.canEdit&&!p.isArchived,title:window.W_L.archived,onClick:b},managePermissions:{isAvailable:!p.isNew&&p.canEdit&&!p.isArchived&&Y.showPermissionsControl,title:window.W_L.mange_permissions,onClick:j},publish:{isAvailable:!d&&p.isDraft&&!p.isArchived&&!p.isNew&&p.canEdit,title:window.W_L.publish,onClick:y},unpublish:{isAvailable:!Y.disablePublish&&!p.isNew&&p.canEdit&&!p.isDraft,title:window.W_L.draft,onClick:v}},{showAPIKey:{isAvailable:!Y.disablePublicUrls&&!p.isNew,title:window.W_L.show+" API Key",onClick:E}}],t={},a=Object(l.map)(e,e=>Object(l.filter)(Object(l.map)(e,(e,a)=>(e=Object(l.extend)({isAvailable:!0,isEnabled:!0,onClick:()=>{}},e)).isAvailable?(t[a]=e.onClick,n.a.createElement(ue.a.Item,{key:a,disabled:!e.isEnabled},e.title)):null))),n.a.createElement(ue.a,{onClick:e=>{var a=e.key;return t[a]()}},Object(l.reduce)(Object(l.filter)(a,e=>e.length>0),(e,t,a)=>{var r=e.length>0?n.a.createElement(ue.a.Divider,{key:"divider".concat(a)}):null;return[...e,r,...t]},[]));var e,t,a},[p.isNew,p.canFork,p.canEdit,p.isArchived,p.isDraft,O,_,b,j,d,y,v,E]);return n.a.createElement("div",{className:"query-page-header"},n.a.createElement("div",{className:"title-with-tags"},n.a.createElement("div",{className:"page-title"},n.a.createElement("div",{className:"d-flex align-items-center"},!p.isNew&&n.a.createElement(Ff,{item:t}),n.a.createElement("h3",null,n.a.createElement(mj,{isEditable:p.canEdit,onDone:f,ignoreBlanks:!0,value:t.name})))),n.a.createElement("div",{className:"query-tags"},n.a.createElement(Jg,{tags:t.tags,isDraft:p.isDraft,isArchived:p.isArchived,canEdit:p.canEdit,getAvailableTags:dk,onEdit:g,tagsExtra:c}))),n.a.createElement("div",{className:"header-actions"},s,d&&p.isDraft&&!p.isArchived&&!p.isNew&&p.canEdit&&n.a.createElement(m.a,{className:"m-r-5",onClick:y},n.a.createElement("i",{className:"fa fa-paper-plane m-r-5","aria-hidden":"true"})," ",window.W_L.publish),!p.isNew&&p.canViewSource&&n.a.createElement("span",null,!o&&n.a.createElement(h.Button,{className:"m-r-5",href:t.getUrl(!0,i)},n.a.createElement("i",{className:"fa fa-pencil-square-o","aria-hidden":"true"}),n.a.createElement("span",{className:"m-l-5"},window.W_L.edit_source)),o&&n.a.createElement(h.Button,{className:"m-r-5",href:t.getUrl(!1,i),"data-test":"QueryPageShowResultOnly"},n.a.createElement("i",{className:"fa fa-table","aria-hidden":"true"}),n.a.createElement("span",{className:"m-l-5"},window.W_L.show_result_only))),!p.isNew&&n.a.createElement(aa.a,{overlay:S,trigger:["click"]},n.a.createElement(m.a,{"data-test":"QueryPageHeaderMoreButton","aria-label":"More actions"},n.a.createElement(th.a,{rotate:90,"aria-hidden":"true"})))))}mk.propTypes={query:ae.a.shape({id:ae.a.oneOfType([ae.a.number,ae.a.string]),name:ae.a.string,tags:ae.a.arrayOf(ae.a.string)}).isRequired,dataSource:ae.a.object,sourceMode:ae.a.bool,selectedVisualization:ae.a.number,headerExtra:ae.a.node,tagsExtra:ae.a.node,onChange:ae.a.func},mk.defaultProps={dataSource:null,sourceMode:!1,selectedVisualization:null,headerExtra:null,tagsExtra:null,onChange:()=>{}};a(1507);function pk(e){var t=e.query,a=e.dataSource,r=e.layout,o=e.onEditSchedule;return n.a.createElement("div",{className:"query-metadata query-metadata-".concat(r)},n.a.createElement("div",{className:"query-metadata-item"},n.a.createElement("img",{className:"profile__image_thumb",src:t.user.profile_image_url,alt:"Avatar"}),n.a.createElement("div",{className:"query-metadata-property"},n.a.createElement("strong",{className:me()("query-metadata-label",{"text-muted":t.user.is_disabled})},t.user.name),n.a.createElement("span",{className:"query-metadata-value"},window.W_L.create_time," ",n.a.createElement("strong",null,n.a.createElement(eg,{date:t.created_at}))))),n.a.createElement("div",{className:"query-metadata-item"},n.a.createElement("img",{className:"profile__image_thumb",src:t.last_modified_by.profile_image_url,alt:"Avatar"}),n.a.createElement("div",{className:"query-metadata-property"},n.a.createElement("strong",{className:me()("query-metadata-label",{"text-muted":t.last_modified_by.is_disabled})},t.last_modified_by.name),n.a.createElement("span",{className:"query-metadata-value"},window.W_L.update_time," ",n.a.createElement("strong",null,n.a.createElement(eg,{date:t.updated_at}))))),n.a.createElement("div",{className:"query-metadata-space"}),Object(l.has)(a,"name")&&Object(l.has)(a,"type")&&n.a.createElement("div",{className:"query-metadata-item"},window.W_L.data_source,"：",n.a.createElement("img",{src:"".concat("static/images/db-logos","/").concat(a.type,".png"),width:"20",alt:a.type}),n.a.createElement("div",{className:"query-metadata-property"},n.a.createElement("div",{className:"query-metadata-label"},a.name))),n.a.createElement("div",{className:"query-metadata-item"},n.a.createElement("div",{className:"query-metadata-property"},n.a.createElement("span",{className:"query-metadata-label"},n.a.createElement("span",{className:"zmdi zmdi-refresh m-r-5"}),window.W_L.auto_flush),n.a.createElement("span",{className:"query-metadata-value"},n.a.createElement(ab,{isLink:Object(l.isFunction)(o),isNew:t.isNew(),schedule:t.schedule,onClick:o})))))}pk.propTypes={layout:ae.a.oneOf(["table","horizontal"]),query:ae.a.shape({created_at:ae.a.oneOfType([ae.a.string,Jf]).isRequired,updated_at:ae.a.oneOfType([ae.a.string,Jf]).isRequired,user:ae.a.shape({name:ae.a.string.isRequired,profile_image_url:ae.a.string.isRequired,is_disabled:ae.a.bool}).isRequired,last_modified_by:ae.a.shape({name:ae.a.string.isRequired,profile_image_url:ae.a.string.isRequired,is_disabled:ae.a.bool}).isRequired,schedule:ae.a.object}).isRequired,dataSource:ae.a.shape({type:ae.a.string,name:ae.a.string}),onEditSchedule:ae.a.func},pk.defaultProps={layout:"table",dataSource:null,onEditSchedule:null};a(1508);function fk(){return(fk=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function gk(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return bk(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return bk(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bk(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function hk(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var yk=bo.a.TabPane;function vk(e){var t=e.title,a=e.message,r=e.refreshButton;return n.a.createElement("div",{className:"query-results-empty-state"},n.a.createElement("div",{className:"empty-state-content"},n.a.createElement("div",null,n.a.createElement("img",{src:"static/images/illustrations/no-query-results.svg",alt:window.W_L.find_nothing})),n.a.createElement("h3",null,t),n.a.createElement("div",{className:"m-b-20"},a),r))}function wk(e){var t=e.visualizationName,a=e.canDelete,o=e.onDelete,i=hk(e,["visualizationName","canDelete","onDelete"]),l=Object(r.useCallback)(e=>{e.stopPropagation(),R.a.confirm({title:window.W_L.delete_view,content:window.W_L.delete_view_confirm,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,okType:"danger",onOk:o,maskClosable:!0,autoFocusButton:null})},[o]);return n.a.createElement("span",i,t,a&&n.a.createElement(ge,{className:"delete-visualization-button",onClick:l,"aria-label":"Close",title:"Close"},n.a.createElement("i",{className:"zmdi zmdi-close","aria-hidden":"true"})))}vk.propTypes={title:ae.a.string.isRequired,message:ae.a.string.isRequired,refreshButton:ae.a.node},vk.defaultProps={refreshButton:null},wk.propTypes={visualizationName:ae.a.string.isRequired,canDelete:ae.a.bool,onDelete:ae.a.func},wk.defaultProps={canDelete:!1,onDelete:()=>{}};var Ok=[{type:"TABLE",name:window.W_L.table,id:null,options:{}}];function _k(e){var t=e.queryResult,a=e.selectedTab,o=e.showNewVisualizationButton,i=e.canDeleteVisualizations,s=e.onChangeTab,c=e.onAddVisualization,u=e.onDeleteVisualization,d=e.refreshButton,p=e.canRefresh,f=hk(e,["queryResult","selectedTab","showNewVisualizationButton","canDeleteVisualizations","onChangeTab","onAddVisualization","onDeleteVisualization","refreshButton","canRefresh"]),g=Object(r.useMemo)(()=>f.visualizations.length>0?f.visualizations:Ok,[f.visualizations]),b={};Object(l.find)(g,{id:a})&&(b.activeKey="".concat(a)),o&&(b.tabBarExtraContent=n.a.createElement(m.a,{className:"add-visualization-button","data-test":"NewVisualization",type:"link",onClick:()=>c()},n.a.createElement("i",{className:"fa fa-plus","aria-hidden":"true"}),n.a.createElement("span",{className:"m-l-5 hidden-xs"},window.W_L.add_view)));var h=Object(r.useMemo)(()=>Object(l.orderBy)(g,["id"]),[g]),y=Object(r.useCallback)(e=>e===h[0].id,[h]),v=ti()({maxWidth:768}),w=gk(Object(r.useState)([]),2),O=w[0],_=w[1];return n.a.createElement(bo.a,fk({},b,{type:"card",className:me()("query-visualization-tabs card-style"),"data-test":"QueryPageVisualizationTabs",animated:!1,tabBarGutter:0,onChange:e=>s(+e),destroyInactiveTabPane:!0}),h.map(e=>n.a.createElement(yk,{key:"".concat(e.id),tab:n.a.createElement(wk,{"data-test":"QueryPageVisualizationTab".concat(e.id),canDelete:!v&&i&&!y(e.id),visualizationName:e.name,onDelete:()=>u(e.id)})},t?n.a.createElement(GO,{visualization:e,queryResult:t,context:"query",filters:O,onFiltersChange:_}):n.a.createElement(vk,{title:window.W_L.find_nothing,message:p?window.W_L.please_exec_flush:window.W_L.no_permission_exec,refreshButton:d}))))}function Ek(e){var t=e.status,a=e.updatedAt,r=e.error,o=e.isCancelling,i=e.onCancel,s="failed"===t?"error":"info",c="failed"!==t&&a,d=Object(l.includes)(["waiting","processing"],t),p=o?n.a.createElement(n.a.Fragment,null,"Cancelling…"):null;switch(t){case"waiting":o||(p=n.a.createElement(n.a.Fragment,null,window.W_L.query_queue,"…"));break;case"processing":o||(p=n.a.createElement(n.a.Fragment,null,window.W_L.exec_query,"…"));break;case"loading-result":p=n.a.createElement(n.a.Fragment,null,window.W_L.loading_query_result,"…");break;case"failed":p=n.a.createElement(n.a.Fragment,null,window.W_L.query_run_error,"：",n.a.createElement("strong",null,r))}return n.a.createElement(u.a,{"data-test":"QueryExecutionStatus",type:s,message:n.a.createElement("div",{className:"d-flex align-items-center"},n.a.createElement("div",{className:"flex-fill p-t-5 p-b-5"},p," ",c&&n.a.createElement(ew,{from:a})),n.a.createElement("div",null,d&&n.a.createElement(m.a,{className:"m-l-10",type:"primary",size:"small",disabled:o,onClick:i},window.W_L.cancel)))})}_k.propTypes={queryResult:ae.a.object,visualizations:ae.a.arrayOf(ae.a.object),selectedTab:ae.a.number,showNewVisualizationButton:ae.a.bool,canDeleteVisualizations:ae.a.bool,onChangeTab:ae.a.func,onAddVisualization:ae.a.func,onDeleteVisualization:ae.a.func,refreshButton:ae.a.node,canRefresh:ae.a.bool},_k.defaultProps={queryResult:null,visualizations:[],selectedTab:null,showNewVisualizationButton:!1,canDeleteVisualizations:!1,onChangeTab:()=>{},onAddVisualization:()=>{},onDeleteVisualization:()=>{},refreshButton:null,canRefresh:!0},Ek.propTypes={status:ae.a.string,updatedAt:ae.a.any,error:ae.a.string,isCancelling:ae.a.bool,onCancel:ae.a.func},Ek.defaultProps={status:"waiting",updatedAt:null,error:null,isCancelling:!0,onCancel:()=>{}};a(1509);function jk(e){var t=e.query,a=e.dataSourcesAvailable,r=RL(t),o=null;return r.isNew&&!r.canCreate?o=n.a.createElement(n.a.Fragment,null,n.a.createElement(Pn.a.Title,{level:4},window.W_L.no_datasource_cant_create_query),n.a.createElement("p",null,n.a.createElement(Pn.a.Text,{type:"secondary"},window.W_L.apply_permission))):a||(o=H.isAdmin?n.a.createElement(n.a.Fragment,null,n.a.createElement(Pn.a.Title,{level:4},window.W_L.no_datasource_or_permission),n.a.createElement("p",null,n.a.createElement(Pn.a.Text,{type:"secondary"},window.W_L.first_create_datasource)),n.a.createElement("div",{className:"query-source-alerts-actions"},n.a.createElement(h.Button,{type:"primary",href:"data_sources/new"},window.W_L.add_datasource),n.a.createElement(h.Button,{type:"default",href:"groups"},window.W_L.mange_permissions))):n.a.createElement(n.a.Fragment,null,n.a.createElement(Pn.a.Title,{level:4},window.W_L.no_datasource_or_permission),n.a.createElement("p",null,n.a.createElement(Pn.a.Text,{type:"secondary"},window.W_L.first_create_datasource)))),o?n.a.createElement("div",{className:"query-source-alerts"},n.a.createElement(vn.a,null,n.a.createElement(se,{name:"QuerySource.Alerts",query:t,dataSourcesAvailable:a},n.a.createElement("div",{className:"query-source-alerts-icon"},n.a.createElement(ch.a,null)),o))):null}function Sk(){return(Sk=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Ck(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return xk(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return xk(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xk(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Pk(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function Lk(e){function t(t){var a=t.queryId,o=t.onError,i=Pk(t,["queryId","onError"]),l=Ck(Object(r.useState)(null),2),s=l[0],c=l[1],u=bw(o);return Object(r.useEffect)(()=>{var e=!1;return(a?hr.get({id:a}):Promise.resolve(hr.newQuery())).then(t=>{e||c(t)}).catch(u),()=>{e=!0}},[a,u]),s?n.a.createElement(e,Sk({query:s,onError:o},i)):n.a.createElement(kb,{className:"flex-fill"})}return t.propTypes={queryId:ae.a.oneOfType([ae.a.number,ae.a.string])},t.defaultProps={queryId:null},t}jk.propTypes={query:ae.a.object.isRequired,dataSourcesAvailable:ae.a.bool},jk.defaultProps={dataSourcesAvailable:!1};var kk=a(728),Nk=a.n(kk);a(1510);function Ak(){return(Ak=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Tk(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Wk(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Wk(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wk(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function Ik(e){var t=e.dialog,a=e.visualization,o=Tk(Object(r.useState)(""),2),i=o[0],s=o[1],c=Tk(Ch(e=>Object(l.isString)(e)&&""!==e?Vp.query({q:e}).then(e=>e.results).catch(()=>[]):Promise.resolve([]),{initialResults:[]}),3),u=c[0],d=c[1],m=c[2],p=Tk(Object(r.useState)(null),2),f=p[0],g=p[1],b=Tk(Object(r.useState)(!1),2),y=b[0],v=b[1];Object(r.useEffect)(()=>{u(i)},[u,i]);var w=f?[f]:d;return n.a.createElement(R.a,Ak({},t.props,{title:window.W_L.widget_add_dashboard,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,okButtonProps:{disabled:!f||y,loading:y},cancelButtonProps:{disabled:y},onOk:function(){Vp.get(f).then(e=>(e.addWidget(a),e)).then(e=>{t.close();var a="notification-".concat(Math.random().toString(36).substr(2,10));uf.success(window.W_L.widget_add_dashboard,n.a.createElement(n.a.Fragment,null,n.a.createElement(h,{href:"".concat(e.url),onClick:()=>uf.close(a)},e.name),n.a.createElement(Jg,{isDraft:e.is_draft,tags:e.tags})),{key:a})}).catch(()=>{uf.error(window.W_L.widget_add_failed)}).finally(()=>{v(!1)})}}),n.a.createElement("label",{htmlFor:"add-to-dashboard-dialog-dashboard"},window.W_L.select_query_to_dashboard,"："),!f&&n.a.createElement(va.a,{id:"add-to-dashboard-dialog-dashboard",className:"w-100",autoComplete:"off",autoFocus:!0,placeholder:window.W_L.filter_by_name,value:i,onChange:e=>s(e.target.value),suffix:n.a.createElement(ge,{className:""===i?"hidden":null,onClick:()=>s("")},n.a.createElement(je.a,null))}),(w.length>0||m)&&n.a.createElement(qb.a,{className:f?"add-to-dashboard-dialog-selection":"add-to-dashboard-dialog-search-results",bordered:!0,itemLayout:"horizontal",loading:m,dataSource:w,renderItem:e=>n.a.createElement(qb.a.Item,{key:"dashboard-".concat(e.id),actions:f?[n.a.createElement(ge,{onClick:()=>g(null)},n.a.createElement(je.a,null))]:[],onClick:f?null:()=>g(e)},n.a.createElement("div",{className:"add-to-dashboard-dialog-item-content"},e.name,n.a.createElement(Jg,{isDraft:e.is_draft,tags:e.tags})))}))}Ik.propTypes={dialog:ja.isRequired,visualization:ae.a.object.isRequired};var qk=Sa(Ik);a(1511);function Dk(){return(Dk=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Rk(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Mk extends n.a.Component{constructor(e){super(e),Rk(this,"state",{enableChangeIframeSize:!1,iframeWidth:720,iframeHeight:391}),Rk(this,"urlEmbedLabelId",Object(l.uniqueId)("url-embed-label")),Rk(this,"iframeEmbedLabelId",Object(l.uniqueId)("iframe-embed-label"));var t=e.query,a=e.visualization;this.embedUrl="".concat(Y.basePath,"embed/query/").concat(t.id,"/visualization/").concat(a.id,"?api_key=").concat(t.api_key,"&").concat(t.getParameters().toUrlParams()),window.snapshotUrlBuilder&&(this.snapshotUrl=window.snapshotUrlBuilder(t,a))}render(){var e=this.props,t=e.query,a=e.dialog,r=this.state,o=r.enableChangeIframeSize,i=r.iframeWidth,l=r.iframeHeight;return n.a.createElement(R.a,Dk({},a.props,{className:"embed-query-dialog",title:window.W_L.embed_query,footer:n.a.createElement(m.a,{onClick:a.dismiss},window.W_L.close)}),t.is_safe?n.a.createElement(n.a.Fragment,null,n.a.createElement("h5",{id:this.urlEmbedLabelId,className:"m-t-0"},window.W_L.public_url),n.a.createElement("div",{className:"m-b-30"},n.a.createElement(ak,{"aria-labelledby":this.urlEmbedLabelId,"data-test":"EmbedIframe",copyable:!0},this.embedUrl)),n.a.createElement("h5",{id:this.iframeEmbedLabelId,className:"m-t-0"},window.W_L.iframe_embed),n.a.createElement("div",null,n.a.createElement(ak,{"aria-labelledby":this.iframeEmbedLabelId,copyable:!0},'<iframe src="'.concat(this.embedUrl,'" width="').concat(i,'" height="').concat(l,'"></iframe>')),n.a.createElement(ih.a,{className:"m-t-10",layout:"inline"},n.a.createElement(ih.a.Item,null,n.a.createElement(gn.a,{checked:o,onChange:e=>this.setState({enableChangeIframeSize:e.target.checked})})),n.a.createElement(ih.a.Item,{label:"Width"},n.a.createElement(pn.a,{className:"size-input",value:i,onChange:e=>this.setState({iframeWidth:e}),size:"small",disabled:!o})),n.a.createElement(ih.a.Item,{label:"Height"},n.a.createElement(pn.a,{className:"size-input",value:l,onChange:e=>this.setState({iframeHeight:e}),size:"small",disabled:!o})))),this.snapshotUrl&&n.a.createElement(n.a.Fragment,null,n.a.createElement("h5",null,window.W_L.image_embed),n.a.createElement(ak,{copyable:!0},this.snapshotUrl))):n.a.createElement(u.a,{message:window.W_L.query_embed_sql_error,type:"error","data-test":"EmbedErrorAlert"}))}}Rk(Mk,"propTypes",{dialog:ja.isRequired,query:ae.a.object.isRequired,visualization:ae.a.object.isRequired});var zk=Sa(Mk);var Fk=a(725),Vk=a.n(Fk),Uk=a(726),Bk=a.n(Uk),Hk=a(213),Yk=a.n(Hk),Qk=a(323),Kk=a.n(Qk);function $k(e){var t="",a=e.query,r=e.queryResult,o=e.fileType,i=r.getId&&r.getId(),l=r.getData&&r.getData();return i&&l&&a.name&&(t=a.id?"api/queries/".concat(a.id,"/results/").concat(i,".").concat(o).concat(e.embed?"?api_key=".concat(e.apiKey):""):"api/query_results/".concat(i,".").concat(o)),n.a.createElement(h,{target:"_blank",rel:"noopener noreferrer",disabled:e.disabled,href:t,download:!0},e.children)}function Gk(e){var t=n.a.createElement(ue.a,null,!e.query.isNew()&&(!e.query.is_draft||!e.query.is_archived)&&n.a.createElement(ue.a.Item,null,n.a.createElement(ge,{onClick:()=>e.openAddToDashboardForm(e.selectedTab)},n.a.createElement(Vk.a,null)," ",window.W_L.add_to_dashboard)),!Y.disablePublicUrls&&!e.query.isNew()&&n.a.createElement(ue.a.Item,null,n.a.createElement(ge,{onClick:()=>e.showEmbedDialog(e.query,e.selectedTab),"data-test":"ShowEmbedDialogButton"},n.a.createElement(Bk.a,null)," ",window.W_L.embed_other)),n.a.createElement(ue.a.Item,null,n.a.createElement($k,{fileType:"csv",disabled:e.queryExecuting||!e.queryResult.getData||!e.queryResult.getData(),query:e.query,queryResult:e.queryResult,embed:e.embed,apiKey:e.apiKey},n.a.createElement(Yk.a,null)," ",window.W_L.save_as_csv)),n.a.createElement(ue.a.Item,null,n.a.createElement($k,{fileType:"tsv",disabled:e.queryExecuting||!e.queryResult.getData||!e.queryResult.getData(),query:e.query,queryResult:e.queryResult,embed:e.embed,apiKey:e.apiKey},n.a.createElement(Yk.a,null)," ",window.W_L.save_as_tsv)),n.a.createElement(ue.a.Item,null,n.a.createElement($k,{fileType:"xlsx",disabled:e.queryExecuting||!e.queryResult.getData||!e.queryResult.getData(),query:e.query,queryResult:e.queryResult,embed:e.embed,apiKey:e.apiKey},n.a.createElement(Kk.a,null)," ",window.W_L.save_as_excel)));return n.a.createElement(aa.a,{trigger:["click"],overlay:t,overlayClassName:"query-control-dropdown-overlay"},n.a.createElement(m.a,{"data-test":"QueryControlDropdownButton"},n.a.createElement(th.a,{rotate:90})))}$k.propTypes={query:ae.a.object.isRequired,queryResult:ae.a.object,fileType:ae.a.string,disabled:ae.a.bool.isRequired,embed:ae.a.bool,apiKey:ae.a.string,children:ae.a.oneOfType([ae.a.arrayOf(ae.a.node),ae.a.node]).isRequired},$k.defaultProps={queryResult:{},fileType:"csv",embed:!1,apiKey:""},Gk.propTypes={query:ae.a.object.isRequired,queryResult:ae.a.object,queryExecuting:ae.a.bool.isRequired,showEmbedDialog:ae.a.func.isRequired,embed:ae.a.bool,apiKey:ae.a.string,selectedTab:ae.a.oneOfType([ae.a.string,ae.a.number]),openAddToDashboardForm:ae.a.func.isRequired},Gk.defaultProps={queryResult:{},embed:!1,apiKey:"",selectedTab:""};var Jk=a(727),Xk=a.n(Jk);function Zk(e){return n.a.createElement(m.a,{"data-test":"EditVisualization",className:"edit-visualization",onClick:()=>e.openVisualizationEditor(e.selectedTab)},n.a.createElement(Xk.a,null),n.a.createElement("span",{className:"hidden-xs hidden-s hidden-m"},window.W_L.edit_view))}Zk.propTypes={openVisualizationEditor:ae.a.func.isRequired,selectedTab:ae.a.oneOfType([ae.a.string,ae.a.number])},Zk.defaultProps={selectedTab:""};a(1522);function eN(e){var t=e.query,a=e.queryResult,o=e.isQueryExecuting,i=e.selectedVisualization,s=e.showEditVisualizationButton,c=e.onEditVisualization,u=e.extraActions,d=gw(a),m=function(e){return Object(r.useCallback)(t=>{var a=Object(l.find)(e.visualizations,{id:t});qk.showModal({visualization:a})},[e.visualizations])}(t),p=function(e){return Object(r.useCallback)((t,a)=>{var r=Object(l.find)(e.visualizations,{id:a});zk.showModal({query:e,visualization:r})},[e])}(t);return n.a.createElement("div",{className:"query-execution-metadata"},n.a.createElement("span",{className:"m-r-5"},n.a.createElement(Gk,{query:t,queryResult:a,queryExecuting:o,showEmbedDialog:p,embed:!1,apiKey:t.api_key,selectedTab:i,openAddToDashboardForm:m})),u,s&&n.a.createElement(Zk,{openVisualizationEditor:c,selectedTab:i}),n.a.createElement("span",{className:"m-l-5 m-r-10"},n.a.createElement("span",null,!0===d.truncated&&n.a.createElement("span",{className:"m-r-5"},n.a.createElement(we,{title:"Result truncated to "+d.rows.length+window.W_L.redash_cut_data_tip},n.a.createElement(Nk.a,{twoToneColor:"#FF9800"}))),n.a.createElement("strong",null,d.rows.length)," ",ug("row",d.rows.length)),n.a.createElement("span",{className:"m-l-5"},!o&&n.a.createElement(n.a.Fragment,null,n.a.createElement("strong",null,dg(d.runtime)),n.a.createElement("span",{className:"hidden-xs"}," ",window.W_L.run_time)),o&&n.a.createElement("span",null,window.W_L.runing,"…")),d.metadata.data_scanned&&n.a.createElement("span",{className:"m-l-5"},"Data Scanned",n.a.createElement("strong",null,gg(d.metadata.data_scanned)))),n.a.createElement("div",null,n.a.createElement("span",{className:"m-r-10"},n.a.createElement("span",{className:"hidden-xs"},window.W_L.flush_time,"："),n.a.createElement("strong",null,n.a.createElement(eg,{date:d.retrievedAt,placeholder:"-"})))))}eN.propTypes={query:ae.a.object.isRequired,queryResult:ae.a.object.isRequired,isQueryExecuting:ae.a.bool,selectedVisualization:ae.a.number,showEditVisualizationButton:ae.a.bool,onEditVisualization:ae.a.func,extraActions:ae.a.node},eN.defaultProps={isQueryExecuting:!1,selectedVisualization:null,showEditVisualizationButton:!1,onEditVisualization:()=>{},extraActions:null};var tN=a(729),aN=a.n(tN),rN=a(730),nN=a.n(rN);function oN(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return iN(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return iN(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function iN(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function lN(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return e?ES.fetchSchema(e,t).catch(()=>(uf.error(window.W_L.flush_error,window.W_L.wait_retry),Promise.resolve([]))):Promise.resolve([])}function sN(){return(sN=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function cN(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function uN(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?cN(Object(a),!0).forEach((function(t){dN(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):cN(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function dN(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function mN(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return pN(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return pN(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pN(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function fN(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var gN=ae.a.shape({name:ae.a.string.isRequired,type:ae.a.string}),bN=ae.a.shape({name:ae.a.string.isRequired,size:ae.a.number,loading:ae.a.bool,columns:ae.a.arrayOf(gN).isRequired});function hN(e){var t=e.item,a=e.expanded,o=e.onToggle,i=e.onSelect,s=fN(e,["item","expanded","onToggle","onSelect"]),c=Object(r.useCallback)((function(e){e.preventDefault(),e.stopPropagation();for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];i(...a)}),[i]);if(!t)return null;var u=t.displayName||t.name;return n.a.createElement("div",s,n.a.createElement("div",{className:"schema-list-item"},n.a.createElement(ge,{className:"table-name",onClick:o},n.a.createElement("i",{className:"fa fa-table m-r-5","aria-hidden":"true"}),n.a.createElement("strong",null,n.a.createElement("span",{title:t.name},u),!Object(l.isNil)(t.size)&&n.a.createElement("span",null," (",t.size,")"))),n.a.createElement(we,{title:"Insert table name into query text",mouseEnterDelay:0,mouseLeaveDelay:0,placement:"topRight",arrowPointAtCenter:!0},n.a.createElement(ge,{className:"copy-to-editor",onClick:e=>c(e,t.name)},n.a.createElement("i",{className:"fa fa-angle-double-right","aria-hidden":"true"})))),a&&n.a.createElement("div",{className:"table-open"},t.loading?n.a.createElement("div",{className:"table-open"},"Loading..."):Object(l.map)(t.columns,e=>{var t=Object(l.get)(e,"name"),a=Object(l.get)(e,"type");return n.a.createElement(we,{title:"Insert column name into query text",mouseEnterDelay:0,mouseLeaveDelay:0,placement:"rightTop"},n.a.createElement(ge,{key:t,className:"table-open-item",onClick:e=>c(e,t)},n.a.createElement("div",null,t," ",a&&n.a.createElement("span",{className:"column-type"},a)),n.a.createElement("div",{className:"copy-to-editor"},n.a.createElement("i",{className:"fa fa-angle-double-right","aria-hidden":"true"}))))})))}function yN(){return n.a.createElement("div",{className:"schema-loading-state"},n.a.createElement(kb,{className:""}))}function vN(e){var t=e.loading,a=e.schema,o=e.expandedFlags,i=e.onTableExpand,l=e.onItemSelect,s=mN(Object(r.useState)(null),2),c=s[0],u=s[1];return Object(r.useEffect)(()=>{c&&c.recomputeRowHeights()},[c,a,o]),n.a.createElement("div",{className:"schema-browser"},t&&n.a.createElement(yN,null),!t&&n.a.createElement(aN.a,null,e=>{var t=e.width,r=e.height;return n.a.createElement(nN.a,{ref:u,width:t,height:r,rowCount:a.length,rowHeight:e=>{var t=e.index,r=a[t],n=r.loading?1:r.columns.length;return 22+18*(o[r.name]?n:0)},rowRenderer:e=>{var t=e.key,r=e.index,s=e.style,c=a[r];return n.a.createElement(hN,{key:t,style:s,item:c,expanded:o[c.name],onToggle:()=>i(c.name),onSelect:l})}})}))}function wN(e,t){var a=Object(l.filter)(t.toLowerCase().split(/\s+/),e=>e.length>0);if(0===a.length)return e;if(1===a.length){var r=a[0],n=a[0];return Object(l.filter)(e,e=>Object(l.includes)(e.name.toLowerCase(),r)||Object(l.some)(e.columns,e=>Object(l.includes)(Object(l.get)(e,"name").toLowerCase(),n)))}var o=a[0],i=a[1];return Object(l.filter)(Object(l.map)(e,e=>{if(Object(l.includes)(e.name.toLowerCase(),o))return(e=uN(uN({},e),{},{columns:Object(l.filter)(e.columns,e=>Object(l.includes)(Object(l.get)(e,"name").toLowerCase(),i))})).columns.length>0?e:null}))}function ON(e){var t=e.dataSource,a=e.onSchemaUpdate,o=e.onItemSelect,i=(e.options,e.onOptionsUpdate,fN(e,["dataSource","onSchemaUpdate","onItemSelect","options","onOptionsUpdate"])),l=mN(function(e){var t=oN(Object(r.useState)([]),2),a=t[0],n=t[1],o=oN(Object(r.useState)(!0),2),i=o[0],l=o[1],s=Object(r.useRef)(null),c=Object(r.useCallback)((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;l(!0);var a=Math.random().toString(36).substr(2);s.current=a,lN(e,t).then(e=>{s.current===a&&n(e)}).finally(()=>{s.current===a&&l(!1)})}),[e]);return Object(r.useEffect)(()=>{c()},[c]),Object(r.useEffect)(()=>()=>{s.current=null},[]),Object(r.useMemo)(()=>[a,i,c],[a,i,c])}(t),3),s=l[0],c=l[1],u=l[2],d=mN(Object(r.useState)(""),2),p=d[0],f=d[1],g=Object(r.useMemo)(()=>wN(s,p),[s,p]),b=mN(Object(Ul.a)(f,500),1)[0],h=mN(Object(r.useState)({}),2),y=h[0],v=h[1],w=bw(a);if(Object(r.useEffect)(()=>{v({}),w(s)},[s,w]),0===s.length&&!c)return null;return n.a.createElement("div",sN({className:"schema-container"},i),n.a.createElement("div",{className:"schema-control"},n.a.createElement(va.a,{className:"m-r-5",placeholder:window.W_L.search_schema,"aria-label":window.W_L.search_schema,disabled:0===s.length,onChange:e=>b(e.target.value)}),n.a.createElement(we,{title:window.W_L.flush_schema},n.a.createElement(m.a,{onClick:()=>u(!0)},n.a.createElement("i",{className:me()("zmdi zmdi-refresh",{"zmdi-hc-spin":c}),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},c?"Loading, please wait.":"Press to refresh.")))),n.a.createElement(vN,{loading:c&&0===s.length,schema:g,expandedFlags:y,onTableExpand:function(e){v(uN(uN({},y),{},{[e]:!y[e]}))},onItemSelect:o}))}hN.propTypes={item:bN,expanded:ae.a.bool,onToggle:ae.a.func,onSelect:ae.a.func},hN.defaultProps={item:null,expanded:!1,onToggle:()=>{},onSelect:()=>{}},ON.propTypes={dataSource:ae.a.object,onSchemaUpdate:ae.a.func,onItemSelect:ae.a.func},ON.defaultProps={dataSource:null,onSchemaUpdate:()=>{},onItemSelect:()=>{}};var _N=a(176),EN=a.n(_N),jN=(a(1596),a(1597),a(1598),a(1599),a(1600),a(1601),a(1602),EN.a.acequire("ace/ext/language_tools")),SN=EN.a.acequire("ace/snippets");function CN(e){EN.a.define("ace/snippets/".concat(e),["require","exports","module"],(t,a)=>{a.snippetText="",a.scope=e})}function xN(e){var t=[],a={},r={};return e.forEach(e=>{t.push({name:e.name,value:e.name,score:100,meta:"Table"}),r[e.name]=function(e){var t=[];return e.columns.forEach(a=>{var r=Object(l.get)(a,"name");t.push({name:"".concat(e.name,".").concat(r),value:"".concat(e.name,".").concat(r),score:100,meta:Object(l.capitalize)(Object(l.get)(a,"type","Column"))})}),t}(e),e.columns.forEach(e=>{var t=Object(l.get)(e,"name",e);a[t]=Object(l.capitalize)(Object(l.get)(e,"type","Column"))})}),{table:t,column:Object(l.map)(a,(e,t)=>({name:t,value:t,score:50,meta:e})),tableColumn:r}}CN("python"),CN("sql"),CN("json"),CN("yaml");var PN={};function LN(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;PN[e]=Object(l.isNil)(t)?null:xN(t)}jN.setCompleters([jN.snippetCompleter,jN.keyWordCompleter,jN.textCompleter,{identifierRegexps:[/[a-zA-Z_0-9.\-\u00A2-\uFFFF]/],getCompletions:(e,t,a,r,n)=>{var o=PN[e.id]||{table:[],column:[],tableColumn:[]},i=o.table,l=o.column,s=o.tableColumn;if(0!==r.length&&0!==i.length)if("."!==r[r.length-1])n(null,i.concat(l));else{var c=r.substring(0,r.length-1);n(null,i.concat(s[c]))}else n(null,[])}}]);class kN{constructor(e){Object(l.extend)(this,e)}getSnippet(){var e=this.trigger;return""!==this.description&&(e="".concat(this.trigger,": ").concat(this.description)),{name:e,content:this.snippet,tabTrigger:this.trigger}}}var NN=e=>new kN(e),AN={get:e=>B.get("api/query_snippets/".concat(e.id)).then(NN),query:()=>B.get("api/query_snippets").then(e=>Object(l.map)(e,NN)),create:e=>B.post("api/query_snippets",e).then(NN),save:e=>B.post("api/query_snippets/".concat(e.id),e).then(NN),delete:e=>B.delete("api/query_snippets/".concat(e.id))};a(1603);function TN(e){var t=e.available,a=e.enabled,o=e.onToggle,i=window.W_L.auto_enable,l="icon-flash";a||(i=window.W_L.auto_disable,l="icon-flash-off"),t||(i=window.W_L.auto_info,l="icon-flash-off");var s=Object(r.useCallback)(()=>{La("toggle_autocomplete","screen","query_editor",{state:!a}),o(!a)},[a,o]);return n.a.createElement(we,{placement:"top",title:i},n.a.createElement(m.a,{className:"query-editor-controls-button m-r-5",disabled:!t,onClick:s,"aria-label":a?"Disable live autocomplete":"Enable live autocomplete"},n.a.createElement("i",{className:"icon "+l,"aria-hidden":"true"})))}TN.propTypes={available:ae.a.bool.isRequired,enabled:ae.a.bool.isRequired,onToggle:ae.a.func.isRequired};a(1604);function WN(e){var t=e.available,a=e.checked,o=e.onChange,i=Object(r.useCallback)(()=>{La("checkbox_auto_limit","screen","query_editor",{state:!a}),o(!a)},[a,o]),l=null;return l=t?window.W_L.limit_1000:window.W_L.not_limit,n.a.createElement(we,{placement:"top",title:l},n.a.createElement(gn.a,{className:"query-editor-controls-checkbox",disabled:!t,onClick:i,checked:t&&a},window.W_L.return_1000))}function IN(){return(IN=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function qN(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function DN(e){var t=e.title,a=e.shortcut,r=qN(e,["title","shortcut"]);return a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,a={mod:Object(l.upperFirst)(jy),alt:Object(l.upperFirst)(Sy)};return e=Object(l.toLower)(Object(l.toString)(e)),e=Object(l.filter)(Object(l.map)(e.split(","),l.trim),e=>""!==e).slice(0,t),""!==(e=Object(l.map)(e,e=>(e=Object(l.filter)(Object(l.map)(e.split("+")),e=>""!==e),Object(l.map)(e,e=>a[e]||Object(l.upperFirst)(e)).join(" + "))).join(", "))?e:null}(a,1),t=t&&a?n.a.createElement(n.a.Fragment,null,t," (",n.a.createElement("i",null,a),")"):t||a,n.a.createElement(we,IN({placement:"top",title:t},r))}function RN(e){var t=e.addParameterButtonProps,a=e.formatButtonProps,o=e.saveButtonProps,i=e.executeButtonProps,s=e.autocompleteToggleProps,c=e.autoLimitCheckboxProps,u=e.dataSourceSelectorProps;return Object(r.useEffect)(()=>{var e=Object(l.filter)([t,a,o,i],e=>e.shortcut&&Object(l.isFunction)(e.onClick));if(e.length>0){var r=Object(l.fromPairs)(Object(l.map)(e,e=>[e.shortcut,e.disabled?l.noop:e.onClick]));return Py.bind(r),()=>{Py.unbind(r)}}},[t,a,o,i]),n.a.createElement("div",{className:"query-editor-controls"},!1!==t&&n.a.createElement(DN,{title:t.title,shortcut:t.shortcut},n.a.createElement(m.a,{className:"query-editor-controls-button m-r-5",disabled:t.disabled,onClick:t.onClick},"{{"," ","}}")),!1!==a&&n.a.createElement(DN,{title:a.title,shortcut:a.shortcut},n.a.createElement(m.a,{className:"query-editor-controls-button m-r-5",disabled:a.disabled,onClick:a.onClick},n.a.createElement("span",{className:"zmdi zmdi-format-indent-increase"}),a.text)),!1!==s&&n.a.createElement(TN,{available:s.available,enabled:s.enabled,onToggle:s.onToggle}),!1!==c&&n.a.createElement(WN,c),!1===u&&n.a.createElement("span",{className:"query-editor-controls-spacer"}),!1!==u&&n.a.createElement(dn.a,{className:"w-100 flex-fill datasource-small",disabled:u.disabled,value:u.value,onChange:u.onChange},Object(l.map)(u.options,e=>n.a.createElement(dn.a.Option,{key:"option-".concat(e.value),value:e.value},e.label))),!1!==o&&n.a.createElement(DN,{title:o.title,shortcut:o.shortcut},n.a.createElement(m.a,{className:"query-editor-controls-button m-l-5",disabled:o.disabled,loading:o.loading,onClick:o.onClick,"data-test":"SaveButton"},!o.loading&&n.a.createElement("span",{className:"fa fa-floppy-o"}),o.text)),!1!==i&&n.a.createElement(DN,{title:i.title,shortcut:i.shortcut},n.a.createElement(m.a,{className:"query-editor-controls-button m-l-5",type:"primary",disabled:i.disabled,onClick:i.onClick,"data-test":"ExecuteButton"},n.a.createElement("span",{className:"zmdi zmdi-play"}),i.text)))}WN.propTypes={available:ae.a.bool,checked:ae.a.bool.isRequired,onChange:ae.a.func.isRequired},DN.propTypes={title:ae.a.node,shortcut:ae.a.string},DN.defaultProps={title:null,shortcut:null};var MN=ae.a.oneOfType([ae.a.bool,ae.a.shape({title:ae.a.node,disabled:ae.a.bool,loading:ae.a.bool,onClick:ae.a.func,text:ae.a.node,shortcut:ae.a.string})]);RN.propTypes={addParameterButtonProps:MN,formatButtonProps:MN,saveButtonProps:MN,executeButtonProps:MN,autocompleteToggleProps:ae.a.oneOfType([ae.a.bool,ae.a.shape({available:ae.a.bool,enabled:ae.a.bool,onToggle:ae.a.func})]),autoLimitCheckboxProps:ae.a.oneOfType([ae.a.bool,ae.a.shape(WN.propTypes)]),dataSourceSelectorProps:ae.a.oneOfType([ae.a.bool,ae.a.shape({disabled:ae.a.bool,value:ae.a.oneOfType([ae.a.string,ae.a.number]),options:ae.a.arrayOf(ae.a.shape({value:ae.a.oneOfType([ae.a.string,ae.a.number]),label:ae.a.node})),onChange:ae.a.func})])},RN.defaultProps={addParameterButtonProps:!1,formatButtonProps:!1,saveButtonProps:!1,executeButtonProps:!1,autocompleteToggleProps:!1,autoLimitCheckboxProps:!1,dataSourceSelectorProps:!1};a(1605);function zN(){return(zN=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function FN(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return VN(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return VN(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function VN(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function UN(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var BN={$blockScrolling:1/0},HN=n.a.forwardRef((function(e,t){var a=e.className,o=e.syntax,i=e.value,l=e.autocompleteEnabled,s=e.schema,c=e.onChange,u=e.onSelectionChange,d=UN(e,["className","syntax","value","autocompleteEnabled","schema","onChange","onSelectionChange"]),m=FN(Object(r.useState)(null),2),p=m[0],f=m[1],g=FN(Object(r.useState)(null),2),b=g[0],h=g[1],y=FN(Object(r.useState)(i),2),v=y[0],w=y[1];Object(r.useEffect)(()=>{w(i)},[i]);var O=Object(r.useCallback)(e=>{w(e),c(e)},[c]),_=Object(r.useMemo)(()=>({behavioursEnabled:!0,enableSnippets:!0,enableBasicAutocompletion:!0,enableLiveAutocompletion:l,autoScrollEditorIntoView:!0}),[l]);Object(r.useEffect)(()=>{if(b){var e=b.editor.id;return LN(e,s),()=>{LN(e,null)}}},[s,b]),Object(r.useEffect)(()=>{function e(){b&&b.editor.resize()}if(p)return e(),Gr(p,e)},[p,b]);var E=Object(r.useCallback)(e=>{var t=b.editor.session.doc.getTextRange(e.getRange()),a=t.length>1?t:null;u(a)},[b,u]),j=Object(r.useCallback)(e=>{e.commands.bindKey({win:"Ctrl+L",mac:"Cmd+L"},null),e.commands.bindKey({win:"Ctrl+Shift+F",mac:"Cmd+Shift+F"},null),e.commands.bindKey({win:"Ctrl+P",mac:null},null),e.commands.bindKey({win:null,mac:"Ctrl+P"},"golineup"),e.commands.bindKey({win:"Esc",mac:"Esc"},()=>{e.blur()});var t=null;e.on("focus",()=>{t=function(e){var t=e.text,a=e.expiry,r=void 0===a?1e3:a,n=e.container,o=void 0===n?document.body:n,i=e.politeness,l=void 0===i?"polite":i,s=document.createElement("div"),c="speak-".concat(Date.now());s.id=c,s.className="sr-only",s.textContent=t,s.setAttribute("role","alert"),s.setAttribute("aria-live",l),o.appendChild(s);var u=null,d=!1,m=()=>{if(!d){d=!0;try{o.removeChild(s)}catch(e){console.error(e)}u&&window.clearTimeout(u)}};return u=window.setTimeout(m,r),m}({text:"You've entered the SQL editor. To exit press the ESC key.",politeness:"assertive"})}),e.on("blur",()=>{t&&t()}),e.commands.on("afterExec",t=>{"insertstring"===t.command.name&&"."===t.args&&e.completer&&e.completer.showPopup(e)}),AN.query().then(e=>{var t=SN.snippetManager,a={snippetText:""};a.snippets=t.parseSnippetFile(a.snippetText),e.forEach(e=>{a.snippets.push(e.getSnippet())}),t.register(a.snippets||[],a.scope)}),e.focus()},[]);return Object(r.useImperativeHandle)(t,()=>({paste:e=>{if(b){var t=b.editor;t.session.doc.replace(t.selection.getRange(),e);var a=t.selection.getRange();c(t.session.getValue()),t.selection.setRange(a)}},focus:()=>{b&&b.editor.focus()}}),[b,c]),n.a.createElement("div",zN({className:me()("query-editor-container",a)},d,{ref:f}),n.a.createElement(zx.a,{ref:h,theme:"textmate",mode:o||"sql",value:v,editorProps:BN,width:"100%",height:"100%",setOptions:_,showPrintMargin:!1,wrapEnabled:!1,onLoad:j,onChange:O,onSelectionChange:E}))}));HN.propTypes={className:ae.a.string,syntax:ae.a.string,value:ae.a.string,autocompleteEnabled:ae.a.bool,schema:ae.a.arrayOf(bN),onChange:ae.a.func,onSelectionChange:ae.a.func},HN.defaultProps={className:null,syntax:null,value:null,autocompleteEnabled:!0,schema:[],onChange:()=>{},onSelectionChange:()=>{}},HN.Controls=RN;var YN=HN,QN=a(731),KN=a.n(QN);function $N(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function GN(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?$N(Object(a),!0).forEach((function(t){JN(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):$N(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function JN(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function XN(e){return Object(l.has)(e,"job.id")?lr(e.job.id,1e3):e}function ZN(e){return Object(l.has)(e,"error")?Promise.reject(new Error(e.error.message)):e}var eA=GN(GN({},ES),{},{getDatabases:function(e){var t=e.id,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r={};return a&&(r.refresh=!0),B.get("api/databricks/databases/".concat(t),{params:r}).then(XN).then(ZN)},getDatabaseTables:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={};return a&&(r.refresh=!0),B.get("api/databricks/databases/".concat(e.id,"/").concat(t,"/tables"),{params:r}).then(XN).then(ZN)},getTableColumns:(e,t,a)=>B.get("api/databricks/databases/".concat(e.id,"/").concat(t,"/columns/").concat(a)).then(XN).then(ZN)});function tA(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return aA(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return aA(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function aA(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function rA(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function nA(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?rA(Object(a),!0).forEach((function(t){oA(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):rA(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function oA(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function iA(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e?eA.getDatabases(e,t).catch(()=>(uf.error("Failed to load Database list.","Please try again later."),Promise.reject())):Promise.resolve([])}function lA(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e&&t?eA.getDatabaseTables(e,t,a).catch(()=>(uf.error("Failed to load tables for ".concat(t,"."),"Please try again later."),Promise.reject())):Promise.resolve([])}function sA(e,t){return t?Object(l.map)(e,e=>{var a=t+".",r=e.name;return Object(l.startsWith)(e.name,a)&&(r=e.name.slice(a.length)),nA(nA({},e),{},{displayName:r})}):e}a(1606);function cA(){return(cA=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function uA(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function dA(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?uA(Object(a),!0).forEach((function(t){mA(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):uA(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function mA(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function pA(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return fA(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return fA(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fA(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function gA(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function bA(e){var t=e.dataSource,a=e.options,o=e.onOptionsUpdate,i=e.onSchemaUpdate,s=e.onItemSelect,c=gA(e,["dataSource","options","onOptionsUpdate","onSchemaUpdate","onItemSelect"]),u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=Object(r.useState)([]),o=tA(n,2),i=o[0],s=o[1],c=Object(r.useState)(!0),u=tA(c,2),d=u[0],m=u[1],p=Object(r.useState)(),f=tA(p,2),g=f[0],b=f[1],h=Object(r.useState)({}),y=tA(h,2),v=y[0],w=y[1],O=Object(r.useState)(!1),_=tA(O,2),E=_[0],j=_[1],S=Object(r.useState)(!1),C=tA(S,2),x=C[0],P=C[1],L=Object(r.useCallback)(e=>w(t=>nA(nA({},t),{},{[g]:e})),[g]),k=Object(r.useRef)();k.current=g;var N=Object(r.useCallback)(t=>{eA.getTableColumns(e,g,t.substring(g.length+1)).then(e=>{k.current===g&&w(a=>{var r=Object(l.get)(a,g,[]),n=Object(l.map)(r,a=>a.name===t?nA(nA({},a),{},{columns:e,loading:!1}):a);return nA(nA({},a),{},{[g]:n})})})},[e,g]),A=Object(r.useMemo)(()=>sA(Object(l.get)(v,g,[]),g),[v,g]),T=Object(r.useCallback)(()=>{if(!x){P(!0);var t=iA(e,!0).then(s),a=lA(e,g,!0).then(e=>{var t=e.schema;return L(t)});Promise.all([a.catch(()=>{}),t.catch(()=>{})]).then(()=>P(!1))}},[e,g,L,x]),W=Object(r.useRef)();W.current=v,Object(r.useEffect)(()=>{var t=!1;return g&&!Object(l.has)(W.current,g)&&(j(!0),lA(e,g).catch(()=>Promise.resolve({schema:[],has_columns:!0})).then(a=>{var r=a.schema,n=a.has_columns;t||(n||Object(l.isEmpty)(r)||(r=Object(l.map)(r,e=>nA(nA({},e),{},{loading:!0})),lA(e,g,!0).then(e=>{var a=e.schema;t||L(a)})),L(r))}).finally(()=>{t||j(!1)})),()=>{t=!0}},[e,g,L]);var I=Object(r.useRef)();I.current=Object(l.get)(t,"selectedDatabase",null),Object(r.useEffect)(()=>{var t=!1;return m(!0),b(void 0),w({}),iA(e).catch(()=>Promise.resolve([])).then(a=>{if(!t){s(a);var r=I.current||localStorage.getItem("lastSelectedDatabricksDatabase_".concat(e.id));r||(r=Object(l.includes)(a,"default")?"default":Object(l.first)(a)||null),b(r)}}).finally(()=>{t||m(!1)}),()=>{t=!0}},[e]);var q=Object(r.useCallback)(r=>{if(r)try{localStorage.setItem("lastSelectedDatabricksDatabase_".concat(e.id),r)}catch(e){}b(r),Object(l.isFunction)(a)&&r!==I.current&&a(nA(nA({},t),{},{selectedDatabase:r}))},[e.id,t,a]);return{databases:i,loadingDatabases:d,schema:A,loadingSchema:E,currentDatabaseName:g,setCurrentDatabase:q,loadTableColumns:N,refreshAll:T,refreshing:x}}(t,a,o),d=u.databases,p=u.loadingDatabases,f=u.schema,g=u.loadingSchema,b=u.loadTableColumns,h=u.currentDatabaseName,y=u.setCurrentDatabase,v=u.refreshAll,w=u.refreshing,O=pA(Object(r.useState)(""),2),_=O[0],E=O[1],j=pA(Object(r.useState)(""),2),S=j[0],C=j[1],x=Object(r.useMemo)(()=>wN(f,_),[f,_]),P=pA(Object(r.useState)(!1),2),L=P[0],k=P[1],N=pA(Object(r.useState)({}),2),A=N[0],T=N[1],W=pA(Object(Ul.a)(E,500),1)[0],I=pA(Object(Ul.a)(C,500),2),q=I[0],D=I[1],R=Object(r.useCallback)(e=>{y(e),D(),C("")},[D,y]),M=Object(r.useMemo)(()=>Object(l.filter)(d,e=>Object(l.includes)(e.toLowerCase(),S.toLowerCase())),[d,S]),z=bw(i);return Object(r.useEffect)(()=>{z(f)},[f,z]),Object(r.useEffect)(()=>{T({})},[h]),n.a.createElement("div",cA({className:"databricks-schema-browser schema-container"},c),n.a.createElement("div",{className:"schema-control"},n.a.createElement(va.a,{className:L?"database-select-open":"",placeholder:window.W_L.filter_table_columns,"aria-label":"{window.W_L.search_schema}",disabled:p||g,onChange:e=>W(e.target.value),addonBefore:n.a.createElement(dn.a,{dropdownClassName:"databricks-schema-browser-db-dropdown",loading:p,disabled:p,onChange:R,value:h,showSearch:!0,onSearch:q,onDropdownVisibleChange:k,placeholder:n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-database m-r-5","aria-hidden":"true"})," Database")},M.map(e=>n.a.createElement(dn.a.Option,{key:e},n.a.createElement("i",{className:"fa fa-database m-r-5","aria-hidden":"true"}),e)))})),n.a.createElement("div",{className:"schema-list-wrapper"},n.a.createElement(vN,{loading:p||g,schema:x,expandedFlags:A,onTableExpand:function(e){var t=Object(l.find)(f,{name:e});!A[e]&&Object(l.get)(t,"loading",!1)&&b(e),T(dA(dA({},A),{},{[e]:!A[e]}))},onItemSelect:s}),!(g||p)&&n.a.createElement("div",{className:"load-button"},n.a.createElement(we,{title:w?null:"Refresh Databases and Current Schema"},n.a.createElement(m.a,{type:"link",onClick:v,disabled:w},n.a.createElement(KN.a,{spin:w}))))))}function hA(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function yA(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?hA(Object(a),!0).forEach((function(t){vA(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):hA(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function vA(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}bA.propTypes={dataSource:ae.a.object,options:ae.a.object,onOptionsUpdate:ae.a.func,onSchemaUpdate:ae.a.func,onItemSelect:ae.a.func},bA.defaultProps={dataSource:null,options:null,onOptionsUpdate:()=>{},onSchemaUpdate:()=>{},onItemSelect:()=>{}};var wA=new Map,OA="SchemaBrowser",_A="QueryEditor";function EA(e,t,a){Object(l.isNil)(a)&&(a=[null]),Object(l.isArray)(a)||(a=[a]),Object(l.each)(a,a=>{wA.set(a,yA(yA({},wA.get(a)),{},{[e]:t}))})}function jA(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return SA(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return SA(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function SA(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function CA(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return xA(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return xA(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xA(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function PA(e){var t=Object(r.useMemo)(()=>Object(l.first)(Object(l.orderBy)(e,["id"]))||{},[e]),a=CA(Object(r.useState)(+A.hash||t.id),2),n=a[0],o=a[1];return Object(r.useEffect)(()=>{var e=n!==t.id?"".concat(n):null;return A.hash!==e&&A.setHash(e),A.listen(()=>{A.hash!==e&&o(+A.hash||t.id)})},[t.id,n]),Object(r.useEffect)(()=>{Object(l.find)(e,{id:n})||o(t.id)},[t.id,n,e]),Object(r.useMemo)(()=>[n,o],[n])}function LA(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return kA(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return kA(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function kA(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function NA(e){var t=Object(r.useMemo)(()=>function(e){return Object(l.reduce)(e,(e,t)=>e+t.columns.length,0)}(e)<=5e3,[e]),a=LA(Object(r.useState)(dr.get("liveAutocomplete",!0)),2),n=a[0],o=a[1],i=Object(r.useCallback)(e=>{o(e),dr.set("liveAutocomplete",e)},[]);return Object(r.useMemo)(()=>[t,n,i],[t,n,i])}function AA(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function TA(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?AA(Object(a),!0).forEach((function(t){WA(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):AA(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function WA(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function IA(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return qA(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return qA(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qA(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function DA(e,t,a){var n=function(e){return Object(l.get)(e,"supports_auto_limit",!1)}(e),o=IA(Object(r.useState)(t.options.apply_auto_limit),2),i=o[0],s=o[1];return t.options.apply_auto_limit=i,[n,i,Object(r.useCallback)(e=>{s(e),dr.set("applyAutoLimit",e),a(Object(l.extend)(t.clone(),{options:TA(TA({},t.options),{},{apply_auto_limit:e})}))},[t,a])]}EA(OA,ON),EA(_A,YN),EA(OA,bA,["databricks","databricks_internal"]);var RA=v()("redash:notifications"),MA=window.Notification||null;MA||RA("HTML5 notifications are not supported.");var zA=Object(l.find)(["hidden","webkitHidden","mozHidden","msHidden"],e=>e in document);var FA={getPermissions:function(){MA&&"default"===MA.permission&&MA.requestPermission()},showNotification:function(e,t){MA&&document[zA]&&"granted"===MA.permission&&(new MA(e,{tag:e+t,body:t,icon:vt.a}).onclick=function(){window.focus(),this.close(),La("click","notification")})}};function VA(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return UA(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return UA(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function UA(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function BA(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function HA(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?BA(Object(a),!0).forEach((function(t){YA(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):BA(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function YA(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var QA=(e,t)=>HA(HA({},e),t);function KA(e){var t=VA(Object(r.useReducer)(QA,{queryResult:null,isExecuting:!1,loadedInitialResults:!1,executionStatus:null,isCancelling:!1,cancelCallback:null,error:null}),2),a=t[0],n=t[1],o=Object(r.useRef)(null);Object(r.useEffect)(()=>()=>{o.current=null},[]);var i=bw((function(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1?arguments[1]:void 0;t=i?i():e.getQueryResult(r),La("execute","query",e.id),FA.getPermissions(),o.current=t,n({updatedAt:t.getUpdatedAt(),executionStatus:t.getStatus(),isExecuting:!0,cancelCallback:()=>{La("cancel_execute","query",e.id),n({isCancelling:!0}),t.cancelExecution()}});var l=e=>{o.current===t&&n({updatedAt:t.getUpdatedAt(),executionStatus:e})};t.toPromise(l).then(r=>{o.current===t&&(r&&r.query_result.query===e.query&&(e.latest_query_data_id=r.getId(),e.queryResult=r),a.loadedInitialResults&&FA.showNotification("DeepBI","".concat(e.name," updated.")),n({queryResult:r,loadedInitialResults:!0,error:null,isExecuting:!1,isCancelling:!1,executionStatus:null}))}).catch(r=>{o.current===t&&(a.loadedInitialResults&&FA.showNotification("DeepBI","".concat(e.name," failed to run: ").concat(r.getError())),n({queryResult:r,loadedInitialResults:!0,error:r.getError(),isExecuting:!1,isCancelling:!1,executionStatus:ar}))})})),l=Object(r.useRef)(e);return l.current=e,Object(r.useEffect)(()=>{var e;l.current.hasResult()||l.current.paramsRequired()?i(void 0!==(e=A.search.maxAge)?e:-1):n({loadedInitialResults:!0})},[i]),HA(HA({},a),{executeQuery:i})}function $A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return GA(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return GA(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function GA(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function JA(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return XA(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return XA(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function XA(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function ZA(e){var t=Object(r.useMemo)(()=>e.getParametersDefs(),[e]),a=JA(Object(r.useState)(e.getParameters().hasPendingValues()),2),n=a[0],o=a[1],i=Object(r.useCallback)(t=>{t=Object(l.isUndefined)(t)?e.getParameters().hasPendingValues():t,o(t)},[e]);return Object(r.useEffect)(()=>{var t=e.getParameters().hasPendingValues();t!==n&&o(t)},[e,t,n]),Object(r.useMemo)(()=>[t,n,i],[t,n,i])}var eT=a(732),tT=a.n(eT);function aT(){return(aT=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function rT(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function nT(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return oT(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return oT(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oT(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var iT=Fa.a.weekdaysShort(),lT=Fa.a.weekdays(),sT=dn.a.Option,cT=dn.a.OptGroup;function uT(e){var t=nT(Object(r.useState)(e.defaultValue),2),a=t[0],o=t[1],i=a&&!a.isUTC();return n.a.createElement(n.a.Fragment,null,n.a.createElement(tT.a,{allowClear:!1,value:a,format:"HH:mm",minuteStep:5,onChange:function(t){o(t),e.onChange(t)}}),i&&n.a.createElement("span",{className:"utc","data-testid":"utc"},"(",Fa.a.utc(a).format("HH:mm")," UTC)"))}uT.propTypes={defaultValue:Jf,onChange:ae.a.func.isRequired},uT.defaultProps={defaultValue:null};class dT extends n.a.Component{constructor(){super(...arguments),rT(this,"state",this.getState()),rT(this,"setTime",e=>{this.newSchedule={time:Fa()(e).utc().format("HH:mm")}}),rT(this,"setInterval",e=>{var t=this.state.newSchedule,a=cg(e).interval;a===rg.NEVER&&(t.until=null),-1!==[rg.NEVER,rg.MINUTES,rg.HOURS].indexOf(a)&&(t.time=null),a!==rg.WEEKS&&(t.day_of_week=null),a!==rg.DAYS&&a!==rg.WEEKS||this.state.minute&&this.state.hour||(t.time=Fa()().hour("00").minute("15").utc().format("HH:mm")),a!==rg.WEEKS||this.state.dayOfWeek||(t.day_of_week=lT[0]),t.interval=e;var r=nT(t.time?sg(t.time).split(":"):[null,null],2),n=r[0],o=r[1];this.setState({interval:a,seconds:e,hour:n,minute:o,dayOfWeek:t.day_of_week?iT[lT.indexOf(t.day_of_week)]:null}),this.newSchedule=t}),rT(this,"setScheduleUntil",(e,t)=>{this.newSchedule={until:t}}),rT(this,"setWeekday",e=>{var t=e.target.value;this.setState({dayOfWeek:t}),this.newSchedule={day_of_week:t?lT[iT.indexOf(t)]:null}}),rT(this,"setUntilToggle",e=>{var t=e.target.value?Fa()().format("YYYY-MM-DD"):null;this.setScheduleUntil(null,t)})}getState(){var e=Object(l.clone)(this.props.schedule||dT.defaultProps.schedule),t=e.time,a=e.interval,r=e.day_of_week,n=cg(a).interval,o=nT(t?sg(t).split(":"):[null,null],2);return{hour:o[0],minute:o[1],seconds:a,interval:n,dayOfWeek:r?iT[lT.indexOf(r)]:null,newSchedule:e}}get intervals(){var e={[rg.NEVER]:[]};return this.props.refreshOptions.forEach(t=>{var a=cg(t),r=a.count,n=a.interval;n in e||(e[n]=[]),e[n].push([r,t])}),Object.defineProperty(this,"intervals",{value:e}),e}set newSchedule(e){this.setState(t=>({newSchedule:aT(t.newSchedule,e)}))}save(){var e=this.state.newSchedule;(()=>{var t=Object(l.omitBy)(e,l.isNil),a=Object(l.omitBy)(this.props.schedule,l.isNil);return!Object(l.isEqual)(t,a)})()&&(e.interval?this.props.dialog.close(Object(l.clone)(e)):this.props.dialog.close(null)),this.props.dialog.dismiss()}render(){var e=this.props.dialog,t=this.state,a=t.interval,r=t.minute,o=t.hour,i=t.seconds,s=t.newSchedule.until;return n.a.createElement(R.a,aT({},e.props,{title:window.W_L.auto_flush,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,className:"schedule",onOk:()=>this.save()}),n.a.createElement("div",{className:"schedule-component"},n.a.createElement("h5",null,window.W_L.flush_hz),n.a.createElement("div",{"data-testid":"interval"},n.a.createElement(dn.a,{className:"input",value:i,onChange:this.setInterval,dropdownMatchSelectWidth:!1},n.a.createElement(sT,{value:null,key:"never"},window.W_L.flush_never),Object.keys(this.intervals).filter(e=>!Object(l.isEmpty)(this.intervals[e])).map(e=>n.a.createElement(cT,{label:Object(l.capitalize)(ug(e)),key:e},this.intervals[e].map(t=>{var a=nT(t,2),r=a[0],o=a[1];return n.a.createElement(sT,{value:o,key:"".concat(e,"-").concat(r)},dg(o))})))))),-1!==[rg.DAYS,rg.WEEKS].indexOf(a)?n.a.createElement("div",{className:"schedule-component"},n.a.createElement("h5",null,window.W_L.on_time),n.a.createElement("div",{"data-testid":"time"},n.a.createElement(uT,{defaultValue:o?Fa()().hour(o).minute(r):null,onChange:this.setTime}))):null,rg.WEEKS===a?n.a.createElement("div",{className:"schedule-component"},n.a.createElement("h5",null,window.W_L.on_day),n.a.createElement("div",{"data-testid":"weekday"},n.a.createElement(Kn.a.Group,{size:"medium",defaultValue:this.state.dayOfWeek,onChange:this.setWeekday},iT.map(e=>n.a.createElement(Kn.a.Button,{value:e,key:e,className:"input"},e[0]))))):null,a!==rg.NEVER?n.a.createElement("div",{className:"schedule-component"},n.a.createElement("h5",null,window.W_L.ends),n.a.createElement("div",{className:"ends","data-testid":"ends"},n.a.createElement(Kn.a.Group,{size:"medium",value:!!s,onChange:this.setUntilToggle},n.a.createElement(Kn.a,{value:!1},window.W_L.never),n.a.createElement(Kn.a,{value:!0},window.W_L.on)),s?n.a.createElement(qy.a,{size:"small",className:"datepicker",value:Fa()(s),allowClear:!1,format:"YYYY-MM-DD",onChange:this.setScheduleUntil}):null)):null)}}rT(dT,"propTypes",{schedule:Uf,refreshOptions:ae.a.arrayOf(ae.a.number).isRequired,dialog:ja.isRequired}),rT(dT,"defaultProps",{schedule:Bf});var mT=Sa(dT);function pT(e,t){var a=RL(e),n=QL(e,t);return Object(r.useCallback)(()=>{if(a.canEdit&&a.canSchedule){var t=Y.queryRefreshIntervals,r=Z.getQueryRefreshIntervals(),o=Object(l.isArray)(r)?Object(l.intersection)(t,r):t;mT.showModal({schedule:e.schedule,refreshOptions:o}).onClose(t=>{La("edit_schedule","query",e.id),n({schedule:t})})}},[e.id,e.schedule,a.canEdit,a.canSchedule,n])}var fT={save:e=>B.post((e=>e.id?"api/visualizations/".concat(e.id):"api/visualizations")(e),e),delete:e=>B.delete("api/visualizations/".concat(e.id))};a(1609);function gT(){return(gT=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function bT(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return hT(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return hT(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function hT(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function yT(e){var t=e.dialog,a=e.visualization,o=e.query,i=e.queryResult,s=Object(r.useRef)(),c=!a,u=gw(i),d=bT(Object(r.useState)(u.filters),2),m=d[0],p=d[1],f=Object(r.useMemo)(()=>({columns:u.columns,rows:mw(u.rows,m)}),[u,m]),g=Object(r.useMemo)(()=>{var e=a?Op[a.type]:_p(),t=e.getOptions(c?{}:a.options,u);return{type:e.type,name:c?e.name:a.name,options:t,originalOptions:t}},[u,c,a]),b=bT(Object(r.useState)(g.type),2),h=b[0],y=b[1],v=bT(Object(r.useState)(g.name),2),w=v[0],O=v[1],_=bT(Object(r.useState)(!1),2),E=_[0],j=_[1],S=bT(Object(r.useState)(g.options),2),C=S[0],x=S[1],P=bT(Object(r.useState)(!1),2),L=P[0],k=P[1];function N(e){var t=Op[h];x(t.getOptions(e,u))}Object(r.useEffect)(()=>{s.current&&s.current.reset()},[u,C]);var A=c?Object(l.filter)(Op,e=>!e.isDeprecated):Object(l.pick)(Op,[h]),T=Se("visualization-type"),W=Se("visualization-name");return n.a.createElement(R.a,gT({},t.props,{wrapClassName:"ant-modal-fullscreen",title:window.W_L.edit_view,okText:window.W_L.save,cancelText:window.W_L.cancel,okButtonProps:{loading:L,disabled:L},onOk:function(){k(!0);var e=C;"TABLE"===h&&(e=Object(l.omit)(e,["paginationSize"])),function(e){return e.id?La("update","visualization",e.id,{type:e.type}):La("create","visualization",null,{type:e.type}),fT.save(e).then(e=>(uf.success(window.W_L.view_save_success),e)).catch(e=>(uf.error(window.W_L.view_save_failed),Promise.reject(e)))}(Object(l.extend)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e?wp[e]:_p();return{type:a.type,name:a.name,description:"",options:t}}(h),a,{name:w,options:e,query_id:o.id})).then(e=>{!function(e,t){var a=Object(l.findIndex)(e.visualizations,e=>e.id===t.id);a>-1?e.visualizations[a]=t:e.visualizations.push(t),e.visualizations=[...e.visualizations]}(o,e),t.close(e)})},onCancel:function(){var e,a=!Object(l.isEqual)(C,g.originalOptions);(e=E||a,new Promise((t,a)=>{e?R.a.confirm({title:window.W_L.edit_view,content:window.W_L.quit_with_not_save,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,onOk:()=>t(),onCancel:()=>a()}):t()})).then(t.dismiss)},wrapProps:{"data-test":"EditVisualizationDialog"}}),n.a.createElement("div",{className:"edit-visualization-dialog"},n.a.createElement("div",{className:"visualization-settings"},n.a.createElement("div",{className:"m-b-15"},n.a.createElement("label",{htmlFor:T},window.W_L.view_type),n.a.createElement(dn.a,{"data-test":"VisualizationType",id:T,className:"w-100",disabled:!c,value:h,onChange:function(e){y(e);var t=Op[e];E||O(t.name),x(t.getOptions(c?{}:a.options,u))}},Object(l.map)(A,e=>n.a.createElement(dn.a.Option,{key:e.type,"data-test":"VisualizationType."+e.type},e.name)))),n.a.createElement("div",{className:"m-b-15"},n.a.createElement("label",{htmlFor:W},window.W_L.view_name),n.a.createElement(va.a,{"data-test":"VisualizationName",id:W,className:"w-100",value:w,onChange:e=>{return t=e.target.value,O(t),void j(t!==w);var t}})),n.a.createElement("div",{"data-test":"VisualizationEditor"},n.a.createElement(UO,{type:h,data:u,options:C,visualizationName:w,onOptionsChange:N}))),n.a.createElement("div",{className:"visualization-preview"},n.a.createElement("label",{htmlFor:"visualization-preview",className:"invisible hidden-xs"},window.W_L.preview),n.a.createElement(fw,{filters:m,onChange:p}),n.a.createElement("div",{className:"scrollbox","data-test":"VisualizationPreview"},n.a.createElement(VO,{type:h,data:f,options:C,visualizationName:w,onOptionsChange:N})))))}yT.propTypes={dialog:ja.isRequired,query:ae.a.object.isRequired,visualization:Zr,queryResult:ae.a.object.isRequired},yT.defaultProps={visualization:null};var vT=Sa(yT);function wT(e,t,a){var n=bw(a);return Object(r.useCallback)((function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=Object(l.find)(e.visualizations,{id:a})||null;vT.showModal({query:e,visualization:r,queryResult:t}).onClose(t=>{var a=Object(l.filter)(e.visualizations,e=>e.id!==t.id);n(Object(l.extend)(e.clone(),{visualizations:[...a,t]}),t)})}),[e,t,n])}function OT(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _T(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _T(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _T(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function ET(e,t){var a=bw(t);return Object(r.useCallback)(t=>fT.delete({id:t}).then(()=>{var r=Object(l.filter)(e.visualizations,e=>e.id!==t);a(Object(l.extend)(e.clone(),{visualizations:r}))}).catch(()=>{uf.error("Error deleting visualization.","Maybe it's used in a dashboard?")}),[e,a])}function jT(e,t){var a=QL(e,t);return Object(r.useCallback)(t=>{La("edit_description","query",e.id),a({description:t})},[e.id,a])}function ST(e){return n.a.createElement("img",{src:"".concat("","/static/images/db-logos/").concat(e.type,".png"),width:"20",alt:e.alt})}function CT(e){var t=e.dataSource,a=e.children;return n.a.createElement(n.a.Fragment,null,n.a.createElement(ST,{type:t.type,"aria-label":t.name,title:t.name}),a||n.a.createElement("span",null,t.name))}function xT(e){return n.a.createElement(dn.a,{className:"w-100","data-test":"SelectDataSource",placeholder:"Choose data source...",value:e.value,disabled:e.disabled,loading:e.loading,optionFilterProp:"data-name",showSearch:!0,onChange:e.onChange},Object(l.map)(e.dataSources,e=>n.a.createElement(dn.a.Option,{key:"ds-".concat(e.id),value:e.id,"data-name":e.name,"data-test":"SelectDataSource".concat(e.id)},n.a.createElement(se,{name:"QuerySourceDropdownItem",dataSource:e}))))}ST.propTypes={type:ae.a.string,alt:ae.a.string},CT.propTypes={dataSource:ae.a.shape({name:ae.a.string,id:ae.a.oneOfType([ae.a.string,ae.a.number]),type:ae.a.string}).isRequired,children:ae.a.element},le("QuerySourceDropdownItem",CT),xT.propTypes={dataSources:ae.a.any,value:ae.a.oneOfType([ae.a.string,ae.a.number]),disabled:ae.a.bool,loading:ae.a.bool,onChange:ae.a.func},le("QuerySourceDropdown",xT);a(1610);function PT(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function LT(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?PT(Object(a),!0).forEach((function(t){kT(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):PT(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function kT(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function NT(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return AT(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return AT(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function AT(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function TT(e){var t,a=function(e){var t=jA(Object(r.useState)(e),2),a=t[0],n=t[1],o=jA(Object(r.useState)(e.query),2),i=o[0],s=o[1],c=jA(Object(r.useState)(a.options.apply_auto_limit),2),u=c[0],d=c[1],m=QL(a,e=>{e.id!==a.id&&Ca(e.getUrl(!0),!0),n(e),s(e.query),d(e.options.apply_auto_limit)});return Object(r.useMemo)(()=>({query:a,setQuery:n,isDirty:a.query!==i||!Object(l.isEmpty)(a.query)&&a.options.apply_auto_limit!==u,saveQuery:()=>m()}),[a,i,m,u])}(e.query),o=a.query,i=a.setQuery,s=a.isDirty,c=a.saveQuery,u=function(e){var t=$A(Object(r.useState)([]),2),a=t[0],n=t[1],o=$A(Object(r.useState)(!1),2),i=o[0],s=o[1],c=Object(r.useMemo)(()=>Object(l.filter)(a,t=>!t.view_only||t.id===e.data_source_id),[a,e.data_source_id]),u=Object(r.useMemo)(()=>Object(l.find)(c,t=>Object(l.toString)(t.id)===Object(l.toString)(e.data_source_id))||null,[e.data_source_id,c]);return Object(r.useEffect)(()=>{var e=!1;return ES.query().then(t=>{e||(s(!0),n(t))}),()=>{e=!0}},[]),Object(r.useMemo)(()=>({dataSourcesLoaded:i,dataSources:c,dataSource:u}),[i,c,u])}(o),d=u.dataSourcesLoaded,p=u.dataSources,f=u.dataSource,g=NT(Object(r.useState)([]),2),b=g[0],h=g[1],y=RL(o,f),v=NT(ZA(o),3),w=v[0],O=v[1],_=v[2],E=NT(PA(o.visualizations),2),j=E[0],S=E[1],C=(t=f&&f.type,yA(yA({},wA.get(null)),wA.get(t))),x=C.QueryEditor,P=C.SchemaBrowser,L=!ti()({minWidth:768});!function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Object(r.useRef)();t.current=e,Object(r.useEffect)(()=>{var e=window.W_L.leave_lost_warning,a="".concat(e,"\n")+window.W_L.leave_lost_confirm,r=window.onbeforeunload;window.onbeforeunload=function(){return t.current?e:void 0};var n=A.confirmChange((e,r)=>{if(t.current&&e.path!==r.path)return a});return()=>{window.onbeforeunload=r,n()}},[])}(s);var k=KA(o),N=k.queryResult,T=k.isExecuting,W=k.executionStatus,I=k.executeQuery,q=k.error,D=k.cancelCallback,R=k.isCancelling,M=k.updatedAt,z=k.loadedInitialResults,F=gw(N),V=Object(r.useRef)(null),U=NT(NA(b),3),B=U[0],H=U[1],Y=U[2],Q=NT(DA(f,o,i),3),K=Q[0],$=Q[1],G=Q[2],J=NT(Object(Ul.a)(e=>{i(Object(l.extend)(o.clone(),{query:e}))},100),1)[0];Object(r.useEffect)(()=>{La("view_source","query",o.id)},[o.id]),Object(r.useEffect)(()=>{document.title=o.name},[o.name]);var X=QL(o,i),Z=jT(o,i),ee=f?f.syntax||"sql":null,te=DL(ee),ae=Object(r.useCallback)(e=>{if(e)try{localStorage.setItem("lastSelectedDataSourceId",e)}catch(e){}if(o.data_source_id!==e){La("update_data_source","query",o.id,{dataSourceId:e});var t={data_source_id:e,latest_query_data_id:null,latest_query_data:null};i(Object(l.extend)(o.clone(),t)),X(t,{successMessage:null})}},[o,i,X]);Object(r.useEffect)(()=>{if(d&&y.isNew){var e=p.length>0?p[0].id:null;ae((t=[o.data_source_id,localStorage.getItem("lastSelectedDataSourceId"),e],a=p,a=Object(l.map)(a,e=>e.id),Object(l.find)(t,e=>Object(l.includes)(a,e))||null))}var t,a},[o.data_source_id,y.isNew,d,p,ae]);var re=pT(o,i),ne=function(e,t){var a=bw(t);return Object(r.useCallback)(()=>{Kv.showModal({parameter:{title:null,name:"",type:"text",value:null},existingParams:Object(l.map)(e.getParameters().get(),e=>e.name)}).onClose(t=>{var r=e.clone();t=r.getParameters().add(t),a(r,t)})},[e,a])}(o,(e,t)=>{V.current&&(V.current.paste(t.toQueryTextFragment()),V.current.focus()),i(e)}),oe=Object(r.useCallback)(e=>{V.current&&V.current.paste(e)},[]),ie=NT(Object(r.useState)(null),2),le=ie[0],ce=ie[1],ue=Object(r.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];y.canExecute&&(e||!O&&!T)&&(s||!Object(l.isEmpty)(le)?I(null,()=>o.getQueryResultByText(0,le)):I())}),[o,y.canExecute,O,T,s,le,I]),de=NT(Object(r.useState)(!1),2),pe=de[0],fe=de[1],ge=Object(r.useCallback)(()=>{pe||(fe(!0),c().finally(()=>fe(!1)))},[pe,c]),be=function(e,t,a,n){var o=RL(e),i=wT(e,t,n),l=OT(Object(r.useState)(!1),2),s=l[0],c=l[1];return Object(r.useEffect)(()=>{!o.isNew&&s&&(c(!1),i())},[o.isNew,s,i]),Object(r.useCallback)(()=>{o.isNew?(c(!0),a()):i()},[o.isNew,a,i])}(o,N,ge,(e,t)=>{i(e),S(t.id)}),he=wT(o,N,e=>i(e)),ye=ET(o,i);return n.a.createElement("div",{className:me()("query-page-wrapper",{"query-fixed-layout":!L})},n.a.createElement(jk,{query:o,dataSourcesAvailable:!d||p.length>0}),n.a.createElement("div",{className:"container w-100 p-b-10"},n.a.createElement(mk,{query:o,dataSource:f,sourceMode:!0,selectedVisualization:j,headerExtra:n.a.createElement(se,{name:"QuerySource.HeaderExtra",query:o}),onChange:i})),n.a.createElement("main",{className:"query-fullscreen"},n.a.createElement(TL,{direction:"horizontal",sizeAttribute:"flex-basis",toggleShortcut:"Alt+Shift+D, Alt+D"},n.a.createElement("nav",null,d&&n.a.createElement("div",{className:"editor__left__data-source"},n.a.createElement(se,{name:"QuerySourceDropdown",dataSources:p,value:f?f.id:void 0,disabled:!y.canEdit||!d||0===p.length,loading:!d,onChange:ae})),n.a.createElement("div",{className:"editor__left__schema"},n.a.createElement(P,{dataSource:f,options:o.options.schemaOptions,onOptionsUpdate:e=>i(Object(l.extend)(o.clone(),{options:LT(LT({},o.options),{},{schemaOptions:e})})),onSchemaUpdate:h,onItemSelect:oe})),!o.isNew()&&n.a.createElement("div",{className:"query-page-query-description"},n.a.createElement(mj,{isEditable:y.canEdit,markdown:!0,ignoreBlanks:!1,placeholder:window.W_L.new_desc,value:o.description,onDone:Z,multiline:!0})),!o.isNew()&&n.a.createElement(pk,{layout:"table",query:o,onEditSchedule:re}))),n.a.createElement("div",{className:"content"},n.a.createElement("div",{className:"flex-fill p-relative"},n.a.createElement("div",{className:"p-absolute d-flex flex-column p-l-15 p-r-15",style:{left:0,top:0,right:0,bottom:0,overflow:"auto"}},n.a.createElement(TL,{direction:"vertical",sizeAttribute:"flex-basis"},n.a.createElement("div",{className:"row editor"},n.a.createElement("section",{className:"query-editor-wrapper","data-test":"QueryEditor"},n.a.createElement(x,{ref:V,"data-executing":T?"true":null,syntax:f?f.syntax:null,value:o.query,schema:b,autocompleteEnabled:B&&H,onChange:J,onSelectionChange:ce}),n.a.createElement(x.Controls,{addParameterButtonProps:{title:window.W_L.new_params,shortcut:"mod+p",onClick:ne},formatButtonProps:{title:te?window.W_L.query_format:window.W_L.query_format_not_support,disabled:!f||!te,shortcut:te?"mod+shift+f":null,onClick:()=>{try{var e=(t=o.query,DL(a=ee)?(0,qL[a])(t):t);i(Object(l.extend)(o.clone(),{query:e}))}catch(e){uf.error(String(e))}var t,a}},saveButtonProps:y.canEdit&&{text:n.a.createElement(n.a.Fragment,null,n.a.createElement("span",{className:"hidden-xs"},window.W_L.save),s&&!pe?"*":null),shortcut:"mod+s",onClick:ge,loading:pe},executeButtonProps:{disabled:!y.canExecute||T||O,shortcut:"mod+enter, alt+enter, ctrl+enter, shift+enter",onClick:ue,text:n.a.createElement("span",{className:"hidden-xs"},null===le?window.W_L.exec_query:window.W_L.exec_select_query)},autocompleteToggleProps:{available:B,enabled:H,onToggle:Y},autoLimitCheckboxProps:{available:K,checked:$,onChange:G},dataSourceSelectorProps:!!f&&{disabled:!y.canEdit,value:f.id,onChange:ae,options:Object(l.map)(p,e=>({value:e.id,label:e.name}))}})))),!y.isNew&&n.a.createElement(pk,{layout:"horizontal",query:o,onEditSchedule:re}),n.a.createElement("section",{className:"query-results-wrapper"},o.hasParameters()&&n.a.createElement("div",{className:"query-parameters-wrapper"},n.a.createElement(Jv,{editable:y.canEdit,sortable:y.canEdit,disableUrlUpdate:y.isNew,parameters:w,onPendingValuesChange:()=>_(),onValuesChange:()=>{_(!1),ue(!0)},onParametersEdit:()=>{s||c()}})),(q||T)&&n.a.createElement("div",{className:"query-alerts"},n.a.createElement(Ek,{status:W,updatedAt:M,error:q,isCancelling:R,onCancel:D})),n.a.createElement(n.a.Fragment,null,F.log.length>0&&n.a.createElement("div",{className:"query-results-log"},n.a.createElement("p",null,"Log Information:"),Object(l.map)(F.log,(e,t)=>n.a.createElement("p",{key:"log-line-".concat(t),className:"query-log-line"},e))),z&&!(y.isNew&&!N)&&n.a.createElement(_k,{queryResult:N,visualizations:o.visualizations,showNewVisualizationButton:y.canEdit&&F.status===tr,canDeleteVisualizations:y.canEdit,selectedTab:j,onChangeTab:S,onAddVisualization:be,onDeleteVisualization:ye,refreshButton:n.a.createElement(m.a,{type:"primary",disabled:!y.canExecute||O,loading:T,onClick:ue},!T&&n.a.createElement("i",{className:"zmdi zmdi-refresh m-r-5","aria-hidden":"true"}),window.W_L.flush)}))))),N&&!N.getError()&&n.a.createElement("div",{className:"bottom-controller-container"},n.a.createElement(eN,{query:o,queryResult:N,selectedVisualization:j,isQueryExecuting:T,showEditVisualizationButton:!y.isNew&&y.canEdit,onEditVisualization:he})))))}TT.propTypes={query:ae.a.object.isRequired};var WT=Lk(TT);_f.register("Queries.New",ha({path:"/queries/new",render:e=>n.a.createElement(WT,e),bodyClass:"fixed-layout"})),_f.register("Queries.Edit",ha({path:"/queries/:queryId/source",render:e=>n.a.createElement(WT,e),bodyClass:"fixed-layout"}));var IT=a(734),qT=a.n(IT),DT=a(733),RT=a.n(DT);function MT(){return(MT=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function zT(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return FT(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return FT(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function FT(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function VT(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function UT(e){var t=e.title,a=e.shortcut,o=e.disabled,i=e.children,l=e.onClick,s=VT(e,["title","shortcut","disabled","children","onClick"]),c=zT(Object(r.useState)(!1),2),u=c[0],d=c[1],p=Object(r.useMemo)(()=>({onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1)}),[]);return Object(r.useEffect)(()=>{o&&d(!1)},[o]),Object(r.useEffect)(()=>{if(a){var e={[a]:l};return Py.bind(e),()=>{Py.unbind(e)}}},[a,l]),n.a.createElement(DN,{title:t,shortcut:a,visible:u},n.a.createElement("span",p,n.a.createElement(m.a,MT({"data-test":"ExecuteButton",disabled:o,onClick:l,style:o?{pointerEvents:"none"}:{}},s),i)))}UT.propTypes={className:ae.a.string,shortcut:ae.a.string,disabled:ae.a.bool,children:ae.a.node,onClick:ae.a.func},UT.defaultProps={className:null,shortcut:null,disabled:!1,children:null,onClick:()=>{}};a(1611);function BT(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return HT(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return HT(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function HT(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function YT(e){var t=BT(Object(r.useState)(e.query),2),a=t[0],o=t[1],i=BT(Object(r.useState)(),2),l=i[0],s=i[1],c=RL(a,l),u=BT(ZA(a),3),d=u[0],p=u[1],f=u[2],g=BT(PA(a.visualizations),2),b=g[0],h=g[1],y=ti()({minWidth:768}),v=ti()({minHeight:500})&&y,w=BT(YE(),2),O=w[0],_=w[1],E=BT(Object(r.useState)(!1),2),j=E[0],S=E[1],C=KA(a),x=C.queryResult,P=C.loadedInitialResults,L=C.isExecuting,k=C.executionStatus,N=C.executeQuery,A=C.error,T=C.cancelCallback,W=C.isCancelling,I=C.updatedAt,q=gw(x),D=jT(a,o),R=pT(a,o),M=wT(a,x,(e,t)=>{o(e),h(t.id)}),z=wT(a,x,e=>o(e)),F=ET(a,o),V=Object(r.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];c.canExecute&&(e||!p&&!L)&&N()}),[p,N,L,c.canExecute]);return Object(r.useEffect)(()=>{document.title=a.name},[a.name]),Object(r.useEffect)(()=>{ES.get({id:a.data_source_id}).then(s)},[a.data_source_id]),n.a.createElement("div",{className:me()("query-page-wrapper",{"query-view-fullscreen":O,"query-fixed-layout":v})},n.a.createElement("div",{className:"container w-100"},n.a.createElement(mk,{query:a,dataSource:l,onChange:o,selectedVisualization:b,headerExtra:n.a.createElement(se,{name:"QueryView.HeaderExtra",query:a},Z.canRun(a)&&n.a.createElement(UT,{className:"m-r-5",type:"primary",shortcut:"mod+enter, alt+enter, ctrl+enter",disabled:!c.canExecute||L||p,onClick:V},window.W_L.flush)),tagsExtra:!a.description&&c.canEdit&&!j&&!O&&n.a.createElement(ge,{className:"label label-tag hidden-xs",role:"none",onClick:()=>S(!0)},n.a.createElement("i",{className:"zmdi zmdi-plus m-r-5","aria-hidden":"true"}),window.W_L.new_desc)}),(a.description||j)&&n.a.createElement("div",{className:me()("m-t-5",{hidden:O})},n.a.createElement(mj,{className:"w-100",value:a.description,isEditable:c.canEdit,onDone:D,onStopEditing:()=>S(!1),placeholder:"Add description",ignoreBlanks:!1,editorProps:{autoSize:{minRows:2,maxRows:4}},defaultEditing:j,multiline:!0}))),n.a.createElement("div",{className:"query-view-content"},a.hasParameters()&&n.a.createElement("div",{className:me()("bg-white tiled p-15 m-t-15 m-l-15 m-r-15",{hidden:O})},n.a.createElement(Jv,{parameters:d,onValuesChange:()=>{f(!1),V(!0)},onPendingValuesChange:()=>f()})),n.a.createElement("div",{className:"query-results m-t-15"},P&&n.a.createElement(_k,{queryResult:x,visualizations:a.visualizations,showNewVisualizationButton:c.canEdit&&q.status===tr,canDeleteVisualizations:c.canEdit,selectedTab:b,onChangeTab:h,onAddVisualization:M,onDeleteVisualization:F,refreshButton:Z.canRun(a)&&n.a.createElement(m.a,{type:"primary",disabled:!c.canExecute||p,loading:L,onClick:V},!L&&n.a.createElement("i",{className:"zmdi zmdi-refresh m-r-5","aria-hidden":"true"}),window.W_L.flush_now),canRefresh:Z.canRun(a)}),n.a.createElement("div",{className:"query-results-footer"},x&&!x.getError()&&n.a.createElement(eN,{query:a,queryResult:x,selectedVisualization:b,isQueryExecuting:L,showEditVisualizationButton:c.canEdit,onEditVisualization:z,extraActions:n.a.createElement(UT,{className:"icon-button m-r-5 hidden-xs",title:window.W_L.toggle_screen,type:"default",shortcut:"alt+f",onClick:_},O?n.a.createElement(RT.a,null):n.a.createElement(qT.a,null))}),(A||L)&&n.a.createElement("div",{className:"query-execution-status"},n.a.createElement(Ek,{status:k,error:A,isCancelling:W,onCancel:T,updatedAt:I})))),n.a.createElement("div",{className:me()("p-t-15 p-r-15 p-l-15",{hidden:O})},n.a.createElement(pk,{layout:"horizontal",query:a,dataSource:l,onEditSchedule:R}))))}YT.propTypes={query:ae.a.object.isRequired};var QT=Lk(YT);function KT(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return $T(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return $T(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $T(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function GT(e){var t=e.queryName,a=e.queryDescription,r=e.visualization;return n.a.createElement("div",{className:"embed-heading p-b-10 p-r-15 p-l-15"},n.a.createElement("h3",null,n.a.createElement("img",{src:vt.a,alt:"DeepBI Logo",style:{height:"24px",verticalAlign:"text-bottom"}}),n.a.createElement(aw,{visualization:r})," ",t,a&&n.a.createElement("small",null,n.a.createElement(We,{className:"markdown text-muted"},Ie.markdown.toHTML(a||"")))))}function JT(e){var t=e.query,a=e.queryResults,r=e.updatedAt,o=e.refreshStartedAt,i=e.queryUrl,l=e.hideTimestamp,s=e.apiKey,c=n.a.createElement(ue.a,null,n.a.createElement(ue.a.Item,null,n.a.createElement($k,{fileType:"csv",query:t,queryResult:a,apiKey:s,disabled:!a||!a.getData||!a.getData(),embed:!0},n.a.createElement(Yk.a,null)," ",window.W_L.save_as_csv)),n.a.createElement(ue.a.Item,null,n.a.createElement($k,{fileType:"tsv",query:t,queryResult:a,apiKey:s,disabled:!a||!a.getData||!a.getData(),embed:!0},n.a.createElement(Yk.a,null)," ",window.W_L.save_as_tsv)),n.a.createElement(ue.a.Item,null,n.a.createElement($k,{fileType:"xlsx",query:t,queryResult:a,apiKey:s,disabled:!a||!a.getData||!a.getData(),embed:!0},n.a.createElement(Kk.a,null),window.W_L.save_as_excel)));return n.a.createElement("div",{className:"tile__bottom-control"},!l&&n.a.createElement("span",null,n.a.createElement("span",{className:"small hidden-print"},n.a.createElement("i",{className:"zmdi zmdi-time-restore","aria-hidden":"true"})," ",o?n.a.createElement(ew,{from:o}):n.a.createElement(eg,{date:r})),n.a.createElement("span",{className:"small visible-print"},n.a.createElement("i",{className:"zmdi zmdi-time-restore","aria-hidden":"true"})," ",ig(r))),i&&n.a.createElement("span",{className:"hidden-print"},n.a.createElement(we,{title:window.W_L.open_in_redash},n.a.createElement(h.Button,{className:"icon-button",href:i,target:"_blank"},n.a.createElement("i",{className:"fa fa-external-link","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Open in Tap"))),!t.hasParameters()&&n.a.createElement(aa.a,{overlay:c,disabled:!a,trigger:["click"],placement:"topLeft"},n.a.createElement(m.a,{loading:!a&&!!o,className:"m-l-5"},window.W_L.save_as,n.a.createElement("i",{className:"fa fa-caret-up m-l-5","aria-hidden":"true"})))))}function XT(e){var t=e.queryId,a=e.visualizationId,o=e.apiKey,i=e.onError,s=KT(Object(r.useState)(null),2),c=s[0],u=s[1],d=KT(Object(r.useState)(null),2),m=d[0],p=d[1],f=KT(Object(r.useState)(null),2),g=f[0],b=f[1],h=KT(Object(r.useState)(null),2),y=h[0],v=h[1],w=bw(i);Object(r.useEffect)(()=>{var e=!1;return hr.get({id:t}).then(t=>{e||u(t)}).catch(w),()=>{e=!0}},[t,w]);var O=Object(r.useCallback)(()=>{c&&(p(null),b(Fa()()),c.getQueryResultPromise().then(e=>{v(e)}).catch(e=>{p(e.getError())}).finally(()=>b(null)))},[c]);if(Object(r.useEffect)(()=>{document.querySelector("body").classList.add("headless"),O()},[O]),!c)return null;var _=Object(l.has)(A.search,"hide_header"),E=Object(l.has)(A.search,"hide_parameters"),j=Object(l.has)(A.search,"hide_link"),S=Object(l.has)(A.search,"hide_timestamp"),C=Object(l.has)(A.search,"showDescription");a=parseInt(a,10);var x=Object(l.find)(c.visualizations,e=>e.id===a);return x?n.a.createElement("div",{className:"tile m-t-10 m-l-10 m-r-10 p-t-10 embed__vis","data-test":"VisualizationEmbed"},!_&&n.a.createElement(GT,{queryName:c.name,queryDescription:C?c.description:null,visualization:x}),n.a.createElement("div",{className:"col-md-12 query__vis"},!E&&c.hasParameters()&&n.a.createElement("div",{className:"p-t-15 p-b-10"},n.a.createElement(Jv,{parameters:c.getParametersDefs(),onValuesChange:O})),m&&n.a.createElement("div",{className:"alert alert-danger","data-test":"ErrorMessage"},"Error: ".concat(m)),!m&&y&&n.a.createElement(GO,{visualization:x,queryResult:y,context:"widget"}),!y&&g&&n.a.createElement("div",{className:"d-flex justify-content-center"},n.a.createElement("div",{className:"spinner"},n.a.createElement("i",{className:"zmdi zmdi-refresh zmdi-hc-spin zmdi-hc-5x","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Refreshing...")))),n.a.createElement(JT,{query:c,queryResults:y,updatedAt:y?y.getUpdatedAt():void 0,refreshStartedAt:g,queryUrl:j?null:c.getUrl(),hideTimestamp:S,apiKey:o})):(setTimeout(()=>{i(new Error(window.W_L.view_not_exist))},10),null)}function ZT(){return(ZT=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function eW(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function tW(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?eW(Object(a),!0).forEach((function(t){aW(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):eW(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function aW(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function rW(e){var t=e.querySnippet,a=e.dialog,o=e.readOnly,i=Object(r.useCallback)((e,r,n)=>{var o=Object(l.get)(t,"id");Object(l.isNil)(e.description)&&(e.description=""),a.close(o?tW({id:o},e):e).then(()=>r(window.W_L.save_success)).catch(()=>n(window.W_L.save_failed))},[a,t]),s=!!Object(l.get)(t,"id"),c=[{name:"trigger",title:window.W_L.code,type:"text",required:!0,autoFocus:!s},{name:"description",title:window.W_L.desc,type:"text"},{name:"snippet",title:window.W_L.query_code,type:"ace",required:!0}].map(e=>tW(tW({},e),{},{readOnly:o,initialValue:Object(l.get)(t,e.name,"")})),u=Se("querySnippetForm");return n.a.createElement(R.a,ZT({},a.props,{title:s?t.trigger:window.W_L.create_query,footer:[n.a.createElement(m.a,ZT({key:"cancel"},a.props.cancelButtonProps,{onClick:a.dismiss}),o?window.W_L.close:window.W_L.cancel),!o&&n.a.createElement(m.a,ZT({key:"submit"},a.props.okButtonProps,{disabled:o||a.props.okButtonProps.disabled,htmlType:"submit",type:"primary",form:u,"data-test":"SaveQuerySnippetButton"}),s?window.W_L.save:window.W_L.create)],wrapProps:{"data-test":"QuerySnippetDialog"}}),n.a.createElement(EP,{id:u,fields:c,onSubmit:i,hideSubmitButton:!0,feedbackIcons:!0}))}_f.register("Queries.View",ha({path:"/queries/:queryId",render:e=>n.a.createElement(QT,e)})),GT.propTypes={queryName:ae.a.string.isRequired,queryDescription:ae.a.string,visualization:Zr.isRequired},GT.defaultProps={queryDescription:""},JT.propTypes={query:ae.a.object.isRequired,queryResults:ae.a.object,updatedAt:ae.a.string,refreshStartedAt:Jf,queryUrl:ae.a.string,hideTimestamp:ae.a.bool,apiKey:ae.a.string},JT.defaultProps={queryResults:null,updatedAt:null,refreshStartedAt:null,queryUrl:null,hideTimestamp:!1,apiKey:null},XT.propTypes={queryId:ae.a.string.isRequired,visualizationId:ae.a.string,apiKey:ae.a.string.isRequired,onError:ae.a.func},XT.defaultProps={onError:()=>{}},_f.register("Visualizations.ViewShared",jx({path:"/embed/query/:queryId/visualization/:visualizationId",render:e=>n.a.createElement(XT,e),getApiKey:()=>A.search.api_key})),rW.propTypes={dialog:ja.isRequired,querySnippet:ae.a.object,readOnly:ae.a.bool},rW.defaultProps={querySnippet:null,readOnly:!1};var nW=Sa(rW);a(1616);function oW(){return(oW=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function iW(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var lW=e=>H.isAdmin||H.id===Object(l.get)(e,"user.id");class sW extends n.a.Component{constructor(){var e;super(...arguments),e=this,iW(this,"listColumns",[_g.custom.sortable((e,t)=>n.a.createElement(ge,{type:"link",className:"table-main-title",onClick:()=>this.showSnippetDialog(t)},t.trigger),{title:window.W_L.snippet_script,field:"trigger",className:"text-nowrap"}),_g.custom.sortable(e=>e,{title:window.W_L.desc,field:"description",className:"text-nowrap"}),_g.custom(e=>n.a.createElement("code",{className:"snippet-content"},e),{title:window.W_L.script,field:"snippet"}),_g.avatar({field:"user",className:"p-l-0 p-r-0"},e=>window.W_L.create_user+" ".concat(e)),_g.date.sortable({title:window.W_L.create_time,field:"created_at",className:"text-nowrap",width:"1%"}),_g.custom((e,t)=>lW(t)&&n.a.createElement(m.a,{type:"danger",className:"w-100",onClick:e=>this.deleteQuerySnippet(e,t)},window.W_L.delete),{width:"1%"})]),iW(this,"saveQuerySnippet",e=>(e.id?AN.save:AN.create)(e)),iW(this,"deleteQuerySnippet",(e,t)=>{R.a.confirm({title:window.W_L.delete_snippet_script,content:window.W_L.delete_snippet_script_confirm,okText:window.W_L.ok_text,okType:"danger",cancelText:window.W_L.cancel,onOk:()=>{AN.delete(t).then(()=>{uf.success(window.W_L.delete_snippet_script_success),this.props.controller.update()}).catch(()=>{uf.error(window.W_L.delete_snippet_script_failed)})}})}),iW(this,"showSnippetDialog",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=!t||lW(t);Ca("query_snippets/"+Object(l.get)(t,"id","new"),!0);var r=()=>Ca("query_snippets",!0);nW.showModal({querySnippet:t,readOnly:!a}).onClose(t=>e.saveQuerySnippet(t).then(()=>{e.props.controller.update(),r()})).onDismiss(r)}))}componentDidMount(){var e=this.props.controller.params,t=e.isNewOrEditPage,a=e.querySnippetId;t&&("new"===a?Z.isCreateQuerySnippetEnabled()?this.showSnippetDialog():Ca("query_snippets",!0):AN.get({id:a}).then(this.showSnippetDialog).catch(e=>{this.props.controller.handleError(e)}))}render(){var e=this.props.controller;return n.a.createElement("div",null,n.a.createElement("div",{className:"m-b-15"},n.a.createElement(m.a,{type:"primary",onClick:()=>this.showSnippetDialog(),disabled:!Z.isCreateQuerySnippetEnabled()},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.new_snippet_script)),!e.isLoaded&&n.a.createElement(kb,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement("div",{className:"text-center"},window.W_L.no_snippet_script,Z.isCreateQuerySnippetEnabled()&&n.a.createElement("div",{className:"m-t-5"},n.a.createElement(ge,{type:"link",onClick:()=>this.showSnippetDialog()},window.W_L.new_snippet_script)," ")),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive query-snippets-table"},n.a.createElement(Eg,{items:e.pageItems,columns:this.listColumns,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Fg,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))}}iW(sW,"propTypes",{controller:sb.isRequired});var cW=TP("QuerySnippets.List",{permission:"create_query",title:window.W_L.snippet_script,path:"query_snippets",order:5},cb(sW,()=>new jb({isPlainList:!0,getRequest:()=>({}),getResource:()=>AN.query.bind(AN)}),()=>new xb({orderByField:"trigger",itemsPerPage:10})));_f.register("QuerySnippets.List",ha({path:"/query_snippets",title:window.W_L.snippet_script,render:e=>n.a.createElement(cW,oW({},e,{currentPage:"query_snippets"}))})),_f.register("QuerySnippets.NewOrEdit",ha({path:"/query_snippets/:querySnippetId",title:window.W_L.snippet_script,render:e=>n.a.createElement(cW,oW({},e,{currentPage:"query_snippets",isNewOrEditPage:!0}))}));a(1617);function uW(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function dW(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?uW(Object(a),!0).forEach((function(t){mW(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):uW(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function mW(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function pW(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return fW(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return fW(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fW(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function gW(e){var t=e.onError,a=pW(Object(r.useState)({}),2),n=a[0],o=a[1],i=pW(Object(r.useState)({}),2),s=i[0],c=i[1],u=pW(Object(r.useState)(!0),2),d=u[0],m=u[1],p=pW(Object(r.useState)(!1),2),f=p[0],g=p[1],b=bw(t);Object(r.useEffect)(()=>{La("view","page","org_settings");var e=!1;return df().then(t=>{if(!e){var a=Object(l.get)(t,"settings");o(a),c(dW({},a)),m(!1)}}).catch(t=>{e||b(t)}),()=>{e=!0}},[b]);var h=Object(r.useCallback)(e=>{c(t=>dW(dW({},t),e))},[]),y=Object(r.useCallback)(()=>{f||(g(!0),mf(s).then(e=>{var t,a=Object(l.get)(e,"settings");o(a),c(dW({},a)),t={dateFormat:s.date_format,timeFormat:s.time_format,dateTimeFormat:"".concat(s.date_format," ").concat(s.time_format)},Object(l.extend)(Y,t)}).catch(b).finally(()=>g(!1)))},[f,s,b]);return{settings:n,currentValues:s,isLoading:d,isSaving:f,handleSubmit:y,handleChange:h}}var bW={settings:ae.a.object,values:ae.a.object,onChange:ae.a.func,loading:ae.a.bool},hW={settings:{},values:{},onChange:()=>{},loading:!1};function yW(){return(yW=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function vW(e){var t=e.values,a=e.onChange,r=e.loading;return n.a.createElement(se,yW({name:"OrganizationSettings.FormatSettings"},e),n.a.createElement(ih.a.Item,{label:window.W_L.date_format},r?n.a.createElement(Mf.a.Input,{style:{width:300},active:!0}):n.a.createElement(dn.a,{value:t.date_format,onChange:e=>a({date_format:e}),"data-test":"DateFormatSelect"},Y.dateFormatList.map(e=>n.a.createElement(dn.a.Option,{key:e,"data-test":"DateFormatSelect:".concat(e)},e)))),n.a.createElement(ih.a.Item,{label:window.W_L.time_format},r?n.a.createElement(Mf.a.Input,{style:{width:300},active:!0}):n.a.createElement(dn.a,{value:t.time_format,onChange:e=>a({time_format:e}),"data-test":"TimeFormatSelect"},Y.timeFormatList.map(e=>n.a.createElement(dn.a.Option,{key:e},e)))))}function wW(){return(wW=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function OW(e){var t=e.values,a=e.onChange,r=e.loading;return n.a.createElement(se,wW({name:"OrganizationSettings.PlotlySettings"},e),n.a.createElement(ih.a.Item,{label:window.W_L.hidden_tool_bar+"(Chart)"},r?n.a.createElement(Mf.a,{title:{width:300},paragraph:!1,active:!0}):n.a.createElement(gn.a,{name:"hide_plotly_mode_bar",checked:t.hide_plotly_mode_bar,onChange:e=>a({hide_plotly_mode_bar:e.target.checked})},window.W_L.hidden_tool_bar)))}vW.propTypes=bW,vW.defaultProps=hW,OW.propTypes=bW,OW.defaultProps=hW;var _W=a(211),EW=a.n(_W);function jW(){return(jW=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function SW(e){var t=e.values,a=e.onChange,r=e.loading;return n.a.createElement(se,jW({name:"OrganizationSettings.FeatureFlagsSettings"},e),n.a.createElement(ih.a.Item,{label:window.W_L.feature_flags},r?n.a.createElement(n.a.Fragment,null,n.a.createElement(EW.a,null,n.a.createElement(Mf.a,{title:!1,paragraph:{width:[300,300,300],rows:3},active:!0}))):n.a.createElement(n.a.Fragment,null,n.a.createElement(se,jW({name:"OrganizationSettings.FeatureFlagsSettings.PermissionsControl"},e),n.a.createElement(EW.a,null,n.a.createElement(gn.a,{name:"feature_show_permissions_control",checked:t.feature_show_permissions_control,onChange:e=>a({feature_show_permissions_control:e.target.checked})},window.W_L.enable_multiple_owners_tip))),n.a.createElement(EW.a,null,n.a.createElement(gn.a,{name:"send_email_on_failed_scheduled_queries",checked:t.send_email_on_failed_scheduled_queries,onChange:e=>a({send_email_on_failed_scheduled_queries:e.target.checked})},window.W_L.when_query_error_info_by_email)),n.a.createElement(EW.a,null,n.a.createElement(gn.a,{name:"multi_byte_search_enabled",checked:t.multi_byte_search_enabled,onChange:e=>a({multi_byte_search_enabled:e.target.checked})},window.W_L.dashboard_language_tip)))))}function CW(){return(CW=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function xW(e){var t=e.values,a=e.onChange,r=e.loading;return n.a.createElement(se,CW({name:"OrganizationSettings.BeaconConsentSettings"},e),n.a.createElement(ih.a.Item,{label:n.a.createElement("span",null,window.W_L.help_share_anonymous_data,n.a.createElement($e,{className:"m-l-5 m-r-5",type:"USAGE_DATA_SHARING"}))},r?n.a.createElement(Mf.a,{title:{width:300},paragraph:!1,active:!0}):n.a.createElement(gn.a,{name:"beacon_consent",checked:t.beacon_consent,onChange:e=>a({beacon_consent:e.target.checked})},window.W_L.help_redash_improve_tip)))}function PW(){return(PW=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function LW(e){return n.a.createElement(se,PW({name:"OrganizationSettings.GeneralSettings"},e),n.a.createElement("h3",{className:"m-t-0"},window.W_L.params),n.a.createElement("hr",null),n.a.createElement(vW,e),n.a.createElement(OW,e),n.a.createElement(SW,e),n.a.createElement(xW,e))}function kW(){return(kW=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function NW(e){var t=e.settings,a=e.values,r=e.onChange,o=e.loading,i=!Y.googleLoginEnabled&&!Y.ldapLoginEnabled&&!a.auth_saml_enabled;return n.a.createElement(se,kW({name:"OrganizationSettings.PasswordLoginSettings"},e),!o&&!t.auth_password_login_enabled&&n.a.createElement(u.a,{message:window.W_L.disable_password_tip,type:"warning",className:"m-t-15 m-b-15"}),n.a.createElement(ih.a.Item,{label:window.W_L.password_login},o?n.a.createElement(Mf.a,{title:{width:300},paragraph:!1,active:!0}):n.a.createElement(gn.a,{checked:a.auth_password_login_enabled,disabled:i,onChange:e=>r({auth_password_login_enabled:e.target.checked})},n.a.createElement(we,{title:i?window.W_L.enable_password_login_tip:null,placement:"right"},window.W_L.enable_password))))}function AW(){return(AW=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function TW(e){var t=e.values,a=e.onChange;return Y.googleLoginEnabled?n.a.createElement(se,AW({name:"OrganizationSettings.GoogleLoginSettings"},e),n.a.createElement("h4",null,window.W_L.google_login),n.a.createElement(ih.a.Item,{label:"{window.W_L.allow} Google Apps Domains"},n.a.createElement(dn.a,{mode:"tags",value:t.auth_google_apps_domains,onChange:e=>a({auth_google_apps_domains:e})}),!Object(l.isEmpty)(t.auth_google_apps_domains)&&n.a.createElement(u.a,{message:n.a.createElement("p",null,window.W_L.google_login_tip,n.a.createElement("strong",null,Object(l.join)(t.auth_google_apps_domains,", ")),window.W_L.google_login_auto_reg),className:"m-t-15"}))):null}function WW(){return(WW=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function IW(e){var t=e.values,a=e.onChange,r=e.loading;return n.a.createElement(se,WW({name:"OrganizationSettings.SAMLSettings"},e),n.a.createElement("h4",null,"SAML"),n.a.createElement(ih.a.Item,{label:window.W_L.enable_saml},r?n.a.createElement(Mf.a,{title:{width:300},paragraph:!1,active:!0}):n.a.createElement(Kn.a.Group,{onChange:e=>{var t={auth_saml_enabled:!!e.target.value};e.target.value&&(t.auth_saml_type=e.target.value),a(t)},value:t.auth_saml_enabled&&(t.auth_saml_type||"dynamic")},n.a.createElement(Kn.a,{value:!1},window.W_L.disable),n.a.createElement(Kn.a,{value:"static"},window.W_L.enable,"(",window.W_L.static,")"),n.a.createElement(Kn.a,{value:"dynamic"},window.W_L.enable,"(",window.W_L.dynamic,")"))),t.auth_saml_enabled&&n.a.createElement(n.a.Fragment,null,"static"===t.auth_saml_type&&n.a.createElement(n.a.Fragment,null,n.a.createElement(ih.a.Item,{label:"SAML Single Sign-on URL"},n.a.createElement(va.a,{value:t.auth_saml_sso_url,onChange:e=>a({auth_saml_sso_url:e.target.value})})),n.a.createElement(ih.a.Item,{label:"SAML Entity ID"},n.a.createElement(va.a,{value:t.auth_saml_entity_id,onChange:e=>a({auth_saml_entity_id:e.target.value})})),n.a.createElement(ih.a.Item,{label:"SAML x509 cert"},n.a.createElement(va.a,{value:t.auth_saml_x509_cert,onChange:e=>a({auth_saml_x509_cert:e.target.value})}))),"dynamic"===t.auth_saml_type&&n.a.createElement(n.a.Fragment,null,n.a.createElement(ih.a.Item,{label:"SAML Metadata URL"},n.a.createElement(va.a,{value:t.auth_saml_metadata_url,onChange:e=>a({auth_saml_metadata_url:e.target.value})})),n.a.createElement(ih.a.Item,{label:"SAML Entity ID"},n.a.createElement(va.a,{value:t.auth_saml_entity_id,onChange:e=>a({auth_saml_entity_id:e.target.value})})),n.a.createElement(ih.a.Item,{label:"SAML NameID Format"},n.a.createElement(va.a,{value:t.auth_saml_nameid_format,onChange:e=>a({auth_saml_nameid_format:e.target.value})})))))}function qW(){return(qW=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function DW(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function RW(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?DW(Object(a),!0).forEach((function(t){MW(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):DW(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function MW(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function zW(e){var t=e.values,a=e.onChange,o=Object(r.useCallback)(e=>{var r=RW(RW({},t),e);!Y.googleLoginEnabled&&!Y.ldapLoginEnabled&&!r.auth_saml_enabled&&(e=RW(RW({},e),{},{auth_password_login_enabled:!0})),a(e)},[t,a]);return n.a.createElement(se,qW({name:"OrganizationSettings.AuthSettings"},e),n.a.createElement("h3",{className:"m-t-0"},window.W_L.authentication," ",n.a.createElement($e,{type:"AUTHENTICATION_OPTIONS"})),n.a.createElement("hr",null),n.a.createElement(NW,qW({},e,{onChange:o})),n.a.createElement(TW,qW({},e,{onChange:o})),n.a.createElement(IW,qW({},e,{onChange:o})))}function FW(){return(FW=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function VW(e){var t=gW(e.onError),a=t.settings,r=t.currentValues,o=t.isLoading,i=t.isSaving,l=t.handleSubmit,s=t.handleChange;return n.a.createElement("div",{className:"row","data-test":"OrganizationSettings"},n.a.createElement("div",{className:"m-r-20 m-l-20"},n.a.createElement(ih.a,FW({},{labelCol:{xs:{span:24},sm:{span:6},lg:{span:4}},wrapperCol:{xs:{span:24},sm:{span:12},lg:{span:10}},layout:"horizontal",className:"ant-form-horizontal--labels-left"},{onFinish:l}),n.a.createElement(LW,{loading:o,settings:a,values:r,onChange:s}),n.a.createElement(zW,{loading:o,settings:a,values:r,onChange:s}),n.a.createElement(ih.a.Item,{wrapperCol:{xs:{span:24},sm:{span:12,offset:6},lg:{span:12,offset:4}}},o?n.a.createElement(Mf.a.Button,{active:!0}):n.a.createElement(m.a,{type:"primary",htmlType:"submit",loading:i,"data-test":"OrganizationSettingsSaveButton"},window.W_L.save)))))}SW.propTypes=bW,SW.defaultProps=hW,xW.propTypes=bW,xW.defaultProps=hW,NW.propTypes=bW,NW.defaultProps=hW,TW.propTypes=bW,TW.defaultProps=hW,IW.propTypes=bW,IW.defaultProps=hW,zW.propTypes=bW,zW.defaultProps=hW,VW.propTypes={onError:ae.a.func},VW.defaultProps={onError:()=>{}};var UW=TP("Settings.Organization",{permission:"admin",title:window.W_L.sys_setting,path:"settings/general",order:6},VW);function BW(e){var t=new URL(e,window.location);return t.protocol=window.location.protocol,t.host=window.location.host,t.toString()}function HW(){return(HW=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function YW(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return QW(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return QW(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function QW(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}_f.register("Settings.Organization",ha({path:"/settings/general",title:window.W_L.sys_setting,render:e=>n.a.createElement(UW,e)}));var KW=[{required:!0,name:"name",title:window.W_L.user_name,type:"text",autoFocus:!0},{required:!0,name:"email",title:"Email",type:"email"}];function $W(e){var t=e.dialog,a=YW(Object(r.useState)(null),2),o=a[0],i=a[1];Object(r.useEffect)(()=>{La("view","page","users/new")},[]);var l=Object(r.useCallback)(e=>t.close(e).catch(i),[t]),s=Se("userForm");return n.a.createElement(R.a,HW({},t.props,{title:window.W_L.create_user,footer:[n.a.createElement(m.a,HW({key:"cancel"},t.props.cancelButtonProps,{onClick:t.dismiss}),window.W_L.cancel),n.a.createElement(m.a,HW({key:"submit"},t.props.okButtonProps,{htmlType:"submit",type:"primary",form:s,"data-test":"SaveUserButton"}),window.W_L.create)],wrapProps:{"data-test":"CreateUserDialog"}}),n.a.createElement(EP,{id:s,fields:KW,onSubmit:l,hideSubmitButton:!0}),o&&n.a.createElement(u.a,{message:o.message,type:"error",showIcon:!0,"data-test":"CreateUserErrorAlert"}))}$W.propTypes={dialog:ja.isRequired};var GW=Sa($W);function JW(){return(JW=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function XW(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ZW(e){var t=e.user,a=e.enableUser,r=e.disableUser,o=e.deleteUser;return t.id===H.id?null:t.is_invitation_pending?n.a.createElement(m.a,{type:"danger",className:"w-100",onClick:e=>o(e,t)},window.W_L.delete):t.is_disabled?n.a.createElement(m.a,{type:"primary",className:"w-100",onClick:e=>a(e,t)},window.W_L.enable):n.a.createElement(m.a,{className:"w-100",onClick:e=>r(e,t)},window.W_L.disable)}ZW.propTypes={user:ae.a.shape({id:ae.a.number,is_invitation_pending:ae.a.bool,is_disabled:ae.a.bool}).isRequired,enableUser:ae.a.func.isRequired,disableUser:ae.a.func.isRequired,deleteUser:ae.a.func.isRequired};class eI extends n.a.Component{constructor(){super(...arguments),XW(this,"sidebarMenu",[{key:"active",href:"users",title:window.W_L.enable_user},{key:"pending",href:"users/pending",title:window.W_L.invite_user},{key:"disabled",href:"users/disabled",title:window.W_L.disable_user,isAvailable:()=>Z.canCreateUser()}]),XW(this,"listColumns",[_g.custom.sortable((e,t)=>n.a.createElement(EE,{user:t,withLink:!0}),{title:window.W_L.account,field:"name",width:null}),_g.custom.sortable((e,t)=>Object(l.map)(t.groups,e=>n.a.createElement(h,{key:"group"+e.id,className:"label label-tag",href:"groups/"+e.id},e.name)),{title:window.W_L.role,field:"groups"}),_g.timeAgo.sortable({title:window.W_L.create_time,field:"created_at",className:"text-nowrap",width:"1%"}),_g.timeAgo.sortable({title:window.W_L.active_time,field:"active_at",className:"text-nowrap",width:"1%"}),_g.custom((e,t)=>n.a.createElement(ZW,{user:t,enableUser:this.enableUser,disableUser:this.disableUser,deleteUser:this.deleteUser}),{width:"1%",isAvailable:()=>Z.canCreateUser()})]),XW(this,"createUser",e=>xE.create(e).then(e=>{uf.success(window.W_L.save_seccess),e.invite_link&&R.a.warning({title:window.W_L.email_send_error,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,content:n.a.createElement(n.a.Fragment,null,n.a.createElement("p",null,window.W_L.email_not_setting,n.a.createElement("b",null,e.name),":"),n.a.createElement(ME,{value:BW(e.invite_link),"aria-label":"Invite link",readOnly:!0}))})}).catch(e=>{var t=Object(l.find)([Object(l.get)(e,"response.data.message"),Object(l.get)(e,"message"),window.W_L.save_failed],l.isString);return Promise.reject(new Error(t))})),XW(this,"showCreateUserDialog",()=>{if(Z.isCreateUserEnabled()){var e=()=>{this.props.controller.params.isNewUserPage&&Ca("users")};GW.showModal().onClose(t=>this.createUser(t).then(()=>{this.props.controller.update(),e()})).onDismiss(e)}}),XW(this,"enableUser",(e,t)=>xE.enableUser(t).then(()=>this.props.controller.update())),XW(this,"disableUser",(e,t)=>xE.disableUser(t).then(()=>this.props.controller.update())),XW(this,"deleteUser",(e,t)=>xE.deleteUser(t).then(()=>this.props.controller.update()))}componentDidMount(){this.props.controller.params.isNewUserPage&&this.showCreateUserDialog()}renderPageHeader(){return Z.canCreateUser()?n.a.createElement("div",{className:"m-b-15"},n.a.createElement(m.a,{type:"primary",disabled:!Z.isCreateUserEnabled(),onClick:this.showCreateUserDialog},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),window.W_L.create_user),n.a.createElement(se,{name:"UsersListExtra"})):null}render(){var e=this.props.controller;return n.a.createElement(n.a.Fragment,null,this.renderPageHeader(),n.a.createElement(qC,null,n.a.createElement(qC.Sidebar,{className:"m-b-0"},n.a.createElement(ex,{value:e.searchTerm,onChange:e.updateSearch,label:"Search users"}),n.a.createElement(tx,{items:this.sidebarMenu,selected:e.params.currentPage})),n.a.createElement(qC.Content,null,!e.isLoaded&&n.a.createElement(kb,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement(LC,{className:""}),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive","data-test":"UserList"},n.a.createElement(Eg,{items:e.pageItems,columns:this.listColumns,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Fg,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))))}}XW(eI,"propTypes",{controller:sb.isRequired});var tI=TP("Users.List",{permission:"list_users",title:window.W_L.account,path:"users",isActive:e=>e.startsWith("/users")&&"/users/me"!==e,order:2},cb(eI,()=>new jb({getRequest(e,t){switch(t.params.currentPage){case"active":e.pending=!1;break;case"pending":e.pending=!0;break;case"disabled":e.disabled=!0}return e},getResource:()=>xE.query.bind(xE)}),()=>new Pb({orderByField:"created_at",orderByReverse:!0})));_f.register("Users.New",ha({path:"/users/new",title:window.W_L.account,render:e=>n.a.createElement(tI,JW({},e,{currentPage:"active",isNewUserPage:!0}))})),_f.register("Users.List",ha({path:"/users",title:window.W_L.enable_user,render:e=>n.a.createElement(tI,JW({},e,{currentPage:"active"}))})),_f.register("Users.Pending",ha({path:"/users/pending",title:window.W_L.invite_user,render:e=>n.a.createElement(tI,JW({},e,{currentPage:"pending"}))})),_f.register("Users.Disabled",ha({path:"/users/disabled",title:window.W_L.disable_user,render:e=>n.a.createElement(tI,JW({},e,{currentPage:"disabled"}))}));a(1618);function aI(){return(aI=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function rI(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function nI(e){var t=e.groups,a=e.linkGroups,r=rI(e,["groups","linkGroups"]);return n.a.createElement("div",aI({className:"user-groups"},r),Object(l.map)(t,e=>n.a.createElement(t_.a,{key:e.id},a?n.a.createElement(h,{href:"groups/".concat(e.id)},e.name):e.name)))}function oI(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return iI(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return iI(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function iI(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function lI(e){var t=oI(Object(r.useState)([]),2),a=t[0],n=t[1],o=oI(Object(r.useState)(!0),2),i=o[0],s=o[1],c=Object(r.useMemo)(()=>Object(l.filter)(a,t=>Object(l.includes)(e.groupIds,t.id)),[a,e]);return Object(r.useEffect)(()=>{XP.query().then(e=>{n(Object(l.isArray)(e)?e:[]),s(!1)})},[]),Object(r.useMemo)(()=>({groups:c,allGroups:a,isLoading:i}),[c,a,i])}function sI(){return(sI=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function cI(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function uI(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?cI(Object(a),!0).forEach((function(t){dI(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):cI(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function dI(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function mI(e){var t=e.user,a=e.onChange,o=lI(t),i=o.groups,s=o.allGroups,c=o.isLoading,u=bw(a),d=Object(r.useCallback)((e,a,r)=>{var n=uI(uI({},e),{},{id:t.id});xE.save(n).then(e=>{a(window.W_L.save_success),u(xE.convertUserInfo(e))}).catch(e=>{r(Object(l.get)(e,"response.data.message","Failed saving."))})},[t,u]),m=Object(r.useMemo)(()=>Object(l.map)([{name:"name",title:window.W_L.name,type:"text",initialValue:t.name},{name:"email",title:window.W_L.email,type:"email",initialValue:t.email},t.isDisabled||H.id===t.id?{name:"group_ids",title:window.W_L.role,type:"content",required:!1,content:c?window.W_L.loading:n.a.createElement(nI,{"data-test":"Groups",groups:i})}:{name:"group_ids",title:window.W_L.role,type:"select",mode:"multiple",options:Object(l.map)(s,e=>({name:e.name,value:e.id})),initialValue:t.groupIds,loading:c,placeholder:c?window.W_L.loading:""}],e=>uI({readOnly:t.isDisabled,required:!0},e)),[t,i,s,c]);return n.a.createElement(se,sI({name:"UserProfile.UserInfoForm"},e),n.a.createElement(EP,{fields:m,onSubmit:d,hideSubmitButton:t.isDisabled}))}function pI(){return(pI=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function fI(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function gI(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?fI(Object(a),!0).forEach((function(t){bI(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):fI(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function bI(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function hI(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return yI(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return yI(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yI(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function vI(e){var t=e.user,a=e.onChange,o=hI(Object(r.useState)(!1),2),i=o[0],l=o[1],s=bw(a),c=Se("apiKey"),u=Object(r.useCallback)(()=>{R.a.confirm({title:window.W_L.re_generate_api_key,content:window.W_L.re_generate_api_key_confirm,okText:window.W_L.ok_text,cancelText:window.W_L.cancel,onOk:()=>{l(!0),xE.regenerateApiKey(t).then(e=>{e&&s(gI(gI({},t),{},{apiKey:e}))}).finally(()=>{l(!1)})},maskClosable:!0,autoFocusButton:null})},[t,s]);return n.a.createElement(se,pI({name:"UserProfile.ApiKeyForm"},e),n.a.createElement(ih.a,{layout:"vertical"},n.a.createElement("hr",null),n.a.createElement(ih.a.Item,{label:"API Key",className:"m-b-10"},n.a.createElement(ME,{id:c,className:"hide-in-percy",value:t.apiKey,"data-test":"ApiKey",readOnly:!0})),n.a.createElement(m.a,{className:"w-100",onClick:u,loading:i,"data-test":"RegenerateApiKey"},window.W_L.re_generate_api_key)))}function wI(){return(wI=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function OI(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function _I(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?OI(Object(a),!0).forEach((function(t){EI(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):OI(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function EI(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}nI.propTypes={groups:ae.a.arrayOf(ae.a.shape({id:ae.a.oneOfType([ae.a.number,ae.a.string]).isRequired,name:ae.a.string})),linkGroups:ae.a.bool},nI.defaultProps={groups:[],linkGroups:!0},mI.propTypes={user:Hf.isRequired,onChange:ae.a.func},mI.defaultProps={onChange:()=>{}},vI.propTypes={user:Hf.isRequired,onChange:ae.a.func},vI.defaultProps={onChange:()=>{}};class jI extends n.a.Component{constructor(e){super(e),EI(this,"fieldError",(e,t)=>0===t.length?window.W_L.required:"currentPassword"!==e&&t.length<6?window.W_L.too_short:"repeatPassword"===e&&t!==this.state.newPassword.value?window.W_L.do_not_match:null),EI(this,"validateFields",e=>{var t=this.state,a=t.currentPassword,r=t.newPassword,n=t.repeatPassword,o={currentPassword:this.fieldError("currentPassword",a.value),newPassword:this.fieldError("newPassword",r.value),repeatPassword:this.fieldError("repeatPassword",n.value)};this.setState({currentPassword:_I(_I({},a),{},{error:o.currentPassword}),newPassword:_I(_I({},r),{},{error:o.newPassword}),repeatPassword:_I(_I({},n),{},{error:o.repeatPassword})}),Object(l.isFunction)(e)&&e(o.currentPassword||o.newPassword||o.repeatPassword?o:null)}),EI(this,"updatePassword",()=>{var e=this.state,t=e.currentPassword,a=e.newPassword;e.updatingPassword||this.validateFields(e=>{if(e)this.setState(e=>({currentPassword:_I(_I({},e.currentPassword),{},{touched:!0}),newPassword:_I(_I({},e.newPassword),{},{touched:!0}),repeatPassword:_I(_I({},e.repeatPassword),{},{touched:!0})}));else{var r={id:this.props.user.id,old_password:t.value,password:a.value};this.setState({updatingPassword:!0}),xE.save(r).then(()=>{uf.success(window.W_L.save_success),this.props.dialog.close({success:!0})}).catch(e=>{uf.error(Object(l.get)(e,"response.data.message",window.W_L.save_failed)),this.setState({updatingPassword:!1})})}})}),EI(this,"handleChange",e=>{var t=e.target,a=t.name,r=t.value,n=this.state[a].error;this.setState({[a]:{value:r,error:n,touched:!0}},()=>{this.validateFields()})}),this.state={currentPassword:{value:"",error:null,touched:!1},newPassword:{value:"",error:null,touched:!1},repeatPassword:{value:"",error:null,touched:!1},updatingPassword:!1}}render(){var e=this.props.dialog,t=this.state,a=t.currentPassword,r=t.newPassword,o=t.repeatPassword,i=t.updatingPassword,l={className:"m-b-10",required:!0},s={onChange:this.handleChange,onPressEnter:this.updatePassword};return n.a.createElement(R.a,wI({},e.props,{okButtonProps:{loading:i},onOk:this.updatePassword,title:window.W_L.change_password,okText:window.W_L.ok_text,cancelText:window.W_L.cancel}),n.a.createElement(ih.a,{layout:"vertical"},n.a.createElement(ih.a.Item,wI({},l,{validateStatus:a.touched&&a.error?"error":null,help:a.touched?a.error:null,label:window.W_L.current_password}),n.a.createElement(va.a.Password,wI({},s,{name:"currentPassword","data-test":"CurrentPassword",autoFocus:!0}))),n.a.createElement(ih.a.Item,wI({},l,{validateStatus:r.touched&&r.error?"error":null,help:r.touched?r.error:null,label:window.W_L.new_password}),n.a.createElement(va.a.Password,wI({},s,{name:"newPassword","data-test":"NewPassword"}))),n.a.createElement(ih.a.Item,wI({},l,{validateStatus:o.touched&&o.error?"error":null,help:o.touched?o.error:null,label:window.W_L.repeat_password}),n.a.createElement(va.a.Password,wI({},s,{name:"repeatPassword","data-test":"RepeatPassword"})))))}}EI(jI,"propTypes",{user:Hf.isRequired,dialog:ja.isRequired});var SI=Sa(jI);function CI(){return(CI=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function xI(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function PI(e){var t=e.user,a=e.passwordLink,r=xI(e,["user","passwordLink"]);return Object(l.isString)(a)?n.a.createElement(se,CI({name:"UserProfile.PasswordLinkAlert"},e),n.a.createElement(u.a,CI({message:window.W_L.email_send_error,description:n.a.createElement(n.a.Fragment,null,n.a.createElement("p",null,window.W_L.email_not_setting,n.a.createElement("b",null,t.name),":"),n.a.createElement(ME,{value:BW(a),"aria-label":"Password link",readOnly:!0})),type:"warning",className:"m-t-20",closable:!0},r))):null}function LI(){return(LI=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function kI(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return NI(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return NI(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function NI(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function AI(e){var t=e.user,a=kI(Object(r.useState)(!1),2),o=a[0],i=a[1],l=kI(Object(r.useState)(null),2),s=l[0],c=l[1],u=Object(r.useCallback)(()=>{i(!0),xE.sendPasswordReset(t).then(e=>{c(e)}).finally(()=>{i(!1)})},[t]);return n.a.createElement(se,LI({name:"UserProfile.PasswordResetForm"},e),n.a.createElement(m.a,{className:"w-100 m-t-10",onClick:u,loading:o},window.W_L.email_reset_password_send),n.a.createElement(PI,{user:t,passwordLink:s,afterClose:()=>c(null)}))}function TI(){return(TI=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function WI(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return II(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return II(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function II(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function qI(e){var t=e.user,a=WI(Object(r.useState)(!1),2),o=a[0],i=a[1],l=WI(Object(r.useState)(null),2),s=l[0],c=l[1],u=Object(r.useCallback)(()=>{i(!0),xE.resendInvitation(t).then(e=>{c(e)}).finally(()=>{i(!1)})},[t]);return n.a.createElement(se,TI({name:"UserProfile.ResendInvitationForm"},e),n.a.createElement(m.a,{className:"w-100 m-t-10",onClick:u,loading:o},window.W_L.email_re_send_invite),n.a.createElement(PI,{user:t,passwordLink:s,afterClose:()=>c(null)}))}function DI(){return(DI=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function RI(e){var t=e.user,a=Object(r.useCallback)(()=>{SI.showModal({user:t})},[t]);return n.a.createElement(se,DI({name:"UserProfile.PasswordForm"},e),n.a.createElement("h5",null,window.W_L.password),t.id===H.id&&n.a.createElement(m.a,{className:"w-100 m-t-10",onClick:a,"data-test":"ChangePassword"},window.W_L.change_password),t.id!==H.id&&H.isAdmin&&n.a.createElement(n.a.Fragment,null,t.isInvitationPending?n.a.createElement(qI,{user:t}):n.a.createElement(AI,{user:t})))}function MI(){return(MI=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function zI(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return FI(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return FI(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function FI(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function VI(e){var t=e.user,a=e.onChange,o=zI(Object(r.useState)(!1),2),i=o[0],l=o[1],s=bw(a),c=Object(r.useCallback)(()=>{var e=t.isDisabled?xE.enableUser:xE.disableUser;l(!0),e(t).then(e=>{e&&s(xE.convertUserInfo(e))}).finally(()=>{l(!1)})},[t,s]);if(!H.isAdmin||t.id===H.id)return null;var u={type:t.isDisabled?"primary":"danger",children:t.isDisabled?window.W_L.enable_user:window.W_L.disable_user};return n.a.createElement(se,{name:"UserProfile.ToggleUserForm"},n.a.createElement(m.a,MI({className:"w-100 m-t-10",onClick:c,loading:i},u)))}function UI(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return BI(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return BI(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function BI(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function HI(e){var t=UI(Object(r.useState)(e.user),2),a=t[0],o=t[1];return Object(r.useEffect)(()=>{o(e.user)},[e.user]),n.a.createElement("div",{className:"col-md-4 col-md-offset-4"},n.a.createElement("img",{alt:"Profile",src:a.profileImageUrl,className:"profile__image",width:"40"}),n.a.createElement("h3",{className:"profile__h3"},a.name),n.a.createElement("hr",null),n.a.createElement(mI,{user:a,onChange:o}),!a.isDisabled&&n.a.createElement(n.a.Fragment,null,n.a.createElement(vI,{user:a,onChange:o}),n.a.createElement("hr",null),n.a.createElement(RI,{user:a})),n.a.createElement("hr",null),n.a.createElement(VI,{user:a,onChange:o}))}function YI(e){var t=e.user,a=lI(t),r=a.groups,o=a.isLoading;return n.a.createElement("div",{className:"col-md-4 col-md-offset-4 profile__container"},n.a.createElement("img",{alt:"profile",src:t.profileImageUrl,className:"profile__image",width:"40"}),n.a.createElement("h3",{className:"profile__h3"},t.name),n.a.createElement("hr",null),n.a.createElement("dl",{className:"profile__dl"},n.a.createElement("dt",null,window.W_L.name,"："),n.a.createElement("dd",null,t.name),n.a.createElement("dt",null,window.W_L.email,"："),n.a.createElement("dd",null,t.email),n.a.createElement("dt",{className:"m-b-5"},window.W_L.role,"："),n.a.createElement("dd",null,o?window.W_L.loading:n.a.createElement(nI,{groups:r}))))}PI.propTypes={user:Hf.isRequired,passwordLink:ae.a.string},PI.defaultProps={passwordLink:null},AI.propTypes={user:Hf.isRequired},qI.propTypes={user:Hf.isRequired},RI.propTypes={user:Hf.isRequired},VI.propTypes={user:Hf.isRequired,onChange:ae.a.func},VI.defaultProps={onChange:()=>{}},HI.propTypes={user:Hf.isRequired},YI.propTypes={user:Hf.isRequired};a(1619);function QI(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return KI(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return KI(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function KI(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function $I(e){var t=e.userId,a=e.onError,o=QI(Object(r.useState)(null),2),i=o[0],l=o[1],s=bw(a);Object(r.useEffect)(()=>{var e=!1;return xE.get({id:t||H.id}).then(t=>{e||l(xE.convertUserInfo(t))}).catch(t=>{e||s(t)}),()=>{e=!0}},[t,s]);var c=i&&(H.isAdmin||H.id===i.id);return n.a.createElement(n.a.Fragment,null,n.a.createElement(Hh,{featureName:window.W_L.invite_email,className:"m-b-20",adminOnly:!0}),n.a.createElement("div",{className:"row"},!i&&n.a.createElement(kb,{className:""}),i&&n.a.createElement(se,{name:"UserProfile",user:i},!c&&n.a.createElement(YI,{user:i}),c&&n.a.createElement(HI,{user:i}))))}$I.propTypes={userId:ae.a.string,onError:ae.a.func},$I.defaultProps={userId:null,onError:()=>{}};var GI=TP("Users.Account",{title:window.W_L.personal_setting,path:"users/me",order:7},$I);_f.register("Users.Account",ha({path:"/users/me",title:window.W_L.personal_setting,render:e=>n.a.createElement(GI,e)})),_f.register("Users.ViewOrEdit",ha({path:"/users/:userId",title:window.W_L.account,render:e=>n.a.createElement(GI,e)}));var JI=a(428),XI=a.n(JI),ZI=a(244),eq=a.n(ZI);function tq(){return(tq=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var aq=e=>{var t=e.excelList,a=e.delList;function r(e){var t=e.item,r=e.keySuffix,o={key:"card".concat(r),className:"visual-card",children:n.a.createElement("div",{style:{display:"flex",alignItems:"center",position:"relative",height:"100%",width:"100%"}},n.a.createElement("div",{style:{position:"absolute",right:"0",top:"-10px",fontSize:"16px",color:"#999898"},onClick:()=>(e=>{a(e)})(t)}," ",n.a.createElement(eq.a,null)),n.a.createElement("img",{alt:t.source_name,src:XI.a}),n.a.createElement("h3",null,t.source_name))};return n.a.createElement(ge,tq({type:"link"},o))}return n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-lg-12 d-inline-flex flex-wrap visual-card-list"},t.map((e,t)=>n.a.createElement(r,{key:t,item:e,keySuffix:t.toString()}))))};a(1620);function rq(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return nq(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return nq(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nq(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var oq=()=>{var e=rq(Object(r.useState)([]),2),t=e[0],a=e[1],o=rq(Object(r.useState)(!1),2),i=o[0],l=o[1],s=()=>{var e,t;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,regeneratorRuntime.awrap(B.get("api/upload"));case 2:e=r.sent,t=e.data,a(t);case 5:case"end":return r.stop()}}),null,null,null,Promise)};Object(r.useEffect)(()=>{s()},[]);var c={name:"file",accept:".csv,.xlsx,.xls",customRequest:e=>{l(!0);var t=new FormData;t.append("file",e.file),B.post("/api/upload",t).then(t=>{e.onSuccess(),l(!1),s()}).catch(t=>{e.onError(),l(!1)})},onChange(e){}};return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"row1"},!t&&n.a.createElement(kb,{className:""}),t&&n.a.createElement(n.a.Fragment,null,n.a.createElement(Yx.a,c,n.a.createElement(m.a,{type:"primary",disabled:i}," ",n.a.createElement(Kx.a,null),window.W_L.upload)),n.a.createElement(aq,{excelList:t,delList:e=>regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(B.delete("api/upload/".concat(e.id)));case 2:s();case 3:case"end":return t.stop()}}),null,null,null,Promise)}))))},iq=TP("Upload.ExcelUpload",{title:window.W_L.excel_upload,path:"upload/excel",order:8},oq);function lq(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function sq(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function cq(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?sq(Object(a),!0).forEach((function(t){uq(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):sq(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function uq(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function dq(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return mq(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return mq(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mq(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}_f.register("Upload.ExcelUpload",ha({path:"/upload/excel",title:window.W_L.excel_upload,render:e=>n.a.createElement(iq,e)}));var pq,fq,gq=()=>{var e=dq(ih.a.useForm(),1)[0],t=dq(Object(r.useState)(!1),2),a=t[0],o=t[1],i=dq(Object(r.useState)("DeepInsight"),2),l=i[0],s=i[1],c=dq(Object(r.useState)({}),2),u=c[0],d=c[1],p=dq(Object(r.useState)({}),2),f=(p[0],p[1]),g=Object(r.useCallback)(()=>{var t,a,r,n,i,l;return regeneratorRuntime.async((function(c){for(;;)switch(c.prev=c.next){case 0:return o(!0),c.prev=1,c.next=4,regeneratorRuntime.awrap(B.get("/api/ai_token"));case 4:return t=c.sent,a=t.data,c.next=8,regeneratorRuntime.awrap(fetch("/static/llm.json"));case 8:if((r=c.sent).ok){c.next=11;break}throw new Error("Failed to load local llm.json API key data");case 11:return c.next=13,regeneratorRuntime.awrap(r.json());case 13:n=c.sent,i=cq({},n),l=a.in_use&&i.hasOwnProperty(a.in_use)?a.in_use:i.in_use,Object.keys(i).forEach(e=>{a[e]&&(i[e]=cq(cq({},i[e]),a[e]))}),delete i.in_use,d(i),f(i[l].required||[]),s(l),e.setFieldsValue(i[l]),c.next=27;break;case 24:c.prev=24,c.t0=c.catch(1),bj.a.error(c.t0.message);case 27:Ft(),o(!1);case 29:case"end":return c.stop()}}),null,null,[[1,24]],Promise)},[e]);Object(r.useEffect)(()=>{g()},[g]);var b,y,v=Object(r.useCallback)((e,t)=>{var a,r;return regeneratorRuntime.async((function(n){for(;;)switch(n.prev=n.next){case 0:return o(!0),n.prev=1,a=cq(cq({},u),{},{[l]:cq(cq({},u[l]),e)}),r=Object.entries(a).reduce((e,t)=>{var a=dq(t,2),r=a[0],n=a[1],o=(n.required,lq(n,["required"]));return e[r]=o,e},{}),n.next=6,regeneratorRuntime.awrap(B.post("/api/ai_token",cq({in_use:l},r)));case 6:if(200!==n.sent.code){n.next=15;break}if(!t){n.next=11;break}return t(e),n.abrupt("return");case 11:bj.a.success(window.W_L.save_success),g(),n.next=16;break;case 15:bj.a.error(window.W_L.save_failed);case 16:n.next=22;break;case 18:n.prev=18,n.t0=n.catch(1),console.log("error22",n.t0),bj.a.error(window.W_L.save_failed);case 22:Wt&&Wt.close(),o(!1);case 24:case"end":return n.stop()}}),null,null,[[1,18]],Promise)},[l,u,g]),w=e=>{if(Wt){(()=>{try{Wt.onmessage=e=>{var t;return regeneratorRuntime.async((function(a){for(;;)switch(a.prev=a.next){case 0:"api"===(t=JSON.parse(e.data)).receiver&&(bj.a.success(t.data.content),o(!1));case 2:case"end":return a.stop()}}),null,null,null,Promise)}}catch(e){o(!1)}})(),o(!0);var t={state:200,receiver:"sender",chat_type:"test",data:{data_type:"apikey",content:"",language_mode:window.W_L.language_mode}};Wt.send(JSON.stringify(t))}else Ft()};return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"row1",style:{width:"50%",margin:"auto"}},n.a.createElement(ih.a,{form:e,layout:"vertical",disabled:a,onFinish:e=>{v(e)}},n.a.createElement(ih.a.Item,null,n.a.createElement("div",{style:{display:"flex",alignItems:"center"}},n.a.createElement("h4",{style:{marginRight:"30px"}},"AI:"),n.a.createElement(Kn.a.Group,{onChange:t=>{var a=t.target.value,r=e.getFieldsValue();d(e=>cq(cq({},e),{},{[l]:cq(cq({},e[l]),r)})),s(a),f(u[a].required||[]),e.setFieldsValue(u[a])},value:l},Object.keys(u).filter(e=>"in_use"!==e).map(e=>n.a.createElement(Kn.a,{key:e,value:e},e))))),(b=u[l]||{},y=b.required||[],Object.keys(b).filter(e=>"required"!==e).map(e=>n.a.createElement(ih.a.Item,{key:e,name:e,label:e,rules:[{required:y.includes(e),message:"".concat(window.W_L.please_enter).concat(e)}]},n.a.createElement(va.a,{placeholder:e})))),n.a.createElement(ih.a.Item,{style:{textAlign:"right"}},n.a.createElement("div",{style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"}},n.a.createElement("div",{style:{display:"flex",alignItems:"center"}},n.a.createElement(Lt.a,{style:{marginRight:"3px",color:"#2196f3"}}),n.a.createElement(h,{href:"https://holmes.bukeshiguang.com/",rel:"noopener noreferrer",target:"_blank"},window.W_L.click_here_to_get_apikey)),n.a.createElement("div",null,n.a.createElement(m.a,{loading:a,style:{marginRight:"10px"},onClick:()=>{e.validateFields().then(e=>{v(e,w)})}},window.W_L.connect_test),n.a.createElement(m.a,{loading:a,htmlType:"submit",type:"primary"},window.W_L.apply)))))))},bq=TP("Settings.OpenKey",{title:"API Key",path:"settings/OpenKey",order:9},gq);function hq(e){for(var t=e.target;t&&"A"!==t.tagName;)t=t.parentNode;if(t&&t.hasAttribute("href")&&!t.hasAttribute("download")&&!t.dataset.skipRouter&&!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)){var a=t.getAttribute("target");Object(l.isString)(a)&&"_blank"===a.toLowerCase()||(e.preventDefault(),Ca(t.href))}}_f.register("Settings.OpenKey",ha({path:"/settings/OpenKey",title:"API Key",render:e=>n.a.createElement(bq,e)})),Df.a.setDefaultIndicator(n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Loading..."))),(pq=a(1621)).keys().forEach(pq),(fq=a(1814)).keys().map(fq).map(e=>e.default).filter(l.isFunction).filter(e=>e.init).map(e=>e());var yq=a(29),vq=a.n(yq),wq=a(735),Oq=a.n(wq);a(1815);function _q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(n)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Eq(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Eq(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Eq(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}var jq={init(){window.addEventListener("offline",()=>{var e;uf.warning("Please check your Internet connection.",null,{key:"connectionNotification",duration:null}),e="connectionNotification",window.addEventListener("online",(function t(){uf.close(e),window.removeEventListener("online",t)}))})}};i.a.render(n.a.createElement((function(){var e=_q(Object(r.useState)(null),2),t=e[0],a=e[1],o=_q(Object(r.useState)(null),2),i=o[0],l=o[1];return Object(r.useEffect)(()=>{t&&t.title&&(document.title=t.title)},[t]),Object(r.useEffect)(()=>{function e(e){e.preventDefault(),l(e.error)}return document.body.addEventListener("click",hq,!1),window.addEventListener("error",e,!1),()=>{document.body.removeEventListener("click",hq,!1),window.removeEventListener("error",e,!1)}},[]),i?n.a.createElement(nt,{error:i}):("CN"===window.W_L.language_mode?Fa.a.locale("zh-cn"):Fa.a.locale("en"),n.a.createElement(vq.a,{locale:"CN"===window.W_L.language_mode?Oq.a:""},n.a.createElement(gj.Toaster,null),n.a.createElement(mt,{routes:_f.items,onRouteChange:a})))}),null),document.getElementById("application-root"),()=>{jq.init()})}]));
//# sourceMappingURL=app.js.map